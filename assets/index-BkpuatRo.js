import{T as Yh,a as yl,b as id,L as rd,c as Wi,F as ba,M as Ps,V as $n,C as cs,d as Ms,S as tn,e as Zh,P as _i,D as vs,f as jo,g as Ue,I as ad,Q as Si,h as Qh,O as cd,i as ki,j as e0,B as Ki,k as t0,l as ld,N as n0,m as s0,n as o0,o as vl,p as ud,R as Bs,q as i0,r as r0,s as a0,t as Bc,u as c0,v as Bt,w as Pn,x as zt,y as l0,z as _d,A as u0,E as St,G as _0,H as $0,J as d0,K as p0,U as ns,W as Ir,X as $d,Y as m0,Z as f0,_ as h0,$ as g0,a0 as b0,a1 as dd,a2 as y0,a3 as $_,a4 as d_,a5 as p_,a6 as m_,a7 as wl,a8 as v0,a9 as w0,aa as pn,ab as S0,ac as k0,ad as gs,ae as Ka,af as Ja,ag as Xa,ah as M0,ai as C0,aj as di,ak as $i,al as f_,am as x0,an as pd,ao as cr,ap as Sl,aq as ya,ar as P0,as as L0,at as I0,au as T0,av as h_,aw as kl,ax as E0,ay as g_}from"./three-DALeLLf3.js";(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))o(s);new MutationObserver(s=>{for(const i of s)if(i.type==="childList")for(const r of i.addedNodes)r.tagName==="LINK"&&r.rel==="modulepreload"&&o(r)}).observe(document,{childList:!0,subtree:!0});function n(s){const i={};return s.integrity&&(i.integrity=s.integrity),s.referrerPolicy&&(i.referrerPolicy=s.referrerPolicy),s.crossOrigin==="use-credentials"?i.credentials="include":s.crossOrigin==="anonymous"?i.credentials="omit":i.credentials="same-origin",i}function o(s){if(s.ep)return;s.ep=!0;const i=n(s);fetch(s.href,i)}})();const A0="release";function f(...e){switch(A0){case"debug":console.log(...e);break}}/**
* @vue/shared v3.5.22
* (c) 2018-present Yuxi (Evan) You and Vue contributors
* @license MIT
**/function cu(e){const t=Object.create(null);for(const n of e.split(","))t[n]=1;return n=>n in t}const ft={},pi=[],os=()=>{},md=()=>!1,Ya=e=>e.charCodeAt(0)===111&&e.charCodeAt(1)===110&&(e.charCodeAt(2)>122||e.charCodeAt(2)<97),lu=e=>e.startsWith("onUpdate:"),Yt=Object.assign,uu=(e,t)=>{const n=e.indexOf(t);n>-1&&e.splice(n,1)},G0=Object.prototype.hasOwnProperty,ut=(e,t)=>G0.call(e,t),Re=Array.isArray,mi=e=>Za(e)==="[object Map]",fd=e=>Za(e)==="[object Set]",Be=e=>typeof e=="function",Et=e=>typeof e=="string",So=e=>typeof e=="symbol",wt=e=>e!==null&&typeof e=="object",hd=e=>(wt(e)||Be(e))&&Be(e.then)&&Be(e.catch),gd=Object.prototype.toString,Za=e=>gd.call(e),R0=e=>Za(e).slice(8,-1),bd=e=>Za(e)==="[object Object]",_u=e=>Et(e)&&e!=="NaN"&&e[0]!=="-"&&""+parseInt(e,10)===e,Ji=cu(",key,ref,ref_for,ref_key,onVnodeBeforeMount,onVnodeMounted,onVnodeBeforeUpdate,onVnodeUpdated,onVnodeBeforeUnmount,onVnodeUnmounted"),Qa=e=>{const t=Object.create(null);return n=>t[n]||(t[n]=e(n))},O0=/-\w/g,mo=Qa(e=>e.replace(O0,t=>t.slice(1).toUpperCase())),D0=/\B([A-Z])/g,Xo=Qa(e=>e.replace(D0,"-$1").toLowerCase()),yd=Qa(e=>e.charAt(0).toUpperCase()+e.slice(1)),zc=Qa(e=>e?`on${yd(e)}`:""),lo=(e,t)=>!Object.is(e,t),Vc=(e,...t)=>{for(let n=0;n<e.length;n++)e[n](...t)},vd=(e,t,n,o=!1)=>{Object.defineProperty(e,t,{configurable:!0,enumerable:!1,writable:o,value:n})},N0=e=>{const t=parseFloat(e);return isNaN(t)?e:t},j0=e=>{const t=Et(e)?Number(e):NaN;return isNaN(t)?e:t};let b_;const ec=()=>b_||(b_=typeof globalThis<"u"?globalThis:typeof self<"u"?self:typeof window<"u"?window:typeof global<"u"?global:{});function zn(e){if(Re(e)){const t={};for(let n=0;n<e.length;n++){const o=e[n],s=Et(o)?B0(o):zn(o);if(s)for(const i in s)t[i]=s[i]}return t}else if(Et(e)||wt(e))return e}const H0=/;(?![^(]*\))/g,F0=/:([^]+)/,U0=/\/\*[^]*?\*\//g;function B0(e){const t={};return e.replace(U0,"").split(H0).forEach(n=>{if(n){const o=n.split(F0);o.length>1&&(t[o[0].trim()]=o[1].trim())}}),t}function kt(e){let t="";if(Et(e))t=e;else if(Re(e))for(let n=0;n<e.length;n++){const o=kt(e[n]);o&&(t+=o+" ")}else if(wt(e))for(const n in e)e[n]&&(t+=n+" ");return t.trim()}const z0="itemscope,allowfullscreen,formnovalidate,ismap,nomodule,novalidate,readonly",V0=cu(z0);function wd(e){return!!e||e===""}const Sd=e=>!!(e&&e.__v_isRef===!0),_e=e=>Et(e)?e:e==null?"":Re(e)||wt(e)&&(e.toString===gd||!Be(e.toString))?Sd(e)?_e(e.value):JSON.stringify(e,kd,2):String(e),kd=(e,t)=>Sd(t)?kd(e,t.value):mi(t)?{[`Map(${t.size})`]:[...t.entries()].reduce((n,[o,s],i)=>(n[qc(o,i)+" =>"]=s,n),{})}:fd(t)?{[`Set(${t.size})`]:[...t.values()].map(n=>qc(n))}:So(t)?qc(t):wt(t)&&!Re(t)&&!bd(t)?String(t):t,qc=(e,t="")=>{var n;return So(e)?`Symbol(${(n=e.description)!=null?n:t})`:e};function q0(e){return e==null?"initial":typeof e=="string"?e===""?" ":e:String(e)}/**
* @vue/reactivity v3.5.22
* (c) 2018-present Yuxi (Evan) You and Vue contributors
* @license MIT
**/let Sn;class W0{constructor(t=!1){this.detached=t,this._active=!0,this._on=0,this.effects=[],this.cleanups=[],this._isPaused=!1,this.parent=Sn,!t&&Sn&&(this.index=(Sn.scopes||(Sn.scopes=[])).push(this)-1)}get active(){return this._active}pause(){if(this._active){this._isPaused=!0;let t,n;if(this.scopes)for(t=0,n=this.scopes.length;t<n;t++)this.scopes[t].pause();for(t=0,n=this.effects.length;t<n;t++)this.effects[t].pause()}}resume(){if(this._active&&this._isPaused){this._isPaused=!1;let t,n;if(this.scopes)for(t=0,n=this.scopes.length;t<n;t++)this.scopes[t].resume();for(t=0,n=this.effects.length;t<n;t++)this.effects[t].resume()}}run(t){if(this._active){const n=Sn;try{return Sn=this,t()}finally{Sn=n}}}on(){++this._on===1&&(this.prevScope=Sn,Sn=this)}off(){this._on>0&&--this._on===0&&(Sn=this.prevScope,this.prevScope=void 0)}stop(t){if(this._active){this._active=!1;let n,o;for(n=0,o=this.effects.length;n<o;n++)this.effects[n].stop();for(this.effects.length=0,n=0,o=this.cleanups.length;n<o;n++)this.cleanups[n]();if(this.cleanups.length=0,this.scopes){for(n=0,o=this.scopes.length;n<o;n++)this.scopes[n].stop(!0);this.scopes.length=0}if(!this.detached&&this.parent&&!t){const s=this.parent.scopes.pop();s&&s!==this&&(this.parent.scopes[this.index]=s,s.index=this.index)}this.parent=void 0}}}function K0(){return Sn}let bt;const Wc=new WeakSet;class Md{constructor(t){this.fn=t,this.deps=void 0,this.depsTail=void 0,this.flags=5,this.next=void 0,this.cleanup=void 0,this.scheduler=void 0,Sn&&Sn.active&&Sn.effects.push(this)}pause(){this.flags|=64}resume(){this.flags&64&&(this.flags&=-65,Wc.has(this)&&(Wc.delete(this),this.trigger()))}notify(){this.flags&2&&!(this.flags&32)||this.flags&8||xd(this)}run(){if(!(this.flags&1))return this.fn();this.flags|=2,y_(this),Pd(this);const t=bt,n=is;bt=this,is=!0;try{return this.fn()}finally{Ld(this),bt=t,is=n,this.flags&=-3}}stop(){if(this.flags&1){for(let t=this.deps;t;t=t.nextDep)pu(t);this.deps=this.depsTail=void 0,y_(this),this.onStop&&this.onStop(),this.flags&=-2}}trigger(){this.flags&64?Wc.add(this):this.scheduler?this.scheduler():this.runIfDirty()}runIfDirty(){Ml(this)&&this.run()}get dirty(){return Ml(this)}}let Cd=0,Xi,Yi;function xd(e,t=!1){if(e.flags|=8,t){e.next=Yi,Yi=e;return}e.next=Xi,Xi=e}function $u(){Cd++}function du(){if(--Cd>0)return;if(Yi){let t=Yi;for(Yi=void 0;t;){const n=t.next;t.next=void 0,t.flags&=-9,t=n}}let e;for(;Xi;){let t=Xi;for(Xi=void 0;t;){const n=t.next;if(t.next=void 0,t.flags&=-9,t.flags&1)try{t.trigger()}catch(o){e||(e=o)}t=n}}if(e)throw e}function Pd(e){for(let t=e.deps;t;t=t.nextDep)t.version=-1,t.prevActiveLink=t.dep.activeLink,t.dep.activeLink=t}function Ld(e){let t,n=e.depsTail,o=n;for(;o;){const s=o.prevDep;o.version===-1?(o===n&&(n=s),pu(o),J0(o)):t=o,o.dep.activeLink=o.prevActiveLink,o.prevActiveLink=void 0,o=s}e.deps=t,e.depsTail=n}function Ml(e){for(let t=e.deps;t;t=t.nextDep)if(t.dep.version!==t.version||t.dep.computed&&(Id(t.dep.computed)||t.dep.version!==t.version))return!0;return!!e._dirty}function Id(e){if(e.flags&4&&!(e.flags&16)||(e.flags&=-17,e.globalVersion===lr)||(e.globalVersion=lr,!e.isSSR&&e.flags&128&&(!e.deps&&!e._dirty||!Ml(e))))return;e.flags|=2;const t=e.dep,n=bt,o=is;bt=e,is=!0;try{Pd(e);const s=e.fn(e._value);(t.version===0||lo(s,e._value))&&(e.flags|=128,e._value=s,t.version++)}catch(s){throw t.version++,s}finally{bt=n,is=o,Ld(e),e.flags&=-3}}function pu(e,t=!1){const{dep:n,prevSub:o,nextSub:s}=e;if(o&&(o.nextSub=s,e.prevSub=void 0),s&&(s.prevSub=o,e.nextSub=void 0),n.subs===e&&(n.subs=o,!o&&n.computed)){n.computed.flags&=-5;for(let i=n.computed.deps;i;i=i.nextDep)pu(i,!0)}!t&&!--n.sc&&n.map&&n.map.delete(n.key)}function J0(e){const{prevDep:t,nextDep:n}=e;t&&(t.nextDep=n,e.prevDep=void 0),n&&(n.prevDep=t,e.nextDep=void 0)}let is=!0;const Td=[];function zs(){Td.push(is),is=!1}function Vs(){const e=Td.pop();is=e===void 0?!0:e}function y_(e){const{cleanup:t}=e;if(e.cleanup=void 0,t){const n=bt;bt=void 0;try{t()}finally{bt=n}}}let lr=0;class X0{constructor(t,n){this.sub=t,this.dep=n,this.version=n.version,this.nextDep=this.prevDep=this.nextSub=this.prevSub=this.prevActiveLink=void 0}}class mu{constructor(t){this.computed=t,this.version=0,this.activeLink=void 0,this.subs=void 0,this.map=void 0,this.key=void 0,this.sc=0,this.__v_skip=!0}track(t){if(!bt||!is||bt===this.computed)return;let n=this.activeLink;if(n===void 0||n.sub!==bt)n=this.activeLink=new X0(bt,this),bt.deps?(n.prevDep=bt.depsTail,bt.depsTail.nextDep=n,bt.depsTail=n):bt.deps=bt.depsTail=n,Ed(n);else if(n.version===-1&&(n.version=this.version,n.nextDep)){const o=n.nextDep;o.prevDep=n.prevDep,n.prevDep&&(n.prevDep.nextDep=o),n.prevDep=bt.depsTail,n.nextDep=void 0,bt.depsTail.nextDep=n,bt.depsTail=n,bt.deps===n&&(bt.deps=o)}return n}trigger(t){this.version++,lr++,this.notify(t)}notify(t){$u();try{for(let n=this.subs;n;n=n.prevSub)n.sub.notify()&&n.sub.dep.notify()}finally{du()}}}function Ed(e){if(e.dep.sc++,e.sub.flags&4){const t=e.dep.computed;if(t&&!e.dep.subs){t.flags|=20;for(let o=t.deps;o;o=o.nextDep)Ed(o)}const n=e.dep.subs;n!==e&&(e.prevSub=n,n&&(n.nextSub=e)),e.dep.subs=e}}const Cl=new WeakMap,Ho=Symbol(""),xl=Symbol(""),ur=Symbol("");function en(e,t,n){if(is&&bt){let o=Cl.get(e);o||Cl.set(e,o=new Map);let s=o.get(n);s||(o.set(n,s=new mu),s.map=o,s.key=n),s.track()}}function js(e,t,n,o,s,i){const r=Cl.get(e);if(!r){lr++;return}const a=c=>{c&&c.trigger()};if($u(),t==="clear")r.forEach(a);else{const c=Re(e),l=c&&_u(n);if(c&&n==="length"){const u=Number(o);r.forEach((_,$)=>{($==="length"||$===ur||!So($)&&$>=u)&&a(_)})}else switch((n!==void 0||r.has(void 0))&&a(r.get(n)),l&&a(r.get(ur)),t){case"add":c?l&&a(r.get("length")):(a(r.get(Ho)),mi(e)&&a(r.get(xl)));break;case"delete":c||(a(r.get(Ho)),mi(e)&&a(r.get(xl)));break;case"set":mi(e)&&a(r.get(Ho));break}}du()}function si(e){const t=ct(e);return t===e?t:(en(t,"iterate",ur),Xn(e)?t:t.map(Xt))}function tc(e){return en(e=ct(e),"iterate",ur),e}const Y0={__proto__:null,[Symbol.iterator](){return Kc(this,Symbol.iterator,Xt)},concat(...e){return si(this).concat(...e.map(t=>Re(t)?si(t):t))},entries(){return Kc(this,"entries",e=>(e[1]=Xt(e[1]),e))},every(e,t){return Gs(this,"every",e,t,void 0,arguments)},filter(e,t){return Gs(this,"filter",e,t,n=>n.map(Xt),arguments)},find(e,t){return Gs(this,"find",e,t,Xt,arguments)},findIndex(e,t){return Gs(this,"findIndex",e,t,void 0,arguments)},findLast(e,t){return Gs(this,"findLast",e,t,Xt,arguments)},findLastIndex(e,t){return Gs(this,"findLastIndex",e,t,void 0,arguments)},forEach(e,t){return Gs(this,"forEach",e,t,void 0,arguments)},includes(...e){return Jc(this,"includes",e)},indexOf(...e){return Jc(this,"indexOf",e)},join(e){return si(this).join(e)},lastIndexOf(...e){return Jc(this,"lastIndexOf",e)},map(e,t){return Gs(this,"map",e,t,void 0,arguments)},pop(){return Ai(this,"pop")},push(...e){return Ai(this,"push",e)},reduce(e,...t){return v_(this,"reduce",e,t)},reduceRight(e,...t){return v_(this,"reduceRight",e,t)},shift(){return Ai(this,"shift")},some(e,t){return Gs(this,"some",e,t,void 0,arguments)},splice(...e){return Ai(this,"splice",e)},toReversed(){return si(this).toReversed()},toSorted(e){return si(this).toSorted(e)},toSpliced(...e){return si(this).toSpliced(...e)},unshift(...e){return Ai(this,"unshift",e)},values(){return Kc(this,"values",Xt)}};function Kc(e,t,n){const o=tc(e),s=o[t]();return o!==e&&!Xn(e)&&(s._next=s.next,s.next=()=>{const i=s._next();return i.done||(i.value=n(i.value)),i}),s}const Z0=Array.prototype;function Gs(e,t,n,o,s,i){const r=tc(e),a=r!==e&&!Xn(e),c=r[t];if(c!==Z0[t]){const _=c.apply(e,i);return a?Xt(_):_}let l=n;r!==e&&(a?l=function(_,$){return n.call(this,Xt(_),$,e)}:n.length>2&&(l=function(_,$){return n.call(this,_,$,e)}));const u=c.call(r,l,o);return a&&s?s(u):u}function v_(e,t,n,o){const s=tc(e);let i=n;return s!==e&&(Xn(e)?n.length>3&&(i=function(r,a,c){return n.call(this,r,a,c,e)}):i=function(r,a,c){return n.call(this,r,Xt(a),c,e)}),s[t](i,...o)}function Jc(e,t,n){const o=ct(e);en(o,"iterate",ur);const s=o[t](...n);return(s===-1||s===!1)&&bu(n[0])?(n[0]=ct(n[0]),o[t](...n)):s}function Ai(e,t,n=[]){zs(),$u();const o=ct(e)[t].apply(e,n);return du(),Vs(),o}const Q0=cu("__proto__,__v_isRef,__isVue"),Ad=new Set(Object.getOwnPropertyNames(Symbol).filter(e=>e!=="arguments"&&e!=="caller").map(e=>Symbol[e]).filter(So));function eg(e){So(e)||(e=String(e));const t=ct(this);return en(t,"has",e),t.hasOwnProperty(e)}class Gd{constructor(t=!1,n=!1){this._isReadonly=t,this._isShallow=n}get(t,n,o){if(n==="__v_skip")return t.__v_skip;const s=this._isReadonly,i=this._isShallow;if(n==="__v_isReactive")return!s;if(n==="__v_isReadonly")return s;if(n==="__v_isShallow")return i;if(n==="__v_raw")return o===(s?i?ug:Nd:i?Dd:Od).get(t)||Object.getPrototypeOf(t)===Object.getPrototypeOf(o)?t:void 0;const r=Re(t);if(!s){let c;if(r&&(c=Y0[n]))return c;if(n==="hasOwnProperty")return eg}const a=Reflect.get(t,n,cn(t)?t:o);if((So(n)?Ad.has(n):Q0(n))||(s||en(t,"get",n),i))return a;if(cn(a)){const c=r&&_u(n)?a:a.value;return s&&wt(c)?Ll(c):c}return wt(a)?s?Ll(a):hu(a):a}}class Rd extends Gd{constructor(t=!1){super(!1,t)}set(t,n,o,s){let i=t[n];if(!this._isShallow){const c=fo(i);if(!Xn(o)&&!fo(o)&&(i=ct(i),o=ct(o)),!Re(t)&&cn(i)&&!cn(o))return c||(i.value=o),!0}const r=Re(t)&&_u(n)?Number(n)<t.length:ut(t,n),a=Reflect.set(t,n,o,cn(t)?t:s);return t===ct(s)&&(r?lo(o,i)&&js(t,"set",n,o):js(t,"add",n,o)),a}deleteProperty(t,n){const o=ut(t,n);t[n];const s=Reflect.deleteProperty(t,n);return s&&o&&js(t,"delete",n,void 0),s}has(t,n){const o=Reflect.has(t,n);return(!So(n)||!Ad.has(n))&&en(t,"has",n),o}ownKeys(t){return en(t,"iterate",Re(t)?"length":Ho),Reflect.ownKeys(t)}}class tg extends Gd{constructor(t=!1){super(!0,t)}set(t,n){return!0}deleteProperty(t,n){return!0}}const ng=new Rd,sg=new tg,og=new Rd(!0);const Pl=e=>e,Br=e=>Reflect.getPrototypeOf(e);function ig(e,t,n){return function(...o){const s=this.__v_raw,i=ct(s),r=mi(i),a=e==="entries"||e===Symbol.iterator&&r,c=e==="keys"&&r,l=s[e](...o),u=n?Pl:t?va:Xt;return!t&&en(i,"iterate",c?xl:Ho),{next(){const{value:_,done:$}=l.next();return $?{value:_,done:$}:{value:a?[u(_[0]),u(_[1])]:u(_),done:$}},[Symbol.iterator](){return this}}}}function zr(e){return function(...t){return e==="delete"?!1:e==="clear"?void 0:this}}function rg(e,t){const n={get(s){const i=this.__v_raw,r=ct(i),a=ct(s);e||(lo(s,a)&&en(r,"get",s),en(r,"get",a));const{has:c}=Br(r),l=t?Pl:e?va:Xt;if(c.call(r,s))return l(i.get(s));if(c.call(r,a))return l(i.get(a));i!==r&&i.get(s)},get size(){const s=this.__v_raw;return!e&&en(ct(s),"iterate",Ho),s.size},has(s){const i=this.__v_raw,r=ct(i),a=ct(s);return e||(lo(s,a)&&en(r,"has",s),en(r,"has",a)),s===a?i.has(s):i.has(s)||i.has(a)},forEach(s,i){const r=this,a=r.__v_raw,c=ct(a),l=t?Pl:e?va:Xt;return!e&&en(c,"iterate",Ho),a.forEach((u,_)=>s.call(i,l(u),l(_),r))}};return Yt(n,e?{add:zr("add"),set:zr("set"),delete:zr("delete"),clear:zr("clear")}:{add(s){!t&&!Xn(s)&&!fo(s)&&(s=ct(s));const i=ct(this);return Br(i).has.call(i,s)||(i.add(s),js(i,"add",s,s)),this},set(s,i){!t&&!Xn(i)&&!fo(i)&&(i=ct(i));const r=ct(this),{has:a,get:c}=Br(r);let l=a.call(r,s);l||(s=ct(s),l=a.call(r,s));const u=c.call(r,s);return r.set(s,i),l?lo(i,u)&&js(r,"set",s,i):js(r,"add",s,i),this},delete(s){const i=ct(this),{has:r,get:a}=Br(i);let c=r.call(i,s);c||(s=ct(s),c=r.call(i,s)),a&&a.call(i,s);const l=i.delete(s);return c&&js(i,"delete",s,void 0),l},clear(){const s=ct(this),i=s.size!==0,r=s.clear();return i&&js(s,"clear",void 0,void 0),r}}),["keys","values","entries",Symbol.iterator].forEach(s=>{n[s]=ig(s,e,t)}),n}function fu(e,t){const n=rg(e,t);return(o,s,i)=>s==="__v_isReactive"?!e:s==="__v_isReadonly"?e:s==="__v_raw"?o:Reflect.get(ut(n,s)&&s in o?n:o,s,i)}const ag={get:fu(!1,!1)},cg={get:fu(!1,!0)},lg={get:fu(!0,!1)};const Od=new WeakMap,Dd=new WeakMap,Nd=new WeakMap,ug=new WeakMap;function _g(e){switch(e){case"Object":case"Array":return 1;case"Map":case"Set":case"WeakMap":case"WeakSet":return 2;default:return 0}}function $g(e){return e.__v_skip||!Object.isExtensible(e)?0:_g(R0(e))}function hu(e){return fo(e)?e:gu(e,!1,ng,ag,Od)}function dg(e){return gu(e,!1,og,cg,Dd)}function Ll(e){return gu(e,!0,sg,lg,Nd)}function gu(e,t,n,o,s){if(!wt(e)||e.__v_raw&&!(t&&e.__v_isReactive))return e;const i=$g(e);if(i===0)return e;const r=s.get(e);if(r)return r;const a=new Proxy(e,i===2?o:n);return s.set(e,a),a}function fi(e){return fo(e)?fi(e.__v_raw):!!(e&&e.__v_isReactive)}function fo(e){return!!(e&&e.__v_isReadonly)}function Xn(e){return!!(e&&e.__v_isShallow)}function bu(e){return e?!!e.__v_raw:!1}function ct(e){const t=e&&e.__v_raw;return t?ct(t):e}function pg(e){return!ut(e,"__v_skip")&&Object.isExtensible(e)&&vd(e,"__v_skip",!0),e}const Xt=e=>wt(e)?hu(e):e,va=e=>wt(e)?Ll(e):e;function cn(e){return e?e.__v_isRef===!0:!1}function oe(e){return mg(e,!1)}function mg(e,t){return cn(e)?e:new fg(e,t)}class fg{constructor(t,n){this.dep=new mu,this.__v_isRef=!0,this.__v_isShallow=!1,this._rawValue=n?t:ct(t),this._value=n?t:Xt(t),this.__v_isShallow=n}get value(){return this.dep.track(),this._value}set value(t){const n=this._rawValue,o=this.__v_isShallow||Xn(t)||fo(t);t=o?t:ct(t),lo(t,n)&&(this._rawValue=t,this._value=o?t:Xt(t),this.dep.trigger())}}function ye(e){return cn(e)?e.value:e}const hg={get:(e,t,n)=>t==="__v_raw"?e:ye(Reflect.get(e,t,n)),set:(e,t,n,o)=>{const s=e[t];return cn(s)&&!cn(n)?(s.value=n,!0):Reflect.set(e,t,n,o)}};function jd(e){return fi(e)?e:new Proxy(e,hg)}class gg{constructor(t,n,o){this.fn=t,this.setter=n,this._value=void 0,this.dep=new mu(this),this.__v_isRef=!0,this.deps=void 0,this.depsTail=void 0,this.flags=16,this.globalVersion=lr-1,this.next=void 0,this.effect=this,this.__v_isReadonly=!n,this.isSSR=o}notify(){if(this.flags|=16,!(this.flags&8)&&bt!==this)return xd(this,!0),!0}get value(){const t=this.dep.track();return Id(this),t&&(t.version=this.dep.version),this._value}set value(t){this.setter&&this.setter(t)}}function bg(e,t,n=!1){let o,s;return Be(e)?o=e:(o=e.get,s=e.set),new gg(o,s,n)}const Vr={},wa=new WeakMap;let To;function yg(e,t=!1,n=To){if(n){let o=wa.get(n);o||wa.set(n,o=[]),o.push(e)}}function vg(e,t,n=ft){const{immediate:o,deep:s,once:i,scheduler:r,augmentJob:a,call:c}=n,l=w=>s?w:Xn(w)||s===!1||s===0?Hs(w,1):Hs(w);let u,_,$,d,p=!1,b=!1;if(cn(e)?(_=()=>e.value,p=Xn(e)):fi(e)?(_=()=>l(e),p=!0):Re(e)?(b=!0,p=e.some(w=>fi(w)||Xn(w)),_=()=>e.map(w=>{if(cn(w))return w.value;if(fi(w))return l(w);if(Be(w))return c?c(w,2):w()})):Be(e)?t?_=c?()=>c(e,2):e:_=()=>{if($){zs();try{$()}finally{Vs()}}const w=To;To=u;try{return c?c(e,3,[d]):e(d)}finally{To=w}}:_=os,t&&s){const w=_,k=s===!0?1/0:s;_=()=>Hs(w(),k)}const g=K0(),m=()=>{u.stop(),g&&g.active&&uu(g.effects,u)};if(i&&t){const w=t;t=(...k)=>{w(...k),m()}}let v=b?new Array(e.length).fill(Vr):Vr;const y=w=>{if(!(!(u.flags&1)||!u.dirty&&!w))if(t){const k=u.run();if(s||p||(b?k.some((I,P)=>lo(I,v[P])):lo(k,v))){$&&$();const I=To;To=u;try{const P=[k,v===Vr?void 0:b&&v[0]===Vr?[]:v,d];v=k,c?c(t,3,P):t(...P)}finally{To=I}}}else u.run()};return a&&a(y),u=new Md(_),u.scheduler=r?()=>r(y,!1):y,d=w=>yg(w,!1,u),$=u.onStop=()=>{const w=wa.get(u);if(w){if(c)c(w,4);else for(const k of w)k();wa.delete(u)}},t?o?y(!0):v=u.run():r?r(y.bind(null,!0),!0):u.run(),m.pause=u.pause.bind(u),m.resume=u.resume.bind(u),m.stop=m,m}function Hs(e,t=1/0,n){if(t<=0||!wt(e)||e.__v_skip||(n=n||new Map,(n.get(e)||0)>=t))return e;if(n.set(e,t),t--,cn(e))Hs(e.value,t,n);else if(Re(e))for(let o=0;o<e.length;o++)Hs(e[o],t,n);else if(fd(e)||mi(e))e.forEach(o=>{Hs(o,t,n)});else if(bd(e)){for(const o in e)Hs(e[o],t,n);for(const o of Object.getOwnPropertySymbols(e))Object.prototype.propertyIsEnumerable.call(e,o)&&Hs(e[o],t,n)}return e}/**
* @vue/runtime-core v3.5.22
* (c) 2018-present Yuxi (Evan) You and Vue contributors
* @license MIT
**/function Tr(e,t,n,o){try{return o?e(...o):e()}catch(s){nc(s,t,n)}}function ls(e,t,n,o){if(Be(e)){const s=Tr(e,t,n,o);return s&&hd(s)&&s.catch(i=>{nc(i,t,n)}),s}if(Re(e)){const s=[];for(let i=0;i<e.length;i++)s.push(ls(e[i],t,n,o));return s}}function nc(e,t,n,o=!0){const s=t?t.vnode:null,{errorHandler:i,throwUnhandledErrorInProduction:r}=t&&t.appContext.config||ft;if(t){let a=t.parent;const c=t.proxy,l=`https://vuejs.org/error-reference/#runtime-${n}`;for(;a;){const u=a.ec;if(u){for(let _=0;_<u.length;_++)if(u[_](e,c,l)===!1)return}a=a.parent}if(i){zs(),Tr(i,null,10,[e,c,l]),Vs();return}}wg(e,n,s,o,r)}function wg(e,t,n,o=!0,s=!1){if(s)throw e;console.error(e)}const mn=[];let fs=-1;const hi=[];let eo=null,ri=0;const Hd=Promise.resolve();let Sa=null;function _r(e){const t=Sa||Hd;return e?t.then(this?e.bind(this):e):t}function Sg(e){let t=fs+1,n=mn.length;for(;t<n;){const o=t+n>>>1,s=mn[o],i=$r(s);i<e||i===e&&s.flags&2?t=o+1:n=o}return t}function yu(e){if(!(e.flags&1)){const t=$r(e),n=mn[mn.length-1];!n||!(e.flags&2)&&t>=$r(n)?mn.push(e):mn.splice(Sg(t),0,e),e.flags|=1,Fd()}}function Fd(){Sa||(Sa=Hd.then(zd))}function Ud(e){Re(e)?hi.push(...e):eo&&e.id===-1?eo.splice(ri+1,0,e):e.flags&1||(hi.push(e),e.flags|=1),Fd()}function w_(e,t,n=fs+1){for(;n<mn.length;n++){const o=mn[n];if(o&&o.flags&2){if(e&&o.id!==e.uid)continue;mn.splice(n,1),n--,o.flags&4&&(o.flags&=-2),o(),o.flags&4||(o.flags&=-2)}}}function Bd(e){if(hi.length){const t=[...new Set(hi)].sort((n,o)=>$r(n)-$r(o));if(hi.length=0,eo){eo.push(...t);return}for(eo=t,ri=0;ri<eo.length;ri++){const n=eo[ri];n.flags&4&&(n.flags&=-2),n.flags&8||n(),n.flags&=-2}eo=null,ri=0}}const $r=e=>e.id==null?e.flags&2?-1:1/0:e.id;function zd(e){try{for(fs=0;fs<mn.length;fs++){const t=mn[fs];t&&!(t.flags&8)&&(t.flags&4&&(t.flags&=-2),Tr(t,t.i,t.i?15:14),t.flags&4||(t.flags&=-2))}}finally{for(;fs<mn.length;fs++){const t=mn[fs];t&&(t.flags&=-2)}fs=-1,mn.length=0,Bd(),Sa=null,(mn.length||hi.length)&&zd()}}let qn=null,Vd=null;function ka(e){const t=qn;return qn=e,Vd=e&&e.type.__scopeId||null,t}function qd(e,t=qn,n){if(!t||e._n)return e;const o=(...s)=>{o._d&&xa(-1);const i=ka(t);let r;try{r=e(...s)}finally{ka(i),o._d&&xa(1)}return r};return o._n=!0,o._c=!0,o._d=!0,o}function Wd(e,t){if(qn===null)return e;const n=ac(qn),o=e.dirs||(e.dirs=[]);for(let s=0;s<t.length;s++){let[i,r,a,c=ft]=t[s];i&&(Be(i)&&(i={mounted:i,updated:i}),i.deep&&Hs(r),o.push({dir:i,instance:n,value:r,oldValue:void 0,arg:a,modifiers:c}))}return e}function Co(e,t,n,o){const s=e.dirs,i=t&&t.dirs;for(let r=0;r<s.length;r++){const a=s[r];i&&(a.oldValue=i[r].value);let c=a.dir[o];c&&(zs(),ls(c,n,8,[e.el,a,e,t]),Vs())}}const Kd=Symbol("_vte"),Jd=e=>e.__isTeleport,Zi=e=>e&&(e.disabled||e.disabled===""),S_=e=>e&&(e.defer||e.defer===""),k_=e=>typeof SVGElement<"u"&&e instanceof SVGElement,M_=e=>typeof MathMLElement=="function"&&e instanceof MathMLElement,Il=(e,t)=>{const n=e&&e.to;return Et(n)?t?t(n):null:n},Xd={name:"Teleport",__isTeleport:!0,process(e,t,n,o,s,i,r,a,c,l){const{mc:u,pc:_,pbc:$,o:{insert:d,querySelector:p,createText:b,createComment:g}}=l,m=Zi(t.props);let{shapeFlag:v,children:y,dynamicChildren:w}=t;if(e==null){const k=t.el=b(""),I=t.anchor=b("");d(k,n,o),d(I,n,o);const P=(x,D)=>{v&16&&u(y,x,D,s,i,r,a,c)},T=()=>{const x=t.target=Il(t.props,p),D=Zd(x,t,b,d);x&&(r!=="svg"&&k_(x)?r="svg":r!=="mathml"&&M_(x)&&(r="mathml"),s&&s.isCE&&(s.ce._teleportTargets||(s.ce._teleportTargets=new Set)).add(x),m||(P(x,D),aa(t,!1)))};m&&(P(n,I),aa(t,!0)),S_(t.props)?(t.el.__isMounted=!1,dn(()=>{T(),delete t.el.__isMounted},i)):T()}else{if(S_(t.props)&&e.el.__isMounted===!1){dn(()=>{Xd.process(e,t,n,o,s,i,r,a,c,l)},i);return}t.el=e.el,t.targetStart=e.targetStart;const k=t.anchor=e.anchor,I=t.target=e.target,P=t.targetAnchor=e.targetAnchor,T=Zi(e.props),x=T?n:I,D=T?k:P;if(r==="svg"||k_(I)?r="svg":(r==="mathml"||M_(I))&&(r="mathml"),w?($(e.dynamicChildren,w,x,s,i,r,a),ku(e,t,!0)):c||_(e,t,x,D,s,i,r,a,!1),m)T?t.props&&e.props&&t.props.to!==e.props.to&&(t.props.to=e.props.to):qr(t,n,k,l,1);else if((t.props&&t.props.to)!==(e.props&&e.props.to)){const U=t.target=Il(t.props,p);U&&qr(t,U,null,l,0)}else T&&qr(t,I,P,l,1);aa(t,m)}},remove(e,t,n,{um:o,o:{remove:s}},i){const{shapeFlag:r,children:a,anchor:c,targetStart:l,targetAnchor:u,target:_,props:$}=e;if(_&&(s(l),s(u)),i&&s(c),r&16){const d=i||!Zi($);for(let p=0;p<a.length;p++){const b=a[p];o(b,t,n,d,!!b.dynamicChildren)}}},move:qr,hydrate:kg};function qr(e,t,n,{o:{insert:o},m:s},i=2){i===0&&o(e.targetAnchor,t,n);const{el:r,anchor:a,shapeFlag:c,children:l,props:u}=e,_=i===2;if(_&&o(r,t,n),(!_||Zi(u))&&c&16)for(let $=0;$<l.length;$++)s(l[$],t,n,2);_&&o(a,t,n)}function kg(e,t,n,o,s,i,{o:{nextSibling:r,parentNode:a,querySelector:c,insert:l,createText:u}},_){function $(b,g,m,v){g.anchor=_(r(b),g,a(b),n,o,s,i),g.targetStart=m,g.targetAnchor=v}const d=t.target=Il(t.props,c),p=Zi(t.props);if(d){const b=d._lpa||d.firstChild;if(t.shapeFlag&16)if(p)$(e,t,b,b&&r(b));else{t.anchor=r(e);let g=b;for(;g;){if(g&&g.nodeType===8){if(g.data==="teleport start anchor")t.targetStart=g;else if(g.data==="teleport anchor"){t.targetAnchor=g,d._lpa=t.targetAnchor&&r(t.targetAnchor);break}}g=r(g)}t.targetAnchor||Zd(d,t,u,l),_(b&&r(b),t,d,n,o,s,i)}aa(t,p)}else p&&t.shapeFlag&16&&$(e,t,e,r(e));return t.anchor&&r(t.anchor)}const Yd=Xd;function aa(e,t){const n=e.ctx;if(n&&n.ut){let o,s;for(t?(o=e.el,s=e.anchor):(o=e.targetStart,s=e.targetAnchor);o&&o!==s;)o.nodeType===1&&o.setAttribute("data-v-owner",n.uid),o=o.nextSibling;n.ut()}}function Zd(e,t,n,o){const s=t.targetStart=n(""),i=t.targetAnchor=n("");return s[Kd]=i,e&&(o(s,e),o(i,e)),i}const Ds=Symbol("_leaveCb"),Wr=Symbol("_enterCb");function Mg(){const e={isMounted:!1,isLeaving:!1,isUnmounting:!1,leavingVNodes:new Map};return gn(()=>{e.isMounted=!0}),Ls(()=>{e.isUnmounting=!0}),e}const Un=[Function,Array],Qd={mode:String,appear:Boolean,persisted:Boolean,onBeforeEnter:Un,onEnter:Un,onAfterEnter:Un,onEnterCancelled:Un,onBeforeLeave:Un,onLeave:Un,onAfterLeave:Un,onLeaveCancelled:Un,onBeforeAppear:Un,onAppear:Un,onAfterAppear:Un,onAppearCancelled:Un},ep=e=>{const t=e.subTree;return t.component?ep(t.component):t},Cg={name:"BaseTransition",props:Qd,setup(e,{slots:t}){const n=Cu(),o=Mg();return()=>{const s=t.default&&sp(t.default(),!0);if(!s||!s.length)return;const i=tp(s),r=ct(e),{mode:a}=r;if(o.isLeaving)return Xc(i);const c=C_(i);if(!c)return Xc(i);let l=Tl(c,r,o,n,_=>l=_);c.type!==fn&&dr(c,l);let u=n.subTree&&C_(n.subTree);if(u&&u.type!==fn&&!Ro(u,c)&&ep(n).type!==fn){let _=Tl(u,r,o,n);if(dr(u,_),a==="out-in"&&c.type!==fn)return o.isLeaving=!0,_.afterLeave=()=>{o.isLeaving=!1,n.job.flags&8||n.update(),delete _.afterLeave,u=void 0},Xc(i);a==="in-out"&&c.type!==fn?_.delayLeave=($,d,p)=>{const b=np(o,u);b[String(u.key)]=u,$[Ds]=()=>{d(),$[Ds]=void 0,delete l.delayedLeave,u=void 0},l.delayedLeave=()=>{p(),delete l.delayedLeave,u=void 0}}:u=void 0}else u&&(u=void 0);return i}}};function tp(e){let t=e[0];if(e.length>1){for(const n of e)if(n.type!==fn){t=n;break}}return t}const xg=Cg;function np(e,t){const{leavingVNodes:n}=e;let o=n.get(t.type);return o||(o=Object.create(null),n.set(t.type,o)),o}function Tl(e,t,n,o,s){const{appear:i,mode:r,persisted:a=!1,onBeforeEnter:c,onEnter:l,onAfterEnter:u,onEnterCancelled:_,onBeforeLeave:$,onLeave:d,onAfterLeave:p,onLeaveCancelled:b,onBeforeAppear:g,onAppear:m,onAfterAppear:v,onAppearCancelled:y}=t,w=String(e.key),k=np(n,e),I=(x,D)=>{x&&ls(x,o,9,D)},P=(x,D)=>{const U=D[1];I(x,D),Re(x)?x.every(L=>L.length<=1)&&U():x.length<=1&&U()},T={mode:r,persisted:a,beforeEnter(x){let D=c;if(!n.isMounted)if(i)D=g||c;else return;x[Ds]&&x[Ds](!0);const U=k[w];U&&Ro(e,U)&&U.el[Ds]&&U.el[Ds](),I(D,[x])},enter(x){let D=l,U=u,L=_;if(!n.isMounted)if(i)D=m||l,U=v||u,L=y||_;else return;let K=!1;const ge=x[Wr]=ce=>{K||(K=!0,ce?I(L,[x]):I(U,[x]),T.delayedLeave&&T.delayedLeave(),x[Wr]=void 0)};D?P(D,[x,ge]):ge()},leave(x,D){const U=String(e.key);if(x[Wr]&&x[Wr](!0),n.isUnmounting)return D();I($,[x]);let L=!1;const K=x[Ds]=ge=>{L||(L=!0,D(),ge?I(b,[x]):I(p,[x]),x[Ds]=void 0,k[U]===e&&delete k[U])};k[U]=e,d?P(d,[x,K]):K()},clone(x){const D=Tl(x,t,n,o,s);return s&&s(D),D}};return T}function Xc(e){if(sc(e))return e=ho(e),e.children=null,e}function C_(e){if(!sc(e))return Jd(e.type)&&e.children?tp(e.children):e;if(e.component)return e.component.subTree;const{shapeFlag:t,children:n}=e;if(n){if(t&16)return n[0];if(t&32&&Be(n.default))return n.default()}}function dr(e,t){e.shapeFlag&6&&e.component?(e.transition=t,dr(e.component.subTree,t)):e.shapeFlag&128?(e.ssContent.transition=t.clone(e.ssContent),e.ssFallback.transition=t.clone(e.ssFallback)):e.transition=t}function sp(e,t=!1,n){let o=[],s=0;for(let i=0;i<e.length;i++){let r=e[i];const a=n==null?r.key:String(n)+String(r.key!=null?r.key:i);r.type===ht?(r.patchFlag&128&&s++,o=o.concat(sp(r.children,t,a))):(t||r.type!==fn)&&o.push(a!=null?ho(r,{key:a}):r)}if(s>1)for(let i=0;i<o.length;i++)o[i].patchFlag=-2;return o}function op(e){e.ids=[e.ids[0]+e.ids[2]+++"-",0,0]}const Ma=new WeakMap;function Qi(e,t,n,o,s=!1){if(Re(e)){e.forEach((p,b)=>Qi(p,t&&(Re(t)?t[b]:t),n,o,s));return}if(er(o)&&!s){o.shapeFlag&512&&o.type.__asyncResolved&&o.component.subTree.component&&Qi(e,t,n,o.component.subTree);return}const i=o.shapeFlag&4?ac(o.component):o.el,r=s?null:i,{i:a,r:c}=e,l=t&&t.r,u=a.refs===ft?a.refs={}:a.refs,_=a.setupState,$=ct(_),d=_===ft?md:p=>ut($,p);if(l!=null&&l!==c){if(x_(t),Et(l))u[l]=null,d(l)&&(_[l]=null);else if(cn(l)){l.value=null;const p=t;p.k&&(u[p.k]=null)}}if(Be(c))Tr(c,a,12,[r,u]);else{const p=Et(c),b=cn(c);if(p||b){const g=()=>{if(e.f){const m=p?d(c)?_[c]:u[c]:c.value;if(s)Re(m)&&uu(m,i);else if(Re(m))m.includes(i)||m.push(i);else if(p)u[c]=[i],d(c)&&(_[c]=u[c]);else{const v=[i];c.value=v,e.k&&(u[e.k]=v)}}else p?(u[c]=r,d(c)&&(_[c]=r)):b&&(c.value=r,e.k&&(u[e.k]=r))};if(r){const m=()=>{g(),Ma.delete(e)};m.id=-1,Ma.set(e,m),dn(m,n)}else x_(e),g()}}}function x_(e){const t=Ma.get(e);t&&(t.flags|=8,Ma.delete(e))}ec().requestIdleCallback;ec().cancelIdleCallback;const er=e=>!!e.type.__asyncLoader,sc=e=>e.type.__isKeepAlive;function Pg(e,t){ip(e,"a",t)}function Lg(e,t){ip(e,"da",t)}function ip(e,t,n=hn){const o=e.__wdc||(e.__wdc=()=>{let s=n;for(;s;){if(s.isDeactivated)return;s=s.parent}return e()});if(oc(t,o,n),n){let s=n.parent;for(;s&&s.parent;)sc(s.parent.vnode)&&Ig(o,t,n,s),s=s.parent}}function Ig(e,t,n,o){const s=oc(t,e,o,!0);vu(()=>{uu(o[t],s)},n)}function oc(e,t,n=hn,o=!1){if(n){const s=n[e]||(n[e]=[]),i=t.__weh||(t.__weh=(...r)=>{zs();const a=Er(n),c=ls(t,n,e,r);return a(),Vs(),c});return o?s.unshift(i):s.push(i),i}}const qs=e=>(t,n=hn)=>{(!mr||e==="sp")&&oc(e,(...o)=>t(...o),n)},Tg=qs("bm"),gn=qs("m"),rp=qs("bu"),Eg=qs("u"),Ls=qs("bum"),vu=qs("um"),Ag=qs("sp"),Gg=qs("rtg"),Rg=qs("rtc");function Og(e,t=hn){oc("ec",e,t)}const Dg=Symbol.for("v-ndc");function Yn(e,t,n,o){let s;const i=n,r=Re(e);if(r||Et(e)){const a=r&&fi(e);let c=!1,l=!1;a&&(c=!Xn(e),l=fo(e),e=tc(e)),s=new Array(e.length);for(let u=0,_=e.length;u<_;u++)s[u]=t(c?l?va(Xt(e[u])):Xt(e[u]):e[u],u,void 0,i)}else if(typeof e=="number"){s=new Array(e);for(let a=0;a<e;a++)s[a]=t(a+1,a,void 0,i)}else if(wt(e))if(e[Symbol.iterator])s=Array.from(e,(a,c)=>t(a,c,void 0,i));else{const a=Object.keys(e);s=new Array(a.length);for(let c=0,l=a.length;c<l;c++){const u=a[c];s[c]=t(e[u],u,c,i)}}else s=[];return s}const El=e=>e?Mp(e)?ac(e):El(e.parent):null,tr=Yt(Object.create(null),{$:e=>e,$el:e=>e.vnode.el,$data:e=>e.data,$props:e=>e.props,$attrs:e=>e.attrs,$slots:e=>e.slots,$refs:e=>e.refs,$parent:e=>El(e.parent),$root:e=>El(e.root),$host:e=>e.ce,$emit:e=>e.emit,$options:e=>cp(e),$forceUpdate:e=>e.f||(e.f=()=>{yu(e.update)}),$nextTick:e=>e.n||(e.n=_r.bind(e.proxy)),$watch:e=>ib.bind(e)}),Yc=(e,t)=>e!==ft&&!e.__isScriptSetup&&ut(e,t),Ng={get({_:e},t){if(t==="__v_skip")return!0;const{ctx:n,setupState:o,data:s,props:i,accessCache:r,type:a,appContext:c}=e;let l;if(t[0]!=="$"){const d=r[t];if(d!==void 0)switch(d){case 1:return o[t];case 2:return s[t];case 4:return n[t];case 3:return i[t]}else{if(Yc(o,t))return r[t]=1,o[t];if(s!==ft&&ut(s,t))return r[t]=2,s[t];if((l=e.propsOptions[0])&&ut(l,t))return r[t]=3,i[t];if(n!==ft&&ut(n,t))return r[t]=4,n[t];Al&&(r[t]=0)}}const u=tr[t];let _,$;if(u)return t==="$attrs"&&en(e.attrs,"get",""),u(e);if((_=a.__cssModules)&&(_=_[t]))return _;if(n!==ft&&ut(n,t))return r[t]=4,n[t];if($=c.config.globalProperties,ut($,t))return $[t]},set({_:e},t,n){const{data:o,setupState:s,ctx:i}=e;return Yc(s,t)?(s[t]=n,!0):o!==ft&&ut(o,t)?(o[t]=n,!0):ut(e.props,t)||t[0]==="$"&&t.slice(1)in e?!1:(i[t]=n,!0)},has({_:{data:e,setupState:t,accessCache:n,ctx:o,appContext:s,propsOptions:i,type:r}},a){let c,l;return!!(n[a]||e!==ft&&a[0]!=="$"&&ut(e,a)||Yc(t,a)||(c=i[0])&&ut(c,a)||ut(o,a)||ut(tr,a)||ut(s.config.globalProperties,a)||(l=r.__cssModules)&&l[a])},defineProperty(e,t,n){return n.get!=null?e._.accessCache[t]=0:ut(n,"value")&&this.set(e,t,n.value,null),Reflect.defineProperty(e,t,n)}};function P_(e){return Re(e)?e.reduce((t,n)=>(t[n]=null,t),{}):e}let Al=!0;function jg(e){const t=cp(e),n=e.proxy,o=e.ctx;Al=!1,t.beforeCreate&&L_(t.beforeCreate,e,"bc");const{data:s,computed:i,methods:r,watch:a,provide:c,inject:l,created:u,beforeMount:_,mounted:$,beforeUpdate:d,updated:p,activated:b,deactivated:g,beforeDestroy:m,beforeUnmount:v,destroyed:y,unmounted:w,render:k,renderTracked:I,renderTriggered:P,errorCaptured:T,serverPrefetch:x,expose:D,inheritAttrs:U,components:L,directives:K,filters:ge}=t;if(l&&Hg(l,o,null),r)for(const q in r){const G=r[q];Be(G)&&(o[q]=G.bind(n))}if(s){const q=s.call(n,n);wt(q)&&(e.data=hu(q))}if(Al=!0,i)for(const q in i){const G=i[q],J=Be(G)?G.bind(n,n):Be(G.get)?G.get.bind(n,n):os,F=!Be(G)&&Be(G.set)?G.set.bind(n):os,O=Je({get:J,set:F});Object.defineProperty(o,q,{enumerable:!0,configurable:!0,get:()=>O.value,set:X=>O.value=X})}if(a)for(const q in a)ap(a[q],o,n,q);if(c){const q=Be(c)?c.call(n):c;Reflect.ownKeys(q).forEach(G=>{qg(G,q[G])})}u&&L_(u,e,"c");function he(q,G){Re(G)?G.forEach(J=>q(J.bind(n))):G&&q(G.bind(n))}if(he(Tg,_),he(gn,$),he(rp,d),he(Eg,p),he(Pg,b),he(Lg,g),he(Og,T),he(Rg,I),he(Gg,P),he(Ls,v),he(vu,w),he(Ag,x),Re(D))if(D.length){const q=e.exposed||(e.exposed={});D.forEach(G=>{Object.defineProperty(q,G,{get:()=>n[G],set:J=>n[G]=J,enumerable:!0})})}else e.exposed||(e.exposed={});k&&e.render===os&&(e.render=k),U!=null&&(e.inheritAttrs=U),L&&(e.components=L),K&&(e.directives=K),x&&op(e)}function Hg(e,t,n=os){Re(e)&&(e=Gl(e));for(const o in e){const s=e[o];let i;wt(s)?"default"in s?i=ca(s.from||o,s.default,!0):i=ca(s.from||o):i=ca(s),cn(i)?Object.defineProperty(t,o,{enumerable:!0,configurable:!0,get:()=>i.value,set:r=>i.value=r}):t[o]=i}}function L_(e,t,n){ls(Re(e)?e.map(o=>o.bind(t.proxy)):e.bind(t.proxy),t,n)}function ap(e,t,n,o){let s=o.includes(".")?yp(n,o):()=>n[o];if(Et(e)){const i=t[e];Be(i)&&Tn(s,i)}else if(Be(e))Tn(s,e.bind(n));else if(wt(e))if(Re(e))e.forEach(i=>ap(i,t,n,o));else{const i=Be(e.handler)?e.handler.bind(n):t[e.handler];Be(i)&&Tn(s,i,e)}}function cp(e){const t=e.type,{mixins:n,extends:o}=t,{mixins:s,optionsCache:i,config:{optionMergeStrategies:r}}=e.appContext,a=i.get(t);let c;return a?c=a:!s.length&&!n&&!o?c=t:(c={},s.length&&s.forEach(l=>Ca(c,l,r,!0)),Ca(c,t,r)),wt(t)&&i.set(t,c),c}function Ca(e,t,n,o=!1){const{mixins:s,extends:i}=t;i&&Ca(e,i,n,!0),s&&s.forEach(r=>Ca(e,r,n,!0));for(const r in t)if(!(o&&r==="expose")){const a=Fg[r]||n&&n[r];e[r]=a?a(e[r],t[r]):t[r]}return e}const Fg={data:I_,props:T_,emits:T_,methods:Hi,computed:Hi,beforeCreate:_n,created:_n,beforeMount:_n,mounted:_n,beforeUpdate:_n,updated:_n,beforeDestroy:_n,beforeUnmount:_n,destroyed:_n,unmounted:_n,activated:_n,deactivated:_n,errorCaptured:_n,serverPrefetch:_n,components:Hi,directives:Hi,watch:Bg,provide:I_,inject:Ug};function I_(e,t){return t?e?function(){return Yt(Be(e)?e.call(this,this):e,Be(t)?t.call(this,this):t)}:t:e}function Ug(e,t){return Hi(Gl(e),Gl(t))}function Gl(e){if(Re(e)){const t={};for(let n=0;n<e.length;n++)t[e[n]]=e[n];return t}return e}function _n(e,t){return e?[...new Set([].concat(e,t))]:t}function Hi(e,t){return e?Yt(Object.create(null),e,t):t}function T_(e,t){return e?Re(e)&&Re(t)?[...new Set([...e,...t])]:Yt(Object.create(null),P_(e),P_(t??{})):t}function Bg(e,t){if(!e)return t;if(!t)return e;const n=Yt(Object.create(null),e);for(const o in t)n[o]=_n(e[o],t[o]);return n}function lp(){return{app:null,config:{isNativeTag:md,performance:!1,globalProperties:{},optionMergeStrategies:{},errorHandler:void 0,warnHandler:void 0,compilerOptions:{}},mixins:[],components:{},directives:{},provides:Object.create(null),optionsCache:new WeakMap,propsCache:new WeakMap,emitsCache:new WeakMap}}let zg=0;function Vg(e,t){return function(o,s=null){Be(o)||(o=Yt({},o)),s!=null&&!wt(s)&&(s=null);const i=lp(),r=new WeakSet,a=[];let c=!1;const l=i.app={_uid:zg++,_component:o,_props:s,_container:null,_context:i,_instance:null,version:xb,get config(){return i.config},set config(u){},use(u,..._){return r.has(u)||(u&&Be(u.install)?(r.add(u),u.install(l,..._)):Be(u)&&(r.add(u),u(l,..._))),l},mixin(u){return i.mixins.includes(u)||i.mixins.push(u),l},component(u,_){return _?(i.components[u]=_,l):i.components[u]},directive(u,_){return _?(i.directives[u]=_,l):i.directives[u]},mount(u,_,$){if(!c){const d=l._ceVNode||xt(o,s);return d.appContext=i,$===!0?$="svg":$===!1&&($=void 0),e(d,u,$),c=!0,l._container=u,u.__vue_app__=l,ac(d.component)}},onUnmount(u){a.push(u)},unmount(){c&&(ls(a,l._instance,16),e(null,l._container),delete l._container.__vue_app__)},provide(u,_){return i.provides[u]=_,l},runWithContext(u){const _=gi;gi=l;try{return u()}finally{gi=_}}};return l}}let gi=null;function qg(e,t){if(hn){let n=hn.provides;const o=hn.parent&&hn.parent.provides;o===n&&(n=hn.provides=Object.create(o)),n[e]=t}}function ca(e,t,n=!1){const o=Cu();if(o||gi){let s=gi?gi._context.provides:o?o.parent==null||o.ce?o.vnode.appContext&&o.vnode.appContext.provides:o.parent.provides:void 0;if(s&&e in s)return s[e];if(arguments.length>1)return n&&Be(t)?t.call(o&&o.proxy):t}}const up={},_p=()=>Object.create(up),$p=e=>Object.getPrototypeOf(e)===up;function Wg(e,t,n,o=!1){const s={},i=_p();e.propsDefaults=Object.create(null),dp(e,t,s,i);for(const r in e.propsOptions[0])r in s||(s[r]=void 0);n?e.props=o?s:dg(s):e.type.props?e.props=s:e.props=i,e.attrs=i}function Kg(e,t,n,o){const{props:s,attrs:i,vnode:{patchFlag:r}}=e,a=ct(s),[c]=e.propsOptions;let l=!1;if((o||r>0)&&!(r&16)){if(r&8){const u=e.vnode.dynamicProps;for(let _=0;_<u.length;_++){let $=u[_];if(ic(e.emitsOptions,$))continue;const d=t[$];if(c)if(ut(i,$))d!==i[$]&&(i[$]=d,l=!0);else{const p=mo($);s[p]=Rl(c,a,p,d,e,!1)}else d!==i[$]&&(i[$]=d,l=!0)}}}else{dp(e,t,s,i)&&(l=!0);let u;for(const _ in a)(!t||!ut(t,_)&&((u=Xo(_))===_||!ut(t,u)))&&(c?n&&(n[_]!==void 0||n[u]!==void 0)&&(s[_]=Rl(c,a,_,void 0,e,!0)):delete s[_]);if(i!==a)for(const _ in i)(!t||!ut(t,_))&&(delete i[_],l=!0)}l&&js(e.attrs,"set","")}function dp(e,t,n,o){const[s,i]=e.propsOptions;let r=!1,a;if(t)for(let c in t){if(Ji(c))continue;const l=t[c];let u;s&&ut(s,u=mo(c))?!i||!i.includes(u)?n[u]=l:(a||(a={}))[u]=l:ic(e.emitsOptions,c)||(!(c in o)||l!==o[c])&&(o[c]=l,r=!0)}if(i){const c=ct(n),l=a||ft;for(let u=0;u<i.length;u++){const _=i[u];n[_]=Rl(s,c,_,l[_],e,!ut(l,_))}}return r}function Rl(e,t,n,o,s,i){const r=e[n];if(r!=null){const a=ut(r,"default");if(a&&o===void 0){const c=r.default;if(r.type!==Function&&!r.skipFactory&&Be(c)){const{propsDefaults:l}=s;if(n in l)o=l[n];else{const u=Er(s);o=l[n]=c.call(null,t),u()}}else o=c;s.ce&&s.ce._setProp(n,o)}r[0]&&(i&&!a?o=!1:r[1]&&(o===""||o===Xo(n))&&(o=!0))}return o}const Jg=new WeakMap;function pp(e,t,n=!1){const o=n?Jg:t.propsCache,s=o.get(e);if(s)return s;const i=e.props,r={},a=[];let c=!1;if(!Be(e)){const u=_=>{c=!0;const[$,d]=pp(_,t,!0);Yt(r,$),d&&a.push(...d)};!n&&t.mixins.length&&t.mixins.forEach(u),e.extends&&u(e.extends),e.mixins&&e.mixins.forEach(u)}if(!i&&!c)return wt(e)&&o.set(e,pi),pi;if(Re(i))for(let u=0;u<i.length;u++){const _=mo(i[u]);E_(_)&&(r[_]=ft)}else if(i)for(const u in i){const _=mo(u);if(E_(_)){const $=i[u],d=r[_]=Re($)||Be($)?{type:$}:Yt({},$),p=d.type;let b=!1,g=!0;if(Re(p))for(let m=0;m<p.length;++m){const v=p[m],y=Be(v)&&v.name;if(y==="Boolean"){b=!0;break}else y==="String"&&(g=!1)}else b=Be(p)&&p.name==="Boolean";d[0]=b,d[1]=g,(b||ut(d,"default"))&&a.push(_)}}const l=[r,a];return wt(e)&&o.set(e,l),l}function E_(e){return e[0]!=="$"&&!Ji(e)}const wu=e=>e==="_"||e==="_ctx"||e==="$stable",Su=e=>Re(e)?e.map(bs):[bs(e)],Xg=(e,t,n)=>{if(t._n)return t;const o=qd((...s)=>Su(t(...s)),n);return o._c=!1,o},mp=(e,t,n)=>{const o=e._ctx;for(const s in e){if(wu(s))continue;const i=e[s];if(Be(i))t[s]=Xg(s,i,o);else if(i!=null){const r=Su(i);t[s]=()=>r}}},fp=(e,t)=>{const n=Su(t);e.slots.default=()=>n},hp=(e,t,n)=>{for(const o in t)(n||!wu(o))&&(e[o]=t[o])},Yg=(e,t,n)=>{const o=e.slots=_p();if(e.vnode.shapeFlag&32){const s=t._;s?(hp(o,t,n),n&&vd(o,"_",s,!0)):mp(t,o)}else t&&fp(e,t)},Zg=(e,t,n)=>{const{vnode:o,slots:s}=e;let i=!0,r=ft;if(o.shapeFlag&32){const a=t._;a?n&&a===1?i=!1:hp(s,t,n):(i=!t.$stable,mp(t,s)),r=t}else t&&(fp(e,t),r={default:1});if(i)for(const a in s)!wu(a)&&r[a]==null&&delete s[a]},dn=db;function Qg(e){return eb(e)}function eb(e,t){const n=ec();n.__VUE__=!0;const{insert:o,remove:s,patchProp:i,createElement:r,createText:a,createComment:c,setText:l,setElementText:u,parentNode:_,nextSibling:$,setScopeId:d=os,insertStaticContent:p}=e,b=(C,E,B,se=null,Q=null,R=null,ue=void 0,ie=null,re=!!E.dynamicChildren)=>{if(C===E)return;C&&!Ro(C,E)&&(se=He(C),X(C,Q,R,!0),C=null),E.patchFlag===-2&&(re=!1,E.dynamicChildren=null);const{type:ne,ref:we,shapeFlag:ae}=E;switch(ne){case rc:g(C,E,B,se);break;case fn:m(C,E,B,se);break;case nr:C==null&&v(E,B,se,ue);break;case ht:L(C,E,B,se,Q,R,ue,ie,re);break;default:ae&1?k(C,E,B,se,Q,R,ue,ie,re):ae&6?K(C,E,B,se,Q,R,ue,ie,re):(ae&64||ae&128)&&ne.process(C,E,B,se,Q,R,ue,ie,re,at)}we!=null&&Q?Qi(we,C&&C.ref,R,E||C,!E):we==null&&C&&C.ref!=null&&Qi(C.ref,null,R,C,!0)},g=(C,E,B,se)=>{if(C==null)o(E.el=a(E.children),B,se);else{const Q=E.el=C.el;E.children!==C.children&&l(Q,E.children)}},m=(C,E,B,se)=>{C==null?o(E.el=c(E.children||""),B,se):E.el=C.el},v=(C,E,B,se)=>{[C.el,C.anchor]=p(C.children,E,B,se,C.el,C.anchor)},y=({el:C,anchor:E},B,se)=>{let Q;for(;C&&C!==E;)Q=$(C),o(C,B,se),C=Q;o(E,B,se)},w=({el:C,anchor:E})=>{let B;for(;C&&C!==E;)B=$(C),s(C),C=B;s(E)},k=(C,E,B,se,Q,R,ue,ie,re)=>{E.type==="svg"?ue="svg":E.type==="math"&&(ue="mathml"),C==null?I(E,B,se,Q,R,ue,ie,re):x(C,E,Q,R,ue,ie,re)},I=(C,E,B,se,Q,R,ue,ie)=>{let re,ne;const{props:we,shapeFlag:ae,transition:Se,dirs:Ce}=C;if(re=C.el=r(C.type,R,we&&we.is,we),ae&8?u(re,C.children):ae&16&&T(C.children,re,null,se,Q,Zc(C,R),ue,ie),Ce&&Co(C,null,se,"created"),P(re,C,C.scopeId,ue,se),we){for(const st in we)st!=="value"&&!Ji(st)&&i(re,st,null,we[st],R,se);"value"in we&&i(re,"value",null,we.value,R),(ne=we.onVnodeBeforeMount)&&_s(ne,se,C)}Ce&&Co(C,null,se,"beforeMount");const Ae=tb(Q,Se);Ae&&Se.beforeEnter(re),o(re,E,B),((ne=we&&we.onVnodeMounted)||Ae||Ce)&&dn(()=>{ne&&_s(ne,se,C),Ae&&Se.enter(re),Ce&&Co(C,null,se,"mounted")},Q)},P=(C,E,B,se,Q)=>{if(B&&d(C,B),se)for(let R=0;R<se.length;R++)d(C,se[R]);if(Q){let R=Q.subTree;if(E===R||wp(R.type)&&(R.ssContent===E||R.ssFallback===E)){const ue=Q.vnode;P(C,ue,ue.scopeId,ue.slotScopeIds,Q.parent)}}},T=(C,E,B,se,Q,R,ue,ie,re=0)=>{for(let ne=re;ne<C.length;ne++){const we=C[ne]=ie?to(C[ne]):bs(C[ne]);b(null,we,E,B,se,Q,R,ue,ie)}},x=(C,E,B,se,Q,R,ue)=>{const ie=E.el=C.el;let{patchFlag:re,dynamicChildren:ne,dirs:we}=E;re|=C.patchFlag&16;const ae=C.props||ft,Se=E.props||ft;let Ce;if(B&&xo(B,!1),(Ce=Se.onVnodeBeforeUpdate)&&_s(Ce,B,E,C),we&&Co(E,C,B,"beforeUpdate"),B&&xo(B,!0),(ae.innerHTML&&Se.innerHTML==null||ae.textContent&&Se.textContent==null)&&u(ie,""),ne?D(C.dynamicChildren,ne,ie,B,se,Zc(E,Q),R):ue||G(C,E,ie,null,B,se,Zc(E,Q),R,!1),re>0){if(re&16)U(ie,ae,Se,B,Q);else if(re&2&&ae.class!==Se.class&&i(ie,"class",null,Se.class,Q),re&4&&i(ie,"style",ae.style,Se.style,Q),re&8){const Ae=E.dynamicProps;for(let st=0;st<Ae.length;st++){const qe=Ae[st],At=ae[qe],ze=Se[qe];(ze!==At||qe==="value")&&i(ie,qe,At,ze,Q,B)}}re&1&&C.children!==E.children&&u(ie,E.children)}else!ue&&ne==null&&U(ie,ae,Se,B,Q);((Ce=Se.onVnodeUpdated)||we)&&dn(()=>{Ce&&_s(Ce,B,E,C),we&&Co(E,C,B,"updated")},se)},D=(C,E,B,se,Q,R,ue)=>{for(let ie=0;ie<E.length;ie++){const re=C[ie],ne=E[ie],we=re.el&&(re.type===ht||!Ro(re,ne)||re.shapeFlag&198)?_(re.el):B;b(re,ne,we,null,se,Q,R,ue,!0)}},U=(C,E,B,se,Q)=>{if(E!==B){if(E!==ft)for(const R in E)!Ji(R)&&!(R in B)&&i(C,R,E[R],null,Q,se);for(const R in B){if(Ji(R))continue;const ue=B[R],ie=E[R];ue!==ie&&R!=="value"&&i(C,R,ie,ue,Q,se)}"value"in B&&i(C,"value",E.value,B.value,Q)}},L=(C,E,B,se,Q,R,ue,ie,re)=>{const ne=E.el=C?C.el:a(""),we=E.anchor=C?C.anchor:a("");let{patchFlag:ae,dynamicChildren:Se,slotScopeIds:Ce}=E;Ce&&(ie=ie?ie.concat(Ce):Ce),C==null?(o(ne,B,se),o(we,B,se),T(E.children||[],B,we,Q,R,ue,ie,re)):ae>0&&ae&64&&Se&&C.dynamicChildren?(D(C.dynamicChildren,Se,B,Q,R,ue,ie),(E.key!=null||Q&&E===Q.subTree)&&ku(C,E,!0)):G(C,E,B,we,Q,R,ue,ie,re)},K=(C,E,B,se,Q,R,ue,ie,re)=>{E.slotScopeIds=ie,C==null?E.shapeFlag&512?Q.ctx.activate(E,B,se,ue,re):ge(E,B,se,Q,R,ue,re):ce(C,E,re)},ge=(C,E,B,se,Q,R,ue)=>{const ie=C.component=yb(C,se,Q);if(sc(C)&&(ie.ctx.renderer=at),vb(ie,!1,ue),ie.asyncDep){if(Q&&Q.registerDep(ie,he,ue),!C.el){const re=ie.subTree=xt(fn);m(null,re,E,B),C.placeholder=re.el}}else he(ie,C,E,B,Q,R,ue)},ce=(C,E,B)=>{const se=E.component=C.component;if(_b(C,E,B))if(se.asyncDep&&!se.asyncResolved){q(se,E,B);return}else se.next=E,se.update();else E.el=C.el,se.vnode=E},he=(C,E,B,se,Q,R,ue)=>{const ie=()=>{if(C.isMounted){let{next:ae,bu:Se,u:Ce,parent:Ae,vnode:st}=C;{const be=gp(C);if(be){ae&&(ae.el=st.el,q(C,ae,ue)),be.asyncDep.then(()=>{C.isUnmounted||ie()});return}}let qe=ae,At;xo(C,!1),ae?(ae.el=st.el,q(C,ae,ue)):ae=st,Se&&Vc(Se),(At=ae.props&&ae.props.onVnodeBeforeUpdate)&&_s(At,Ae,ae,st),xo(C,!0);const ze=G_(C),ot=C.subTree;C.subTree=ze,b(ot,ze,_(ot.el),He(ot),C,Q,R),ae.el=ze.el,qe===null&&$b(C,ze.el),Ce&&dn(Ce,Q),(At=ae.props&&ae.props.onVnodeUpdated)&&dn(()=>_s(At,Ae,ae,st),Q)}else{let ae;const{el:Se,props:Ce}=E,{bm:Ae,m:st,parent:qe,root:At,type:ze}=C,ot=er(E);xo(C,!1),Ae&&Vc(Ae),!ot&&(ae=Ce&&Ce.onVnodeBeforeMount)&&_s(ae,qe,E),xo(C,!0);{At.ce&&At.ce._def.shadowRoot!==!1&&At.ce._injectChildStyle(ze);const be=C.subTree=G_(C);b(null,be,B,se,C,Q,R),E.el=be.el}if(st&&dn(st,Q),!ot&&(ae=Ce&&Ce.onVnodeMounted)){const be=E;dn(()=>_s(ae,qe,be),Q)}(E.shapeFlag&256||qe&&er(qe.vnode)&&qe.vnode.shapeFlag&256)&&C.a&&dn(C.a,Q),C.isMounted=!0,E=B=se=null}};C.scope.on();const re=C.effect=new Md(ie);C.scope.off();const ne=C.update=re.run.bind(re),we=C.job=re.runIfDirty.bind(re);we.i=C,we.id=C.uid,re.scheduler=()=>yu(we),xo(C,!0),ne()},q=(C,E,B)=>{E.component=C;const se=C.vnode.props;C.vnode=E,C.next=null,Kg(C,E.props,se,B),Zg(C,E.children,B),zs(),w_(C),Vs()},G=(C,E,B,se,Q,R,ue,ie,re=!1)=>{const ne=C&&C.children,we=C?C.shapeFlag:0,ae=E.children,{patchFlag:Se,shapeFlag:Ce}=E;if(Se>0){if(Se&128){F(ne,ae,B,se,Q,R,ue,ie,re);return}else if(Se&256){J(ne,ae,B,se,Q,R,ue,ie,re);return}}Ce&8?(we&16&&Ze(ne,Q,R),ae!==ne&&u(B,ae)):we&16?Ce&16?F(ne,ae,B,se,Q,R,ue,ie,re):Ze(ne,Q,R,!0):(we&8&&u(B,""),Ce&16&&T(ae,B,se,Q,R,ue,ie,re))},J=(C,E,B,se,Q,R,ue,ie,re)=>{C=C||pi,E=E||pi;const ne=C.length,we=E.length,ae=Math.min(ne,we);let Se;for(Se=0;Se<ae;Se++){const Ce=E[Se]=re?to(E[Se]):bs(E[Se]);b(C[Se],Ce,B,null,Q,R,ue,ie,re)}ne>we?Ze(C,Q,R,!0,!1,ae):T(E,B,se,Q,R,ue,ie,re,ae)},F=(C,E,B,se,Q,R,ue,ie,re)=>{let ne=0;const we=E.length;let ae=C.length-1,Se=we-1;for(;ne<=ae&&ne<=Se;){const Ce=C[ne],Ae=E[ne]=re?to(E[ne]):bs(E[ne]);if(Ro(Ce,Ae))b(Ce,Ae,B,null,Q,R,ue,ie,re);else break;ne++}for(;ne<=ae&&ne<=Se;){const Ce=C[ae],Ae=E[Se]=re?to(E[Se]):bs(E[Se]);if(Ro(Ce,Ae))b(Ce,Ae,B,null,Q,R,ue,ie,re);else break;ae--,Se--}if(ne>ae){if(ne<=Se){const Ce=Se+1,Ae=Ce<we?E[Ce].el:se;for(;ne<=Se;)b(null,E[ne]=re?to(E[ne]):bs(E[ne]),B,Ae,Q,R,ue,ie,re),ne++}}else if(ne>Se)for(;ne<=ae;)X(C[ne],Q,R,!0),ne++;else{const Ce=ne,Ae=ne,st=new Map;for(ne=Ae;ne<=Se;ne++){const Lt=E[ne]=re?to(E[ne]):bs(E[ne]);Lt.key!=null&&st.set(Lt.key,ne)}let qe,At=0;const ze=Se-Ae+1;let ot=!1,be=0;const Ot=new Array(ze);for(ne=0;ne<ze;ne++)Ot[ne]=0;for(ne=Ce;ne<=ae;ne++){const Lt=C[ne];if(At>=ze){X(Lt,Q,R,!0);continue}let un;if(Lt.key!=null)un=st.get(Lt.key);else for(qe=Ae;qe<=Se;qe++)if(Ot[qe-Ae]===0&&Ro(Lt,E[qe])){un=qe;break}un===void 0?X(Lt,Q,R,!0):(Ot[un-Ae]=ne+1,un>=be?be=un:ot=!0,b(Lt,E[un],B,null,Q,R,ue,ie,re),At++)}const vn=ot?nb(Ot):pi;for(qe=vn.length-1,ne=ze-1;ne>=0;ne--){const Lt=Ae+ne,un=E[Lt],ti=E[Lt+1],ni=Lt+1<we?ti.el||ti.placeholder:se;Ot[ne]===0?b(null,un,B,ni,Q,R,ue,ie,re):ot&&(qe<0||ne!==vn[qe]?O(un,B,ni,2):qe--)}}},O=(C,E,B,se,Q=null)=>{const{el:R,type:ue,transition:ie,children:re,shapeFlag:ne}=C;if(ne&6){O(C.component.subTree,E,B,se);return}if(ne&128){C.suspense.move(E,B,se);return}if(ne&64){ue.move(C,E,B,at);return}if(ue===ht){o(R,E,B);for(let ae=0;ae<re.length;ae++)O(re[ae],E,B,se);o(C.anchor,E,B);return}if(ue===nr){y(C,E,B);return}if(se!==2&&ne&1&&ie)if(se===0)ie.beforeEnter(R),o(R,E,B),dn(()=>ie.enter(R),Q);else{const{leave:ae,delayLeave:Se,afterLeave:Ce}=ie,Ae=()=>{C.ctx.isUnmounted?s(R):o(R,E,B)},st=()=>{R._isLeaving&&R[Ds](!0),ae(R,()=>{Ae(),Ce&&Ce()})};Se?Se(R,Ae,st):st()}else o(R,E,B)},X=(C,E,B,se=!1,Q=!1)=>{const{type:R,props:ue,ref:ie,children:re,dynamicChildren:ne,shapeFlag:we,patchFlag:ae,dirs:Se,cacheIndex:Ce}=C;if(ae===-2&&(Q=!1),ie!=null&&(zs(),Qi(ie,null,B,C,!0),Vs()),Ce!=null&&(E.renderCache[Ce]=void 0),we&256){E.ctx.deactivate(C);return}const Ae=we&1&&Se,st=!er(C);let qe;if(st&&(qe=ue&&ue.onVnodeBeforeUnmount)&&_s(qe,E,C),we&6)Ne(C.component,B,se);else{if(we&128){C.suspense.unmount(B,se);return}Ae&&Co(C,null,E,"beforeUnmount"),we&64?C.type.remove(C,E,B,at,se):ne&&!ne.hasOnce&&(R!==ht||ae>0&&ae&64)?Ze(ne,E,B,!1,!0):(R===ht&&ae&384||!Q&&we&16)&&Ze(re,E,B),se&&W(C)}(st&&(qe=ue&&ue.onVnodeUnmounted)||Ae)&&dn(()=>{qe&&_s(qe,E,C),Ae&&Co(C,null,E,"unmounted")},B)},W=C=>{const{type:E,el:B,anchor:se,transition:Q}=C;if(E===ht){ve(B,se);return}if(E===nr){w(C);return}const R=()=>{s(B),Q&&!Q.persisted&&Q.afterLeave&&Q.afterLeave()};if(C.shapeFlag&1&&Q&&!Q.persisted){const{leave:ue,delayLeave:ie}=Q,re=()=>ue(B,R);ie?ie(C.el,R,re):re()}else R()},ve=(C,E)=>{let B;for(;C!==E;)B=$(C),s(C),C=B;s(E)},Ne=(C,E,B)=>{const{bum:se,scope:Q,job:R,subTree:ue,um:ie,m:re,a:ne}=C;A_(re),A_(ne),se&&Vc(se),Q.stop(),R&&(R.flags|=8,X(ue,C,E,B)),ie&&dn(ie,E),dn(()=>{C.isUnmounted=!0},E)},Ze=(C,E,B,se=!1,Q=!1,R=0)=>{for(let ue=R;ue<C.length;ue++)X(C[ue],E,B,se,Q)},He=C=>{if(C.shapeFlag&6)return He(C.component.subTree);if(C.shapeFlag&128)return C.suspense.next();const E=$(C.anchor||C.el),B=E&&E[Kd];return B?$(B):E};let lt=!1;const et=(C,E,B)=>{C==null?E._vnode&&X(E._vnode,null,null,!0):b(E._vnode||null,C,E,null,null,null,B),E._vnode=C,lt||(lt=!0,w_(),Bd(),lt=!1)},at={p:b,um:X,m:O,r:W,mt:ge,mc:T,pc:G,pbc:D,n:He,o:e};return{render:et,hydrate:void 0,createApp:Vg(et)}}function Zc({type:e,props:t},n){return n==="svg"&&e==="foreignObject"||n==="mathml"&&e==="annotation-xml"&&t&&t.encoding&&t.encoding.includes("html")?void 0:n}function xo({effect:e,job:t},n){n?(e.flags|=32,t.flags|=4):(e.flags&=-33,t.flags&=-5)}function tb(e,t){return(!e||e&&!e.pendingBranch)&&t&&!t.persisted}function ku(e,t,n=!1){const o=e.children,s=t.children;if(Re(o)&&Re(s))for(let i=0;i<o.length;i++){const r=o[i];let a=s[i];a.shapeFlag&1&&!a.dynamicChildren&&((a.patchFlag<=0||a.patchFlag===32)&&(a=s[i]=to(s[i]),a.el=r.el),!n&&a.patchFlag!==-2&&ku(r,a)),a.type===rc&&a.patchFlag!==-1&&(a.el=r.el),a.type===fn&&!a.el&&(a.el=r.el)}}function nb(e){const t=e.slice(),n=[0];let o,s,i,r,a;const c=e.length;for(o=0;o<c;o++){const l=e[o];if(l!==0){if(s=n[n.length-1],e[s]<l){t[o]=s,n.push(o);continue}for(i=0,r=n.length-1;i<r;)a=i+r>>1,e[n[a]]<l?i=a+1:r=a;l<e[n[i]]&&(i>0&&(t[o]=n[i-1]),n[i]=o)}}for(i=n.length,r=n[i-1];i-- >0;)n[i]=r,r=t[r];return n}function gp(e){const t=e.subTree.component;if(t)return t.asyncDep&&!t.asyncResolved?t:gp(t)}function A_(e){if(e)for(let t=0;t<e.length;t++)e[t].flags|=8}const sb=Symbol.for("v-scx"),ob=()=>ca(sb);function Tn(e,t,n){return bp(e,t,n)}function bp(e,t,n=ft){const{immediate:o,deep:s,flush:i,once:r}=n,a=Yt({},n),c=t&&o||!t&&i!=="post";let l;if(mr){if(i==="sync"){const d=ob();l=d.__watcherHandles||(d.__watcherHandles=[])}else if(!c){const d=()=>{};return d.stop=os,d.resume=os,d.pause=os,d}}const u=hn;a.call=(d,p,b)=>ls(d,u,p,b);let _=!1;i==="post"?a.scheduler=d=>{dn(d,u&&u.suspense)}:i!=="sync"&&(_=!0,a.scheduler=(d,p)=>{p?d():yu(d)}),a.augmentJob=d=>{t&&(d.flags|=4),_&&(d.flags|=2,u&&(d.id=u.uid,d.i=u))};const $=vg(e,t,a);return mr&&(l?l.push($):c&&$()),$}function ib(e,t,n){const o=this.proxy,s=Et(e)?e.includes(".")?yp(o,e):()=>o[e]:e.bind(o,o);let i;Be(t)?i=t:(i=t.handler,n=t);const r=Er(this),a=bp(s,i.bind(o),n);return r(),a}function yp(e,t){const n=t.split(".");return()=>{let o=e;for(let s=0;s<n.length&&o;s++)o=o[n[s]];return o}}const rb=(e,t)=>t==="modelValue"||t==="model-value"?e.modelModifiers:e[`${t}Modifiers`]||e[`${mo(t)}Modifiers`]||e[`${Xo(t)}Modifiers`];function ab(e,t,...n){if(e.isUnmounted)return;const o=e.vnode.props||ft;let s=n;const i=t.startsWith("update:"),r=i&&rb(o,t.slice(7));r&&(r.trim&&(s=n.map(u=>Et(u)?u.trim():u)),r.number&&(s=n.map(N0)));let a,c=o[a=zc(t)]||o[a=zc(mo(t))];!c&&i&&(c=o[a=zc(Xo(t))]),c&&ls(c,e,6,s);const l=o[a+"Once"];if(l){if(!e.emitted)e.emitted={};else if(e.emitted[a])return;e.emitted[a]=!0,ls(l,e,6,s)}}const cb=new WeakMap;function vp(e,t,n=!1){const o=n?cb:t.emitsCache,s=o.get(e);if(s!==void 0)return s;const i=e.emits;let r={},a=!1;if(!Be(e)){const c=l=>{const u=vp(l,t,!0);u&&(a=!0,Yt(r,u))};!n&&t.mixins.length&&t.mixins.forEach(c),e.extends&&c(e.extends),e.mixins&&e.mixins.forEach(c)}return!i&&!a?(wt(e)&&o.set(e,null),null):(Re(i)?i.forEach(c=>r[c]=null):Yt(r,i),wt(e)&&o.set(e,r),r)}function ic(e,t){return!e||!Ya(t)?!1:(t=t.slice(2).replace(/Once$/,""),ut(e,t[0].toLowerCase()+t.slice(1))||ut(e,Xo(t))||ut(e,t))}function G_(e){const{type:t,vnode:n,proxy:o,withProxy:s,propsOptions:[i],slots:r,attrs:a,emit:c,render:l,renderCache:u,props:_,data:$,setupState:d,ctx:p,inheritAttrs:b}=e,g=ka(e);let m,v;try{if(n.shapeFlag&4){const w=s||o,k=w;m=bs(l.call(k,w,u,_,d,$,p)),v=a}else{const w=t;m=bs(w.length>1?w(_,{attrs:a,slots:r,emit:c}):w(_,null)),v=t.props?a:lb(a)}}catch(w){sr.length=0,nc(w,e,1),m=xt(fn)}let y=m;if(v&&b!==!1){const w=Object.keys(v),{shapeFlag:k}=y;w.length&&k&7&&(i&&w.some(lu)&&(v=ub(v,i)),y=ho(y,v,!1,!0))}return n.dirs&&(y=ho(y,null,!1,!0),y.dirs=y.dirs?y.dirs.concat(n.dirs):n.dirs),n.transition&&dr(y,n.transition),m=y,ka(g),m}const lb=e=>{let t;for(const n in e)(n==="class"||n==="style"||Ya(n))&&((t||(t={}))[n]=e[n]);return t},ub=(e,t)=>{const n={};for(const o in e)(!lu(o)||!(o.slice(9)in t))&&(n[o]=e[o]);return n};function _b(e,t,n){const{props:o,children:s,component:i}=e,{props:r,children:a,patchFlag:c}=t,l=i.emitsOptions;if(t.dirs||t.transition)return!0;if(n&&c>=0){if(c&1024)return!0;if(c&16)return o?R_(o,r,l):!!r;if(c&8){const u=t.dynamicProps;for(let _=0;_<u.length;_++){const $=u[_];if(r[$]!==o[$]&&!ic(l,$))return!0}}}else return(s||a)&&(!a||!a.$stable)?!0:o===r?!1:o?r?R_(o,r,l):!0:!!r;return!1}function R_(e,t,n){const o=Object.keys(t);if(o.length!==Object.keys(e).length)return!0;for(let s=0;s<o.length;s++){const i=o[s];if(t[i]!==e[i]&&!ic(n,i))return!0}return!1}function $b({vnode:e,parent:t},n){for(;t;){const o=t.subTree;if(o.suspense&&o.suspense.activeBranch===e&&(o.el=e.el),o===e)(e=t.vnode).el=n,t=t.parent;else break}}const wp=e=>e.__isSuspense;function db(e,t){t&&t.pendingBranch?Re(e)?t.effects.push(...e):t.effects.push(e):Ud(e)}const ht=Symbol.for("v-fgt"),rc=Symbol.for("v-txt"),fn=Symbol.for("v-cmt"),nr=Symbol.for("v-stc"),sr=[];let Dn=null;function V(e=!1){sr.push(Dn=e?null:[])}function pb(){sr.pop(),Dn=sr[sr.length-1]||null}let pr=1;function xa(e,t=!1){pr+=e,e<0&&Dn&&t&&(Dn.hasOnce=!0)}function Sp(e){return e.dynamicChildren=pr>0?Dn||pi:null,pb(),pr>0&&Dn&&Dn.push(e),e}function Z(e,t,n,o,s,i){return Sp(h(e,t,n,o,s,i,!0))}function Cn(e,t,n,o,s){return Sp(xt(e,t,n,o,s,!0))}function Pa(e){return e?e.__v_isVNode===!0:!1}function Ro(e,t){return e.type===t.type&&e.key===t.key}const kp=({key:e})=>e??null,la=({ref:e,ref_key:t,ref_for:n})=>(typeof e=="number"&&(e=""+e),e!=null?Et(e)||cn(e)||Be(e)?{i:qn,r:e,k:t,f:!!n}:e:null);function h(e,t=null,n=null,o=0,s=null,i=e===ht?0:1,r=!1,a=!1){const c={__v_isVNode:!0,__v_skip:!0,type:e,props:t,key:t&&kp(t),ref:t&&la(t),scopeId:Vd,slotScopeIds:null,children:n,component:null,suspense:null,ssContent:null,ssFallback:null,dirs:null,transition:null,el:null,anchor:null,target:null,targetStart:null,targetAnchor:null,staticCount:0,shapeFlag:i,patchFlag:o,dynamicProps:s,dynamicChildren:null,appContext:null,ctx:qn};return a?(Mu(c,n),i&128&&e.normalize(c)):n&&(c.shapeFlag|=Et(n)?8:16),pr>0&&!r&&Dn&&(c.patchFlag>0||i&6)&&c.patchFlag!==32&&Dn.push(c),c}const xt=mb;function mb(e,t=null,n=null,o=0,s=null,i=!1){if((!e||e===Dg)&&(e=fn),Pa(e)){const a=ho(e,t,!0);return n&&Mu(a,n),pr>0&&!i&&Dn&&(a.shapeFlag&6?Dn[Dn.indexOf(e)]=a:Dn.push(a)),a.patchFlag=-2,a}if(Mb(e)&&(e=e.__vccOpts),t){t=fb(t);let{class:a,style:c}=t;a&&!Et(a)&&(t.class=kt(a)),wt(c)&&(bu(c)&&!Re(c)&&(c=Yt({},c)),t.style=zn(c))}const r=Et(e)?1:wp(e)?128:Jd(e)?64:wt(e)?4:Be(e)?2:0;return h(e,t,n,o,s,r,i,!0)}function fb(e){return e?bu(e)||$p(e)?Yt({},e):e:null}function ho(e,t,n=!1,o=!1){const{props:s,ref:i,patchFlag:r,children:a,transition:c}=e,l=t?hb(s||{},t):s,u={__v_isVNode:!0,__v_skip:!0,type:e.type,props:l,key:l&&kp(l),ref:t&&t.ref?n&&i?Re(i)?i.concat(la(t)):[i,la(t)]:la(t):i,scopeId:e.scopeId,slotScopeIds:e.slotScopeIds,children:a,target:e.target,targetStart:e.targetStart,targetAnchor:e.targetAnchor,staticCount:e.staticCount,shapeFlag:e.shapeFlag,patchFlag:t&&e.type!==ht?r===-1?16:r|16:r,dynamicProps:e.dynamicProps,dynamicChildren:e.dynamicChildren,appContext:e.appContext,dirs:e.dirs,transition:c,component:e.component,suspense:e.suspense,ssContent:e.ssContent&&ho(e.ssContent),ssFallback:e.ssFallback&&ho(e.ssFallback),placeholder:e.placeholder,el:e.el,anchor:e.anchor,ctx:e.ctx,ce:e.ce};return c&&o&&dr(u,c.clone(u)),u}function zo(e=" ",t=0){return xt(rc,null,e,t)}function La(e,t){const n=xt(nr,null,e);return n.staticCount=t,n}function Ie(e="",t=!1){return t?(V(),Cn(fn,null,e)):xt(fn,null,e)}function bs(e){return e==null||typeof e=="boolean"?xt(fn):Re(e)?xt(ht,null,e.slice()):Pa(e)?to(e):xt(rc,null,String(e))}function to(e){return e.el===null&&e.patchFlag!==-1||e.memo?e:ho(e)}function Mu(e,t){let n=0;const{shapeFlag:o}=e;if(t==null)t=null;else if(Re(t))n=16;else if(typeof t=="object")if(o&65){const s=t.default;s&&(s._c&&(s._d=!1),Mu(e,s()),s._c&&(s._d=!0));return}else{n=32;const s=t._;!s&&!$p(t)?t._ctx=qn:s===3&&qn&&(qn.slots._===1?t._=1:(t._=2,e.patchFlag|=1024))}else Be(t)?(t={default:t,_ctx:qn},n=32):(t=String(t),o&64?(n=16,t=[zo(t)]):n=8);e.children=t,e.shapeFlag|=n}function hb(...e){const t={};for(let n=0;n<e.length;n++){const o=e[n];for(const s in o)if(s==="class")t.class!==o.class&&(t.class=kt([t.class,o.class]));else if(s==="style")t.style=zn([t.style,o.style]);else if(Ya(s)){const i=t[s],r=o[s];r&&i!==r&&!(Re(i)&&i.includes(r))&&(t[s]=i?[].concat(i,r):r)}else s!==""&&(t[s]=o[s])}return t}function _s(e,t,n,o=null){ls(e,t,7,[n,o])}const gb=lp();let bb=0;function yb(e,t,n){const o=e.type,s=(t?t.appContext:e.appContext)||gb,i={uid:bb++,vnode:e,type:o,parent:t,appContext:s,root:null,next:null,subTree:null,effect:null,update:null,job:null,scope:new W0(!0),render:null,proxy:null,exposed:null,exposeProxy:null,withProxy:null,provides:t?t.provides:Object.create(s.provides),ids:t?t.ids:["",0,0],accessCache:null,renderCache:[],components:null,directives:null,propsOptions:pp(o,s),emitsOptions:vp(o,s),emit:null,emitted:null,propsDefaults:ft,inheritAttrs:o.inheritAttrs,ctx:ft,data:ft,props:ft,attrs:ft,slots:ft,refs:ft,setupState:ft,setupContext:null,suspense:n,suspenseId:n?n.pendingId:0,asyncDep:null,asyncResolved:!1,isMounted:!1,isUnmounted:!1,isDeactivated:!1,bc:null,c:null,bm:null,m:null,bu:null,u:null,um:null,bum:null,da:null,a:null,rtg:null,rtc:null,ec:null,sp:null};return i.ctx={_:i},i.root=t?t.root:i,i.emit=ab.bind(null,i),e.ce&&e.ce(i),i}let hn=null;const Cu=()=>hn||qn;let Ia,Ol;{const e=ec(),t=(n,o)=>{let s;return(s=e[n])||(s=e[n]=[]),s.push(o),i=>{s.length>1?s.forEach(r=>r(i)):s[0](i)}};Ia=t("__VUE_INSTANCE_SETTERS__",n=>hn=n),Ol=t("__VUE_SSR_SETTERS__",n=>mr=n)}const Er=e=>{const t=hn;return Ia(e),e.scope.on(),()=>{e.scope.off(),Ia(t)}},O_=()=>{hn&&hn.scope.off(),Ia(null)};function Mp(e){return e.vnode.shapeFlag&4}let mr=!1;function vb(e,t=!1,n=!1){t&&Ol(t);const{props:o,children:s}=e.vnode,i=Mp(e);Wg(e,o,i,t),Yg(e,s,n||t);const r=i?wb(e,t):void 0;return t&&Ol(!1),r}function wb(e,t){const n=e.type;e.accessCache=Object.create(null),e.proxy=new Proxy(e.ctx,Ng);const{setup:o}=n;if(o){zs();const s=e.setupContext=o.length>1?kb(e):null,i=Er(e),r=Tr(o,e,0,[e.props,s]),a=hd(r);if(Vs(),i(),(a||e.sp)&&!er(e)&&op(e),a){if(r.then(O_,O_),t)return r.then(c=>{D_(e,c)}).catch(c=>{nc(c,e,0)});e.asyncDep=r}else D_(e,r)}else Cp(e)}function D_(e,t,n){Be(t)?e.type.__ssrInlineRender?e.ssrRender=t:e.render=t:wt(t)&&(e.setupState=jd(t)),Cp(e)}function Cp(e,t,n){const o=e.type;e.render||(e.render=o.render||os);{const s=Er(e);zs();try{jg(e)}finally{Vs(),s()}}}const Sb={get(e,t){return en(e,"get",""),e[t]}};function kb(e){const t=n=>{e.exposed=n||{}};return{attrs:new Proxy(e.attrs,Sb),slots:e.slots,emit:e.emit,expose:t}}function ac(e){return e.exposed?e.exposeProxy||(e.exposeProxy=new Proxy(jd(pg(e.exposed)),{get(t,n){if(n in t)return t[n];if(n in tr)return tr[n](e)},has(t,n){return n in t||n in tr}})):e.proxy}function Mb(e){return Be(e)&&"__vccOpts"in e}const Je=(e,t)=>bg(e,t,mr);function Cb(e,t,n){try{xa(-1);const o=arguments.length;return o===2?wt(t)&&!Re(t)?Pa(t)?xt(e,null,[t]):xt(e,t):xt(e,null,t):(o>3?n=Array.prototype.slice.call(arguments,2):o===3&&Pa(n)&&(n=[n]),xt(e,t,n))}finally{xa(1)}}const xb="3.5.22";/**
* @vue/runtime-dom v3.5.22
* (c) 2018-present Yuxi (Evan) You and Vue contributors
* @license MIT
**/let Dl;const N_=typeof window<"u"&&window.trustedTypes;if(N_)try{Dl=N_.createPolicy("vue",{createHTML:e=>e})}catch{}const xp=Dl?e=>Dl.createHTML(e):e=>e,Pb="http://www.w3.org/2000/svg",Lb="http://www.w3.org/1998/Math/MathML",Os=typeof document<"u"?document:null,j_=Os&&Os.createElement("template"),Ib={insert:(e,t,n)=>{t.insertBefore(e,n||null)},remove:e=>{const t=e.parentNode;t&&t.removeChild(e)},createElement:(e,t,n,o)=>{const s=t==="svg"?Os.createElementNS(Pb,e):t==="mathml"?Os.createElementNS(Lb,e):n?Os.createElement(e,{is:n}):Os.createElement(e);return e==="select"&&o&&o.multiple!=null&&s.setAttribute("multiple",o.multiple),s},createText:e=>Os.createTextNode(e),createComment:e=>Os.createComment(e),setText:(e,t)=>{e.nodeValue=t},setElementText:(e,t)=>{e.textContent=t},parentNode:e=>e.parentNode,nextSibling:e=>e.nextSibling,querySelector:e=>Os.querySelector(e),setScopeId(e,t){e.setAttribute(t,"")},insertStaticContent(e,t,n,o,s,i){const r=n?n.previousSibling:t.lastChild;if(s&&(s===i||s.nextSibling))for(;t.insertBefore(s.cloneNode(!0),n),!(s===i||!(s=s.nextSibling)););else{j_.innerHTML=xp(o==="svg"?`<svg>${e}</svg>`:o==="mathml"?`<math>${e}</math>`:e);const a=j_.content;if(o==="svg"||o==="mathml"){const c=a.firstChild;for(;c.firstChild;)a.appendChild(c.firstChild);a.removeChild(c)}t.insertBefore(a,n)}return[r?r.nextSibling:t.firstChild,n?n.previousSibling:t.lastChild]}},Xs="transition",Gi="animation",fr=Symbol("_vtc"),Pp={name:String,type:String,css:{type:Boolean,default:!0},duration:[String,Number,Object],enterFromClass:String,enterActiveClass:String,enterToClass:String,appearFromClass:String,appearActiveClass:String,appearToClass:String,leaveFromClass:String,leaveActiveClass:String,leaveToClass:String},Tb=Yt({},Qd,Pp),Eb=e=>(e.displayName="Transition",e.props=Tb,e),Ab=Eb((e,{slots:t})=>Cb(xg,Gb(e),t)),Po=(e,t=[])=>{Re(e)?e.forEach(n=>n(...t)):e&&e(...t)},H_=e=>e?Re(e)?e.some(t=>t.length>1):e.length>1:!1;function Gb(e){const t={};for(const L in e)L in Pp||(t[L]=e[L]);if(e.css===!1)return t;const{name:n="v",type:o,duration:s,enterFromClass:i=`${n}-enter-from`,enterActiveClass:r=`${n}-enter-active`,enterToClass:a=`${n}-enter-to`,appearFromClass:c=i,appearActiveClass:l=r,appearToClass:u=a,leaveFromClass:_=`${n}-leave-from`,leaveActiveClass:$=`${n}-leave-active`,leaveToClass:d=`${n}-leave-to`}=e,p=Rb(s),b=p&&p[0],g=p&&p[1],{onBeforeEnter:m,onEnter:v,onEnterCancelled:y,onLeave:w,onLeaveCancelled:k,onBeforeAppear:I=m,onAppear:P=v,onAppearCancelled:T=y}=t,x=(L,K,ge,ce)=>{L._enterCancelled=ce,Lo(L,K?u:a),Lo(L,K?l:r),ge&&ge()},D=(L,K)=>{L._isLeaving=!1,Lo(L,_),Lo(L,d),Lo(L,$),K&&K()},U=L=>(K,ge)=>{const ce=L?P:v,he=()=>x(K,L,ge);Po(ce,[K,he]),F_(()=>{Lo(K,L?c:i),Rs(K,L?u:a),H_(ce)||U_(K,o,b,he)})};return Yt(t,{onBeforeEnter(L){Po(m,[L]),Rs(L,i),Rs(L,r)},onBeforeAppear(L){Po(I,[L]),Rs(L,c),Rs(L,l)},onEnter:U(!1),onAppear:U(!0),onLeave(L,K){L._isLeaving=!0;const ge=()=>D(L,K);Rs(L,_),L._enterCancelled?(Rs(L,$),V_(L)):(V_(L),Rs(L,$)),F_(()=>{L._isLeaving&&(Lo(L,_),Rs(L,d),H_(w)||U_(L,o,g,ge))}),Po(w,[L,ge])},onEnterCancelled(L){x(L,!1,void 0,!0),Po(y,[L])},onAppearCancelled(L){x(L,!0,void 0,!0),Po(T,[L])},onLeaveCancelled(L){D(L),Po(k,[L])}})}function Rb(e){if(e==null)return null;if(wt(e))return[Qc(e.enter),Qc(e.leave)];{const t=Qc(e);return[t,t]}}function Qc(e){return j0(e)}function Rs(e,t){t.split(/\s+/).forEach(n=>n&&e.classList.add(n)),(e[fr]||(e[fr]=new Set)).add(t)}function Lo(e,t){t.split(/\s+/).forEach(o=>o&&e.classList.remove(o));const n=e[fr];n&&(n.delete(t),n.size||(e[fr]=void 0))}function F_(e){requestAnimationFrame(()=>{requestAnimationFrame(e)})}let Ob=0;function U_(e,t,n,o){const s=e._endId=++Ob,i=()=>{s===e._endId&&o()};if(n!=null)return setTimeout(i,n);const{type:r,timeout:a,propCount:c}=Db(e,t);if(!r)return o();const l=r+"end";let u=0;const _=()=>{e.removeEventListener(l,$),i()},$=d=>{d.target===e&&++u>=c&&_()};setTimeout(()=>{u<c&&_()},a+1),e.addEventListener(l,$)}function Db(e,t){const n=window.getComputedStyle(e),o=p=>(n[p]||"").split(", "),s=o(`${Xs}Delay`),i=o(`${Xs}Duration`),r=B_(s,i),a=o(`${Gi}Delay`),c=o(`${Gi}Duration`),l=B_(a,c);let u=null,_=0,$=0;t===Xs?r>0&&(u=Xs,_=r,$=i.length):t===Gi?l>0&&(u=Gi,_=l,$=c.length):(_=Math.max(r,l),u=_>0?r>l?Xs:Gi:null,$=u?u===Xs?i.length:c.length:0);const d=u===Xs&&/\b(?:transform|all)(?:,|$)/.test(o(`${Xs}Property`).toString());return{type:u,timeout:_,propCount:$,hasTransform:d}}function B_(e,t){for(;e.length<t.length;)e=e.concat(e);return Math.max(...t.map((n,o)=>z_(n)+z_(e[o])))}function z_(e){return e==="auto"?0:Number(e.slice(0,-1).replace(",","."))*1e3}function V_(e){return(e?e.ownerDocument:document).body.offsetHeight}function Nb(e,t,n){const o=e[fr];o&&(t=(t?[t,...o]:[...o]).join(" ")),t==null?e.removeAttribute("class"):n?e.setAttribute("class",t):e.className=t}const Ta=Symbol("_vod"),Lp=Symbol("_vsh"),Ip={name:"show",beforeMount(e,{value:t},{transition:n}){e[Ta]=e.style.display==="none"?"":e.style.display,n&&t?n.beforeEnter(e):Ri(e,t)},mounted(e,{value:t},{transition:n}){n&&t&&n.enter(e)},updated(e,{value:t,oldValue:n},{transition:o}){!t!=!n&&(o?t?(o.beforeEnter(e),Ri(e,!0),o.enter(e)):o.leave(e,()=>{Ri(e,!1)}):Ri(e,t))},beforeUnmount(e,{value:t}){Ri(e,t)}};function Ri(e,t){e.style.display=t?e[Ta]:"none",e[Lp]=!t}const Tp=Symbol("");function Qn(e){const t=Cu();if(!t)return;const n=t.ut=(s=e(t.proxy))=>{Array.from(document.querySelectorAll(`[data-v-owner="${t.uid}"]`)).forEach(i=>Ea(i,s))},o=()=>{const s=e(t.proxy);t.ce?Ea(t.ce,s):Nl(t.subTree,s),n(s)};rp(()=>{Ud(o)}),gn(()=>{Tn(o,os,{flush:"post"});const s=new MutationObserver(o);s.observe(t.subTree.el.parentNode,{childList:!0}),vu(()=>s.disconnect())})}function Nl(e,t){if(e.shapeFlag&128){const n=e.suspense;e=n.activeBranch,n.pendingBranch&&!n.isHydrating&&n.effects.push(()=>{Nl(n.activeBranch,t)})}for(;e.component;)e=e.component.subTree;if(e.shapeFlag&1&&e.el)Ea(e.el,t);else if(e.type===ht)e.children.forEach(n=>Nl(n,t));else if(e.type===nr){let{el:n,anchor:o}=e;for(;n&&(Ea(n,t),n!==o);)n=n.nextSibling}}function Ea(e,t){if(e.nodeType===1){const n=e.style;let o="";for(const s in t){const i=q0(t[s]);n.setProperty(`--${s}`,i),o+=`--${s}: ${i};`}n[Tp]=o}}const jb=/(?:^|;)\s*display\s*:/;function Hb(e,t,n){const o=e.style,s=Et(n);let i=!1;if(n&&!s){if(t)if(Et(t))for(const r of t.split(";")){const a=r.slice(0,r.indexOf(":")).trim();n[a]==null&&ua(o,a,"")}else for(const r in t)n[r]==null&&ua(o,r,"");for(const r in n)r==="display"&&(i=!0),ua(o,r,n[r])}else if(s){if(t!==n){const r=o[Tp];r&&(n+=";"+r),o.cssText=n,i=jb.test(n)}}else t&&e.removeAttribute("style");Ta in e&&(e[Ta]=i?o.display:"",e[Lp]&&(o.display="none"))}const q_=/\s*!important$/;function ua(e,t,n){if(Re(n))n.forEach(o=>ua(e,t,o));else if(n==null&&(n=""),t.startsWith("--"))e.setProperty(t,n);else{const o=Fb(e,t);q_.test(n)?e.setProperty(Xo(o),n.replace(q_,""),"important"):e[o]=n}}const W_=["Webkit","Moz","ms"],el={};function Fb(e,t){const n=el[t];if(n)return n;let o=mo(t);if(o!=="filter"&&o in e)return el[t]=o;o=yd(o);for(let s=0;s<W_.length;s++){const i=W_[s]+o;if(i in e)return el[t]=i}return t}const K_="http://www.w3.org/1999/xlink";function J_(e,t,n,o,s,i=V0(t)){o&&t.startsWith("xlink:")?n==null?e.removeAttributeNS(K_,t.slice(6,t.length)):e.setAttributeNS(K_,t,n):n==null||i&&!wd(n)?e.removeAttribute(t):e.setAttribute(t,i?"":So(n)?String(n):n)}function X_(e,t,n,o,s){if(t==="innerHTML"||t==="textContent"){n!=null&&(e[t]=t==="innerHTML"?xp(n):n);return}const i=e.tagName;if(t==="value"&&i!=="PROGRESS"&&!i.includes("-")){const a=i==="OPTION"?e.getAttribute("value")||"":e.value,c=n==null?e.type==="checkbox"?"on":"":String(n);(a!==c||!("_value"in e))&&(e.value=c),n==null&&e.removeAttribute(t),e._value=n;return}let r=!1;if(n===""||n==null){const a=typeof e[t];a==="boolean"?n=wd(n):n==null&&a==="string"?(n="",r=!0):a==="number"&&(n=0,r=!0)}try{e[t]=n}catch{}r&&e.removeAttribute(s||t)}function Ub(e,t,n,o){e.addEventListener(t,n,o)}function Bb(e,t,n,o){e.removeEventListener(t,n,o)}const Y_=Symbol("_vei");function zb(e,t,n,o,s=null){const i=e[Y_]||(e[Y_]={}),r=i[t];if(o&&r)r.value=o;else{const[a,c]=Vb(t);if(o){const l=i[t]=Kb(o,s);Ub(e,a,l,c)}else r&&(Bb(e,a,r,c),i[t]=void 0)}}const Z_=/(?:Once|Passive|Capture)$/;function Vb(e){let t;if(Z_.test(e)){t={};let o;for(;o=e.match(Z_);)e=e.slice(0,e.length-o[0].length),t[o[0].toLowerCase()]=!0}return[e[2]===":"?e.slice(3):Xo(e.slice(2)),t]}let tl=0;const qb=Promise.resolve(),Wb=()=>tl||(qb.then(()=>tl=0),tl=Date.now());function Kb(e,t){const n=o=>{if(!o._vts)o._vts=Date.now();else if(o._vts<=n.attached)return;ls(Jb(o,n.value),t,5,[o])};return n.value=e,n.attached=Wb(),n}function Jb(e,t){if(Re(t)){const n=e.stopImmediatePropagation;return e.stopImmediatePropagation=()=>{n.call(e),e._stopped=!0},t.map(o=>s=>!s._stopped&&o&&o(s))}else return t}const Q_=e=>e.charCodeAt(0)===111&&e.charCodeAt(1)===110&&e.charCodeAt(2)>96&&e.charCodeAt(2)<123,Xb=(e,t,n,o,s,i)=>{const r=s==="svg";t==="class"?Nb(e,o,r):t==="style"?Hb(e,n,o):Ya(t)?lu(t)||zb(e,t,n,o,i):(t[0]==="."?(t=t.slice(1),!0):t[0]==="^"?(t=t.slice(1),!1):Yb(e,t,o,r))?(X_(e,t,o),!e.tagName.includes("-")&&(t==="value"||t==="checked"||t==="selected")&&J_(e,t,o,r,i,t!=="value")):e._isVueCE&&(/[A-Z]/.test(t)||!Et(o))?X_(e,mo(t),o,i,t):(t==="true-value"?e._trueValue=o:t==="false-value"&&(e._falseValue=o),J_(e,t,o,r))};function Yb(e,t,n,o){if(o)return!!(t==="innerHTML"||t==="textContent"||t in e&&Q_(t)&&Be(n));if(t==="spellcheck"||t==="draggable"||t==="translate"||t==="autocorrect"||t==="form"||t==="list"&&e.tagName==="INPUT"||t==="type"&&e.tagName==="TEXTAREA")return!1;if(t==="width"||t==="height"){const s=e.tagName;if(s==="IMG"||s==="VIDEO"||s==="CANVAS"||s==="SOURCE")return!1}return Q_(t)&&Et(n)?!1:t in e}const Zb=["ctrl","shift","alt","meta"],Qb={stop:e=>e.stopPropagation(),prevent:e=>e.preventDefault(),self:e=>e.target!==e.currentTarget,ctrl:e=>!e.ctrlKey,shift:e=>!e.shiftKey,alt:e=>!e.altKey,meta:e=>!e.metaKey,left:e=>"button"in e&&e.button!==0,middle:e=>"button"in e&&e.button!==1,right:e=>"button"in e&&e.button!==2,exact:(e,t)=>Zb.some(n=>e[`${n}Key`]&&!t.includes(n))},Fs=(e,t)=>{const n=e._withMods||(e._withMods={}),o=t.join(".");return n[o]||(n[o]=(s,...i)=>{for(let r=0;r<t.length;r++){const a=Qb[t[r]];if(a&&a(s,t))return}return e(s,...i)})},e1=Yt({patchProp:Xb},Ib);let e$;function t1(){return e$||(e$=Qg(e1))}const t$=(...e)=>{const t=t1().createApp(...e),{mount:n}=t;return t.mount=o=>{const s=s1(o);if(!s)return;const i=t._component;!Be(i)&&!i.render&&!i.template&&(i.template=s.innerHTML),s.nodeType===1&&(s.textContent="");const r=n(s,!1,n1(s));return s instanceof Element&&(s.removeAttribute("v-cloak"),s.setAttribute("data-v-app","")),r},t};function n1(e){if(e instanceof SVGElement)return"svg";if(typeof MathMLElement=="function"&&e instanceof MathMLElement)return"mathml"}function s1(e){return Et(e)?document.querySelector(e):e}const _a={maxRetries:3,retryDelay:1e3,timeout:1e4};let nl=null;const bi={enabled:!0,maxCacheSize:50*1024*1024,cachePrefix:"mgpic_",version:"1.0.0",loadInterval:50,batchSize:3};class o1{constructor(){this.cache=new Map,this.totalSize=0}isSupported(){return"caches"in window}getCacheName(){return`${bi.cachePrefix}${bi.version}`}async isCached(t){if(!this.isSupported())return!1;try{return await(await caches.open(this.getCacheName())).match(t)!==void 0}catch(n){return f(":",n.message),!1}}async cacheResource(t,n){if(!this.isSupported())return!1;try{const o=await caches.open(this.getCacheName());if(await o.match(t))return f(`: ${t}`),!0;await o.put(t,n.clone());const i=n.headers.get("content-length");return i&&(this.totalSize+=parseInt(i)),f(`: ${t}`),!0}catch(o){return f(":",o.message),!1}}async getCachedResource(t){if(!this.isSupported())return null;try{return await(await caches.open(this.getCacheName())).match(t)}catch(n){return f(":",n.message),null}}async cleanupCache(){if(this.isSupported())try{const t=await caches.keys(),n=this.getCacheName();for(const o of t)o.startsWith(bi.cachePrefix)&&o!==n&&(await caches.delete(o),f(`: ${o}`))}catch(t){f(":",t.message)}}}const Wn=new o1;let Kr=null;function i1(){return Kr||(f("R2 URL"),Kr="https://pub-6f9181bda40946ea92b5e87fe84e27d4.r2.dev",Kr)}function Y(e){let t=e;e.startsWith("/assets/")?t=e.slice(7):e.startsWith("@assets/")&&(t=e.slice(8));const n=i1(),o=t.startsWith("/")?t.slice(1):t;return`${n}/${o}`}async function Ep(e,t={}){if(Wn.isSupported()){const s=await Wn.getCachedResource(e);if(s)return f(` Cache Storage : ${e}`),s}const{maxRetries:n=_a.maxRetries,retryDelay:o=_a.retryDelay}=t;for(let s=1;s<=n;s++)try{f(` (${s}/${n}): ${e}`);const i=new AbortController,r=setTimeout(()=>i.abort(),_a.timeout),a=await fetch(e,{method:"GET",mode:"cors",credentials:"omit",cache:"no-cache",signal:i.signal,...t});if(clearTimeout(r),a.ok)return Wn.isSupported()&&await Wn.cacheResource(e,a),f(`: ${e}`),a;throw new Error(`HTTP ${a.status}: ${a.statusText}`)}catch(i){if(f(` (${s}/${n}): ${e}`,i.message),s===n)throw f(`: ${e}`,i.message),i;const r=o*s;f(` ${r}ms ...`),await new Promise(a=>setTimeout(a,r))}}async function r1(e=["high","medium"]){try{if(nl){f("");const i=n$(nl,e);return f(` ${i.length}  (: ${e.join(", ")})`),i}const t=Y("asset-list.json");f(` R2 CDN : ${t}`);const n=await Ep(t);if(!n.ok)throw new Error(`: HTTP ${n.status}`);const o=await n.json();nl=o,f("");const s=n$(o,e);return f(` ${s.length}  (: ${e.join(", ")})`),s}catch(t){return f(":",t.message),["logo.glb","frontend_resource/start_game.png","frontend_resource/copper_warehouse.png","frontend_resource/game_wiki.png","frontend_resource/Tutorial.png","frontend_resource/gacha.png"]}}function n$(e,t){const n=[];for(const o of t)if(e.categories&&e.categories[o]){const s=e.categories[o].resources||[];n.push(...s.map(i=>i.path))}return n}async function jl(e=null,t=["high","medium"]){f("..."),await Wn.cleanupCache();const n=await r1(t),o=bi.batchSize,s=bi.loadInterval,i=n.length;let r=0;e&&e(0,i,0);for(let a=0;a<n.length;a+=o){const c=n.slice(a,a+o);f(` ${Math.floor(a/o)+1}/${Math.ceil(n.length/o)}: ${c.length} `);const l=c.map(async(g,m)=>{const v=Y(g);try{if(await Wn.isCached(v))return f(`Cache Storage: ${g}`),{success:!0,path:g,cached:!0,source:"cache"};const w=new AbortController,k=setTimeout(()=>w.abort(),_a.timeout),I=await fetch(v,{method:"GET",mode:"cors",credentials:"omit",cache:"no-cache",signal:w.signal});if(clearTimeout(k),I.ok){const P=I.headers.get("x-cache")||I.headers.get("cf-cache-status")||I.type==="basic"&&!I.redirected;return Wn.isSupported()&&await Wn.cacheResource(v,I),f(`: ${g}${P?" ()":""}`),{success:!0,path:g,cached:!1,fromBrowserCache:!!P}}else throw new Error(`HTTP ${I.status}: ${I.statusText}`)}catch(y){return f(`: ${g}`,y.message),{success:!1,path:g,error:y.message}}}),u=await Promise.all(l);r+=c.length;const _=Math.round(r/i*100);e&&e(r,i,_);const $=u.filter(g=>g.success).length,d=u.filter(g=>g.cached).length,p=u.filter(g=>g.fromBrowserCache).length,b=u.filter(g=>!g.success).length;f(`:  ${$}, Cache Storage ${d},  ${p},  ${b}`),a+o<n.length&&(f(` ${s}ms ...`),await new Promise(g=>setTimeout(g,s)))}f(""),e&&e(i,i,100)}async function a1(){if(!Wn.isSupported())return{supported:!1,message:"API"};try{const t=await(await caches.open(Wn.getCacheName())).keys();return{supported:!0,cacheName:Wn.getCacheName(),resourceCount:t.length,totalSize:Wn.totalSize,maxSize:bi.maxCacheSize}}catch(e){return{supported:!0,error:e.message}}}function cc(e,t){return Y(`copper/${e.toLowerCase()}/${t}/${t}.glb`)}function lc(e){return Y(`enemy/${e}/${e}.glb`)}function Ap(e){return Y(`structure/${e}/${e}.glb`)}function c1(e){return Y(e)}const qt=(e,t)=>{const n=e.__vccOpts||e;for(const[o,s]of t)n[o]=s;return n},l1={class:"hall-container"},u1=["src"],_1={__name:"Hall",props:{musicOn:{type:Boolean,default:!0},paused:{type:Boolean,default:!1}},emits:["startGame","openWarehouse","openTutorial","openEncyclopedia","toggle-music"],setup(e,{emit:t}){const n=t,o=e;function s(){n("startGame")}function i(){n("openWarehouse")}function r(){n("openTutorial")}function a(){const g="https://mgpic-2025.github.io/CopperPuppetry-Wiki/";f(`[Hall] : ${g}`),window!=null&&window.open?window.open(g,"_blank","noopener"):window.location.href=g}const c=oe(Y("@assets/frontend_resource/start_game.png")),l=oe(Y("@assets/frontend_resource/copper_warehouse.png")),u=oe(Y("@assets/frontend_resource/game_wiki.png")),_=oe(Y("@assets/frontend_resource/Tutorial.png")),$=oe(Y("ui/Gemini_Generated_Image_gtrehogtrehogtre (1).png")),d=oe(!1),p=oe(null),b=Y("@assets/frontend_resource/hall.mp3");return gn(()=>{setTimeout(()=>{d.value=!0,f("HallUI")},100),o.musicOn&&!o.paused&&p.value&&setTimeout(()=>{if(p.value.readyState>=2)p.value.play().then(()=>{f("[Hall] ")}).catch(m=>{f("[Hall] :",m)});else{const m=()=>{p.value.play().then(()=>{f("[Hall] ")}).catch(v=>{f("[Hall] :",v)}),p.value.removeEventListener("canplay",m)};p.value.addEventListener("canplay",m,{once:!0})}},200)}),Tn(()=>o.musicOn,g=>{if(p.value)if(g&&!o.paused)if(p.value.readyState>=2)p.value.play().catch(m=>{f("[Hall] :",m)});else{const m=()=>{p.value.play().catch(v=>{f("[Hall] :",v)}),p.value.removeEventListener("canplay",m)};p.value.addEventListener("canplay",m)}else p.value.pause()}),Tn(()=>o.paused,g=>{if(p.value){if(g)p.value.pause(),f("[Hall] ");else if(o.musicOn){if(p.value.readyState>=2)p.value.play().catch(m=>{f("[Hall] :",m)});else{const m=()=>{p.value.play().catch(v=>{f("[Hall] :",v)}),p.value.removeEventListener("canplay",m)};p.value.addEventListener("canplay",m)}f("[Hall] ")}}}),Ls(()=>{p.value&&p.value.pause()}),(g,m)=>(V(),Z("div",l1,[h("div",{class:"hall-bg",style:zn({backgroundImage:`url('${$.value}')`})},null,4),h("div",{class:kt(["menu",{"menu--loaded":d.value}])},[h("button",{class:"tile tile--start",style:zn({backgroundImage:`url('${c.value}')`}),onClick:s},[...m[0]||(m[0]=[h("div",{class:"tile__mask"},null,-1),h("div",{class:"tile__caption tile__caption--bottom"},[h("div",{class:"tile__title"},""),h("div",{class:"tile__subtitle"},"Begin Adventure")],-1)])],4),h("button",{class:"tile tile--warehouse",style:zn({backgroundImage:`url('${l.value}')`}),onClick:i},[...m[1]||(m[1]=[h("div",{class:"tile__mask"},null,-1),h("div",{class:"tile__caption tile__caption--top"},[h("div",{class:"tile__title"},""),h("div",{class:"tile__subtitle"},"Character Collection")],-1)])],4),h("button",{class:"tile tile--wiki",style:zn({backgroundImage:`url('${u.value}')`}),onClick:a},[...m[2]||(m[2]=[h("div",{class:"tile__mask"},null,-1),h("div",{class:"tile__caption tile__caption--bottom"},[h("div",{class:"tile__title"},""),h("div",{class:"tile__subtitle"},"Encyclopedia")],-1)])],4),h("button",{class:"tile tile--tutorial",style:zn({backgroundImage:`url('${_.value}')`}),onClick:r},[...m[3]||(m[3]=[h("div",{class:"tile__mask"},null,-1),h("div",{class:"tile__caption tile__caption--top"},[h("div",{class:"tile__title"},""),h("div",{class:"tile__subtitle"},"Tutorial")],-1)])],4)],2),h("audio",{ref_key:"audioRef",ref:p,src:ye(b),loop:"",preload:"auto"},null,8,u1)]))}},$1=qt(_1,[["__scopeId","data-v-8df2e7f5"]]),Kn={HeartCrystalDust:{name:"",icon:Y("resource/heart_crystal_dust.png")},RecallGear:{name:"",icon:Y("resource/recall_gear.png")},ResonantCrystal:{name:"",icon:Y("resource/resonant_star_crystal/resonant_star_crystal.png")},RefinedCopper:{name:"",icon:Y("resource/refined_copper_ingot/refined_copper_ingot.png")},SpiritalSpark:{name:"",icon:Y("resource/spiritual_spark.png")}};function uc(e){var t;if(Array.isArray(e==null?void 0:e.item_type)&&e.item_type[0]==="Resource"){const n=e.item_type[1];return((t=Kn[n])==null?void 0:t.name)||n}else if(Array.isArray(e==null?void 0:e.item_type)&&e.item_type[0]==="Equipment")return"";return""}function Qt(e){var t;return((t=Kn[e])==null?void 0:t.name)||e}function $s(e){var t;return((t=Kn[e])==null?void 0:t.icon)||""}function d1(e){return{all:e=e||new Map,on:function(t,n){var o=e.get(t);o?o.push(n):e.set(t,[n])},off:function(t,n){var o=e.get(t);o&&(n?o.splice(o.indexOf(n)>>>0,1):e.set(t,[]))},emit:function(t,n){var o=e.get(t);o&&o.slice().map(function(s){s(n)}),(o=e.get("*"))&&o.slice().map(function(s){s(t,n)})}}}const xu=d1(),kn={UPDATE_RESOURCES:"update:resources",RESOURCES_UPDATED:"resources:updated",COPPER_ID_ADDED:"copper:id:added",START_MENU_PAUSE:"menu:pause",START_MENU_RESUME:"menu:resume",START_MENU_STARTED:"menu:started",CONTROL_MODE_CHANGED:"control:mode:changed",GAME_STARTED:"game:started",GAME_ENDED:"game:ended"},Oo=(e,t)=>{xu.emit(e,t)},_c=(e,t)=>{xu.on(e,t)},Pu=(e,t)=>{xu.off(e,t)};class p1{constructor(){this.queue=[],this.isProcessing=!1,this.handlers=new Map,this.sceneContext=null}setSceneContext(t){this.sceneContext=t}registerHandler(t,n){this.handlers.set(t,n)}enqueue(t){["handle_on_click_copper","on_game_start"].includes(t.type_msg)&&f("[MessageQueue] :",t.type_msg),this.queue.push(t),this.isProcessing||this.processNext()}async processNext(){if(this.queue.length===0){this.isProcessing=!1;return}this.isProcessing=!0;const t=50;let n=0;for(;this.queue.length>0&&n<t;){const o=this.queue.shift();n++;try{const{type_msg:s,content:i}=o,r=this.handlers.get(s);if(r){const a=JSON.parse(i),c=r(a,this.sceneContext||{});c&&typeof c.then=="function"&&await c}else f("[MessageQueue] :",s),f("[MessageQueue] :",Array.from(this.handlers.keys()))}catch(s){f("[MessageQueue] :",s),f("[MessageQueue] :",s.message),f("[MessageQueue] :",s.stack)}}this.queue.length>0?requestAnimationFrame(()=>this.processNext()):this.isProcessing=!1}}const je=new p1;function Jr(e,t){return e.find(n=>n.id===t)}function s$(e){return new Promise(t=>setTimeout(t,e))}function m1(){f("[MessageQueue] ..."),je.registerHandler("handle_on_click_copper",async(i,r)=>{var u,_;const{copper:a,resources:c,has_attack_targets:l}=i;f(`[Handler] : ${((u=a.copper.copper_info)==null?void 0:u.name)||"Unknown"} (ID=${a.id})`),f(`[Handler] : HP=${a.now_health}/${a.copper.attribute.health}, =${a.can_move}, =${a.can_attack}, =${a.can_summon}, =${a.can_build}, =${l}`),f(`[Handler] : ${(_=a.copper)==null?void 0:_.copper_type}`),r.highlightSelectedCopper&&r.highlightSelectedCopper(a.id),r.onShowCopperInfo&&r.onShowCopperInfo(a,c,l)}),je.registerHandler("handle_on_click_enemy",async(i,r)=>{var d,p;const{enemy:a,resources:c,has_attack_targets:l}=i,u=a.owned||!1;f(`[Handler] ${u?"":""}: ${((d=a.enemy_base)==null?void 0:d.name)||"Unknown"} (ID=${a.id})`),f(`[Handler] : HP=${a.now_health}/${a.enemy_base.health}, =${a.can_move}, =${a.can_attack}, owned=${a.owned}, =${l}`);const $={id:a.id,now_health:a.now_health,can_move:u?a.can_move:!1,can_attack:u?a.can_attack:!1,can_summon:!1,position:a.position,isEnemy:!u,isOwnedEnemy:u,copper:{copper_info:{name:((p=a.enemy_base)==null?void 0:p.name)||(u?"":"")},attribute:{health:a.enemy_base.health,attack:a.enemy_base.attack,defense:a.enemy_base.defense,speed:a.enemy_base.speed}}};r.highlightSelectedCopper&&r.highlightSelectedCopper(a.id),r.onShowCopperInfo&&r.onShowCopperInfo($,c,l)}),je.registerHandler("handle_on_click_structure",async(i,r)=>{var _;const{structure:a,resources:c}=i,u=a.owned||!1?"":"";f(`[Handler] ${u}: ${((_=a.structure_base)==null?void 0:_.name)||"Unknown"} (ID=${a.id})`),f(`[Handler] : HP=${a.now_health}/${a.structure_base.health}, =${a.can_move}, =${a.can_attack}, owned=${a.owned}, =${a.structure_base.has_storage}`),r.highlightSelectedCopper&&r.highlightSelectedCopper(a.id),r.onShowStructureInfo&&r.onShowStructureInfo(a,c)}),je.registerHandler("set_copper",async(i,r)=>{const{id:a,position:c,copper:l}=i;window.__ACTUAL_COPPER_IDS__||(window.__ACTUAL_COPPER_IDS__=[]),window.__ACTUAL_COPPER_IDS__.push(l.id),Oo(kn.COPPER_ID_ADDED,l.id),r.onSetCopper&&await r.onSetCopper(a,c,l)}),je.registerHandler("set_enemy",async(i,r)=>{const{id:a,position:c,enemy:l}=i;r.onSetEnemy&&r.onSetEnemy(a,c,l),l.owned&&Oo(kn.UPDATE_RESOURCES)}),je.registerHandler("set_material",async(i,r)=>{const{id:a,position:c,material:l}=i;r.onSetMaterial&&await r.onSetMaterial(a,c,l)}),je.registerHandler("set_structure",async(i,r)=>{const{id:a,position:c,structure:l}=i;r.onSetStructure&&await r.onSetStructure(a,c,l),l.owned&&Oo(kn.UPDATE_RESOURCES)}),je.registerHandler("remove_unit",async(i,r)=>{const{id:a}=i,c=Jr(r.models||[],a),l=c&&c.type==="enemy"&&!c.isOwned,u=l?c.position:null;if(f(`[Handler] remove_unit: ID=${a}, type=${c==null?void 0:c.type}, isOwned=${c==null?void 0:c.isOwned}, isEnemyDeath=${l}, position=${JSON.stringify(u)}`),c&&c.object){c.object.traverse(d=>{d.material&&(Array.isArray(d.material)?d.material=d.material.map(p=>p.clone()):d.material=d.material.clone())});const _=500,$=performance.now();if(await new Promise(d=>{function p(){const b=performance.now()-$,g=Math.min(b/_,1);c.object&&c.object.traverse(m=>{m.material&&(Array.isArray(m.material)?m.material.forEach(v=>{v.transparent=!0,v.opacity=1-g}):(m.material.transparent=!0,m.material.opacity=1-g))}),g<1?requestAnimationFrame(p):d()}p()}),r.scene&&r.scene.remove(c.object),c.object.traverse(d=>{d.geometry&&d.geometry.dispose(),d.material&&(Array.isArray(d.material)?d.material.forEach(p=>{p.map&&p.map.dispose(),p.lightMap&&p.lightMap.dispose(),p.bumpMap&&p.bumpMap.dispose(),p.normalMap&&p.normalMap.dispose(),p.specularMap&&p.specularMap.dispose(),p.envMap&&p.envMap.dispose(),p.alphaMap&&p.alphaMap.dispose(),p.aoMap&&p.aoMap.dispose(),p.displacementMap&&p.displacementMap.dispose(),p.emissiveMap&&p.emissiveMap.dispose(),p.metalnessMap&&p.metalnessMap.dispose(),p.roughnessMap&&p.roughnessMap.dispose(),p.dispose()}):(d.material.map&&d.material.map.dispose(),d.material.lightMap&&d.material.lightMap.dispose(),d.material.bumpMap&&d.material.bumpMap.dispose(),d.material.normalMap&&d.material.normalMap.dispose(),d.material.specularMap&&d.material.specularMap.dispose(),d.material.envMap&&d.material.envMap.dispose(),d.material.alphaMap&&d.material.alphaMap.dispose(),d.material.aoMap&&d.material.aoMap.dispose(),d.material.displacementMap&&d.material.displacementMap.dispose(),d.material.emissiveMap&&d.material.emissiveMap.dispose(),d.material.metalnessMap&&d.material.metalnessMap.dispose(),d.material.roughnessMap&&d.material.roughnessMap.dispose(),d.material.dispose()))}),r.models){const d=r.models.indexOf(c);d>-1&&r.models.splice(d,1)}r.onClearState&&r.onClearState(a),r.onRemoveHealthBar&&r.onRemoveHealthBar(a),c.type==="copper"&&r.onRemoveCopper&&r.onRemoveCopper(a)}if(l&&u){f("[Handler] ...");const _=$=>{f("[Handler] :",$),r.onShowResourceGain&&Object.keys($).length>0&&(f("[Handler] :",u,$),r.onShowResourceGain(u,$))};_c(kn.RESOURCES_UPDATED,_),Oo(kn.UPDATE_RESOURCES),setTimeout(()=>{Pu(kn.RESOURCES_UPDATED,_)},1e3)}}),je.registerHandler("change_direction",async(i,r)=>{const{id:a,direction:c}=i,l=Jr(r.models||[],a);if(l&&l.object){let u=0;switch(c){case"PositiveY":u=0;break;case"PositiveX":u=Math.PI/2;break;case"NegativeY":u=Math.PI;break;case"NegativeX":u=-Math.PI/2;break}let _=l.object.rotation.y;_=Math.atan2(Math.sin(_),Math.cos(_));let $=u-_;$>Math.PI?$-=2*Math.PI:$<-Math.PI&&($+=2*Math.PI);const d=300,p=performance.now();await new Promise(b=>{function g(){const m=performance.now()-p,v=Math.min(m/d,1),y=1-Math.pow(1-v,2);l.object&&(l.object.rotation.y=_+$*y),v<1?requestAnimationFrame(g):(l.object&&(l.object.rotation.y=u),b())}g()})}}),je.registerHandler("move_to",async(i,r)=>{const{id:a,to:c}=i,l=Jr(r.models||[],a);if(l&&l.object&&r.gridCellSize){const[u,_]=c,$=u,d=_,p=l.object.position.y;l.position=[u,_],r.onMoveStart&&r.onMoveStart(a,l),r.animateModelMove&&await new Promise(b=>{r.animateModelMove(l,{x:$,y:p,z:d},b)}),r.onMoveComplete&&r.onMoveComplete(a)}}),je.registerHandler("display_can_move",(i,r)=>{const{id:a,can_move:c}=i,l=c==="true"||c===!0;r.onDisplayCanMove&&r.onDisplayCanMove(a,l)}),je.registerHandler("display_can_attack",(i,r)=>{const{id:a,can_attack:c}=i,l=c==="true"||c===!0;r.onDisplayCanAttack&&r.onDisplayCanAttack(a,l)}),je.registerHandler("display_can_summon",(i,r)=>{const{id:a,can_summon:c}=i,l=c==="true"||c===!0;f(`[Handler] display_can_summon id=${a}, can_summon=${l}`),r.onDisplayCanSummon&&r.onDisplayCanSummon(a,l)}),je.registerHandler("update_health",(i,r)=>{const{id:a,now_health:c,max_health:l}=i;r.onUpdateHealth&&r.onUpdateHealth(a,c,l)}),je.registerHandler("clear_state",(i,r)=>{const{id:a}=i;r.onClearState&&r.onClearState(a)}),je.registerHandler("animate_move",async(i,r)=>{const{id:a}=i,c=Jr(r.models||[],a);if(!c){f(`[Handler] animate_move:  ID=${a}`);return}if(window.disableAutoFocus){f(`[Handler] animate_move:  ID=${a}`);return}const l=r.followEnemies!==void 0?r.followEnemies:!1;if(c.type==="enemy"&&!l){f(`[Handler] animate_move:  ID=${a}  context.followEnemies = true `);return}if(r.camera&&r.focusOnModel){const u=r.focusOnModel(c.object,r.camera,r.controls);r.focusState&&(r.focusState.focusPosition=u.focusPosition,r.focusState.focusTarget=u.focusTarget,r.focusState.lerpFactor=u.lerpFactor,f(`[Handler] animate_move:  ID=${a} (${c.name})`)),await s$(1e3)}}),je.registerHandler("animate_reset",async(i,r)=>{if(f("[Handler] animate_reset"),r.camera&&r.controls){const a={x:0,y:2,z:5},c={x:0,y:0,z:0};r.focusState&&(r.focusState.focusPosition=a,r.focusState.focusTarget=c,r.focusState.lerpFactor=.08),await s$(1e3)}}),je.registerHandler("put_map_block",(i,r)=>{const{position:a}=i;r.onPutMapBlock&&r.onPutMapBlock(a)}),je.registerHandler("put_room_blocks",async(i,r)=>{const{room_position:a,size:c}=i,[l,u]=a;if(f(`[Handler]  : [${l}, ${u}], ${c}x${c}`),!r.onPutMapBlock){f("[Handler]  context.onPutMapBlock ");return}f("[Handler]  context.onPutMapBlock ...");const _=32,$=c*c;let d=0;for(let p=0;p<c;p++)for(let b=0;b<c;b++){const g=[l+p,u+b];r.onPutMapBlock(g),d++,d%_===0&&await new Promise(m=>requestAnimationFrame(m))}f(`[Handler]  : ${$}`)}),je.registerHandler("put_resource_marker",(i,r)=>{const{position:a}=i;r.onPutResourceMarker&&r.onPutResourceMarker(a)}),je.registerHandler("clear_resource_marker",(i,r)=>{const{position:a}=i;r.onClearResourceMarker&&r.onClearResourceMarker(a)});let e=0,t=0,n=0;je.registerHandler("set_move_block",(i,r)=>{const{position:a}=i;e++,r.onSetMoveBlock&&r.onSetMoveBlock(a)}),je.registerHandler("set_attack_block",(i,r)=>{const{position:a}=i;t++,r.onSetAttackBlock&&r.onSetAttackBlock(a),(t===1||t%10===0)&&f(`[Handler]  ${t} `)}),je.registerHandler("set_can_summon_blocks",(i,r)=>{const{position:a}=i;n++,r.onSetCanSummonBlock&&r.onSetCanSummonBlock(a),(n===1||n%10===0)&&f(`[Handler]  ${n} `)});let o=0,s=Date.now();je.registerHandler("clear_block",(i,r)=>{const{position:a}=i;r.onClearBlock&&r.onClearBlock(a),o++;const c=Date.now();c-s>500&&(o>1&&f(`[Handler]   ${o} `),o=0,e>0&&(f(`[Handler]  ${e} `),e=0),t>0&&(f(`[Handler]  ${t} `),t=0),n>0&&(f(`[Handler]  ${n} `),n=0)),s=c}),je.registerHandler("attack_complete",(i,r)=>{const{id:a}=i;r.onAttackComplete&&r.onAttackComplete(a)}),je.registerHandler("on_game_round_pass",(i,r)=>{}),je.registerHandler("craft_success",(i,r)=>{r.onCraftResult&&r.onCraftResult(!0,i.message||"")}),je.registerHandler("craft_failed",(i,r)=>{r.onCraftResult&&r.onCraftResult(!1,i.message||"")}),je.registerHandler("cannot_pick_up_item",(i,r)=>{f("[Handler] :",i.message||i)}),je.registerHandler("equipment_slot_full",(i,r)=>{f("[Handler] :",i.message||i)}),je.registerHandler("inventory_full",(i,r)=>{f("[Handler] :",i.message||i)}),je.registerHandler("resource_not_enough",(i,r)=>{let a="";if(i.missing&&Array.isArray(i.missing)&&i.missing.length>0){const c={HeartCrystalDust:"",RecallGear:"",SpiritalSpark:"",RefinedCopper:"",ResonantCrystal:""};a=`: ${i.missing.map(u=>{const _=c[u.type]||u.type,$=u.needed-u.current;return`${_} ( ${$})`}).join("")}`}f("[Handler] :",a),r.onResourceNotEnough&&r.onResourceNotEnough(a)}),je.registerHandler("summon_failed",(i,r)=>{f("[Handler] :",i.message||i),r.onSummonFailed&&r.onSummonFailed(i.message||"")}),je.registerHandler("summon_expired",(i,r)=>{const{id:a,message:c}=i;f(`[Handler] : ID=${a}, ${c}`)}),je.registerHandler("get_summon_menu",(i,r)=>{const{contents:a}=i;f("[Handler] :",a),r.onShowSummonMenu&&r.onShowSummonMenu(a)}),je.registerHandler("get_structure_menu",(i,r)=>{const{contents:a}=i;if(!a||a.length===0){f("[Handler]  ");return}const c=a.filter(l=>l.name!=="");f("[Handler] ",c.length,""),r.onShowStructureMenu&&r.onShowStructureMenu(c)}),je.registerHandler("drill_resource_generate",(i,r)=>{const{position:a,resource_type:c,amount:l}=i;f(`[Handler] : =${JSON.stringify(a)}, =${c}, =${l}`);const u={[c]:parseInt(l)};r.onShowResourceGain&&r.onShowResourceGain(a,u),Oo(kn.UPDATE_RESOURCES)}),je.registerHandler("game_over",(i,r)=>{f("[Handler] "),r.onGameOver&&r.onGameOver()}),je.registerHandler("success",(i,r)=>{f("[Handler] "),r.onGameSuccess&&r.onGameSuccess()})}const Gp={hi:-1,lo:-1},f1={hi:232830643,lo:-1486618624},Ct={hi:0,lo:0},ln={hi:0,lo:1},nn={hi:0,lo:10},h1={hi:0,lo:100},g1={hi:0,lo:1e3},b1={hi:0,lo:1e4},y1={hi:0,lo:1e5},v1={hi:0,lo:1e6},w1={hi:0,lo:1e7},S1={hi:0,lo:1e8},k1={hi:0,lo:1e9},M1={hi:2,lo:1410065408},C1={hi:23,lo:1215752192},x1={hi:232,lo:-727379968},P1={hi:2328,lo:1316134912},L1={hi:23283,lo:276447232},I1={hi:232830,lo:-1530494976},T1={hi:0,lo:22},E1={hi:0,lo:37},A1={hi:-1,lo:-22},o$=new DataView(new ArrayBuffer(8));function Lu(e){return o$.setInt32(0,e,!0),o$.getFloat32(0,!0)}const G1={$tag:0},Rp={$tag:1},Op={$tag:2};function Ar(e,t){this._0=e,this._1=t}Ar.prototype.$tag=3;function Ee(e){this._0=e}Ee.prototype.$tag=4;function En(e){this._0=e}En.prototype.$tag=5;function ke(e){this._0=e}ke.prototype.$tag=6;const R1={hi:-1048576,lo:0},O1={hi:2146435072,lo:0},D1={hi:2146959360,lo:1},Dp={hi:0,lo:2};class N1 extends Error{}function ee(){throw new N1}function S(e,t){if(t<0||t>=e.length)throw new Error("Index out of bounds")}function $t(e,t){const n=new Array(e);return n.fill(t),n}const j1=e=>e.slice(0);function Fi(e){this._0=e}Fi.prototype.$tag=1;function De(e){this._0=e}De.prototype.$tag=6;function Gr(e,t){this._0=e,this._1=t}Gr.prototype.$tag=5;const An={$tag:4},Np={$tag:1};function Ws(e){this._0=e}Ws.prototype.$tag=0;function jp(e){this._0=e}jp.prototype.$tag=0;function $c(e){this._0=e}$c.prototype.$tag=0;function Iu(e){this._0=e}Iu.prototype.$tag=1;function Hp(e){this._0=e}Hp.prototype.$tag=0;function Fp(e){this._0=e}Fp.prototype.$tag=1;function Tu(e){this._0=e}Tu.prototype.$tag=0;function uo(e){this._0=e}uo.prototype.$tag=1;function Up(e){this._0=e}Up.prototype.$tag=0;function Eo(e){this._0=e}Eo.prototype.$tag=1;function Bp(e){this._0=e}Bp.prototype.$tag=0;function zp(e){this._0=e}zp.prototype.$tag=0;function Vp(e){this._0=e}Vp.prototype.$tag=1;const sl={hi:2147483647,lo:-1},i$={hi:0,lo:16},ol={hi:-2147483648,lo:0};function H1(e,t){return new Uint8Array(e)}const F1={hi:0,lo:65536},$a={$tag:0};function Eu(e){this._0=e}Eu.prototype.$tag=1;function dc(e){return e=e-(e>>>1&1431655765),e=(e&858993459)+(e>>>2&858993459),e=e+(e>>>4)&252645135,e=e+(e>>>8),e=e+(e>>>16),e&63}function U1(e){return e>>>=0,e===0?32:(e&=-e,31-Math.clz32(e))}function Vo(e,t,n){this._0=e,this._1=t,this._2=n}Vo.prototype.$tag=0;function _o(e,t,n){this._0=e,this._1=t,this._2=n}_o.prototype.$tag=1;function Mi(e){this._0=e}Mi.prototype.$tag=2;const yi={$tag:0};function hr(e,t){this._0=e,this._1=t}hr.prototype.$tag=1;function pc(e){this._0=e}pc.prototype.$tag=0;function ys(e){this._0=e}ys.prototype.$tag=1;function mc(e){this._0=e}mc.prototype.$tag=0;function Au(e){this._0=e}Au.prototype.$tag=1;function Rr(e){this._0=e}Rr.prototype.$tag=0;function Nn(e){this._0=e}Nn.prototype.$tag=1;function go(e){this._0=e}go.prototype.$tag=0;function Ut(e){this._0=e}Ut.prototype.$tag=1;function qp(e){this._0=e}qp.prototype.$tag=0;function Wp(e){this._0=e}Wp.prototype.$tag=1;function Kp(e){this._0=e}Kp.prototype.$tag=0;function Jp(e){this._0=e}Jp.prototype.$tag=0;function Ui(e){this._0=e}Ui.prototype.$tag=1;function Xp(e){this._0=e}Xp.prototype.$tag=0;function Hl(e){this._0=e}Hl.prototype.$tag=1;function Yp(e){this._0=e}Yp.prototype.$tag=0;function Zp(e){this._0=e}Zp.prototype.$tag=1;const B1={hi:2097151,lo:-1},z1={hi:-2097152,lo:1};function Qp(e){this._0=e}Qp.prototype.$tag=0;function em(e){this._0=e}em.prototype.$tag=1;function Fl(e){this._0=e}Fl.prototype.$tag=0;function tm(e){this._0=e}tm.prototype.$tag=1;const V1={$tag:0},q1={$tag:1},W1={$tag:2};function Bi(e,t){this._0=e,this._1=t}Bi.prototype.$tag=3;function fc(e){this._0=e}fc.prototype.$tag=4;const K1={$tag:5},nm={$tag:6},J1={$tag:7},sm={$tag:8},om={$tag:9};function im(e,t){this._0=e,this._1=t}im.prototype.$tag=0;function rm(e,t){this._0=e,this._1=t}rm.prototype.$tag=1;const am={$tag:0};function tt(e,t){this._0=e,this._1=t}tt.prototype.$tag=1;const X1={$tag:0};function cm(e){this._0=e}cm.prototype.$tag=1;const il={hi:0,lo:-1},Y1=new Uint8Array([65,66,67,68,69,70,71,72,73,74,75,76,77,78,79,80,81,82,83,84,85,86,87,88,89,90,49,50,51,52,53,54]),Z1=()=>{var e;if((e=globalThis.crypto)!=null&&e.getRandomValues){const t=new Uint32Array(1);return globalThis.crypto.getRandomValues(t),t[0]|0}else return Math.floor(Math.random()*4294967296)|0},Q1=(e,t)=>e.toString(t),e2=e=>(e.hi>>>0)*4294967296+(e.lo>>>0),t2=function e(t){let n=e._view;return n===void 0&&(n=e._view=new DataView(new ArrayBuffer(8))),n.setUint32(0,t.hi),n.setUint32(4,t.lo),n.getFloat64(0)},bn=(e,t)=>{e.push(t)},Gu=function e(){return e._exports?e._exports:e._exports=new WebAssembly.Instance(new WebAssembly.Module(new Uint8Array([0,97,115,109,1,0,0,0,1,13,2,96,0,1,127,96,4,127,127,127,127,1,127,3,7,6,0,1,1,1,1,1,6,6,1,127,1,65,0,11,7,50,6,3,109,117,108,0,1,5,100,105,118,95,115,0,2,5,100,105,118,95,117,0,3,5,114,101,109,95,115,0,4,5,114,101,109,95,117,0,5,8,103,101,116,95,104,105,103,104,0,0,10,191,1,6,4,0,35,0,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,126,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,127,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,128,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,129,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,130,34,4,66,32,135,167,36,0,32,4,167,11])),{}).exports},n2=(e,t)=>{const n=e.hi,o=t.hi;if(n<o)return-1;if(n>o)return 1;const s=e.lo>>>0,i=t.lo>>>0;return s<i?-1:s>i?1:0},s2=(e,t)=>{const n=e.hi>>>0,o=t.hi>>>0;if(n<o)return-1;if(n>o)return 1;const s=e.lo>>>0,i=t.lo>>>0;return s<i?-1:s>i?1:0},o2=e=>e.hi*4294967296+(e.lo>>>0),i2=e=>e.pop(),r2=(e,t,n)=>e.splice(t,n),Xr={$tag:0};function zi(e){this._0=e}zi.prototype.$tag=1;function Ao(e){this._0=e}Ao.prototype.$tag=0;function lm(e){this._0=e}lm.prototype.$tag=1;function da(e){this._0=e}da.prototype.$tag=0;function um(e){this._0=e}um.prototype.$tag=1;function ai(e){this._0=e}ai.prototype.$tag=0;function _m(e){this._0=e}_m.prototype.$tag=1;function ps(e){this._0=e}ps.prototype.$tag=0;function $m(e){this._0=e}$m.prototype.$tag=1;function Vi(e){this._0=e}Vi.prototype.$tag=0;function ci(e){this._0=e}ci.prototype.$tag=1;const r$={$tag:0};function Ul(e){this._0=e}Ul.prototype.$tag=1;function Bl(e){this._0=e}Bl.prototype.$tag=0;function dm(e){this._0=e}dm.prototype.$tag=1;const a2={$tag:0};function pm(e){this._0=e}pm.prototype.$tag=1;const mm={$tag:0};function Ru(e){this._0=e}Ru.prototype.$tag=1;function Go(e){this._0=e}Go.prototype.$tag=0;function fm(e){this._0=e}fm.prototype.$tag=1;function qi(e){this._0=e}qi.prototype.$tag=0;function hm(e){this._0=e}hm.prototype.$tag=1;function qo(e){this._0=e}qo.prototype.$tag=0;function Ci(e){this._0=e}Ci.prototype.$tag=1;function Wo(e){this._0=e}Wo.prototype.$tag=2;function $o(e){this._0=e}$o.prototype.$tag=0;function vi(e){this._0=e}vi.prototype.$tag=1;function zl(e){this._0=e}zl.prototype.$tag=2;function Ou(e){this._0=e}Ou.prototype.$tag=3;const gr={$tag:4};function gm(e){this._0=e}gm.prototype.$tag=0;const c2=Gp,bm="value out of range",xi="invalid syntax",a$="",ym=f1,l2=Ct,u2=Ct,Jt={mantissa_bits:52,exponent_bits:11,bias:-1023},Yr=[1,3,6,9,13,16,19,23,26,29,33,36,39,43,46,49,53,56,59],_2={_0:0,_1:""},$2={_0:1,_1:"5"},d2={_0:1,_1:"25"},p2={_0:1,_1:"125"},m2={_0:2,_1:"625"},f2={_0:2,_1:"3125"},h2={_0:2,_1:"15625"},g2={_0:3,_1:"78125"},b2={_0:3,_1:"390625"},y2={_0:3,_1:"1953125"},v2={_0:4,_1:"9765625"},w2={_0:4,_1:"48828125"},S2={_0:4,_1:"244140625"},k2={_0:4,_1:"1220703125"},M2={_0:5,_1:"6103515625"},C2={_0:5,_1:"30517578125"},x2={_0:5,_1:"152587890625"},P2={_0:6,_1:"762939453125"},L2={_0:6,_1:"3814697265625"},I2={_0:6,_1:"19073486328125"},T2={_0:7,_1:"95367431640625"},E2={_0:7,_1:"476837158203125"},A2={_0:7,_1:"2384185791015625"},G2={_0:7,_1:"11920928955078125"},R2={_0:8,_1:"59604644775390625"},O2={_0:8,_1:"298023223876953125"},D2={_0:8,_1:"1490116119384765625"},N2={_0:9,_1:"7450580596923828125"},j2={_0:9,_1:"37252902984619140625"},H2={_0:9,_1:"186264514923095703125"},F2={_0:10,_1:"931322574615478515625"},U2={_0:10,_1:"4656612873077392578125"},B2={_0:10,_1:"23283064365386962890625"},z2={_0:10,_1:"116415321826934814453125"},V2={_0:11,_1:"582076609134674072265625"},q2={_0:11,_1:"2910383045673370361328125"},W2={_0:11,_1:"14551915228366851806640625"},K2={_0:12,_1:"72759576141834259033203125"},J2={_0:12,_1:"363797880709171295166015625"},X2={_0:12,_1:"1818989403545856475830078125"},Y2={_0:13,_1:"9094947017729282379150390625"},Z2={_0:13,_1:"45474735088646411895751953125"},Q2={_0:13,_1:"227373675443232059478759765625"},ey={_0:13,_1:"1136868377216160297393798828125"},ty={_0:14,_1:"5684341886080801486968994140625"},ny={_0:14,_1:"28421709430404007434844970703125"},sy={_0:14,_1:"142108547152020037174224853515625"},oy={_0:15,_1:"710542735760100185871124267578125"},iy={_0:15,_1:"3552713678800500929355621337890625"},ry={_0:15,_1:"17763568394002504646778106689453125"},ay={_0:16,_1:"88817841970012523233890533447265625"},cy={_0:16,_1:"444089209850062616169452667236328125"},ly={_0:16,_1:"2220446049250313080847263336181640625"},uy={_0:16,_1:"11102230246251565404236316680908203125"},_y={_0:17,_1:"55511151231257827021181583404541015625"},$y={_0:17,_1:"277555756156289135105907917022705078125"},dy={_0:17,_1:"1387778780781445675529539585113525390625"},py={_0:18,_1:"6938893903907228377647697925567626953125"},my={_0:18,_1:"34694469519536141888238489627838134765625"},fy={_0:18,_1:"173472347597680709441192448139190673828125"},hy={_0:19,_1:"867361737988403547205962240695953369140625"},Zr=[_2,$2,d2,p2,m2,f2,h2,g2,b2,y2,v2,w2,S2,k2,M2,C2,x2,P2,L2,I2,T2,E2,A2,G2,R2,O2,D2,N2,j2,H2,F2,U2,B2,z2,V2,q2,W2,K2,J2,X2,Y2,Z2,Q2,ey,ty,ny,sy,oy,iy,ry,ay,cy,ly,uy,_y,$y,dy,py,my,fy,hy],c$=[ln,nn,h1,g1,b1,y1,v1,w1,S1,k1,M1,C1,x1,P1,L1,I1],rl=T1,l$=[1,10,100,1e3,1e4,1e5,1e6,1e7,1e8,1e9,1e10,1e11,1e12,1e13,1e14,1e15,1e16,1e17,1e18,1e19,1e20,1e21,1e22,0,0,0,0,0,0,0,0,0],gy=E1,by=A1,yy=Ct,vy={_0:160,_1:160},wy={_0:5760,_1:5760},Sy={_0:8192,_1:8202},ky={_0:8232,_1:8233},My={_0:8239,_1:8239},Cy={_0:8287,_1:8287},xy={_0:12288,_1:12288},Py={_0:65279,_1:65279},u$=".",_$="e",$$="E",Ly=Lu(2143289344),Iy=Lu(2139095040),Ty=Lu(-8388608),Ey=0,Ay=0,Gy=G1,Ry="",Oy="",Dy="/assets/copper/iron_wall/rocky/rocky.png",Ny="/assets/copper/iron_wall/rocky/rocky.glb",jy="",Hy="",Fy="/assets/copper/iron_wall/wesley/wesley.png",Uy="/assets/copper/iron_wall/wesley/wesley.glb",By="",zy="",Vy="/assets/copper/iron_wall/bell/bell.png",qy="/assets/copper/iron_wall/bell/bell.glb",Wy="",Ky="",Jy="/assets/copper/iron_wall/tumble/tumble.png",Xy="/assets/copper/iron_wall/tumble/tumble.glb",Yy="",Zy="",Qy="/assets/copper/iron_wall/chief/chief.png",e4="/assets/copper/iron_wall/chief/chief.glb",t4="",n4="1001",s4="/assets/copper/arcanist/spark/spark.png",o4="/assets/copper/arcanist/spark/spark.glb",i4="",r4="",a4="/assets/copper/arcanist/syrup/syrup.png",c4="/assets/copper/arcanist/syrup/syrup.glb",l4="",u4="",_4="/assets/copper/arcanist/bubble/bubble.png",$4="/assets/copper/arcanist/bubble/bubble.glb",d4="",p4="",m4="/assets/copper/arcanist/glimmer/glimmer.png",f4="/assets/copper/arcanist/glimmer/glimmer.glb",h4="",g4="",b4="/assets/copper/arcanist/turner/turner.png",y4="/assets/copper/arcanist/turner/turner.glb",v4="",w4="",S4="/assets/copper/resonator/murmur/murmur.png",k4="/assets/copper/resonator/murmur/murmur.glb",M4="",C4="",x4="/assets/copper/resonator/melody/melody.png",P4="/assets/copper/resonator/melody/melody.glb",L4="",I4="",T4="/assets/copper/resonator/clawster/clawster.png",E4="/assets/copper/resonator/clawster/clawster.glb",A4="",G4=" 3*3 ",R4="/assets/copper/resonator/diggs/diggs.png",O4="/assets/copper/resonator/diggs/diggs.glb",D4="",N4="",j4="/assets/copper/resonator/hive/hive.png",H4="/assets/copper/resonator/hive/hive.glb",F4="",U4="",B4="/assets/copper/mechanic/gyro/gyro.png",z4="/assets/copper/mechanic/gyro/gyro.glb",V4="",q4="",W4="/assets/copper/mechanic/tricky/tricky.png",K4="/assets/copper/mechanic/tricky/tricky.glb",J4="",X4="",Y4="/assets/copper/mechanic/pendulum/pendulum.png",Z4="/assets/copper/mechanic/pendulum/pendulum.glb",Q4="",ev="",tv="/assets/copper/mechanic/yoyo/yoyo.png",nv="/assets/copper/mechanic/yoyo/yoyo.glb",sv="",ov="",iv="/assets/copper/mechanic/karin/karin.png",rv="/assets/copper/mechanic/karin/karin.glb",av="",cv="",lv="/assets/copper/craftsman/wrench/wrench.png",uv="/assets/copper/craftsman/wrench/wrench.glb",_v="",$v="",dv="/assets/copper/craftsman/coil/coil.png",pv="/assets/copper/craftsman/coil/coil.glb",mv="",fv="",hv="/assets/copper/craftsman/artifex/artifex.png",gv="/assets/copper/craftsman/artifex/artifex.glb",bv="",yv="",vv="/assets/copper/craftsman/drillbit/drillbit.png",wv="/assets/copper/craftsman/drillbit/drillbit.glb",Sv="",kv="",Mv="/assets/copper/craftsman/quickhand/quickhand.png",Cv="/assets/copper/craftsman/quickhand/quickhand.glb",xv=10,Pv={name:"",description:"1082",resource_url:"/assets/copper/iron_wall/rocky/rocky_skill.png",cool_down:xv},Lv=Pv,Iv=10,Tv={name:"",description:" 20%  15% ",resource_url:"/assets/copper/iron_wall/wesley/wesley_skill.png",cool_down:Iv},Ev=Tv,Av=20,Gv={name:"",description:" 100 ",resource_url:"/assets/copper/arcanist/spark/spark_skill.png",cool_down:Av},Rv=Gv,Ov=10,Dv={name:"",description:"",resource_url:"/assets/copper/arcanist/bubble/bubble_skill.png",cool_down:Ov},Nv=Dv,jv=5,Hv={name:"",description:" 200% ",resource_url:"/assets/copper/arcanist/turner/turner_skill.png",cool_down:jv},Fv=Hv,Uv=10,Bv={name:"",description:"",resource_url:"/assets/copper/mechanic/gyro/gyro_skill.png",cool_down:Uv},zv=Bv,Vv=10,qv={name:"",description:"",resource_url:"/assets/copper/mechanic/tricky/tricky_skill.png",cool_down:Vv},Wv=qv,Kv=5,Jv={name:"",description:"",resource_url:"/assets/copper/mechanic/pendulum/pendulum_skill.png",cool_down:Kv},Xv=Jv,Yv=3,Zv={name:"",description:" 200%",resource_url:"/assets/copper/mechanic/yoyo/yoyo_skill.png",cool_down:Yv},Qv=Zv,ew={type_msg:"upgrade_cost_error",content:""},tw={_0:2,_1:100},nw={_0:1,_1:0},sw={_0:4,_1:0},ow={_0:3,_1:0},iw={_0:0,_1:0},rw={_0:2,_1:0},aw={_0:1,_1:0},cw={_0:4,_1:0},lw={_0:3,_1:0},uw={_0:0,_1:0},_w={type_msg:"resource_not_enough",content:""},$w={type_msg:"resource_not_enough",content:""},dw={_0:3,_1:1},pw={_0:4,_1:1},mw={_0:0,_1:1},fw={_0:1,_1:1},hw={_0:3,_1:8},gw={_0:1,_1:2},bw={_0:3,_1:6},yw={_0:1,_1:3},vw={_0:3,_1:10},ww={_0:1,_1:4},Sw={_0:0,_1:5},kw={_0:3,_1:20},Mw={_0:1,_1:6},Cw={_0:4,_1:10},xw={_0:3,_1:8},Pw={_0:1,_1:3},Lw={_0:0,_1:3},Iw={_0:3,_1:30},Tw={_0:4,_1:20},Ew={_0:0,_1:10},Aw={_0:2,_1:8},Gw={_0:3,_1:15},Rw={_0:1,_1:5},Ow={_0:4,_1:8},Dw={_0:3,_1:25},Nw={_0:4,_1:15},jw={_0:2,_1:5},Hw=[0,2,3,4,6,6,8],Fw={_0:0,_1:1},Uw={_0:1,_1:Fw},Bw={_0:1,_1:1},zw={_0:3,_1:Bw},Vw={_0:3,_1:2},qw={_0:1,_1:1},Ww={_0:0,_1:1},Kw={_0:4,_1:Ww},Jw={_0:1,_1:1},Xw={_0:0,_1:Jw},Yw={_0:3,_1:1},Zw={_0:0,_1:2},Qw={_0:1,_1:2},eS={_0:1,_1:Qw},tS={_0:0,_1:1},nS={_0:3,_1:tS},sS={_0:3,_1:3},oS={_0:1,_1:2},iS={_0:0,_1:1},rS={_0:1,_1:2},aS={_0:4,_1:rS},cS={_0:0,_1:1},lS={_0:0,_1:cS},uS={_0:1,_1:2},_S={_0:4,_1:3},$S={_0:2,_1:1},dS={_0:1,_1:3},pS={_0:1,_1:dS},mS={_0:1,_1:2},fS={_0:4,_1:mS},hS={_0:0,_1:1},gS={_0:3,_1:hS},bS={_0:1,_1:4},yS={_0:4,_1:2},vS={_0:3,_1:8},wS={_0:2,_1:3},SS={_0:1,_1:2},kS={_0:1,_1:SS},MS={_0:0,_1:1},CS={_0:4,_1:MS},xS={_0:1,_1:2},PS={_0:0,_1:6},LS={_0:3,_1:6},IS={_0:2,_1:1},TS={_0:2,_1:4},ES={_0:1,_1:TS},AS={_0:1,_1:3},GS={_0:4,_1:AS},RS={_0:1,_1:2},OS={_0:3,_1:RS},DS={_0:1,_1:6},NS={_0:4,_1:4},jS={_0:3,_1:12},HS={_0:2,_1:3},FS={_0:1,_1:2},US={_0:1,_1:FS},BS={_0:2,_1:3},zS={_0:4,_1:BS},VS={_0:1,_1:2},qS={_0:0,_1:VS},WS={_0:1,_1:10},KS={_0:4,_1:10},JS={_0:0,_1:10},XS={_0:2,_1:3},YS={_0:2,_1:4},ZS={_0:1,_1:YS},QS={_0:2,_1:4},ek={_0:4,_1:QS},tk={_0:1,_1:2},nk={_0:3,_1:tk},sk={_0:1,_1:10},ok={_0:4,_1:10},ik={_0:3,_1:15},rk={_0:2,_1:5},ak={_0:3,_1:5},ck={_0:1,_1:ak},lk={_0:2,_1:3},uk={_0:4,_1:lk},_k={_0:1,_1:2},$k={_0:0,_1:_k},dk={_0:1,_1:10},pk={_0:4,_1:15},mk={_0:3,_1:10},fk={_0:2,_1:5},hk={_0:2,_1:3},gk={_0:1,_1:hk},bk={_0:3,_1:5},yk={_0:4,_1:bk},vk={_0:1,_1:2},wk={_0:3,_1:vk},Sk={_0:1,_1:15},kk={_0:4,_1:15},Mk={_0:0,_1:20},Ck={_0:3,_1:20},xk={_0:2,_1:8},Pk={_0:4,_1:6},Lk={_0:1,_1:Pk},Ik={_0:4,_1:6},Tk={_0:4,_1:Ik},Ek={_0:2,_1:3},Ak={_0:3,_1:Ek},Gk={_0:2,_1:3},Rk={_0:0,_1:Gk},Ok={_0:1,_1:30},Dk={_0:4,_1:30},Nk={_0:0,_1:30},jk={_0:3,_1:30},Hk={_0:2,_1:10},Fk={_0:5,_1:7},Uk={_0:1,_1:Fk},Bk={_0:5,_1:7},zk={_0:4,_1:Bk},Vk={_0:3,_1:4},qk={_0:3,_1:Vk},Wk={_0:3,_1:4},Kk={_0:0,_1:Wk},Jk={_0:1,_1:40},Xk={_0:4,_1:40},Yk={_0:0,_1:40},Zk={_0:3,_1:40},Qk={_0:2,_1:15},e5={name:"",resource_type:3,model_url:"/assets/resource/refined_copper_ingot/refined_copper_ingot.glb"},t5={name:"",resource_type:4,model_url:"/assets/resource/resonant_star_crystal/resonant_star_crystal.glb"},n5={_0:0,_1:0},s5={_0:0,_1:3},o5={_0:0,_1:4},i5={_0:0,_1:5},r5=[s5,o5,i5],a5={_0:0,_1:3},c5={_0:0,_1:4},l5={_0:0,_1:5},u5={_0:-1,_1:0},_5={_0:1,_1:0},$5={_0:0,_1:-1},d5={_0:0,_1:1},p5={_0:-1,_1:0},m5={_0:1,_1:0},f5={_0:0,_1:-1},h5={_0:0,_1:1},g5=void 0,b5={name:Ry,copper_type:0,description:Oy,icon_url:Dy,model_url:Ny,skill:Lv,attack_range:g5},y5=void 0,v5={name:jy,copper_type:0,description:Hy,icon_url:Fy,model_url:Uy,skill:Ev,attack_range:y5},w5={name:"",description:"",resource_url:"/assets/copper/iron_wall/bell/bell_skill.png",cool_down:void 0},S5=void 0,k5={name:By,copper_type:0,description:zy,icon_url:Vy,model_url:qy,skill:w5,attack_range:S5},M5={name:"",description:" 1:1 ",resource_url:"/assets/copper/iron_wall/tumble/tumble_skill.png",cool_down:void 0},C5=void 0,x5={name:Wy,copper_type:0,description:Ky,icon_url:Jy,model_url:Xy,skill:M5,attack_range:C5},P5={name:"",description:" 3x3  20%  10% ",resource_url:"/assets/copper/iron_wall/chief/chief_skill.png",cool_down:void 0},L5=void 0,I5={name:Yy,copper_type:0,description:Zy,icon_url:Qy,model_url:e4,skill:P5,attack_range:L5},T5=void 0,E5={name:t4,copper_type:1,description:n4,icon_url:s4,model_url:o4,skill:Rv,attack_range:T5},A5={name:"",description:" 20% ",resource_url:"/assets/copper/arcanist/syrup/syrup_skill.png",cool_down:void 0},G5=void 0,R5={name:i4,copper_type:1,description:r4,icon_url:a4,model_url:c4,skill:A5,attack_range:G5},O5=void 0,D5={name:l4,copper_type:1,description:u4,icon_url:_4,model_url:$4,skill:Nv,attack_range:O5},N5={name:"",description:" 20% ",resource_url:"/assets/copper/arcanist/glimmer/glimmer_skill.png",cool_down:void 0},j5=void 0,H5={name:d4,copper_type:1,description:p4,icon_url:m4,model_url:f4,skill:N5,attack_range:j5},F5=void 0,U5={name:h4,copper_type:1,description:g4,icon_url:b4,model_url:y4,skill:Fv,attack_range:F5},B5={name:"",description:" 20 ",resource_url:"/assets/copper/resonator/murmur/murmur_skill.png",cool_down:void 0},z5=void 0,V5={name:v4,copper_type:4,description:w4,icon_url:S4,model_url:k4,skill:B5,attack_range:z5},q5={name:"",description:" 5 ",resource_url:"/assets/copper/resonator/melody/melody_skill.png",cool_down:void 0},W5=void 0,K5={name:M4,copper_type:4,description:C4,icon_url:x4,model_url:P4,skill:q5,attack_range:W5},J5={name:"",description:" 0 ",resource_url:"/assets/copper/resonator/clawsteak/clawster_skill.png",cool_down:void 0},X5=void 0,Y5={name:L4,copper_type:4,description:I4,icon_url:T4,model_url:E4,skill:J5,attack_range:X5},Z5={name:"",description:" 3*3 ",resource_url:"/assets/copper/resonator/diggs/diggs_skill.png",cool_down:void 0},Q5=void 0,eM={name:A4,copper_type:4,description:G4,icon_url:R4,model_url:O4,skill:Z5,attack_range:Q5},tM={name:"",description:" 10 ",resource_url:"/assets/copper/resonator/hive/hive_skill.png",cool_down:void 0},nM=void 0,sM={name:D4,copper_type:4,description:N4,icon_url:j4,model_url:H4,skill:tM,attack_range:nM},oM=void 0,iM={name:F4,copper_type:3,description:U4,icon_url:B4,model_url:z4,skill:zv,attack_range:oM},rM=void 0,aM={name:V4,copper_type:3,description:q4,icon_url:W4,model_url:K4,skill:Wv,attack_range:rM},cM=void 0,lM={name:J4,copper_type:3,description:X4,icon_url:Y4,model_url:Z4,skill:Xv,attack_range:cM},uM=void 0,_M={name:Q4,copper_type:3,description:ev,icon_url:tv,model_url:nv,skill:Qv,attack_range:uM},$M={name:"",description:"",resource_url:"/assets/copper/mechanic/karin/karin_skill.png",cool_down:void 0},dM=void 0,pM={name:sv,copper_type:3,description:ov,icon_url:iv,model_url:rv,skill:$M,attack_range:dM},mM=void 0,fM=void 0,hM={name:av,copper_type:2,description:cv,icon_url:lv,model_url:uv,skill:mM,attack_range:fM},gM=void 0,bM=void 0,yM={name:_v,copper_type:2,description:$v,icon_url:dv,model_url:pv,skill:gM,attack_range:bM},vM=void 0,wM=void 0,SM={name:mv,copper_type:2,description:fv,icon_url:hv,model_url:gv,skill:vM,attack_range:wM},kM=void 0,MM=void 0,CM={name:bv,copper_type:2,description:yv,icon_url:vv,model_url:wv,skill:kM,attack_range:MM},xM=void 0,PM=void 0,or=[b5,v5,k5,x5,I5,E5,R5,D5,H5,U5,V5,K5,Y5,eM,sM,iM,aM,lM,_M,pM,hM,yM,SM,CM,{name:Sv,copper_type:2,description:kv,icon_url:Mv,model_url:Cv,skill:xM,attack_range:PM}],LM=Z1(),IM=hx(e=>{const t=or.length;let n=0;for(;;){const o=n;if(o<t){const s=or[o];if(e({_0:s.name,_1:s})===1){n=o+1|0;continue}else return 0}else return 1}}),Pi=Gf(),Tt=HM(NP()),TM=Gf(),Qe=fP(),vm=u6(),br=Mr(R1),yr=Mr(O1),wm=[vy,wy,Sy,ky,My,Cy,xy,Py],EM=Mr(D1),Sm=xr(Dp,52),Cs=Or(8),ir=Or(8),Vt=Or(8),Gn=Or(8),bo=eC(8),It=FM(void 0),Fn=zC([]),Vl=[{name:"",health:Math.fround(400),can_move:!1,can_attack:!1,attack_range:0,description:" ",asset_url:"assets/structure/riveted_barrier/riveted_barrier.png",model_url:"assets/structure/riveted_barrier/riveted_barrier.glb",attribute:Wt(Math.fround(0),0,Math.fround(0),Math.fround(0),Math.fround(0)),cost:Mt([hw,gw])},{name:"",health:Math.fround(180),can_move:!1,can_attack:!0,attack_range:3,description:"",asset_url:"assets/structure/gear_arrow_tower/gear_arrow_tower.png",model_url:"assets/structure/gear_arrow_tower/gear_arrow_tower.glb",attribute:Wt(Math.fround(0),0,Math.fround(30),Math.fround(0),Math.fround(0)),cost:Mt([bw,yw])},{name:"",health:Math.fround(300),can_move:!1,can_attack:!1,attack_range:0,description:"",asset_url:"assets/structure/heart_source_drill/heart_source_mineral_drill.png",model_url:"assets/structure/heart_source_drill/heart_source_mineral_drill.glb",attribute:Wt(Math.fround(0),0,Math.fround(0),Math.fround(0),Math.fround(0)),cost:Mt([vw,ww,Sw])},{name:"",health:Math.fround(200),can_move:!1,can_attack:!1,attack_range:0,description:"",asset_url:"assets/structure/charging_coil/charging_coil.png",model_url:"assets/structure/charging_coil/charging_coil.glb",attribute:Wt(Math.fround(0),0,Math.fround(0),Math.fround(0),Math.fround(0)),cost:Mt([kw,Mw,Cw])},{name:"",health:Math.fround(200),can_move:!1,can_attack:!0,attack_range:3,description:"",asset_url:"assets/structure/repair_workshop/repair_workshop.png",model_url:"assets/structure/repair_workshop/repair_workshop.glb",attribute:Wt(Math.fround(0),0,Math.fround(25),Math.fround(0),Math.fround(0)),cost:Mt([xw,Pw,Lw])},{name:"",health:Math.fround(1200),can_move:!1,can_attack:!0,attack_range:5,description:"",asset_url:"assets/structure/mirror_refractory_tower/mirror_light_refraction_tower.png",model_url:"assets/structure/mirror_refractory_tower/mirror_light_refraction_tower.glb",attribute:Wt(Math.fround(0),0,Math.fround(120),Math.fround(0),Math.fround(0)),cost:Mt([Iw,Tw,Ew,Aw])},{name:"",health:Math.fround(500),can_move:!1,can_attack:!0,attack_range:4,description:"",asset_url:"assets/structure/resonance_alarm_bell/resonance_alarm_bell.png",model_url:"assets/structure/resonance_alarm_bell/resonance_alarm_bell.glb",attribute:Wt(Math.fround(0),0,Math.fround(60),Math.fround(0),Math.fround(0)),cost:Mt([Gw,Rw,Ow])},{name:"",health:Math.fround(800),can_move:!1,can_attack:!0,attack_range:4,description:"",asset_url:"assets/structure/storm_iron_anvil/storm_anvil.png",model_url:"assets/structure/storm_iron_anvil/storm_anvil.glb",attribute:Wt(Math.fround(0),0,Math.fround(100),Math.fround(0),Math.fround(0)),cost:Mt([Dw,Nw,jw])}],km=fx(e=>{const t=Vl.length;let n=0;for(;;){const o=n;if(o<t){const s=Vl[o];if(e({_0:s.name,_1:s})===1){n=o+1|0;continue}else return 0}else return 1}}),Ks=VC([]),Aa=[{level:1,health:Math.fround(25),attack:Math.fround(8),defense:Math.fround(3),dodge:Math.fround(0),attack_range:1,speed:2,name:"",enemy_type:"goblin",description:"''",asset_url:"/assets/enemy/goblin/goblin.png",model_url:"/assets/enemy/goblin/goblin.glb",drop_items:[Uw,zw],summon_cost:Mt([Vw,qw])},{level:1,health:Math.fround(30),attack:Math.fround(7),defense:Math.fround(5),dodge:Math.fround(0),attack_range:1,speed:1,name:"",enemy_type:"cruiser",description:"",asset_url:"/assets/enemy/cruiser/cruiser.png",model_url:"/assets/enemy/cruiser/cruiser.glb",drop_items:[Kw,Xw],summon_cost:Mt([Yw,Zw])},{level:2,health:Math.fround(35),attack:Math.fround(12),defense:Math.fround(5),dodge:Math.fround(10),attack_range:1,speed:4,name:"",enemy_type:"scout",description:"''",asset_url:"/assets/enemy/scout/scout.png",model_url:"/assets/enemy/scout/scout.glb",drop_items:[eS,nS],summon_cost:Mt([sS,oS,iS])},{level:2,health:Math.fround(40),attack:Math.fround(16),defense:Math.fround(8),dodge:Math.fround(5),attack_range:3,speed:2,name:"",enemy_type:"horn",description:"",asset_url:"/assets/enemy/horn/horn.png",model_url:"/assets/enemy/horn/horn.glb",drop_items:[aS,lS],summon_cost:Mt([uS,_S,$S])},{level:3,health:Math.fround(70),attack:Math.fround(22),defense:Math.fround(15),dodge:Math.fround(0),attack_range:1,speed:1,name:"",enemy_type:"boxer",description:" ",asset_url:"/assets/enemy/boxer/boxer.png",model_url:"/assets/enemy/boxer/boxer.glb",drop_items:[pS,fS,gS],summon_cost:Mt([bS,yS,vS,wS])},{level:3,health:Math.fround(55),attack:Math.fround(30),defense:Math.fround(4),dodge:Math.fround(20),attack_range:1,speed:3,name:"",enemy_type:"assassin",description:"",asset_url:"/assets/enemy/assassin/assassin.png",model_url:"/assets/enemy/assassin/assassin.glb",drop_items:[kS,CS],summon_cost:Mt([xS,PS,LS,IS])},{level:4,health:Math.fround(110),attack:Math.fround(30),defense:Math.fround(20),dodge:Math.fround(0),attack_range:1,speed:2,name:"",enemy_type:"devourer",description:"",asset_url:"/assets/enemy/devourer/devourer.glb",model_url:"/assets/enemy/devourer/devourer.glb",drop_items:[ES,GS,OS],summon_cost:Mt([DS,NS,jS,HS])},{level:4,health:Math.fround(50),attack:Math.fround(32),defense:Math.fround(10),dodge:Math.fround(70),attack_range:2,speed:3,name:"",enemy_type:"mirror",description:"",asset_url:"/assets/enemy/mirror/mirror.png",model_url:"/assets/enemy/mirror/mirror.glb",drop_items:[US,zS,qS],summon_cost:Mt([WS,KS,JS,XS])},{level:5,health:Math.fround(250),attack:Math.fround(45),defense:Math.fround(35),dodge:Math.fround(5),attack_range:2,speed:1,name:"",enemy_type:"guard",description:"",asset_url:"/assets/enemy/guard/guard.png",model_url:"/assets/enemy/guard/guard.glb",drop_items:[ZS,ek,nk],summon_cost:Mt([sk,ok,ik,rk])},{level:5,health:Math.fround(100),attack:Math.fround(50),defense:Math.fround(10),dodge:Math.fround(25),attack_range:2,speed:5,name:"",enemy_type:"demon",description:"''''",asset_url:"/assets/enemy/demon/demon.png",model_url:"/assets/enemy/demon/demon.glb",drop_items:[ck,uk,$k],summon_cost:Mt([dk,pk,mk,fk])},{level:5,health:Math.fround(160),attack:Math.fround(55),defense:Math.fround(15),dodge:Math.fround(0),attack_range:2,speed:2,name:"",enemy_type:"variant",description:"''''",asset_url:"/assets/enemy/variant/variant.png",model_url:"/assets/enemy/variant/variant.glb",drop_items:[gk,yk,wk],summon_cost:Mt([Sk,kk,Mk,Ck,xk])},{level:6,health:Math.fround(300),attack:Math.fround(60),defense:Math.fround(20),dodge:Math.fround(30),attack_range:3,speed:3,name:"BOSS",enemy_type:"shatra",description:"''''''",asset_url:"/assets/enemy/shatra/shatra.png",model_url:"/assets/enemy/shatra/shatra.glb",drop_items:[Lk,Tk,Ak,Rk],summon_cost:Mt([Ok,Dk,Nk,jk,Hk])},{level:6,health:Math.fround(500),attack:Math.fround(40),defense:Math.fround(40),dodge:Math.fround(0),attack_range:1,speed:2,name:"BOSS",enemy_type:"glutton",description:"''''",asset_url:"/assets/enemy/glutton/glutton.png",model_url:"/assets/enemy/glutton/glutton.glb",drop_items:[Uk,zk,qk,Kk],summon_cost:Mt([Jk,Xk,Yk,Zk,Qk])}],AM=Q6(Aa),ql=mx(e=>AM(t=>e({_0:t.name,_1:t}))),vr=Du(!1),wr=Du(!1),Sr=Du(!1);function Js(e){ee()}function GM(e){return ee()}function Ga(e){return ee()}function RM(e){return ee()}function OM(e){return ee()}function DM(e){return ee()}function NM(e){return ee()}function jM(e){return ee()}function HM(e){return{val:e}}function FM(e){return{val:e}}function Du(e){return{val:e}}function Ra(e){return Is(e)|-1073741824}function UM(e,t){{const n=$t(e,t(0));let o=1;for(;;){const s=o;if(s<e){S(n,s),n[s]=t(s),o=s+1|0;continue}else break}return n}}function BM(e){return j1(e)}function zM(e,t){{e:{let n;t:{let o;n:{let s;s:if(gt(e.str,2,e.start,e.end))if(fe(e.str,H(e.str,0,e.start,e.end))===48)switch(fe(e.str,H(e.str,1,e.start,e.end))){case 120:{const a=e.str,c=H(e.str,2,e.start,e.end);let l;c===void 0?l=e.end:l=c,s={str:a,start:l,end:e.end};break s}case 88:{const a=e.str,c=H(e.str,2,e.start,e.end);let l;c===void 0?l=e.end:l=c,s={str:a,start:l,end:e.end};break s}case 111:{const a=e.str,c=H(e.str,2,e.start,e.end);let l;c===void 0?l=e.end:l=c,o={str:a,start:l,end:e.end};break n}case 79:{const a=e.str,c=H(e.str,2,e.start,e.end);let l;c===void 0?l=e.end:l=c,o={str:a,start:l,end:e.end};break n}case 98:{const a=e.str,c=H(e.str,2,e.start,e.end);let l;c===void 0?l=e.end:l=c,n={str:a,start:l,end:e.end};break t}case 66:{const a=e.str,c=H(e.str,2,e.start,e.end);let l;c===void 0?l=e.end:l=c,n={str:a,start:l,end:e.end};break t}default:break e}else break e;else break e;return new Fi({_0:16,_1:s,_2:!0})}return new Fi({_0:8,_1:o,_2:!0})}return new Fi({_0:2,_1:n,_2:!0})}return new Fi({_0:10,_1:e,_2:!1})}}function pa(){return new jp(new Ws(bm))}function Qr(){return new $c(new Ws(bm))}function VM(){return new Hp(new Ws(xi))}function Oi(){return new $c(new Ws(xi))}function Oa(){return new Tu(new Ws(xi))}function qM(){return new Up(new Ws(xi))}function d$(){return new Bp(new Ws(xi))}function p$(){return new zp(new Ws(xi))}function WM(e,t){return t?e===10?no(ol,nn):e===16?no(ol,i$):no(ol,jn(e)):Ss(e===10?no(sl,nn):e===16?no(sl,i$):no(sl,jn(e)),ln)}function Mm(e,t){if(S6(e,{str:a$,start:0,end:a$.length})){let n,o;e:{t:{const d=Fm(e,0,void 0);if(gt(d.str,1,d.start,d.end))switch(fe(d.str,H(d.str,0,d.start,d.end))){case 43:{const b=d.str,g=H(d.str,1,d.start,d.end);let m;g===void 0?m=d.end:m=g,n={_0:!1,_1:{str:b,start:m,end:d.end}};break}case 45:{const b=d.str,g=H(d.str,1,d.start,d.end);let m;g===void 0?m=d.end:m=g,n={_0:!0,_1:{str:b,start:m,end:d.end}};break}default:{o=d;break t}}else{o=d;break t}break e}n={_0:!1,_1:o}}const s=n._0,i=n._1,r=zM(i);let a;if(r.$tag===1)a=r._0;else return r;const c=a._0,l=a._1,u=a._2,_=WM(c,s);let $;if(gt(l.str,1,l.start,l.end)){const d=fe(l.str,H(l.str,0,l.start,l.end));if(d>=48&&d<=57)$=!0;else if(d>=97&&d<=122)$=!0;else if(d>=65&&d<=90)$=!0;else if(gt(l.str,2,l.start,l.end))if(d===95){const p=fe(l.str,H(l.str,1,l.start,l.end));$=p>=48&&p<=57||p>=97&&p<=122?!0:p>=65&&p<=90}else $=!1;else $=!1}else $=!1;if($){let d,p=l,b=Ct,g=u;for(;;){const m=p,v=b,y=g;let w,k,I;e:if(po(m.str,1,m.start,m.end)){const x=fe(m.str,H(m.str,0,m.start,m.end));if(x===95){const D=Oi();if(D.$tag===1){d=D._0;break}else return D}else{const D=m.str,U=H(m.str,1,m.start,m.end);let L;U===void 0?L=m.end:L=U;const ge={str:D,start:L,end:m.end};w=v,k=ge,I=x;break e}}else if(gt(m.str,1,m.start,m.end)){const x=fe(m.str,H(m.str,0,m.start,m.end));if(x===95)if(y===!1){const D=Oi();if(D.$tag===1){d=D._0;break}else return D}else{const D=m.str,U=H(m.str,1,m.start,m.end);let L;U===void 0?L=m.end:L=U,p={str:D,start:L,end:m.end},g=!1;continue}else{const D=m.str,U=H(m.str,1,m.start,m.end);let L;U===void 0?L=m.end:L=U;const ge={str:D,start:L,end:m.end};w=v,k=ge,I=x;break e}}else{d=v;break}const P=I;let T;if(P>=48&&P<=57)T=P-48|0;else if(P>=97&&P<=122)T=P+-87|0;else if(P>=65&&P<=90)T=P+-55|0;else{const x=VM();if(x.$tag===1)T=x._0;else return x}if(T<c)if(s)if(Kl(w,_)){const x=Cr(Ko(w,jn(c)),jn(T));if(kr(x,w)){p=k,b=x,g=!0;continue}else{const D=Qr();if(D.$tag===1){d=D._0;break}else return D}}else{const x=Qr();if(x.$tag===1){d=x._0;break}else return x}else if(yc(w,_)){const x=Ss(Ko(w,jn(c)),jn(T));if(Kl(x,w)){p=k,b=x,g=!0;continue}else{const D=Qr();if(D.$tag===1){d=D._0;break}else return D}}else{const x=Qr();if(x.$tag===1){d=x._0;break}else return x}else{const x=Oi();if(x.$tag===1){d=x._0;break}else return x}}return new Iu(d)}else return Oi()}else return Oi()}function KM(e,t){const n=Mm(e);let o;if(n.$tag===1)o=n._0;else return n;if(yc(o,jn(-2147483648))||qm(o,jn(2147483647))){const s=pa();if(s.$tag===1)s._0;else return s}return new Fp(Do(o))}function JM(e){let t;if(gt(e.str,1,e.start,e.end))switch(fe(e.str,H(e.str,0,e.start,e.end))){case 43:{const _=e.str,$=H(e.str,1,e.start,e.end);let d;$===void 0?d=e.end:d=$,t={str:_,start:d,end:e.end};break}case 45:{const _=e.str,$=H(e.str,1,e.start,e.end);let d;$===void 0?d=e.end:d=$,t={str:_,start:d,end:e.end};break}default:t=e}else t=e;let n,o;e:{t:{let u;n:{s:{let _;r:{o:{let $;i:if(gt(t.str,2,t.start,t.end))if(fe(t.str,H(t.str,0,t.start,t.end))===48)switch(fe(t.str,H(t.str,1,t.start,t.end))){case 120:{const b=t.str,g=H(t.str,2,t.start,t.end);let m;g===void 0?m=t.end:m=g,$={str:b,start:m,end:t.end};break i}case 88:{const b=t.str,g=H(t.str,2,t.start,t.end);let m;g===void 0?m=t.end:m=g,$={str:b,start:m,end:t.end};break i}case 111:{const b=t.str,g=H(t.str,2,t.start,t.end);let m;g===void 0?m=t.end:m=g,_={str:b,start:m,end:t.end};break o}case 79:{const b=t.str,g=H(t.str,2,t.start,t.end);let m;g===void 0?m=t.end:m=g,_={str:b,start:m,end:t.end};break o}case 98:{const b=t.str,g=H(t.str,2,t.start,t.end);let m;g===void 0?m=t.end:m=g,u={str:b,start:m,end:t.end};break s}case 66:{const b=t.str,g=H(t.str,2,t.start,t.end);let m;g===void 0?m=t.end:m=g,u={str:b,start:m,end:t.end};break s}default:{o=t;break t}}else{o=t;break t}else{o=t;break t}n={_0:$,_1:!0,_2:!0};break r}n={_0:_,_1:!0,_2:!1}}break n}n={_0:u,_1:!0,_2:!1}}break e}n={_0:o,_1:!1,_2:!1}}const s=n._0,i=n._1,r=n._2;let a=s,c=i,l=!1;for(;;){const u=a,_=c,$=l;let d,p,b;e:{if(po(u.str,0,u.start,u.end))return!0;if(po(u.str,1,u.start,u.end)){const g=fe(u.str,H(u.str,0,u.start,u.end));if(g===95)return!1;{const m=u.str,v=H(u.str,1,u.start,u.end);let y;v===void 0?y=u.end:y=v,d={str:m,start:y,end:u.end},p=g,b=$;break e}}else{const g=fe(u.str,H(u.str,0,u.start,u.end));if(g===95){if(_===!1)return!1;{const m=u.str,v=H(u.str,1,u.start,u.end);let y;v===void 0?y=u.end:y=v,a={str:m,start:y,end:u.end},c=!1,l=!0;continue}}else{const m=u.str,v=H(u.str,1,u.start,u.end);let y;v===void 0?y=u.end:y=v,d={str:m,start:y,end:u.end},p=g,b=$;break e}}}if(p>=48&&p<=57||r&&(p>=97&&p<=102||p>=65&&p<=70)){a=d,c=!0,l=!1;continue}else{if(b)return!1;a=d,c=!1,l=!1;continue}}}function XM(){return{digits:H1(800),digits_num:0,decimal_point:0,negative:!1,truncated:!1}}function Nu(e){for(;;){let t;if(e.digits_num>0){const n=e.digits,o=e.digits_num-1|0;S(n,o),t=n[o]===0}else t=!1;if(t){e.digits_num=e.digits_num-1|0;continue}else break}if(e.digits_num===0){e.decimal_point=0;return}else return}function YM(e){const t=XM();let n=!1,o=!1,s;e:{t:{if(gt(e.str,1,e.start,e.end))switch(fe(e.str,H(e.str,0,e.start,e.end))){case 45:{const c=e.str,l=H(e.str,1,e.start,e.end);let u;l===void 0?u=e.end:u=l;const $={str:c,start:u,end:e.end};t.negative=!0,s=$;break}case 43:{const c=e.str,l=H(e.str,1,e.start,e.end);let u;l===void 0?u=e.end:u=l,s={str:c,start:u,end:e.end};break}default:break t}else break t;break e}s=e}let i,r=s;for(;;){const a=r;if(gt(a.str,1,a.start,a.end)){const c=fe(a.str,H(a.str,0,a.start,a.end));if(c===95){const l=a.str,u=H(a.str,1,a.start,a.end);let _;u===void 0?_=a.end:_=u,r={str:l,start:_,end:a.end};continue}else if(c===46){const l=a.str,u=H(a.str,1,a.start,a.end);let _;u===void 0?_=a.end:_=u;const d={str:l,start:_,end:a.end};if(n){const p=d$();if(p.$tag===1){i=p._0;break}else return p}else{n=!0,t.decimal_point=t.digits_num,r=d;continue}}else if(c>=48&&c<=57){const l=a.str,u=H(a.str,1,a.start,a.end);let _;u===void 0?_=a.end:_=u;const d={str:l,start:_,end:a.end};if(o=!0,c===48&&t.digits_num===0){t.decimal_point=t.decimal_point-1|0,r=d;continue}if(t.digits_num<t.digits.length){const p=t.digits,b=t.digits_num;S(p,b),p[b]=(c-48|0)&255,t.digits_num=t.digits_num+1|0}else c!==48&&(t.truncated=!0);r=d;continue}else{i=a;break}}else{i=a;break}}if(o){n||(t.decimal_point=t.digits_num);let a,c;e:{t:{if(gt(i.str,1,i.start,i.end))switch(fe(i.str,H(i.str,0,i.start,i.end))){case 101:{const $=i.str,d=H(i.str,1,i.start,i.end);let p;d===void 0?p=i.end:p=d,c={str:$,start:p,end:i.end};break t}case 69:{const $=i.str,d=H(i.str,1,i.start,i.end);let p;d===void 0?p=i.end:p=d,c={str:$,start:p,end:i.end};break t}default:a=i}else a=i;break e}let l=1,u;if(gt(c.str,1,c.start,c.end))switch(fe(c.str,H(c.str,0,c.start,c.end))){case 43:{const $=c.str,d=H(c.str,1,c.start,c.end);let p;d===void 0?p=c.end:p=d,u={str:$,start:p,end:c.end};break}case 45:{const $=c.str,d=H(c.str,1,c.start,c.end);let p;d===void 0?p=c.end:p=d;const g={str:$,start:p,end:c.end};l=-1,u=g;break}default:u=c}else u=c;t:{n:{if(gt(u.str,1,u.start,u.end)){const $=fe(u.str,H(u.str,0,u.start,u.end));if($>=48&&$<=57){let d=0,p,b=u;for(;;){const g=b;if(gt(g.str,1,g.start,g.end)){const m=fe(g.str,H(g.str,0,g.start,g.end));if(m===95){const v=g.str,y=H(g.str,1,g.start,g.end);let w;y===void 0?w=g.end:w=y,b={str:v,start:w,end:g.end};continue}else if(m>=48&&m<=57){const v=g.str,y=H(g.str,1,g.start,g.end);let w;y===void 0?w=g.end:w=y;const I={str:v,start:w,end:g.end};d=(Math.imul(d,10)|0)+(m-48|0)|0,b=I;continue}else{p=g;break}}else{p=g;break}}t.decimal_point=t.decimal_point+(Math.imul(l,d)|0)|0,a=p}else break n}else break n;break t}const _=d$();if(_.$tag===1)a=_._0;else return _}}return po(a.str,0,a.start,a.end)?(Nu(t),new Vp(t)):p$()}else return p$()}function ZM(e){return YM(e)}function QM(e){let t,n;e:{t:{if(gt(e.str,1,e.start,e.end))switch(fe(e.str,H(e.str,0,e.start,e.end))){case 45:{const r=e.str,a=H(e.str,1,e.start,e.end);let c;a===void 0?c=e.end:c=a,t={_0:!1,_1:{str:r,start:c,end:e.end}};break}case 43:{const r=e.str,a=H(e.str,1,e.start,e.end);let c;a===void 0?c=e.end:c=a,n={str:r,start:c,end:e.end};break t}default:{n=e;break t}}else{n=e;break t}break e}t={_0:!0,_1:n}}const o=t._0,s=t._1;e:{let i;t:{n:if(po(s.str,3,s.start,s.end))switch(fe(s.str,H(s.str,0,s.start,s.end))){case 110:switch(fe(s.str,H(s.str,1,s.start,s.end))){case 97:switch(fe(s.str,H(s.str,2,s.start,s.end))){case 110:break n;case 78:break n;default:break e}case 65:switch(fe(s.str,H(s.str,2,s.start,s.end))){case 110:break n;case 78:break n;default:break e}default:break e}case 78:switch(fe(s.str,H(s.str,1,s.start,s.end))){case 97:switch(fe(s.str,H(s.str,2,s.start,s.end))){case 110:break n;case 78:break n;default:break e}case 65:switch(fe(s.str,H(s.str,2,s.start,s.end))){case 110:break n;case 78:break n;default:break e}default:break e}case 105:switch(fe(s.str,H(s.str,1,s.start,s.end))){case 110:switch(fe(s.str,H(s.str,2,s.start,s.end))){case 102:{const l=s.str,u=H(s.str,3,s.start,s.end);let _;u===void 0?_=s.end:_=u,i={str:l,start:_,end:s.end};break t}case 70:{const l=s.str,u=H(s.str,3,s.start,s.end);let _;u===void 0?_=s.end:_=u,i={str:l,start:_,end:s.end};break t}default:break e}case 78:switch(fe(s.str,H(s.str,2,s.start,s.end))){case 102:{const l=s.str,u=H(s.str,3,s.start,s.end);let _;u===void 0?_=s.end:_=u,i={str:l,start:_,end:s.end};break t}case 70:{const l=s.str,u=H(s.str,3,s.start,s.end);let _;u===void 0?_=s.end:_=u,i={str:l,start:_,end:s.end};break t}default:break e}default:break e}case 73:switch(fe(s.str,H(s.str,1,s.start,s.end))){case 110:switch(fe(s.str,H(s.str,2,s.start,s.end))){case 102:{const l=s.str,u=H(s.str,3,s.start,s.end);let _;u===void 0?_=s.end:_=u,i={str:l,start:_,end:s.end};break t}case 70:{const l=s.str,u=H(s.str,3,s.start,s.end);let _;u===void 0?_=s.end:_=u,i={str:l,start:_,end:s.end};break t}default:break e}case 78:switch(fe(s.str,H(s.str,2,s.start,s.end))){case 102:{const l=s.str,u=H(s.str,3,s.start,s.end);let _;u===void 0?_=s.end:_=u,i={str:l,start:_,end:s.end};break t}case 70:{const l=s.str,u=H(s.str,3,s.start,s.end);let _;u===void 0?_=s.end:_=u,i={str:l,start:_,end:s.end};break t}default:break e}default:break e}default:break e}else if(gt(s.str,3,s.start,s.end))switch(fe(s.str,H(s.str,0,s.start,s.end))){case 105:switch(fe(s.str,H(s.str,1,s.start,s.end))){case 110:switch(fe(s.str,H(s.str,2,s.start,s.end))){case 102:{const l=s.str,u=H(s.str,3,s.start,s.end);let _;u===void 0?_=s.end:_=u,i={str:l,start:_,end:s.end};break t}case 70:{const l=s.str,u=H(s.str,3,s.start,s.end);let _;u===void 0?_=s.end:_=u,i={str:l,start:_,end:s.end};break t}default:break e}case 78:switch(fe(s.str,H(s.str,2,s.start,s.end))){case 102:{const l=s.str,u=H(s.str,3,s.start,s.end);let _;u===void 0?_=s.end:_=u,i={str:l,start:_,end:s.end};break t}case 70:{const l=s.str,u=H(s.str,3,s.start,s.end);let _;u===void 0?_=s.end:_=u,i={str:l,start:_,end:s.end};break t}default:break e}default:break e}case 73:switch(fe(s.str,H(s.str,1,s.start,s.end))){case 110:switch(fe(s.str,H(s.str,2,s.start,s.end))){case 102:{const l=s.str,u=H(s.str,3,s.start,s.end);let _;u===void 0?_=s.end:_=u,i={str:l,start:_,end:s.end};break t}case 70:{const l=s.str,u=H(s.str,3,s.start,s.end);let _;u===void 0?_=s.end:_=u,i={str:l,start:_,end:s.end};break t}default:break e}case 78:switch(fe(s.str,H(s.str,2,s.start,s.end))){case 102:{const l=s.str,u=H(s.str,3,s.start,s.end);let _;u===void 0?_=s.end:_=u,i={str:l,start:_,end:s.end};break t}case 70:{const l=s.str,u=H(s.str,3,s.start,s.end);let _;u===void 0?_=s.end:_=u,i={str:l,start:_,end:s.end};break t}default:break e}default:break e}default:break e}else break e;return new uo(EM)}t:{n:{if(po(i.str,0,i.start,i.end))break n;if(po(i.str,5,i.start,i.end))switch(fe(i.str,H(i.str,0,i.start,i.end))){case 105:switch(fe(i.str,H(i.str,1,i.start,i.end))){case 110:switch(fe(i.str,H(i.str,2,i.start,i.end))){case 105:switch(fe(i.str,H(i.str,3,i.start,i.end))){case 116:switch(fe(i.str,H(i.str,4,i.start,i.end))){case 121:break n;case 89:break n;default:break t}case 84:switch(fe(i.str,H(i.str,4,i.start,i.end))){case 121:break n;case 89:break n;default:break t}default:break t}case 73:switch(fe(i.str,H(i.str,3,i.start,i.end))){case 116:switch(fe(i.str,H(i.str,4,i.start,i.end))){case 121:break n;case 89:break n;default:break t}case 84:switch(fe(i.str,H(i.str,4,i.start,i.end))){case 121:break n;case 89:break n;default:break t}default:break t}default:break t}case 78:switch(fe(i.str,H(i.str,2,i.start,i.end))){case 105:switch(fe(i.str,H(i.str,3,i.start,i.end))){case 116:switch(fe(i.str,H(i.str,4,i.start,i.end))){case 121:break n;case 89:break n;default:break t}case 84:switch(fe(i.str,H(i.str,4,i.start,i.end))){case 121:break n;case 89:break n;default:break t}default:break t}case 73:switch(fe(i.str,H(i.str,3,i.start,i.end))){case 116:switch(fe(i.str,H(i.str,4,i.start,i.end))){case 121:break n;case 89:break n;default:break t}case 84:switch(fe(i.str,H(i.str,4,i.start,i.end))){case 121:break n;case 89:break n;default:break t}default:break t}default:break t}default:break t}case 73:switch(fe(i.str,H(i.str,1,i.start,i.end))){case 110:switch(fe(i.str,H(i.str,2,i.start,i.end))){case 105:switch(fe(i.str,H(i.str,3,i.start,i.end))){case 116:switch(fe(i.str,H(i.str,4,i.start,i.end))){case 121:break n;case 89:break n;default:break t}case 84:switch(fe(i.str,H(i.str,4,i.start,i.end))){case 121:break n;case 89:break n;default:break t}default:break t}case 73:switch(fe(i.str,H(i.str,3,i.start,i.end))){case 116:switch(fe(i.str,H(i.str,4,i.start,i.end))){case 121:break n;case 89:break n;default:break t}case 84:switch(fe(i.str,H(i.str,4,i.start,i.end))){case 121:break n;case 89:break n;default:break t}default:break t}default:break t}case 78:switch(fe(i.str,H(i.str,2,i.start,i.end))){case 105:switch(fe(i.str,H(i.str,3,i.start,i.end))){case 116:switch(fe(i.str,H(i.str,4,i.start,i.end))){case 121:break n;case 89:break n;default:break t}case 84:switch(fe(i.str,H(i.str,4,i.start,i.end))){case 121:break n;case 89:break n;default:break t}default:break t}case 73:switch(fe(i.str,H(i.str,3,i.start,i.end))){case 116:switch(fe(i.str,H(i.str,4,i.start,i.end))){case 121:break n;case 89:break n;default:break t}case 84:switch(fe(i.str,H(i.str,4,i.start,i.end))){case 121:break n;case 89:break n;default:break t}default:break t}default:break t}default:break t}default:break t}else break t}return o?new uo(yr):new uo(br)}return Oa()}return Oa()}function e3(e,t,n){let o=t,s=0,i=e;for(;;){const r=i;if(gt(r.str,1,r.start,r.end)){const a=fe(r.str,H(r.str,0,r.start,r.end)),c=r.str,l=H(r.str,1,r.start,r.end);let u;l===void 0?u=r.end:u=l;const $={str:c,start:u,end:r.end};if(a>=48&&a<=57)s=s+1|0,o=n(a-48|0,o);else if(a!==95)break;i=$;continue}else break}return{_0:i,_1:o,_2:s}}function t3(e,t,n){let o=t,s=0,i=e;for(;;){const r=i;if(gt(r.str,1,r.start,r.end)){const a=fe(r.str,H(r.str,0,r.start,r.end)),c=r.str,l=H(r.str,1,r.start,r.end);let u;l===void 0?u=r.end:u=l;const $={str:c,start:u,end:r.end};if(a>=48&&a<=57)s=s+1|0,o=n(a-48|0,o);else if(a!==95)break;i=$;continue}else break}return{_0:i,_1:o,_2:s}}function m$(e,t){return e3(e,t,(n,o)=>ro(Vn(o,nn),qu(n)))}function n3(e){let t=e,n=!1,o,s;e:{t:{const i=t;if(gt(i.str,1,i.start,i.end)){const r=fe(i.str,H(i.str,0,i.start,i.end));switch(r){case 43:{const a=i.str,c=H(i.str,1,i.start,i.end);let l;c===void 0?l=i.end:l=c,o={str:a,start:l,end:i.end},s=r;break t}case 45:{const a=i.str,c=H(i.str,1,i.start,i.end);let l;c===void 0?l=i.end:l=c,o={str:a,start:l,end:i.end},s=r;break t}}}break e}n=s===45,t=o}e:{const i=t;if(gt(i.str,1,i.start,i.end)){const r=fe(i.str,H(i.str,0,i.start,i.end));if(r>=48&&r<=57){const a=t3(t,l2,(u,_)=>yc(_,F1)?Ss(Ko(nn,_),jn(u)):_),c=a._0,l=a._1;return n?{_0:c,_1:If(l)}:{_0:c,_1:l}}else break e}else break e}}function f$(e,t){let n=t,o=0,s=e;for(;;){const i=s;let r;e:if(gt(i.str,1,i.start,i.end)){const a=fe(i.str,H(i.str,0,i.start,i.end));if(a>=48&&a<=57){const c=i.str,l=H(i.str,1,i.start,i.end);let u;l===void 0?u=i.end:u=l;const $={str:c,start:u,end:i.end};if(Jl(n,ym)){o=o+1|0,n=ro(Vn(n,nn),qu(a-48|0)),s=$;continue}else{r=i;break e}}else if(a===95){const c=i.str,l=H(i.str,1,i.start,i.end);let u;l===void 0?u=i.end:u=l,s={str:c,start:u,end:i.end};continue}else{r=i;break e}}else{r=i;break e}return{_0:r,_1:n,_2:o}}}function s3(e){let t,n;e:{t:{if(gt(e.str,1,e.start,e.end))switch(fe(e.str,H(e.str,0,e.start,e.end))){case 45:{const v=e.str,y=H(e.str,1,e.start,e.end);let w;y===void 0?w=e.end:w=y,t={_0:{str:v,start:w,end:e.end},_1:!0};break}case 43:{const v=e.str,y=H(e.str,1,e.start,e.end);let w;y===void 0?w=e.end:w=y,n={str:v,start:w,end:e.end};break t}default:{n=e;break t}}else{n=e;break t}break e}t={_0:n,_1:!1}}const o=t._0,s=t._1;if(s6(o))return new Eo(void 0);const i=m$(o,Ct),r=i._0,a=i._1,c=i._2;let l=a,u=r,_=c,$=0,d=Ct;const p=u;if(gt(p.str,1,p.start,p.end)&&fe(p.str,H(p.str,0,p.start,p.end))===46){const v=p.str,y=H(p.str,1,p.start,p.end);let w;y===void 0?w=p.end:w=y,u={str:v,start:w,end:p.end};const P=m$(u,l),T=P._0,x=P._1,D=P._2;u=T,l=x,$=D,d=If(jn($))}if(_=_+$|0,_===0)return new Eo(void 0);let b;e:{t:{const k=u;if(gt(k.str,1,k.start,k.end))switch(fe(k.str,H(k.str,0,k.start,k.end))){case 101:{const P=k.str,T=H(k.str,1,k.start,k.end);let x;T===void 0?x=k.end:x=T,b={str:P,start:x,end:k.end};break t}case 69:{const P=k.str,T=H(k.str,1,k.start,k.end);let x;T===void 0?x=k.end:x=T,b={str:P,start:x,end:k.end};break t}}break e}const m=n3(b);let v;if(m===void 0)return new Eo(void 0);v=m;const y=v._0,w=v._1;u=y,d=Ss(d,w)}const g=u;if(po(g.str,0,g.start,g.end)){if(_<=19)return new Eo({exponent:d,mantissa:l,negative:s,many_digits:!1});_=_-19|0;let m=!1,v=e.str,y=e.start,w=e.end;e:for(;;){const I=v,P=y,T=w;let x,D;t:if(gt(I,1,P,T)){const U=fe(I,H(I,0,P,T));switch(U){case 48:{const L=H(I,1,P,T);let K;L===void 0?K=T:K=L,x={str:I,start:K,end:T},D=U;break t}case 46:{const L=H(I,1,P,T);let K;L===void 0?K=T:K=L,x={str:I,start:K,end:T},D=U;break t}default:break e}}else break;_=_-((D-46|0)/2|0)|0,v=x.str,y=x.start,w=x.end}let k=l;if(_>0){m=!0,k=Ct;const I=f$(e,k),P=I._0,T=I._1,x=I._2;k=T;let D;if(g6(k,ym))D=x;else if(gt(P.str,1,P.start,P.end)){const U=P.str,L=H(P.str,1,P.start,P.end);let K;L===void 0?K=P.end:K=L;const ce={str:U,start:K,end:P.end},he=f$(ce,k),q=he._1,G=he._2;k=q,D=G}else return new Eo(void 0);d=jn(D),d=Ss(d,u2)}return new Eo({exponent:d,mantissa:k,negative:s,many_digits:m})}else return qM()}function h$(e,t,n){const o=t-Jt.bias|0;let s=Tf(e,Cr(No(ln,Jt.mantissa_bits),ln));const i=jn(o&((1<<Jt.exponent_bits)-1|0));return s=j$(s,No(i,Jt.mantissa_bits)),n&&(s=j$(s,No(No(ln,Jt.mantissa_bits),Jt.exponent_bits))),s}function o3(e,t){if(t<0||t>=e.digits_num)return!1;let n;const o=e.digits;if(S(o,t),o[t]===5?n=(t+1|0)===e.digits_num:n=!1,n){if(e.truncated)return!0;let i;if(t>0){const r=e.digits,a=t-1|0;S(r,a),i=(r[a]%2|0)!==0}else i=!1;return i}const s=e.digits;return S(s,t),s[t]>=5}function i3(e){if(e.decimal_point>20)return Gp;let t=Ct,n=0;for(;n<e.decimal_point&&n<e.digits_num;){const o=Ko(t,nn),s=e.digits,i=n;S(s,i),t=Ss(o,Fa(s[i])),n=n+1|0;continue}for(;n<e.decimal_point;){t=Ko(t,nn),n=n+1|0;continue}return o3(e,e.decimal_point)&&(t=Ss(t,ln)),t}function r3(e,t){S(Zr,t);const n=Zr[t]._0;S(Zr,t);const o=Zr[t]._1;let s=!1;const i=o.length;let r=0;for(;;){const a=r;if(a<i){if(a>=e.digits_num){s=!0;break}const c=o.charCodeAt(a)-48|0,l=e.digits;if(S(l,a),l[a]!==c){const u=e.digits;S(u,a),s=u[a]<c;break}r=a+1|0;continue}else break}return s?n-1|0:n}function g$(e,t){const n=r3(e,t);let o=e.digits_num,s=e.digits_num+n|0,i=Ct;for(o=o-1|0;o>=0;){const r=e.digits,a=o;S(r,a);const c=Fa(r[a]);i=Ss(i,No(c,t));const l=no(i,nn),u=Do(Cr(i,Ko(l,nn)));if(s=s-1|0,s<e.digits.length){const _=e.digits,$=s;S(_,$),_[$]=u&255}else u!==0&&(e.truncated=!0);i=l,o=o-1|0;continue}for(;qm(i,Ct);){const r=no(i,nn),a=Do(Cr(i,Ko(nn,r)));if(s=s-1|0,s<e.digits.length){const c=e.digits,l=s;S(c,l),c[l]=a&255}else a!==0&&(e.truncated=!0);i=r;continue}e.digits_num=e.digits_num+n|0,e.digits_num>e.digits.length&&(e.digits_num=e.digits.length),e.decimal_point=e.decimal_point+n|0,Nu(e)}function b$(e,t){let n=0,o=0,s=Ct;for(;ao(ss(s,t),Ct);){if(n>=e.digits_num){for(;ao(ss(s,t),Ct);){s=Vn(s,nn),n=n+1|0;continue}break}const r=e.digits,a=n;S(r,a);const c=r[a];s=ro(Vn(s,nn),Fa(c)),n=n+1|0;continue}e.decimal_point=e.decimal_point-(n-1|0)|0;const i=nu(xr(ln,t),ln);for(;n<e.digits_num;){const r=ss(s,t),a=e.digits,c=o;S(a,c),a[c]=N$(r),o=o+1|0,s=Fo(s,i);const l=e.digits,u=n;S(l,u);const _=l[u];s=ro(Vn(s,nn),Fa(_)),n=n+1|0;continue}for(;Da(s,Ct);){const r=ss(s,t);if(o<e.digits.length){const a=e.digits,c=o;S(a,c),a[c]=N$(r),o=o+1|0}else Da(r,Ct)&&(e.truncated=!0);s=Fo(s,i),s=Vn(s,nn);continue}e.digits_num=o,Nu(e)}function ea(e,t){if(e.digits_num===0)return;let n=t;if(n>0){for(;n>59;){g$(e,59),n=n-59|0;continue}g$(e,n)}if(n<0){for(;n<-59;){b$(e,59),n=n+59|0;continue}b$(e,-n|0);return}else return}function a3(e){let t=0,n=Ct;if(e.digits_num===0||e.decimal_point<-330){n=Ct,t=Jt.bias;const s=h$(n,t,e.negative);return new uo(Mr(s))}if(e.decimal_point>310){const s=pa();if(s.$tag===1)s._0;else return s}for(;e.decimal_point>0;){let s=0;e.decimal_point>=Yr.length?s=60:s=Ns(Yr,e.decimal_point),ea(e,-s|0),t=t+s|0;continue}for(;;){let s;if(e.decimal_point<0)s=!0;else{let i;if(e.decimal_point===0){const r=e.digits;S(r,0),i=r[0]<5}else i=!1;s=i}if(s){let i=0;(-e.decimal_point|0)>=Yr.length?i=60:i=Ns(Yr,-e.decimal_point|0),ea(e,i),t=t-i|0;continue}else break}if(t=t-1|0,t<(Jt.bias+1|0)){const s=(Jt.bias+1|0)-t|0;ea(e,-s|0),t=t+s|0}if((t-Jt.bias|0)>=((1<<Jt.exponent_bits)-1|0)){const s=pa();if(s.$tag===1)s._0;else return s}if(ea(e,Jt.mantissa_bits+1|0),n=i3(e),H$(n,No(Dp,Jt.mantissa_bits))&&(n=Xx(n,1),t=t+1|0,(t-Jt.bias|0)>=((1<<Jt.exponent_bits)-1|0))){const s=pa();if(s.$tag===1)s._0;else return s}H$(Tf(n,No(ln,Jt.mantissa_bits)),Ct)&&(t=Jt.bias);const o=h$(n,t,e.negative);return new uo(Mr(o))}function c3(e,t){if(ao(e,Ct)||ao(t,Ct))return yy;if(ao(e,ln))return t;if(ao(t,ln))return e;if(U$(t)===0||U$(e)===0)return;const n=Qx(c2,t);if(!Da(e,n))return Vn(e,t)}function al(e){const t=e&31;return S(l$,t),l$[t]}function l3(e){return kr(by,e.exponent)&&kr(e.exponent,gy)&&b6(e.mantissa,Sm)&&!e.many_digits}function u3(e){if(l3(e)){let t;if(kr(e.exponent,rl)){const n=Ha(e.mantissa);t=yc(e.exponent,Ct)?n/al(-Do(e.exponent)|0):n*al(Do(e.exponent))}else{const n=Cr(e.exponent,rl),o=e.mantissa,s=Do(n);S(c$,s);const i=c3(o,c$[s]);let r;if(i===void 0||(r=i,Da(r,Sm)))return $a;t=Ha(r)*al(Do(rl))}return e.negative&&(t=-t),new Eu(t)}else return $a}function _3(e){if((e.end-e.start|0)>0)if(JM(e)){const t=s3(e);let n;if(t.$tag===1)n=t._0;else return t;if(n===void 0)return QM(e);{const i=u3(n);if(i.$tag===1){const a=i._0;return new uo(a)}else{const r=ZM(e);let a;if(r.$tag===1)a=r._0;else return r;return a3(a)}}}else return Oa();else return Oa()}function ta(e,t){if(t>=0&&t<(e.end-e.start|0)){const n=e.bytes,o=e.start+t|0;return S(n,o),n[o]}else return jM(`index out of bounds: the len is from 0 to ${xn(e.end-e.start|0)} but the index is ${xn(t)}`)}function $3(e,t,n){const o=e.length;let s;if(n===void 0)s=o;else{const a=n;s=a<0?o+a|0:a}const i=t<0?o+t|0:t;return i>=0&&i<=s&&s<=o?{bytes:e,start:i,end:s}:NM()}function d3(e){const t=ta(e,0),n=ta(e,1),o=(t>>>0)+(n<<8>>>0)|0,s=ta(e,2),i=(o>>>0)+(s<<16>>>0)|0,r=ta(e,3);return(i>>>0)+(r<<24>>>0)|0}function p3(e,t){return{elem_info:0|1<<e,data:[t]}}function ju(e,t){if(e.elem_info&1<<t){const o=e.data,s=e.elem_info,i=dc(s&((1<<t>>>0)-1|0));return S(o,i),o[i]}else return}function m3(e,t,n,o){return{elem_info:0|1<<e|1<<n,data:e<n?[t,o]:[o,t]}}function f3(e,t,n){const o=e.data,s=o.length,i=s+1|0,r=e.elem_info,a=dc(r&((1<<t>>>0)-1|0)),c=$t(i,n);return Ua(o,c,a,0,0),Ua(o,c,s-a|0,a,a+1|0),{elem_info:e.elem_info|1<<t,data:c}}function h3(e,t){const n=e.data,o=n.length,s=e.elem_info,i=dc(s&((1<<t>>>0)-1|0)),r=$t(o-1|0,n[0]);return Ua(n,r,i,0,0),Ua(n,r,(o-i|0)-1|0,i+1|0,i),{elem_info:e.elem_info^1<<t,data:r}}function Cm(e,t,n){const o=BM(e.data),s=e.elem_info,i=dc(s&((1<<t>>>0)-1|0));return S(o,i),o[i]=n,{elem_info:e.elem_info,data:o}}function g3(e,t,n){let o=e,s=n;e:for(;;){const i=o,r=s;switch(i.$tag){case 1:{const a=i,c=a._0,l=a._1,u=a._2;return t===c?l:K3(u,t)}case 0:{const a=i,c=a._0,l=a._1,u=a._2;return r===u&&t===c?l:void 0}default:{const c=i._0,u=r&31,_=ju(c,u);if(_!==void 0){o=_,s=r>>>5|0;continue e}return}}}}function b3(e,t){const n=e;if(n!==void 0)return g3(n,t,Ra(t))}function xm(e,t,n,o,s,i){const a=n&31,l=i&31;if(a===l){let u;if(n>>>0<=127){const $={_0:e,_1:t};u=new _o(o,s,new hr($,yi))}else{const d=n>>>5|0;u=xm(e,t,d,o,s,i>>>5|0)}return new Mi(p3(a,u))}else{let u,_;e:if(n>>>0<=127){const d=new _o(e,t,yi),p=new _o(o,s,yi);u=d,_=p;break e}else{const d=n,p=new Vo(e,t,d>>>5|0),b=i,g=new Vo(o,s,b>>>5|0);u=p,_=g;break e}return new Mi(m3(a,u,l,_))}}function Pm(e,t,n,o){switch(e.$tag){case 1:{const s=e,i=s._0,r=s._1,a=s._2;if(t===i)return new _o(t,n,a);{const c=jm(a,_=>_._0===t);let l;c===void 0?l=a:l=Hm(a,c);const u={_0:i,_1:r};return new _o(t,n,new hr(u,l))}}case 0:{const s=e,i=s._0,r=s._1,a=s._2;return o===a&&t===i?new Vo(i,n,a):xm(i,r,a,t,n,o)}default:{const i=e._0,a=o&31,c=ju(i,a);if(c===void 0){const l=o,u=new Vo(t,n,l>>>5|0);return new Mi(f3(i,a,u))}else{const $=Pm(c,t,n,o>>>5|0);return new Mi(Cm(i,a,$))}}}}function ma(e,t,n){const o=e;return o===void 0?new Vo(t,n,Ra(t)):Pm(o,t,n,Ra(t))}function Lm(e,t,n){switch(e.$tag){case 1:{const o=e,s=o._0,i=o._1,r=o._2;if(s===t){if(r.$tag===0)return;{const a=r,c=a._0,l=c._0,u=c._1,_=a._1;return new _o(l,u,_)}}else{const a=jm(r,c=>c._0===t);if(a===void 0)return e;{const l=a;return new _o(s,i,Hm(r,l))}}}case 0:{const o=e,s=o._0,i=o._2;return n===i&&t===s?void 0:e}default:{const s=e._0,r=n&31,a=ju(s,r);if(a===void 0)return e;{const _=Lm(a,t,n>>>5|0);let $,d;e:{t:{if(s.data.length===1){if(_===void 0)return;d=_;break t}else if(_===void 0)$=h3(s,r);else{d=_;break t}break e}$=Cm(s,r,d)}e:{const p=$.data;if(p.length===1){const b=p[0];if(b.$tag===0){const g=b,m=g._0,v=g._1,y=g._2,w=$.elem_info,k=U1(w),I=y;return new Vo(m,v,I<<5|k)}else break e}else break e}return new Mi($)}}}}function y3(e,t){const n=e;if(n!==void 0)return Lm(n,t,Ra(t))}function Im(e){switch(e.$tag){case 1:{const t=e,n=t._0,o=t._1,s=t._2;return Hx(D$({_0:n,_1:o}),W3(s))}case 0:{const t=e,n=t._0,o=t._1;return D$({_0:n,_1:o})}default:{const o=e._0.data;return s=>{const i=o.length;let r=0;for(;;){const a=r;if(a<i){const c=o[a];if(Im(c)(s)===1){r=a+1|0;continue}else return 0}else return 1}}}}}function v3(e){const t=e;return t===void 0?jx():Im(t)}function w3(e){const t=v3(e);return n=>t(o=>n(o._1))}function na(e,t){if(e!==void 0)return t(e)}function S3(e,t){return Math.pow(e,t)}function hc(e,t){let n=1,o=0,s=0;for(;;){const i=s;if(i<t){const r=e.str,a=e.start+i|0;r.charCodeAt(a)===10?(n=n+1|0,o=0):o=o+1|0,s=i+1|0;continue}else break}return{line:n,column:o}}function k3(e,t){const n=e.offset+t|0,o=bc(e.input,n),s=65533;return new pc(new Gr(hc(e.input,n),o===-1?s:o))}function Zn(e,t){const n=e.offset+t|0,o=bc(e.input,n),s=65533;return new mc(new Gr(hc(e.input,n),o===-1?s:o))}function Hu(e,t){const n=e.offset+t|0,o=bc(e.input,n),s=65533;return new Rr(new Gr(hc(e.input,n),o===-1?s:o))}function gc(e,t){const n=e.offset+t|0,o=bc(e.input,n),s=65533;return new go(new Gr(hc(e.input,n),o===-1?s:o))}function M3(e,t){return new qp(new De({_0:e,_1:t}))}function C3(e,t){return new Kp(new De({_0:e,_1:t}))}function x3(e,t){return new Jp(new De({_0:e,_1:t}))}function P3(e,t){return new Xp(new De({_0:e,_1:t}))}function L3(e,t){return new Yp(new De({_0:e,_1:t}))}function Tm(e,t){const n=e;let o=0,s=n.length;for(;;){const i=o,r=s;if(i<r){const a=(i+r|0)/2|0,c=x6(n,a),l=c._0,u=c._1;if(t<l){s=a;continue}else if(t>u){o=a+1|0;continue}else return!0}else return!1}}function Kt(e){if(e.offset<e.end_offset){const t=e.input,n=e.offset,o=t.str,s=t.start+n|0,i=o.charCodeAt(s);if(e.offset=e.offset+1|0,i>=55296&&i<=56319&&e.offset<e.end_offset){const r=e.input,a=e.offset,c=r.str,l=r.start+a|0,u=c.charCodeAt(l);if(u>=56320&&u<=57343)return e.offset=e.offset+1|0,((i<<10)+u|0)-56613888|0}return i}else return-1}function Li(e){e:for(;;)t:{n:{const t=Kt(e);if(t===-1)break;{const o=t;switch(o){case 9:break n;case 32:break n;case 10:break n;case 13:break n;default:{if(o>127&&Tm(wm,o))break t;e.offset=e.offset-1|0;break e}}}}break t}}function I3(e,t){return{offset:0,input:e,end_offset:e.end-e.start|0,remaining_available_depth:t}}function ds(e,t){if(e.offset<e.end_offset){const n=e.input,o=e.offset,s=n.str,i=n.start+o|0,r=s.charCodeAt(i);return e.offset=e.offset+1|0,t!==r?Zn(e,-1):new Au(void 0)}else return new mc(An)}function yo(e,t,n){const o=Fm(e.input,t,n);if(!cl(o,{str:u$,start:0,end:u$.length})&&!cl(o,{str:_$,start:0,end:_$.length})&&!cl(o,{str:$$,start:0,end:$$.length})){let s,i;e:{t:{const r=Mm(o);let a;if(r.$tag===1)a=r._0;else{i=r._0;break t}s=new Iu(a);break e}s=new $c(i)}e:if(s.$tag===1){const a=s._0;if(kr(a,B1)&&Kl(a,z1))return{_0:Zx(a),_1:void 0};break e}else break e;e:if(gt(o.str,1,o.start,o.end)){if(fe(o.str,H(o.str,0,o.start,o.end))===45)return{_0:br,_1:o};break e}else break e;return{_0:yr,_1:o}}else{let s,i;e:{t:{const r=_3(o);let a;if(r.$tag===1)a=r._0;else{i=r._0;break t}s=new uo(a);break e}s=new Tu(i)}if(s.$tag===1)return{_0:s._0,_1:void 0};e:if(gt(o.str,1,o.start,o.end)){if(fe(o.str,H(o.str,0,o.start,o.end))===45)return{_0:br,_1:o};break e}else break e;return{_0:yr,_1:o}}}function Em(e,t){for(;;)e:{const n=Kt(e);if(n===-1)return yo(e,t,e.offset);{const s=n;if(s>=48&&s<=57)break e;return e.offset=e.offset-1|0,yo(e,t,e.offset)}}}function T3(e,t){const n=Kt(e);if(n===-1)return new Rr(An);{const s=n;return s>=48&&s<=57?new Nn(Em(e,t)):(e.offset=e.offset-1|0,Hu(e,0))}}function Fu(e,t){e:{const s=Kt(e);if(s===-1)return new Rr(An);{const r=s;switch(r){case 43:break e;case 45:break e;default:return r>=48&&r<=57?new Nn(Em(e,t)):(e.offset=e.offset-1|0,Hu(e,0))}}}const n=T3(e,t);let o;if(n.$tag===1)o=n._0;else return n;return new Nn(o)}function E3(e,t){for(;;)e:{t:{const s=Kt(e);if(s===-1)return new Nn(yo(e,t,e.offset));{const r=s;switch(r){case 101:break t;case 69:break t;default:{if(r>=48&&r<=57)break e;return e.offset=e.offset-1|0,new Nn(yo(e,t,e.offset))}}}}const n=Fu(e,t);let o;if(n.$tag===1)o=n._0;else return n;return new Nn(o)}}function Am(e,t){const n=Kt(e);if(n===-1)return new Rr(An);{const s=n;return s>=48&&s<=57?E3(e,t):Hu(e,-1)}}function y$(e,t){for(;;)e:{t:{const s=Kt(e);if(s===-1)return new Nn(yo(e,t,e.offset));{const r=s;switch(r){case 46:{const a=Am(e,t);let c;if(a.$tag===1)c=a._0;else return a;return new Nn(c)}case 101:break t;case 69:break t;default:{if(r>=48&&r<=57)break e;return e.offset=e.offset-1|0,new Nn(yo(e,t,e.offset))}}}}const n=Fu(e,t);let o;if(n.$tag===1)o=n._0;else return n;return new Nn(o)}}function A3(e,t){let n=0,o=0;for(;;){const s=o;if(s<t){const i=Kt(e);if(i===-1)return new Qp(An);{const a=i;if(a>=65){const c=((a&-33)-65|0)+10|0;if(c>15){const l=Zn(e,-1);if(l.$tag===1)l._0;else return l}n=n<<4|c}else if(a>=48){const c=a-48|0;if(c>9){const l=Zn(e,-1);if(l.$tag===1)l._0;else return l}n=n<<4|c}else{const c=Zn(e,-1);if(c.$tag===1)c._0;else return c}}o=s+1|0;continue}else break}return new em(n)}function v$(e,t){const n=e._2,o=e._1,s=e._0;if(s.val>0&&t>s.val){const r=o.input.str,c=o.input.start;Dr(n,r,c+s.val|0,t-s.val|0);return}else return}function Uu(e){const t=Yo(),n={val:e.offset},o={_0:n,_1:e,_2:t};e:for(;;)t:{n:{s:{const i=Kt(e);if(i===-1)return new Fl(An);{const a=i;switch(a){case 34:{v$(o,e.offset-1|0);break e}case 10:break s;case 13:break s;case 92:{v$(o,e.offset-1|0);const c=Kt(e);if(c===-1)return new Fl(An);switch(c){case 98:{dt(t,8);break}case 102:{dt(t,12);break}case 110:{dt(t,10);break}case 114:{dt(t,13);break}case 116:{dt(t,9);break}case 34:{dt(t,34);break}case 92:{dt(t,92);break}case 47:{dt(t,47);break}case 117:{const _=A3(e,4);let $;if(_.$tag===1)$=_._0;else return _;dt(t,$);break}default:{const _=Zn(e,-1);if(_.$tag===1)_._0;else return _}}n.val=e.offset;break}default:if(a<32){const c=Zn(e,-1);if(c.$tag===1)c._0;else return c}else break t}}break n}const s=Zn(e,-1);if(s.$tag===1)s._0;else return s}break t}return new tm(t.val)}function w$(e,t){e:{const n=Kt(e);if(n===-1)return new Nn(yo(e,t,e.offset));{const s=n;switch(s){case 46:return Am(e,t);case 101:break e;case 69:break e;default:{if(s>=48&&s<=57){e.offset=e.offset-1|0;const i=Zn(e,0);if(i.$tag===1)i._0;else return i}return e.offset=e.offset-1|0,new Nn(yo(e,t,e.offset))}}}}return Fu(e,t)}function Wl(e,t){for(;;)e:{t:{n:{const n=Kt(e);if(n===-1)return new go(An);{const s=n;if(s===9)break n;if(s===32)break n;if(s===10)break n;if(s===13)break n;if(s===123)return new Ut(K1);if(s===91)return new Ut(J1);if(s===93){if(t)return new Ut(sm);{const i=Zn(e,-1);if(i.$tag===1)i._0;else return i}}else if(s===110){const i=ds(e,117);if(i.$tag===1)i._0;else return i;const r=ds(e,108);if(r.$tag===1)r._0;else return r;const a=ds(e,108);if(a.$tag===1)a._0;else return a;return new Ut(V1)}else if(s===116){const i=ds(e,114);if(i.$tag===1)i._0;else return i;const r=ds(e,117);if(r.$tag===1)r._0;else return r;const a=ds(e,101);if(a.$tag===1)a._0;else return a;return new Ut(q1)}else if(s===102){const i=ds(e,97);if(i.$tag===1)i._0;else return i;const r=ds(e,108);if(r.$tag===1)r._0;else return r;const a=ds(e,115);if(a.$tag===1)a._0;else return a;const c=ds(e,101);if(c.$tag===1)c._0;else return c;return new Ut(W1)}else if(s===45){const i=Kt(e);if(i===-1)return new go(An);{const a=i;if(a===48){const c=w$(e,e.offset-2|0);let l;if(c.$tag===1)l=c._0;else return c;const u=l._0,_=l._1;return new Ut(new Bi(u,na(_,$=>oa($))))}else{if(a>=49&&a<=57){const l=y$(e,e.offset-2|0);let u;if(l.$tag===1)u=l._0;else return l;const _=u._0,$=u._1;return new Ut(new Bi(_,na($,d=>oa(d))))}const c=Zn(e,-1);if(c.$tag===1)c._0;else return c}}}else if(s===48){const i=w$(e,e.offset-1|0);let r;if(i.$tag===1)r=i._0;else return i;const a=r._0,c=r._1;return new Ut(new Bi(a,na(c,l=>oa(l))))}else if(s>=49&&s<=57){const i=y$(e,e.offset-1|0);let r;if(i.$tag===1)r=i._0;else return i;const a=r._0,c=r._1;return new Ut(new Bi(a,na(c,l=>oa(l))))}else if(s===34){const i=Uu(e);let r;if(i.$tag===1)r=i._0;else return i;return new Ut(new fc(r))}else{if(s>127&&Tm(wm,s))break e;const r=-(s<=65535?1:2)|0,a=Zn(e,r);if(a.$tag===1)a._0;else return a}}break t}break e}break e}}function G3(e){Li(e);const t=Kt(e);if(t===-1)return new go(An);switch(t){case 93:return new Ut(sm);case 44:return new Ut(om);default:return gc(e,-1)}}function R3(e){Li(e);const t=Kt(e);if(t===-1)return new go(An);switch(t){case 125:return new Ut(nm);case 44:return new Ut(om);default:return gc(e,-1)}}function O3(e){Li(e);const t=Kt(e);return t===-1?new mc(An):t===58?new Au(void 0):Zn(e,-1)}function D3(e){Li(e);const t=Kt(e);if(t===-1)return new go(An);switch(t){case 125:return new Ut(nm);case 34:{const s=Uu(e);let i;if(s.$tag===1)i=s._0;else return s;return new Ut(new fc(i))}default:return gc(e,-1)}}function N3(e){Li(e);const t=Kt(e);if(t===-1)return new go(An);if(t===34){const s=Uu(e);let i;if(s.$tag===1)i=s._0;else return s;return new Ut(new fc(i))}else return gc(e,-1)}function Gm(e){const t=Wl(e,!1);let n;if(t.$tag===1)n=t._0;else return t;return Rm(e,n)}function Rm(e,t){e:switch(t.$tag){case 0:return new ys(Gy);case 1:return new ys(Rp);case 2:return new ys(Op);case 3:{const n=t,o=n._0,s=n._1;return new ys(new Ar(o,s))}case 4:{const o=t._0;return new ys(new Ee(o))}case 5:return H3(e);case 7:return j3(e);case 8:break e;case 6:break e;default:break e}return new ys(Ga())}function j3(e){if(e.remaining_available_depth<=0)return new pc(Np);e.remaining_available_depth=e.remaining_available_depth-1|0;const t=[];let n;const o=Wl(e,!0);let s;if(o.$tag===1)s=o._0;else return o;let i=s;e:for(;;){const r=i;if(r.$tag===8){e.remaining_available_depth=e.remaining_available_depth+1|0,n=new En(t);break}else{const a=Rm(e,r);let c;if(a.$tag===1)c=a._0;else return a;Rx(t,c);const l=G3(e);let u;if(l.$tag===1)u=l._0;else return l;switch(u.$tag){case 9:{const _=Wl(e,!1);if(_.$tag===1)i=_._0;else return _;continue e}case 8:{e.remaining_available_depth=e.remaining_available_depth+1|0,n=new En(t);break e}default:{n=Ga();break e}}}}return new ys(n)}function H3(e){if(e.remaining_available_depth<=0)return new pc(Np);e.remaining_available_depth=e.remaining_available_depth-1|0;const t=Xm(8);let n;const o=D3(e);let s;if(o.$tag===1)s=o._0;else return o;let i=s;e:for(;;){const r=i;switch(r.$tag){case 6:{e.remaining_available_depth=e.remaining_available_depth+1|0,n=new ke(t);break e}case 4:{const c=r._0,l=O3(e);if(l.$tag===1)l._0;else return l;const u=Gm(e);let _;if(u.$tag===1)_=u._0;else return u;$e(t,c,_);const $=R3(e);let d;if($.$tag===1)d=$._0;else return $;switch(d.$tag){case 9:{const p=N3(e);if(p.$tag===1)i=p._0;else return p;continue e}case 6:{e.remaining_available_depth=e.remaining_available_depth+1|0,n=new ke(t);break e}default:{n=Ga();break e}}}default:{n=Ga();break e}}}return new ys(n)}function Om(e,t){const n=I3(e,t),o=Gm(n);let s;if(o.$tag===1)s=o._0;else return o;return Li(n),n.offset>=n.end_offset?new ys(s):k3(n,0)}function S$(e,t){const n=Yo(e.length),o=Q3(e);for(;;){const s=gx(o);if(s===-1)break;{const r=s;switch(r){case 34:{mt(n,'\\"');break}case 92:{mt(n,"\\\\");break}case 47:{dt(n,r);break}case 10:{mt(n,"\\n");break}case 13:{mt(n,"\\r");break}case 8:{mt(n,"\\b");break}case 9:{mt(n,"\\t");break}default:{const a=r;a===12?mt(n,"\\f"):a<32?(mt(n,"\\u00"),mt(n,Z6(a&255))):dt(n,r)}}continue}}return n.val}function oi(e,t){return""}function Xe(e,t,n,o){const s=Yo(),i=[];let r=e;for(;;){const a=r;if(a===void 0){if(i.length===0)break;{const c=i[i.length-1|0];if(c.$tag===0){const l=c,u=l._0,_=l._1;if(_<u.length){const $=k6(u,_);l._1=_+1|0,_>0&&(dt(s,44),mt(s,oi())),r=$;continue}else{B$(i),mt(s,oi()),dt(s,93),r=void 0;continue}}else{const l=c,u=l._0,_=l._1,$=wf(u);if($===void 0){B$(i),mt(s,oi()),dt(s,125),r=void 0;continue}else{const p=$,b=p._0;let m=p._1;_||(dt(s,44),mt(s,oi())),dt(s,34),mt(s,S$(b)),dt(s,34),dt(s,58),l._1=!1,r=m;continue}}}}else{const l=a;switch(l.$tag){case 6:{const _=l._0;_.size===0?mt(s,"{}"):(dt(s,123),mt(s,oi()),O$(i,new rm(yf(_),!0)));break}case 5:{const _=l._0;_.length===0?mt(s,"[]"):(dt(s,91),mt(s,oi()),O$(i,new im(_,0)));break}case 4:{const _=l._0;dt(s,34),mt(s,S$(_)),dt(s,34);break}case 3:{const u=l,_=u._0,$=u._1;$===void 0?Y6(s,_):mt(s,$);break}case 1:{mt(s,"true");break}case 2:{mt(s,"false");break}default:mt(s,"null")}r=void 0;continue}}return s.val}function Di(e){if(e.$tag===3){const n=e._0;return new Eu(n)}else return $a}function fa(e){if(e.$tag===4)return e._0}function Dm(e){if(e.$tag===5){const n=e._0;return new cm(n)}else return X1}function Nm(e){if(e.$tag===6)return e._0}function F3(e,t){return gP(e,t)}function U3(e,t){return ou(e,t)}function B3(e,t){let n;return n=am,F3(e,n)}function z3(e,t){let n;return n=am,U3(e,n)}function V3(e,t){switch(e.$tag){case 1:return new Hl(!0);case 2:return new Hl(!1);default:return P3(t,"Bool::from_json: expected boolean")}}function io(e,t){e:if(e.$tag===3){const o=e._0;if(o!==yr)if(o!==br){if(o>2147483647||o<-2147483648){const s=C3(t,"Int::from_json: overflow");if(s.$tag===1)s._0;else return s}return new Wp(ui(o))}else break e;else break e}else break e;return M3(t,"Int::from_json: expected number")}function sa(e,t){e:switch(e.$tag){case 4:switch(e._0){case"NaN":return new Ui(Ly);case"Infinity":return new Ui(Iy);case"-Infinity":return new Ui(Ty);default:break e}case 3:{const o=e._0;if(o!==yr&&o!==br)return new Ui(Math.fround(o));break e}default:break e}return x3(t,"Float::from_json: expected number")}function ws(e,t){if(e.$tag===4){const o=e._0;return new Zp(o)}else return L3(t,"String::from_json: expected string")}function q3(e){return Math.round(e)}function W3(e){return n=>{let o=e;for(;;){const s=o;if(s.$tag===0)return 1;{const i=s,r=i._0,a=i._1;if(n(r)===0)return 0;o=a;continue}}}}function K3(e,t){let n=e;for(;;){const o=n;if(o.$tag===0)return;{const s=o,i=s._0,r=i._0,a=i._1,c=s._1;if(r===t)return a;n=c;continue}}}function jm(e,t){let n=e,o=0;for(;;){const s=n,i=o;if(s.$tag===0)return;{const r=s,a=r._0,c=r._1;if(t(a))return i;n=c,o=i+1|0;continue}}}function Hm(e,t){if(e.$tag===0)return yi;if(t<0)return e;if(t===0)return e._1;{const n=e,o=n._0,s=n._1,i=new hr(o,yi);let r=i,a=s,c=t-1|0;for(;;){const l=r,u=a,_=c;if(u.$tag===0)break;if(l.$tag===1){const $=l,d=u,p=d._0,b=d._1;if(_===0){$._1=b;break}else{$._1=new hr(p,yi),r=$._1,a=b,c=_-1|0;continue}}else{ee();break}}return i}}function J3(e,t){t.method_0(t.self,String(e))}function Fm(e,t,n){let o;return n===void 0?o=e.end-e.start|0:o=n,t>=0&&t<=o&&o<=(e.end-e.start|0)?{str:e.str,start:e.start+t|0,end:e.start+o|0}:RM()}function X3(e,t,n,o){let s=0,i=o;for(;(i-1|0)>=n&&s<t;){const r=i-1|0,a=e.charCodeAt(r);56320<=a&&a<=57343?i=i-2|0:i=i-1|0,s=s+1|0;continue}return s<t||i<n?void 0:i}function Y3(e,t,n,o){if(n>=0&&n<=o){let s=n,i=0;for(;s<o&&i<t;){const r=s,a=e.charCodeAt(r);55296<=a&&a<=56319?s=s+2|0:s=s+1|0,i=i+1|0;continue}return i<t||s>=o?void 0:s}else return OM()}function H(e,t,n,o){let s;return o===void 0?s=e.length:s=o,t>=0?Y3(e,t,n,s):X3(e,-t|0,n,s)}function po(e,t,n,o){let s;o===void 0?s=e.length:s=o;let i=n,r=0;for(;;){const a=i,c=r;if(a<s&&c<t){const l=e.charCodeAt(a);if(55296<=l&&l<=56319&&(a+1|0)<s){const u=a+1|0,_=e.charCodeAt(u);if(56320<=_&&_<=57343){i=a+2|0,r=c+1|0;continue}else Js()}i=a+1|0,r=c+1|0;continue}else return c===t&&a===s}}function gt(e,t,n,o){let s;o===void 0?s=e.length:s=o;let i=n,r=0;for(;;){const a=i,c=r;if(a<s&&c<t){const l=e.charCodeAt(a);if(55296<=l&&l<=56319&&(a+1|0)<s){const u=a+1|0,_=e.charCodeAt(u);if(56320<=_&&_<=57343){i=a+2|0,r=c+1|0;continue}else Js()}i=a+1|0,r=c+1|0;continue}else return c>=t}}function oa(e){return e.str.substring(e.start,e.end)}function Um(e,t){return(((Math.imul(e-55296|0,1024)|0)+t|0)-56320|0)+65536|0}function Z3(e,t){const n=e.end-e.start|0;if(n===(t.end-t.start|0)){if(e.str===t.str&&e.start===t.start)return!0;let o=0;for(;;){const s=o;if(s<n){const i=e.str,r=e.start+s|0,a=i.charCodeAt(r),c=t.str,l=t.start+s|0;if(a!==c.charCodeAt(l))return!1;o=s+1|0;continue}else break}return!0}else return!1}function Q3(e){const t=e.length,n={val:0};return()=>{if(n.val<t){const s=n.val,i=e.charCodeAt(s);if(55296<=i&&i<=56319&&(n.val+1|0)<t){const r=n.val+1|0,a=e.charCodeAt(r);if(56320<=a&&a<=57343){const c=Um(i,a);return n.val=n.val+2|0,c}}return n.val=n.val+1|0,i}else return-1}}function e6(e,t){const n=e.end-e.start|0,o=t.end-t.start|0;if(o>0)if(n>=o){const s=$t(256,o),i=o-1|0;let r=0;for(;;){const c=r;if(c<i){const l=t.str,u=t.start+c|0,_=l.charCodeAt(u)&255;S(s,_),s[_]=(o-1|0)-c|0,r=c+1|0;continue}else break}let a=0;for(;;){const c=a;if(c<=(n-o|0)){const l=o-1|0;let u=0;for(;;){const b=u;if(b<=l){const g=c+b|0,m=e.str,v=e.start+g|0,y=m.charCodeAt(v),w=t.str,k=t.start+b|0;if(y!==w.charCodeAt(k))break;u=b+1|0;continue}else return c}const _=(c+o|0)-1|0,$=e.str,d=e.start+_|0,p=$.charCodeAt(d)&255;S(s,p),a=c+s[p]|0;continue}else break}return}else return;else return Ey}function t6(e,t){const n=e.end-e.start|0,o=t.end-t.start|0;if(o>0)if(n>=o){const i=t.str,r=t.start+0|0,a=i.charCodeAt(r),c=n-o|0;let l=0;for(;l<=c;){for(;;){let u;if(l<=c){const _=l,$=e.str,d=e.start+_|0;u=$.charCodeAt(d)!==a}else u=!1;if(u){l=l+1|0;continue}else break}if(l<=c){let u=1;for(;;){const _=u;if(_<o){const $=l+_|0,d=e.str,p=e.start+$|0,b=d.charCodeAt(p),g=t.str,m=t.start+_|0;if(b!==g.charCodeAt(m))break;u=_+1|0;continue}else return l}l=l+1|0}continue}return}else return;else return Ay}function n6(e,t){return(t.end-t.start|0)<=4?t6(e,t):e6(e,t)}function cl(e,t){return n6(e,t)!==void 0}function s6(e){return(e.end-e.start|0)===0}function bc(e,t){if(t>=0&&t<(e.end-e.start|0)){const n=e.str,o=e.start+t|0,s=n.charCodeAt(o);if(55296<=s&&s<=56319)if((t+1|0)<(e.end-e.start|0)){const i=t+1|0,r=e.str,a=e.start+i|0,c=r.charCodeAt(a);return 56320<=c&&c<=57343?Um(s,c):-1}else return-1;else return 56320<=s&&s<=57343?-1:s}else return-1}function o6(e,t,n){S(t,0),t[0]=1634760805,S(t,1),t[1]=1634760805,S(t,2),t[2]=1634760805,S(t,3),t[3]=1634760805,S(t,4),t[4]=857760878,S(t,5),t[5]=857760878,S(t,6),t[6]=857760878,S(t,7),t[7]=857760878,S(t,8),t[8]=2036477234,S(t,9),t[9]=2036477234,S(t,10),t[10]=2036477234,S(t,11),t[11]=2036477234,S(t,12),t[12]=1797285236,S(t,13),t[13]=1797285236,S(t,14),t[14]=1797285236,S(t,15),t[15]=1797285236,S(e,0),S(t,16),t[16]=e[0],S(e,0),S(t,17),t[17]=e[0],S(e,0),S(t,18),t[18]=e[0],S(e,0),S(t,19),t[19]=e[0],S(e,1),S(t,20),t[20]=e[1],S(e,1),S(t,21),t[21]=e[1],S(e,1),S(t,22),t[22]=e[1],S(e,1),S(t,23),t[23]=e[1],S(e,2),S(t,24),t[24]=e[2],S(e,2),S(t,25),t[25]=e[2],S(e,2),S(t,26),t[26]=e[2],S(e,2),S(t,27),t[27]=e[2],S(e,3),S(t,28),t[28]=e[3],S(e,3),S(t,29),t[29]=e[3],S(e,3),S(t,30),t[30]=e[3],S(e,3),S(t,31),t[31]=e[3],S(e,4),S(t,32),t[32]=e[4],S(e,4),S(t,33),t[33]=e[4],S(e,4),S(t,34),t[34]=e[4],S(e,4),S(t,35),t[35]=e[4],S(e,5),S(t,36),t[36]=e[5],S(e,5),S(t,37),t[37]=e[5],S(e,5),S(t,38),t[38]=e[5],S(e,5),S(t,39),t[39]=e[5],S(e,6),S(t,40),t[40]=e[6],S(e,6),S(t,41),t[41]=e[6],S(e,6),S(t,42),t[42]=e[6],S(e,6),S(t,43),t[43]=e[6],S(e,7),S(t,44),t[44]=e[7],S(e,7),S(t,45),t[45]=e[7],S(e,7),S(t,46),t[46]=e[7],S(e,7),S(t,47),t[47]=e[7],S(t,48),t[48]=n,S(t,49),t[49]=(n>>>0)+1|0,S(t,50),t[50]=(n>>>0)+2|0,S(t,51),t[51]=(n>>>0)+3|0,S(t,52),t[52]=0,S(t,53),t[53]=0,S(t,54),t[54]=0,S(t,55),t[55]=0,S(t,56),t[56]=0,S(t,57),t[57]=0,S(t,58),t[58]=0,S(t,59),t[59]=0,S(t,60),t[60]=0,S(t,61),t[61]=0,S(t,62),t[62]=0,S(t,63),t[63]=0}function Ys(e){const t=e._0,n=e._1,o=e._2,s=e._3,i=(t>>>0)+(n>>>0)|0,r=s^i,a=r<<16|(r>>>16|0),c=(o>>>0)+(a>>>0)|0,l=n^c,u=l<<12|(l>>>20|0),_=(i>>>0)+(u>>>0)|0,$=a^_,d=$<<8|($>>>24|0),p=(c>>>0)+(d>>>0)|0,b=u^p,g=b<<7|(b>>>25|0);return{_0:_,_1:g,_2:p,_3:d}}function Bm(e,t,n){o6(e,t,n);let o=0;for(;;){const s=o;if(s<4){S(t,s);let i=t[s];const r=4+s|0;S(t,r);let a=t[r];const c=8+s|0;S(t,c);let l=t[c];const u=12+s|0;S(t,u);let _=t[u];const $=16+s|0;S(t,$);let d=t[$];const p=20+s|0;S(t,p);let b=t[p];const g=24+s|0;S(t,g);let m=t[g];const v=28+s|0;S(t,v);let y=t[v];const w=32+s|0;S(t,w);let k=t[w];const I=36+s|0;S(t,I);let P=t[I];const T=40+s|0;S(t,T);let x=t[T];const D=44+s|0;S(t,D);let U=t[D];const L=48+s|0;S(t,L);let K=t[L];const ge=52+s|0;S(t,ge);let ce=t[ge];const he=56+s|0;S(t,he);let q=t[he];const G=60+s|0;S(t,G);let J=t[G],F=0;for(;;){const Q=F;if(Q<4){const R=Ys({_0:i,_1:d,_2:k,_3:K});i=R._0,d=R._1,k=R._2,K=R._3;const ue=Ys({_0:a,_1:b,_2:P,_3:ce});a=ue._0,b=ue._1,P=ue._2,ce=ue._3;const ie=Ys({_0:l,_1:m,_2:x,_3:q});l=ie._0,m=ie._1,x=ie._2,q=ie._3;const re=Ys({_0:_,_1:y,_2:U,_3:J});_=re._0,y=re._1,U=re._2,J=re._3;const ne=Ys({_0:i,_1:b,_2:x,_3:J});i=ne._0,b=ne._1,x=ne._2,J=ne._3;const we=Ys({_0:a,_1:m,_2:U,_3:K});a=we._0,m=we._1,U=we._2,K=we._3;const ae=Ys({_0:l,_1:y,_2:k,_3:ce});l=ae._0,y=ae._1,k=ae._2,ce=ae._3;const Se=Ys({_0:_,_1:d,_2:P,_3:q});_=Se._0,d=Se._1,P=Se._2,q=Se._3,F=Q+1|0;continue}else break}S(t,s),t[s]=i;const O=4+s|0;S(t,O),t[O]=a;const X=8+s|0;S(t,X),t[X]=l;const W=12+s|0;S(t,W),t[W]=_;const ve=16+s|0;S(t,ve),S(t,ve),t[ve]=(t[ve]>>>0)+(d>>>0)|0;const Ne=20+s|0;S(t,Ne),S(t,Ne),t[Ne]=(t[Ne]>>>0)+(b>>>0)|0;const Ze=24+s|0;S(t,Ze),S(t,Ze),t[Ze]=(t[Ze]>>>0)+(m>>>0)|0;const He=28+s|0;S(t,He),S(t,He),t[He]=(t[He]>>>0)+(y>>>0)|0;const lt=32+s|0;S(t,lt),S(t,lt),t[lt]=(t[lt]>>>0)+(k>>>0)|0;const et=36+s|0;S(t,et),S(t,et),t[et]=(t[et]>>>0)+(P>>>0)|0;const at=40+s|0;S(t,at),S(t,at),t[at]=(t[at]>>>0)+(x>>>0)|0;const Rt=44+s|0;S(t,Rt),S(t,Rt),t[Rt]=(t[Rt]>>>0)+(U>>>0)|0;const C=48+s|0;S(t,C),t[C]=K;const E=52+s|0;S(t,E),t[E]=ce;const B=56+s|0;S(t,B),t[B]=q;const se=60+s|0;S(t,se),t[se]=J,o=s+1|0;continue}else return}}function i6(e){const t=UM(8,s=>d3($3(e,Math.imul(s,4)|0,(Math.imul(s,4)|0)+4|0))),n=$t(64,0);return Bm(t,n,0),{buffer:n,seed:t,i:0,n:32,counter:0}}function r6(e){const t=e.i;if(t>>>0>=e.n>>>0)return;e.i=(t>>>0)+1|0;const n=t&31,o=e.buffer,s=Math.imul(n,2)|0;S(o,s);const i=tu(o[s]),r=e.buffer,a=(Math.imul(n,2)|0)+1|0;S(r,a);const c=tu(r[a]);return tP(xr(c,32),i)}function a6(e){e.counter=(e.counter>>>0)+4|0,e.counter===16&&(aP(e.buffer,e.seed,8,56,0),e.counter=0),Bm(e.seed,e.buffer,e.counter),e.i=0,e.n=e.counter===12?28:32}function c6(e){for(;;){const t=r6(e);if(t!==void 0)return t;a6(e)}}function l6(e){return{self:i6(e),method_0:c6}}function u6(e){return l6(Y1)}function k$(e,t){const n=Fo(e,il),o=ss(e,32),s=Fo(t,il),i=ss(t,32),r=Vn(n,s),a=ro(Vn(o,s),ss(r,32)),c=ro(Vn(n,i),Fo(a,il));return{hi:ro(ro(Vn(o,i),ss(a,32)),ss(c,32)),lo:Vn(e,t)}}function _6(e,t){if(ao(t,Ct)){const s=e;return s.method_0(s.self)}else if(ao(Fo(t,nu(t,ln)),Ct)){const s=e;return Fo(s.method_0(s.self),nu(t,ln))}const n=e;let o=k$(n.method_0(n.self),t);if(Jl(o.lo,t)){const s=eP(nP(t),t);for(;Jl(o.lo,s);){const i=e;o=k$(i.method_0(i.self),t);continue}}return o.hi}function $6(e,t){if(t===0){const n=e;return F$(n.method_0(n.self))}return F$(_6(e,tu(t)))}function d6(e,t){if(t===0){const n=e;return Km(ss(n.method_0(n.self),33))}else return $6(e,t)}function p6(e){const t=e;return Ha(ss(xr(t.method_0(t.self),11),11))/Ha(xr(ln,53))}function Or(e){const t=Pt(e),n=t-1|0,o=(Math.imul(t,13)|0)/16|0;return{entries:$t(t,void 0),size:0,capacity:t,capacity_mask:n,grow_at:o,head:void 0,tail:-1}}function m6(e,t,n){const o=e.tail;if(o===-1)e.head=n;else{const i=e.entries;S(i,o);const r=i[o];let a;r===void 0?a=ee():a=r,a.next=n}e.tail=t;const s=e.entries;S(s,t),s[t]=n,e.size=e.size+1|0}function M$(e,t,n){const o=e.entries;S(o,n),o[n]=t;const s=t.next;if(s===void 0){e.tail=n;return}else{const r=s;r.prev=n;return}}function f6(e,t,n){let o=n.psl+1|0,s=t+1&e.capacity_mask,i=n;for(;;){const r=o,a=s,c=i,l=e.entries;S(l,a);const u=l[a];if(u===void 0){c.psl=r,M$(e,c,a);break}else{const $=u;if(r>$.psl){c.psl=r,M$(e,c,a),o=$.psl+1|0,s=a+1&e.capacity_mask,i=$;continue}else{o=r+1|0,s=a+1&e.capacity_mask;continue}}}}function zm(e,t,n){e.size>=e.grow_at&&h6(e);let o,s=0,i=n&e.capacity_mask;for(;;){const _=s,$=i,d=e.entries;S(d,$);const p=d[$];if(p===void 0){o={_0:$,_1:_};break}else{const g=p;let m;if(g.hash===n){const v=g.key;m=v._0===t._0&&v._1===t._1}else m=!1;if(m)return;if(_>g.psl){f6(e,$,g),o={_0:$,_1:_};break}s=_+1|0,i=$+1&e.capacity_mask;continue}}const r=o._0,a=o._1,u={prev:e.tail,next:void 0,psl:a,hash:n,key:t};m6(e,r,u)}function h6(e){const t=e.head,n=e.capacity<<1;e.entries=$t(n,void 0),e.capacity=n,e.capacity_mask=n-1|0;const o=e.capacity;e.grow_at=(Math.imul(o,13)|0)/16|0,e.size=0,e.head=void 0,e.tail=-1;let s=t;for(;;){const i=s;if(i===void 0)return;{const a=i,c=a.next,l=a.key,u=a.hash;zm(e,l,u),s=c;continue}}}function rs(e,t){zm(e,t,Zo(t))}function Vm(e){const t=e.end-e.start|0;let n=Pt(t);t>((Math.imul(n,13)|0)/16|0)&&(n=Math.imul(n,2)|0);const s=Or(n),i=e.end-e.start|0;let r=0;for(;;){const a=r;if(a<i){const c=e.buf[e.start+a|0];rs(s,c),r=a+1|0;continue}else break}return s}function ms(e,t){const n=Zo(t);let o=0,s=n&e.capacity_mask;for(;;){const i=o,r=s,a=e.entries;S(a,r);const c=a[r];if(c===void 0)return!1;{const u=c;let _;if(u.hash===n){const $=u.key;_=$._0===t._0&&$._1===t._1}else _=!1;if(_)return!0;if(i>u.psl)return!1;o=i+1|0,s=r+1&e.capacity_mask;continue}}}function sn(e){dx(e.entries,void 0,0),e.size=0,e.head=void 0,e.tail=-1}function on(e){const t={val:e.head};return()=>{const o=t.val;if(o!==void 0){const i=o,r=i.key,a=i.next;return t.val=a,r}}}function Kl(e,t){return U6(e,t)}function g6(e,t){return B6(e,t)}function kr(e,t){return H6(e,t)}function b6(e,t){return F6(e,t)}function yc(e,t){return O6(e,t)}function Jl(e,t){return D6(e,t)}function y6(e,t,n,o,s){if(e===n&&t<o){let i=0;for(;;){const r=i;if(r<s){const a=t+r|0,c=o+r|0;S(n,c),S(e,a),e[a]=n[c],i=r+1|0;continue}else return}}else{let i=s-1|0;for(;;){const r=i;if(r>=0){const a=t+r|0,c=o+r|0;S(n,c),S(e,a),e[a]=n[c],i=r-1|0;continue}else return}}}function v6(e,t,n,o,s){if(e===n&&t<o){let i=0;for(;;){const r=i;if(r<s){const a=t+r|0,c=o+r|0;S(n,c),S(e,a),e[a]=n[c],i=r+1|0;continue}else return}}else{let i=s-1|0;for(;;){const r=i;if(r>=0){const a=t+r|0,c=o+r|0;S(n,c),S(e,a),e[a]=n[c],i=r-1|0;continue}else return}}}function Yo(e){return{val:""}}function dt(e,t){const n=e;n.val=`${n.val}${String.fromCodePoint(t)}`}function qm(e,t){return N6(e,t)}function Da(e,t){return j6(e,t)}function w6(e,t){return(((Math.imul(e-55296|0,1024)|0)+t|0)-56320|0)+65536|0}function fe(e,t){const n=e.charCodeAt(t);if(55296<=n&&n<=56319){const o=t+1|0,s=e.charCodeAt(o);return w6(n,s)}else return n}function S6(e,t){return!Z3(e,t)}function k6(e,t){const n=e.length;return t>=0&&t<n?(S(e,t),e[t]):ee()}function yt(e,t){const n=e.length;return t>=0&&t<n?(S(e,t),e[t]):ee()}function vt(e,t){const n=e.length;return t>=0&&t<n?(S(e,t),e[t]):ee()}function Ns(e,t){const n=e.length;return t>=0&&t<n?(S(e,t),e[t]):ee()}function M6(e,t){const n=e.length;return t<n?(S(e,t),e[t]):ee()}function C6(e,t){const n=e.length;return t>=0&&t<n?(S(e,t),e[t]):ee()}function x6(e,t){const n=e.length;return t>=0&&t<n?(S(e,t),e[t]):ee()}function P6(e,t){const n=e.length;return t>=0&&t<n?(S(e,t),e[t]):ee()}function L6(e,t){const n=e.length;return t<n?(S(e,t),e[t]):ee()}function Zs(e,t){const n=e.length;return t>=0&&t<n?(S(e,t),e[t]):ee()}function mt(e,t){const n=e;n.val=`${n.val}${t}`}function yn(e){const t=e._0,n=e._1,o=[Ge(t),Ge(n)];return new En(o)}function I6(e){const t=e._0,n=e._1,o=[Pc(t),yn(n)];return new En(o)}function T6(e){const t=e._0,n=e._1,o=[Pc(t),Ge(n)];return new En(o)}function E6(e,t){iP(t,e)}function A6(e,t){$P(t,e)}function G6(e,t){R6(t,e)}function Xl(e,t){rP(t,e)}function R6(e,t){const n=e._0,o=e._1;Xl(t,n),Xl(t,o)}function O6(e,t){return Cc(e,t)<0}function D6(e,t){return xc(e,t)<0}function N6(e,t){return Cc(e,t)>0}function j6(e,t){return xc(e,t)>0}function H6(e,t){return Cc(e,t)<=0}function F6(e,t){return xc(e,t)<=0}function U6(e,t){return Cc(e,t)>=0}function B6(e,t){return xc(e,t)>=0}function z6(e){let t=e.acc;return t=t^(t>>>15|0),t=Math.imul(t,-2048144777)|0,t=t^(t>>>13|0),t=Math.imul(t,-1028477379)|0,t=t^(t>>>16|0),t}function vc(e){return z6(e)}function V6(e){return{acc:(e>>>0)+374761393|0}}function wc(e){let t;return t=LM,V6(t)}function us(e){const t=wc();return E6(t,e),vc(t)}function Wm(e){const t=wc();return A6(t,e),vc(t)}function Zo(e){const t=wc();return G6(t,e),vc(t)}function Is(e){const t=wc();return Xl(t,e),vc(t)}function q6(e){const t=Yo();return WP(e,{self:t,method_0:mt,method_1:Dr,method_2:dt}),t.val}function W6(e){const t=Yo();return _P(e,{self:t,method_0:mt,method_1:Dr,method_2:dt}),t.val}function Sc(e){const t=Yo(),n={self:t,method_0:mt,method_1:Dr,method_2:dt};return e?n.method_0(n.self,"true"):n.method_0(n.self,"false"),t.val}function K6(e){return{hi:e>>31&-1,lo:e|0}}function jn(e){return K6(e)}function Do(e){return e.lo}function J6(e,t){return Q1(e,t)}function xn(e){return J6(e,10)}function Km(e){return e.lo}function X6(e,t,n){const o=e.length;let s;return n===void 0?s=o:s=n,t>=0&&t<=s&&s<=o?e.substring(t,s):ee()}function Dr(e,t,n,o){const s=e;s.val=`${s.val}${X6(t,n,n+o|0)}`}function Y6(e,t){J3(t,{self:e,method_0:mt,method_1:Dr,method_2:dt})}function C$(e){return e<10?(e+48|0)&255:(((e+97|0)&255)-10|0)&255}function Z6(e){const t=Yo();return dt(t,C$((e/16|0)&255)),dt(t,C$((e%16|0)&255)),t.val}function Q6(e){return n=>{const o=e.length;let s=0;for(;;){const i=s;if(i<o){const r=e[i];if(n(r)!==1)return 0;s=i+1|0;continue}else return 1}}}function Jm(e){return e.$tag===0?ee():e._0}function Ni(e){return e.$tag===0?ee():e._0}function Pt(e){return e>=0?e<=1?1:e>1073741824?1073741824:(2147483647>>(Math.clz32(e-1|0)-1|0))+1|0:ee()}function Xm(e){const t=Pt(e),n=t-1|0,o=(Math.imul(t,13)|0)/16|0;return{entries:$t(t,void 0),size:0,capacity:t,capacity_mask:n,grow_at:o,head:void 0,tail:-1}}function eC(e){const t=Pt(e),n=t-1|0,o=(Math.imul(t,13)|0)/16|0;return{entries:$t(t,void 0),size:0,capacity:t,capacity_mask:n,grow_at:o,head:void 0,tail:-1}}function tC(e){const t=Pt(e),n=t-1|0,o=(Math.imul(t,13)|0)/16|0;return{entries:$t(t,void 0),size:0,capacity:t,capacity_mask:n,grow_at:o,head:void 0,tail:-1}}function nC(e){const t=Pt(e),n=t-1|0,o=(Math.imul(t,13)|0)/16|0;return{entries:$t(t,void 0),size:0,capacity:t,capacity_mask:n,grow_at:o,head:void 0,tail:-1}}function sC(e){const t=Pt(e),n=t-1|0,o=(Math.imul(t,13)|0)/16|0;return{entries:$t(t,void 0),size:0,capacity:t,capacity_mask:n,grow_at:o,head:void 0,tail:-1}}function oC(e){const t=Pt(e),n=t-1|0,o=(Math.imul(t,13)|0)/16|0;return{entries:$t(t,void 0),size:0,capacity:t,capacity_mask:n,grow_at:o,head:void 0,tail:-1}}function iC(e){const t=Pt(e),n=t-1|0,o=(Math.imul(t,13)|0)/16|0;return{entries:$t(t,void 0),size:0,capacity:t,capacity_mask:n,grow_at:o,head:void 0,tail:-1}}function rC(e){const t=Pt(e),n=t-1|0,o=(Math.imul(t,13)|0)/16|0;return{entries:$t(t,void 0),size:0,capacity:t,capacity_mask:n,grow_at:o,head:void 0,tail:-1}}function aC(e){const t=Pt(e),n=t-1|0,o=(Math.imul(t,13)|0)/16|0;return{entries:$t(t,void 0),size:0,capacity:t,capacity_mask:n,grow_at:o,head:void 0,tail:-1}}function cC(e){const t=Pt(e),n=t-1|0,o=(Math.imul(t,13)|0)/16|0;return{entries:$t(t,void 0),size:0,capacity:t,capacity_mask:n,grow_at:o,head:void 0,tail:-1}}function lC(e){const t=Pt(e),n=t-1|0,o=(Math.imul(t,13)|0)/16|0;return{entries:$t(t,void 0),size:0,capacity:t,capacity_mask:n,grow_at:o,head:void 0,tail:-1}}function uC(e,t,n){const o=e.tail;if(o===-1)e.head=n;else{const i=e.entries;S(i,o);const r=i[o];let a;r===void 0?a=ee():a=r,a.next=n}e.tail=t;const s=e.entries;S(s,t),s[t]=n,e.size=e.size+1|0}function _C(e,t,n){const o=e.tail;if(o===-1)e.head=n;else{const i=e.entries;S(i,o);const r=i[o];let a;r===void 0?a=ee():a=r,a.next=n}e.tail=t;const s=e.entries;S(s,t),s[t]=n,e.size=e.size+1|0}function $C(e,t,n){const o=e.tail;if(o===-1)e.head=n;else{const i=e.entries;S(i,o);const r=i[o];let a;r===void 0?a=ee():a=r,a.next=n}e.tail=t;const s=e.entries;S(s,t),s[t]=n,e.size=e.size+1|0}function dC(e,t,n){const o=e.tail;if(o===-1)e.head=n;else{const i=e.entries;S(i,o);const r=i[o];let a;r===void 0?a=ee():a=r,a.next=n}e.tail=t;const s=e.entries;S(s,t),s[t]=n,e.size=e.size+1|0}function pC(e,t,n){const o=e.tail;if(o===-1)e.head=n;else{const i=e.entries;S(i,o);const r=i[o];let a;r===void 0?a=ee():a=r,a.next=n}e.tail=t;const s=e.entries;S(s,t),s[t]=n,e.size=e.size+1|0}function mC(e,t,n){const o=e.tail;if(o===-1)e.head=n;else{const i=e.entries;S(i,o);const r=i[o];let a;r===void 0?a=ee():a=r,a.next=n}e.tail=t;const s=e.entries;S(s,t),s[t]=n,e.size=e.size+1|0}function fC(e,t,n){const o=e.tail;if(o===-1)e.head=n;else{const i=e.entries;S(i,o);const r=i[o];let a;r===void 0?a=ee():a=r,a.next=n}e.tail=t;const s=e.entries;S(s,t),s[t]=n,e.size=e.size+1|0}function hC(e,t,n){const o=e.tail;if(o===-1)e.head=n;else{const i=e.entries;S(i,o);const r=i[o];let a;r===void 0?a=ee():a=r,a.next=n}e.tail=t;const s=e.entries;S(s,t),s[t]=n,e.size=e.size+1|0}function gC(e,t,n){const o=e.tail;if(o===-1)e.head=n;else{const i=e.entries;S(i,o);const r=i[o];let a;r===void 0?a=ee():a=r,a.next=n}e.tail=t;const s=e.entries;S(s,t),s[t]=n,e.size=e.size+1|0}function bC(e,t,n){const o=e.tail;if(o===-1)e.head=n;else{const i=e.entries;S(i,o);const r=i[o];let a;r===void 0?a=ee():a=r,a.next=n}e.tail=t;const s=e.entries;S(s,t),s[t]=n,e.size=e.size+1|0}function yC(e,t,n){const o=e.tail;if(o===-1)e.head=n;else{const i=e.entries;S(i,o);const r=i[o];let a;r===void 0?a=ee():a=r,a.next=n}e.tail=t;const s=e.entries;S(s,t),s[t]=n,e.size=e.size+1|0}function x$(e,t,n){const o=e.entries;S(o,n),o[n]=t;const s=t.next;if(s===void 0){e.tail=n;return}else{const r=s;r.prev=n;return}}function P$(e,t,n){const o=e.entries;S(o,n),o[n]=t;const s=t.next;if(s===void 0){e.tail=n;return}else{const r=s;r.prev=n;return}}function Yl(e,t,n){const o=e.entries;S(o,n),o[n]=t;const s=t.next;if(s===void 0){e.tail=n;return}else{const r=s;r.prev=n;return}}function Zl(e,t,n){const o=e.entries;S(o,n),o[n]=t;const s=t.next;if(s===void 0){e.tail=n;return}else{const r=s;r.prev=n;return}}function Ql(e,t,n){const o=e.entries;S(o,n),o[n]=t;const s=t.next;if(s===void 0){e.tail=n;return}else{const r=s;r.prev=n;return}}function L$(e,t,n){const o=e.entries;S(o,n),o[n]=t;const s=t.next;if(s===void 0){e.tail=n;return}else{const r=s;r.prev=n;return}}function I$(e,t,n){const o=e.entries;S(o,n),o[n]=t;const s=t.next;if(s===void 0){e.tail=n;return}else{const r=s;r.prev=n;return}}function T$(e,t,n){const o=e.entries;S(o,n),o[n]=t;const s=t.next;if(s===void 0){e.tail=n;return}else{const r=s;r.prev=n;return}}function E$(e,t,n){const o=e.entries;S(o,n),o[n]=t;const s=t.next;if(s===void 0){e.tail=n;return}else{const r=s;r.prev=n;return}}function A$(e,t,n){const o=e.entries;S(o,n),o[n]=t;const s=t.next;if(s===void 0){e.tail=n;return}else{const r=s;r.prev=n;return}}function G$(e,t,n){const o=e.entries;S(o,n),o[n]=t;const s=t.next;if(s===void 0){e.tail=n;return}else{const r=s;r.prev=n;return}}function vC(e,t,n){let o=n.psl+1|0,s=t+1&e.capacity_mask,i=n;for(;;){const r=o,a=s,c=i,l=e.entries;S(l,a);const u=l[a];if(u===void 0){c.psl=r,x$(e,c,a);break}else{const $=u;if(r>$.psl){c.psl=r,x$(e,c,a),o=$.psl+1|0,s=a+1&e.capacity_mask,i=$;continue}else{o=r+1|0,s=a+1&e.capacity_mask;continue}}}}function wC(e,t,n){let o=n.psl+1|0,s=t+1&e.capacity_mask,i=n;for(;;){const r=o,a=s,c=i,l=e.entries;S(l,a);const u=l[a];if(u===void 0){c.psl=r,P$(e,c,a);break}else{const $=u;if(r>$.psl){c.psl=r,P$(e,c,a),o=$.psl+1|0,s=a+1&e.capacity_mask,i=$;continue}else{o=r+1|0,s=a+1&e.capacity_mask;continue}}}}function SC(e,t,n){let o=n.psl+1|0,s=t+1&e.capacity_mask,i=n;for(;;){const r=o,a=s,c=i,l=e.entries;S(l,a);const u=l[a];if(u===void 0){c.psl=r,Ql(e,c,a);break}else{const $=u;if(r>$.psl){c.psl=r,Ql(e,c,a),o=$.psl+1|0,s=a+1&e.capacity_mask,i=$;continue}else{o=r+1|0,s=a+1&e.capacity_mask;continue}}}}function kC(e,t,n){let o=n.psl+1|0,s=t+1&e.capacity_mask,i=n;for(;;){const r=o,a=s,c=i,l=e.entries;S(l,a);const u=l[a];if(u===void 0){c.psl=r,Yl(e,c,a);break}else{const $=u;if(r>$.psl){c.psl=r,Yl(e,c,a),o=$.psl+1|0,s=a+1&e.capacity_mask,i=$;continue}else{o=r+1|0,s=a+1&e.capacity_mask;continue}}}}function MC(e,t,n){let o=n.psl+1|0,s=t+1&e.capacity_mask,i=n;for(;;){const r=o,a=s,c=i,l=e.entries;S(l,a);const u=l[a];if(u===void 0){c.psl=r,Zl(e,c,a);break}else{const $=u;if(r>$.psl){c.psl=r,Zl(e,c,a),o=$.psl+1|0,s=a+1&e.capacity_mask,i=$;continue}else{o=r+1|0,s=a+1&e.capacity_mask;continue}}}}function CC(e,t,n){let o=n.psl+1|0,s=t+1&e.capacity_mask,i=n;for(;;){const r=o,a=s,c=i,l=e.entries;S(l,a);const u=l[a];if(u===void 0){c.psl=r,L$(e,c,a);break}else{const $=u;if(r>$.psl){c.psl=r,L$(e,c,a),o=$.psl+1|0,s=a+1&e.capacity_mask,i=$;continue}else{o=r+1|0,s=a+1&e.capacity_mask;continue}}}}function xC(e,t,n){let o=n.psl+1|0,s=t+1&e.capacity_mask,i=n;for(;;){const r=o,a=s,c=i,l=e.entries;S(l,a);const u=l[a];if(u===void 0){c.psl=r,I$(e,c,a);break}else{const $=u;if(r>$.psl){c.psl=r,I$(e,c,a),o=$.psl+1|0,s=a+1&e.capacity_mask,i=$;continue}else{o=r+1|0,s=a+1&e.capacity_mask;continue}}}}function PC(e,t,n){let o=n.psl+1|0,s=t+1&e.capacity_mask,i=n;for(;;){const r=o,a=s,c=i,l=e.entries;S(l,a);const u=l[a];if(u===void 0){c.psl=r,T$(e,c,a);break}else{const $=u;if(r>$.psl){c.psl=r,T$(e,c,a),o=$.psl+1|0,s=a+1&e.capacity_mask,i=$;continue}else{o=r+1|0,s=a+1&e.capacity_mask;continue}}}}function LC(e,t,n){let o=n.psl+1|0,s=t+1&e.capacity_mask,i=n;for(;;){const r=o,a=s,c=i,l=e.entries;S(l,a);const u=l[a];if(u===void 0){c.psl=r,E$(e,c,a);break}else{const $=u;if(r>$.psl){c.psl=r,E$(e,c,a),o=$.psl+1|0,s=a+1&e.capacity_mask,i=$;continue}else{o=r+1|0,s=a+1&e.capacity_mask;continue}}}}function IC(e,t,n){let o=n.psl+1|0,s=t+1&e.capacity_mask,i=n;for(;;){const r=o,a=s,c=i,l=e.entries;S(l,a);const u=l[a];if(u===void 0){c.psl=r,A$(e,c,a);break}else{const $=u;if(r>$.psl){c.psl=r,A$(e,c,a),o=$.psl+1|0,s=a+1&e.capacity_mask,i=$;continue}else{o=r+1|0,s=a+1&e.capacity_mask;continue}}}}function TC(e,t,n){let o=n.psl+1|0,s=t+1&e.capacity_mask,i=n;for(;;){const r=o,a=s,c=i,l=e.entries;S(l,a);const u=l[a];if(u===void 0){c.psl=r,G$(e,c,a);break}else{const $=u;if(r>$.psl){c.psl=r,G$(e,c,a),o=$.psl+1|0,s=a+1&e.capacity_mask,i=$;continue}else{o=r+1|0,s=a+1&e.capacity_mask;continue}}}}function Ym(e,t,n,o){e.size>=e.grow_at&&EC(e);let s,i=0,r=o&e.capacity_mask;for(;;){const $=i,d=r,p=e.entries;S(p,d);const b=p[d];if(b===void 0){s={_0:d,_1:$};break}else{const m=b;if(m.hash===o&&m.key===t){m.value=n;return}if($>m.psl){vC(e,d,m),s={_0:d,_1:$};break}i=$+1|0,r=d+1&e.capacity_mask;continue}}const a=s._0,c=s._1,_={prev:e.tail,next:void 0,psl:c,hash:o,key:t,value:n};uC(e,a,_)}function Zm(e,t,n,o){e.size>=e.grow_at&&AC(e);let s,i=0,r=o&e.capacity_mask;for(;;){const $=i,d=r,p=e.entries;S(p,d);const b=p[d];if(b===void 0){s={_0:d,_1:$};break}else{const m=b;if(m.hash===o&&Of(m.key,t)){m.value=n;return}if($>m.psl){wC(e,d,m),s={_0:d,_1:$};break}i=$+1|0,r=d+1&e.capacity_mask;continue}}const a=s._0,c=s._1,_={prev:e.tail,next:void 0,psl:c,hash:o,key:t,value:n};_C(e,a,_)}function Qm(e,t,n,o){e.size>=e.grow_at&&GC(e);let s,i=0,r=o&e.capacity_mask;for(;;){const $=i,d=r,p=e.entries;S(p,d);const b=p[d];if(b===void 0){s={_0:d,_1:$};break}else{const m=b;if(m.hash===o&&m.key===t){m.value=n;return}if($>m.psl){SC(e,d,m),s={_0:d,_1:$};break}i=$+1|0,r=d+1&e.capacity_mask;continue}}const a=s._0,c=s._1,_={prev:e.tail,next:void 0,psl:c,hash:o,key:t,value:n};$C(e,a,_)}function ef(e,t,n,o){e.size>=e.grow_at&&RC(e);let s,i=0,r=o&e.capacity_mask;for(;;){const $=i,d=r,p=e.entries;S(p,d);const b=p[d];if(b===void 0){s={_0:d,_1:$};break}else{const m=b;if(m.hash===o&&m.key===t){m.value=n;return}if($>m.psl){kC(e,d,m),s={_0:d,_1:$};break}i=$+1|0,r=d+1&e.capacity_mask;continue}}const a=s._0,c=s._1,_={prev:e.tail,next:void 0,psl:c,hash:o,key:t,value:n};dC(e,a,_)}function tf(e,t,n,o){e.size>=e.grow_at&&OC(e);let s,i=0,r=o&e.capacity_mask;for(;;){const $=i,d=r,p=e.entries;S(p,d);const b=p[d];if(b===void 0){s={_0:d,_1:$};break}else{const m=b;if(m.hash===o&&m.key===t){m.value=n;return}if($>m.psl){MC(e,d,m),s={_0:d,_1:$};break}i=$+1|0,r=d+1&e.capacity_mask;continue}}const a=s._0,c=s._1,_={prev:e.tail,next:void 0,psl:c,hash:o,key:t,value:n};pC(e,a,_)}function nf(e,t,n,o){e.size>=e.grow_at&&DC(e);let s,i=0,r=o&e.capacity_mask;for(;;){const $=i,d=r,p=e.entries;S(p,d);const b=p[d];if(b===void 0){s={_0:d,_1:$};break}else{const m=b;if(m.hash===o&&m.key===t){m.value=n;return}if($>m.psl){CC(e,d,m),s={_0:d,_1:$};break}i=$+1|0,r=d+1&e.capacity_mask;continue}}const a=s._0,c=s._1,_={prev:e.tail,next:void 0,psl:c,hash:o,key:t,value:n};mC(e,a,_)}function sf(e,t,n,o){e.size>=e.grow_at&&NC(e);let s,i=0,r=o&e.capacity_mask;for(;;){const $=i,d=r,p=e.entries;S(p,d);const b=p[d];if(b===void 0){s={_0:d,_1:$};break}else{const m=b;if(m.hash===o&&m.key===t){m.value=n;return}if($>m.psl){xC(e,d,m),s={_0:d,_1:$};break}i=$+1|0,r=d+1&e.capacity_mask;continue}}const a=s._0,c=s._1,_={prev:e.tail,next:void 0,psl:c,hash:o,key:t,value:n};fC(e,a,_)}function of(e,t,n,o){e.size>=e.grow_at&&jC(e);let s,i=0,r=o&e.capacity_mask;for(;;){const $=i,d=r,p=e.entries;S(p,d);const b=p[d];if(b===void 0){s={_0:d,_1:$};break}else{const m=b;let v;if(m.hash===o){const y=m.key;v=y._0===t._0&&y._1===t._1}else v=!1;if(v){m.value=n;return}if($>m.psl){PC(e,d,m),s={_0:d,_1:$};break}i=$+1|0,r=d+1&e.capacity_mask;continue}}const a=s._0,c=s._1,_={prev:e.tail,next:void 0,psl:c,hash:o,key:t,value:n};hC(e,a,_)}function rf(e,t,n,o){e.size>=e.grow_at&&HC(e);let s,i=0,r=o&e.capacity_mask;for(;;){const $=i,d=r,p=e.entries;S(p,d);const b=p[d];if(b===void 0){s={_0:d,_1:$};break}else{const m=b;let v;if(m.hash===o){const y=m.key;v=y._0===t._0&&y._1===t._1}else v=!1;if(v){m.value=n;return}if($>m.psl){LC(e,d,m),s={_0:d,_1:$};break}i=$+1|0,r=d+1&e.capacity_mask;continue}}const a=s._0,c=s._1,_={prev:e.tail,next:void 0,psl:c,hash:o,key:t,value:n};gC(e,a,_)}function af(e,t,n,o){e.size>=e.grow_at&&FC(e);let s,i=0,r=o&e.capacity_mask;for(;;){const $=i,d=r,p=e.entries;S(p,d);const b=p[d];if(b===void 0){s={_0:d,_1:$};break}else{const m=b;if(m.hash===o&&m.key===t){m.value=n;return}if($>m.psl){IC(e,d,m),s={_0:d,_1:$};break}i=$+1|0,r=d+1&e.capacity_mask;continue}}const a=s._0,c=s._1,_={prev:e.tail,next:void 0,psl:c,hash:o,key:t,value:n};bC(e,a,_)}function cf(e,t,n,o){e.size>=e.grow_at&&UC(e);let s,i=0,r=o&e.capacity_mask;for(;;){const $=i,d=r,p=e.entries;S(p,d);const b=p[d];if(b===void 0){s={_0:d,_1:$};break}else{const m=b;let v;if(m.hash===o){const y=m.key;v=y._0===t._0&&y._1===t._1}else v=!1;if(v){m.value=n;return}if($>m.psl){TC(e,d,m),s={_0:d,_1:$};break}i=$+1|0,r=d+1&e.capacity_mask;continue}}const a=s._0,c=s._1,_={prev:e.tail,next:void 0,psl:c,hash:o,key:t,value:n};yC(e,a,_)}function EC(e){const t=e.head,n=e.capacity<<1;e.entries=$t(n,void 0),e.capacity=n,e.capacity_mask=n-1|0;const o=e.capacity;e.grow_at=(Math.imul(o,13)|0)/16|0,e.size=0,e.head=void 0,e.tail=-1;let s=t;for(;;){const i=s;if(i===void 0)return;{const a=i,c=a.next,l=a.key,u=a.value,_=a.hash;Ym(e,l,u,_),s=c;continue}}}function AC(e){const t=e.head,n=e.capacity<<1;e.entries=$t(n,void 0),e.capacity=n,e.capacity_mask=n-1|0;const o=e.capacity;e.grow_at=(Math.imul(o,13)|0)/16|0,e.size=0,e.head=void 0,e.tail=-1;let s=t;for(;;){const i=s;if(i===void 0)return;{const a=i,c=a.next,l=a.key,u=a.value,_=a.hash;Zm(e,l,u,_),s=c;continue}}}function GC(e){const t=e.head,n=e.capacity<<1;e.entries=$t(n,void 0),e.capacity=n,e.capacity_mask=n-1|0;const o=e.capacity;e.grow_at=(Math.imul(o,13)|0)/16|0,e.size=0,e.head=void 0,e.tail=-1;let s=t;for(;;){const i=s;if(i===void 0)return;{const a=i,c=a.next,l=a.key,u=a.value,_=a.hash;Qm(e,l,u,_),s=c;continue}}}function RC(e){const t=e.head,n=e.capacity<<1;e.entries=$t(n,void 0),e.capacity=n,e.capacity_mask=n-1|0;const o=e.capacity;e.grow_at=(Math.imul(o,13)|0)/16|0,e.size=0,e.head=void 0,e.tail=-1;let s=t;for(;;){const i=s;if(i===void 0)return;{const a=i,c=a.next,l=a.key,u=a.value,_=a.hash;ef(e,l,u,_),s=c;continue}}}function OC(e){const t=e.head,n=e.capacity<<1;e.entries=$t(n,void 0),e.capacity=n,e.capacity_mask=n-1|0;const o=e.capacity;e.grow_at=(Math.imul(o,13)|0)/16|0,e.size=0,e.head=void 0,e.tail=-1;let s=t;for(;;){const i=s;if(i===void 0)return;{const a=i,c=a.next,l=a.key,u=a.value,_=a.hash;tf(e,l,u,_),s=c;continue}}}function DC(e){const t=e.head,n=e.capacity<<1;e.entries=$t(n,void 0),e.capacity=n,e.capacity_mask=n-1|0;const o=e.capacity;e.grow_at=(Math.imul(o,13)|0)/16|0,e.size=0,e.head=void 0,e.tail=-1;let s=t;for(;;){const i=s;if(i===void 0)return;{const a=i,c=a.next,l=a.key,u=a.value,_=a.hash;nf(e,l,u,_),s=c;continue}}}function NC(e){const t=e.head,n=e.capacity<<1;e.entries=$t(n,void 0),e.capacity=n,e.capacity_mask=n-1|0;const o=e.capacity;e.grow_at=(Math.imul(o,13)|0)/16|0,e.size=0,e.head=void 0,e.tail=-1;let s=t;for(;;){const i=s;if(i===void 0)return;{const a=i,c=a.next,l=a.key,u=a.value,_=a.hash;sf(e,l,u,_),s=c;continue}}}function jC(e){const t=e.head,n=e.capacity<<1;e.entries=$t(n,void 0),e.capacity=n,e.capacity_mask=n-1|0;const o=e.capacity;e.grow_at=(Math.imul(o,13)|0)/16|0,e.size=0,e.head=void 0,e.tail=-1;let s=t;for(;;){const i=s;if(i===void 0)return;{const a=i,c=a.next,l=a.key,u=a.value,_=a.hash;of(e,l,u,_),s=c;continue}}}function HC(e){const t=e.head,n=e.capacity<<1;e.entries=$t(n,void 0),e.capacity=n,e.capacity_mask=n-1|0;const o=e.capacity;e.grow_at=(Math.imul(o,13)|0)/16|0,e.size=0,e.head=void 0,e.tail=-1;let s=t;for(;;){const i=s;if(i===void 0)return;{const a=i,c=a.next,l=a.key,u=a.value,_=a.hash;rf(e,l,u,_),s=c;continue}}}function FC(e){const t=e.head,n=e.capacity<<1;e.entries=$t(n,void 0),e.capacity=n,e.capacity_mask=n-1|0;const o=e.capacity;e.grow_at=(Math.imul(o,13)|0)/16|0,e.size=0,e.head=void 0,e.tail=-1;let s=t;for(;;){const i=s;if(i===void 0)return;{const a=i,c=a.next,l=a.key,u=a.value,_=a.hash;af(e,l,u,_),s=c;continue}}}function UC(e){const t=e.head,n=e.capacity<<1;e.entries=$t(n,void 0),e.capacity=n,e.capacity_mask=n-1|0;const o=e.capacity;e.grow_at=(Math.imul(o,13)|0)/16|0,e.size=0,e.head=void 0,e.tail=-1;let s=t;for(;;){const i=s;if(i===void 0)return;{const a=i,c=a.next,l=a.key,u=a.value,_=a.hash;cf(e,l,u,_),s=c;continue}}}function $e(e,t,n){Ym(e,t,n,us(t))}function Bu(e,t,n){Zm(e,t,n,Wm(t))}function BC(e,t,n){Qm(e,t,n,Is(t))}function lf(e,t,n){ef(e,t,n,Is(t))}function uf(e,t,n){tf(e,t,n,Is(t))}function _f(e,t,n){nf(e,t,n,us(t))}function $f(e,t,n){sf(e,t,n,us(t))}function Na(e,t,n){of(e,t,n,Zo(t))}function eu(e,t,n){rf(e,t,n,Zo(t))}function df(e,t,n){af(e,t,n,us(t))}function pf(e,t,n){cf(e,t,n,Zo(t))}function Me(e){const t=e.length;let n=Pt(t);t>((Math.imul(n,13)|0)/16|0)&&(n=Math.imul(n,2)|0);const s=Xm(n),i=e.length;let r=0;for(;;){const a=r;if(a<i){const c=e[a];$e(s,c._0,c._1),r=a+1|0;continue}else break}return s}function zC(e){const t=e.length;let n=Pt(t);t>((Math.imul(n,13)|0)/16|0)&&(n=Math.imul(n,2)|0);const s=tC(n),i=e.length;let r=0;for(;;){const a=r;if(a<i){const c=e[a];lf(s,c._0,c._1),r=a+1|0;continue}else break}return s}function VC(e){const t=e.length;let n=Pt(t);t>((Math.imul(n,13)|0)/16|0)&&(n=Math.imul(n,2)|0);const s=nC(n),i=e.length;let r=0;for(;;){const a=r;if(a<i){const c=e[a];uf(s,c._0,c._1),r=a+1|0;continue}else break}return s}function mf(e){const t=e.length;let n=Pt(t);t>((Math.imul(n,13)|0)/16|0)&&(n=Math.imul(n,2)|0);const s=sC(n),i=e.length;let r=0;for(;;){const a=r;if(a<i){const c=e[a];Bu(s,c._0,c._1),r=a+1|0;continue}else break}return s}function qC(e){const t=e.length;let n=Pt(t);t>((Math.imul(n,13)|0)/16|0)&&(n=Math.imul(n,2)|0);const s=oC(n),i=e.length;let r=0;for(;;){const a=r;if(a<i){const c=e[a];_f(s,c._0,c._1),r=a+1|0;continue}else break}return s}function WC(e){const t=e.length;let n=Pt(t);t>((Math.imul(n,13)|0)/16|0)&&(n=Math.imul(n,2)|0);const s=iC(n),i=e.length;let r=0;for(;;){const a=r;if(a<i){const c=e[a];$f(s,c._0,c._1),r=a+1|0;continue}else break}return s}function ff(e){const t=e.length;let n=Pt(t);t>((Math.imul(n,13)|0)/16|0)&&(n=Math.imul(n,2)|0);const s=rC(n),i=e.length;let r=0;for(;;){const a=r;if(a<i){const c=e[a];Na(s,c._0,c._1),r=a+1|0;continue}else break}return s}function KC(e){const t=e.length;let n=Pt(t);t>((Math.imul(n,13)|0)/16|0)&&(n=Math.imul(n,2)|0);const s=aC(n),i=e.length;let r=0;for(;;){const a=r;if(a<i){const c=e[a];eu(s,c._0,c._1),r=a+1|0;continue}else break}return s}function JC(e){const t=e.length;let n=Pt(t);t>((Math.imul(n,13)|0)/16|0)&&(n=Math.imul(n,2)|0);const s=cC(n),i=e.length;let r=0;for(;;){const a=r;if(a<i){const c=e[a];df(s,c._0,c._1),r=a+1|0;continue}else break}return s}function XC(e){const t=e.length;let n=Pt(t);t>((Math.imul(n,13)|0)/16|0)&&(n=Math.imul(n,2)|0);const s=lC(n),i=e.length;let r=0;for(;;){const a=r;if(a<i){const c=e[a];pf(s,c._0,c._1),r=a+1|0;continue}else break}return s}function le(e,t){const n=us(t);let o=0,s=n&e.capacity_mask;for(;;){const i=o,r=s,a=e.entries;S(a,r);const c=a[r];if(c===void 0)return;{const u=c;if(u.hash===n&&u.key===t)return u.value;if(i>u.psl)return;o=i+1|0,s=r+1&e.capacity_mask;continue}}}function hf(e,t){const n=Wm(t);let o=0,s=n&e.capacity_mask;for(;;){const i=o,r=s,a=e.entries;S(a,r);const c=a[r];if(c===void 0)return;{const u=c;if(u.hash===n&&Of(u.key,t))return u.value;if(i>u.psl)return;o=i+1|0,s=r+1&e.capacity_mask;continue}}}function Nr(e,t){const n=Is(t);let o=0,s=n&e.capacity_mask;for(;;){const i=o,r=s,a=e.entries;S(a,r);const c=a[r];if(c===void 0)return;{const u=c;if(u.hash===n&&u.key===t)return u.value;if(i>u.psl)return;o=i+1|0,s=r+1&e.capacity_mask;continue}}}function YC(e,t){const n=us(t);let o=0,s=n&e.capacity_mask;for(;;){const i=o,r=s,a=e.entries;S(a,r);const c=a[r];if(c===void 0)return;{const u=c;if(u.hash===n&&u.key===t)return u.value;if(i>u.psl)return;o=i+1|0,s=r+1&e.capacity_mask;continue}}}function ZC(e,t){const n=us(t);let o=0,s=n&e.capacity_mask;for(;;){const i=o,r=s,a=e.entries;S(a,r);const c=a[r];if(c===void 0)return;{const u=c;if(u.hash===n&&u.key===t)return u.value;if(i>u.psl)return;o=i+1|0,s=r+1&e.capacity_mask;continue}}}function QC(e,t){const n=Is(t);let o=0,s=n&e.capacity_mask;for(;;){const i=o,r=s,a=e.entries;S(a,r);const c=a[r];if(c===void 0)return;{const u=c;if(u.hash===n&&u.key===t)return u.value;if(i>u.psl)return;o=i+1|0,s=r+1&e.capacity_mask;continue}}}function ex(e,t){const n=Is(t);let o=0,s=n&e.capacity_mask;for(;;){const i=o,r=s,a=e.entries;S(a,r);const c=a[r];if(c===void 0)return;{const u=c;if(u.hash===n&&u.key===t)return u.value;if(i>u.psl)return;o=i+1|0,s=r+1&e.capacity_mask;continue}}}function tx(e,t){const n=Zo(t);let o=0,s=n&e.capacity_mask;for(;;){const i=o,r=s,a=e.entries;S(a,r);const c=a[r];if(c===void 0)return;{const u=c;let _;if(u.hash===n){const $=u.key;_=$._0===t._0&&$._1===t._1}else _=!1;if(_)return u.value;if(i>u.psl)return;o=i+1|0,s=r+1&e.capacity_mask;continue}}}function gf(e,t){const n=Zo(t);let o=0,s=n&e.capacity_mask;for(;;){const i=o,r=s,a=e.entries;S(a,r);const c=a[r];if(c===void 0)return-1;{const u=c;let _;if(u.hash===n){const $=u.key;_=$._0===t._0&&$._1===t._1}else _=!1;if(_)return u.value;if(i>u.psl)return-1;o=i+1|0,s=r+1&e.capacity_mask;continue}}}function ja(e,t){const n=us(t);let o=0,s=n&e.capacity_mask;for(;;){const i=o,r=s,a=e.entries;S(a,r);const c=a[r];if(c===void 0)ee();else{const u=c;if(u.hash===n&&u.key===t)return u.value;if(i<=u.psl){o=i+1|0,s=r+1&e.capacity_mask;continue}else ee()}}}function R$(e,t){const n=us(t);let o=0,s=n&e.capacity_mask;for(;;){const i=o,r=s,a=e.entries;S(a,r);const c=a[r];if(c===void 0)ee();else{const u=c;if(u.hash===n&&u.key===t)return u.value;if(i<=u.psl){o=i+1|0,s=r+1&e.capacity_mask;continue}else ee()}}}function nx(e,t){const n=us(t);let o=0,s=n&e.capacity_mask;for(;;){const i=o,r=s,a=e.entries;S(a,r);const c=a[r];if(c===void 0)ee();else{const u=c;if(u.hash===n&&u.key===t)return u.value;if(i<=u.psl){o=i+1|0,s=r+1&e.capacity_mask;continue}else ee()}}}function sx(e,t){const n=us(t);let o=0,s=n&e.capacity_mask;for(;;){const i=o,r=s,a=e.entries;S(a,r);const c=a[r];if(c===void 0)ee();else{const u=c;if(u.hash===n&&u.key===t)return u.value;if(i<=u.psl){o=i+1|0,s=r+1&e.capacity_mask;continue}else ee()}}}function ox(e,t){const n=t.prev;if(n===-1)e.head=t.next;else{const s=e.entries;S(s,n);const i=s[n];let r;i===void 0?r=ee():r=i;const a=r;a.next=t.next}const o=t.next;if(o===void 0){e.tail=t.prev;return}else{const i=o;i.prev=t.prev;return}}function ix(e,t){const n=t.prev;if(n===-1)e.head=t.next;else{const s=e.entries;S(s,n);const i=s[n];let r;i===void 0?r=ee():r=i;const a=r;a.next=t.next}const o=t.next;if(o===void 0){e.tail=t.prev;return}else{const i=o;i.prev=t.prev;return}}function rx(e,t){const n=t.prev;if(n===-1)e.head=t.next;else{const s=e.entries;S(s,n);const i=s[n];let r;i===void 0?r=ee():r=i;const a=r;a.next=t.next}const o=t.next;if(o===void 0){e.tail=t.prev;return}else{const i=o;i.prev=t.prev;return}}function ax(e,t){let n=t;for(;;){const o=n,s=o+1&e.capacity_mask;e:{const r=e.entries;S(r,s);const a=r[s];if(a===void 0)break e;{const l=a;if(l.psl===0)break e;l.psl=l.psl-1|0,Yl(e,l,o),n=s;continue}}const i=e.entries;S(i,o),i[o]=void 0;return}}function cx(e,t){let n=t;for(;;){const o=n,s=o+1&e.capacity_mask;e:{const r=e.entries;S(r,s);const a=r[s];if(a===void 0)break e;{const l=a;if(l.psl===0)break e;l.psl=l.psl-1|0,Zl(e,l,o),n=s;continue}}const i=e.entries;S(i,o),i[o]=void 0;return}}function lx(e,t){let n=t;for(;;){const o=n,s=o+1&e.capacity_mask;e:{const r=e.entries;S(r,s);const a=r[s];if(a===void 0)break e;{const l=a;if(l.psl===0)break e;l.psl=l.psl-1|0,Ql(e,l,o),n=s;continue}}const i=e.entries;S(i,o),i[o]=void 0;return}}function ux(e,t,n){let o=0,s=n&e.capacity_mask;for(;;){const i=o,r=s,a=e.entries;S(a,r);const c=a[r];if(c===void 0)break;{const u=c;if(u.hash===n&&u.key===t){ox(e,u),ax(e,r),e.size=e.size-1|0;break}if(i>u.psl)break;o=i+1|0,s=r+1&e.capacity_mask;continue}}}function _x(e,t,n){let o=0,s=n&e.capacity_mask;for(;;){const i=o,r=s,a=e.entries;S(a,r);const c=a[r];if(c===void 0)break;{const u=c;if(u.hash===n&&u.key===t){ix(e,u),cx(e,r),e.size=e.size-1|0;break}if(i>u.psl)break;o=i+1|0,s=r+1&e.capacity_mask;continue}}}function $x(e,t,n){let o=0,s=n&e.capacity_mask;for(;;){const i=o,r=s,a=e.entries;S(a,r);const c=a[r];if(c===void 0)break;{const u=c;if(u.hash===n&&u.key===t){rx(e,u),lx(e,r),e.size=e.size-1|0;break}if(i>u.psl)break;o=i+1|0,s=r+1&e.capacity_mask;continue}}}function kc(e,t){ux(e,t,Is(t))}function Mc(e,t){_x(e,t,Is(t))}function bf(e,t){$x(e,t,Is(t))}function dx(e,t,n,o){const s=e.length;if(s>0)if(n<s){let i;i=s-n|0,e.fill(t,n,n+i);return}else{ee();return}else return}function yf(e){const t={val:e.head};return()=>{const o=t.val;if(o!==void 0){const i=o,r=i.key,a=i.value,c=i.next;return t.val=c,{_0:r,_1:a}}}}function px(e){const t={val:e.head};return()=>{const o=t.val;if(o!==void 0){const i=o,r=i.key,a=i.value,c=i.next;return t.val=c,{_0:r,_1:a}}}}function vf(e){return n=>{let o=e.head;for(;;){const s=o;if(s===void 0)return 1;{const r=s,a=r.value,c=r.next;if(n(a)===1){o=c;continue}else return 0}}}}function zu(e){return n=>{let o=e.head;for(;;){const s=o;if(s===void 0)return 1;{const r=s,a=r.value,c=r.next;if(n(a)===1){o=c;continue}else return 0}}}}function Vu(e){return n=>{let o=e.head;for(;;){const s=o;if(s===void 0)return 1;{const r=s,a=r.value,c=r.next;if(n(a)===1){o=c;continue}else return 0}}}}function mx(e){const t=qC([]);return e(n=>(_f(t,n._0,n._1),1)),t}function fx(e){const t=WC([]);return e(n=>($f(t,n._0,n._1),1)),t}function hx(e){const t=JC([]);return e(n=>(df(t,n._0,n._1),1)),t}function wf(e){return e()}function rn(e){return e()}function gx(e){return e()}function bx(e){return e()}function Ln(e){return e?Rp:Op}function Ge(e){const t=e+0,n=void 0;return new Ar(t,n)}function yx(e){return{hi:0,lo:e}}function qu(e){return yx(e)}function tu(e){return qu(e)}function Ha(e){return e2(e)}function Mr(e){return t2(e)}function In(e){const t=e,n=void 0;return new Ar(t,n)}function vx(e){const t=new Array(e.length),n=e.length;let o=0;for(;;){const s=o;if(s<n){const i=e[s];t[s]=Ic(i),o=s+1|0;continue}else break}return new En(t)}function wx(e){const t=new Array(e.length),n=e.length;let o=0;for(;;){const s=o;if(s<n){const i=e[s];t[s]=su(i),o=s+1|0;continue}else break}return new En(t)}function Sx(e){const t=new Array(e.length),n=e.length;let o=0;for(;;){const s=o;if(s<n){const i=e[s];t[s]=i,o=s+1|0;continue}else break}return new En(t)}function kx(e){const t=new Array(e.length),n=e.length;let o=0;for(;;){const s=o;if(s<n){const i=e[s];t[s]=qf(i),o=s+1|0;continue}else break}return new En(t)}function Mx(e){const t=new Array(e.length),n=e.length;let o=0;for(;;){const s=o;if(s<n){const i=e[s];t[s]=I6(i),o=s+1|0;continue}else break}return new En(t)}function Cx(e){const t=new Array(e.length),n=e.length;let o=0;for(;;){const s=o;if(s<n){const i=e[s];t[s]=T6(i),o=s+1|0;continue}else break}return new En(t)}function xx(e){if(e.length===0){const i=[];return new En(i)}const n=new Array(e.length),o=e.length;let s=0;for(;;){const i=s;if(i<o){const r=e[i];n[i]=Wf(r),s=i+1|0;continue}else break}return new En(n)}function O$(e,t){bn(e,t)}function Px(e,t){bn(e,t)}function Lx(e,t){bn(e,t)}function Mn(e,t){bn(e,t)}function Ix(e,t){bn(e,t)}function Tx(e,t){bn(e,t)}function vo(e,t){bn(e,t)}function Ex(e,t){bn(e,t)}function Ax(e,t){bn(e,t)}function Gx(e,t){bn(e,t)}function Rx(e,t){bn(e,t)}function Ox(e,t){bn(e,t)}function ll(e,t){bn(e,t)}function Dx(e,t){bn(e,t)}function Nx(e,t){bn(e,t)}function jx(){return e=>1}function D$(e){return t=>t(e)}function Hx(e,t){return n=>e(n)===1&&t(n)===1?1:0}function Fx(e){const t=[];return e(n=>(Px(t,n),1)),t}function Ux(e){const t=[];return e(n=>(Nx(t,n),1)),t}function N$(e){return Km(e)&255}function Fa(e){return jn(e)}function Bx(e){return e.lo===0?{hi:~e.hi+1|0,lo:0}:{hi:~e.hi,lo:~e.lo+1|0}}function Sf(e,t,n){const o=e.hi,s=e.lo,i=s+n|0,r=i>>31,a=s>>31,c=n>>31,l=(a&c|~r&(a^c))&1;return{hi:(o+t|0)+l|0,lo:i}}function kf(e,t){return Sf(e,t.hi,t.lo)}function Mf(e,t){return t.lo===0?{hi:e.hi-t.hi|0,lo:e.lo}:Sf(e,~t.hi,~t.lo+1|0)}function Cf(e,t){const n=e.hi,o=e.lo,s=t.hi,i=t.lo,r=n,a=o,c=s,l=i,u=r>>>16|0,_=r&65535,$=a>>>16|0,d=a&65535,p=c>>>16|0,b=c&65535,g=l>>>16|0,m=l&65535,v=Math.imul(d,m)|0,y=v>>>16|0,w=v&65535,k=(y>>>0)+((Math.imul($,m)|0)>>>0)|0,I=k>>>16|0,T=((k&65535)>>>0)+((Math.imul(d,g)|0)>>>0)|0,x=(I>>>0)+((T>>>16|0)>>>0)|0,D=T&65535,U=(x>>>0)+((Math.imul(_,m)|0)>>>0)|0,L=U>>>16|0,ge=((U&65535)>>>0)+((Math.imul($,g)|0)>>>0)|0,ce=(L>>>0)+((ge>>>16|0)>>>0)|0,q=((ge&65535)>>>0)+((Math.imul(d,b)|0)>>>0)|0,G=(ce>>>0)+((q>>>16|0)>>>0)|0,J=q&65535;return{hi:(((((((((G>>>0)+((Math.imul(u,m)|0)>>>0)|0)>>>0)+((Math.imul(_,g)|0)>>>0)|0)>>>0)+((Math.imul($,b)|0)>>>0)|0)>>>0)+((Math.imul(d,p)|0)>>>0)|0)&65535)<<16|J,lo:D<<16|w}}function zx(e,t){if(t.hi===0&&t.lo===0)return ee();{const n=Gu(),o=e.hi,s=e.lo,i=t.hi,r=t.lo,a=n.div_s,c=a(s,o,r,i),l=n.get_high;return{hi:l(),lo:c}}}function Vx(e,t){if(t.hi===0&&t.lo===0)return ee();{const n=Gu(),o=e.hi,s=e.lo,i=t.hi,r=t.lo,a=n.div_u,c=a(s,o,r,i),l=n.get_high;return{hi:l(),lo:c}}}function qx(e,t){if(t.hi===0&&t.lo===0)return ee();{const n=Gu(),o=e.hi,s=e.lo,i=t.hi,r=t.lo,a=n.rem_u,c=a(s,o,r,i),l=n.get_high;return{hi:l(),lo:c}}}function Wx(e){return{hi:~e.hi,lo:~e.lo}}function xf(e,t){return{hi:e.hi&t.hi,lo:e.lo&t.lo}}function Pf(e,t){return{hi:e.hi|t.hi,lo:e.lo|t.lo}}function Lf(e,t){const n=t&63;if(n===0)return e;if(n<32){const o=e.hi,s=e.lo,i=o,r=s,a=i<<n|(r>>>(32-n|0)|0),c=r<<n;return{hi:a,lo:c}}else return{hi:e.lo<<(n-32|0),lo:0}}function Kx(e,t){const n=t&63;return n===0?e:n<32?{hi:e.hi>>>n|0,lo:e.lo>>>n|e.hi<<(32-n|0)}:{hi:0,lo:e.hi>>>(n-32|0)|0}}function Jx(e,t){const n=t&63;return n===0?e:n<32?{hi:e.hi>>n,lo:e.lo>>>n|e.hi<<(32-n|0)}:{hi:e.hi>>31,lo:e.hi>>(n-32|0)}}function If(e){return Bx(e)}function Ss(e,t){return kf(e,t)}function Cr(e,t){return Mf(e,t)}function Ko(e,t){return Cf(e,t)}function no(e,t){return zx(e,t)}function Tf(e,t){return xf(e,t)}function j$(e,t){return Pf(e,t)}function Xx(e,t){return Jx(e,t)}function No(e,t){return Lf(e,t)}function H$(e,t){const n=e,o=t;return n.hi===o.hi&&n.lo===o.lo}function Cc(e,t){return n2(e,t)}function Yx(e){return o2(e)}function Zx(e){return Yx(e)}function ro(e,t){return kf(e,t)}function nu(e,t){return Mf(e,t)}function Vn(e,t){return Cf(e,t)}function Qx(e,t){return Vx(e,t)}function eP(e,t){return qx(e,t)}function F$(e){return e.lo}function xc(e,t){return s2(e,t)}function ao(e,t){const n=e,o=t;return n.hi===o.hi&&n.lo===o.lo}function Fo(e,t){return xf(e,t)}function tP(e,t){return Pf(e,t)}function nP(e){return Wx(e)}function xr(e,t){return Lf(e,t)}function ss(e,t){return Kx(e,t)}function U$(e){const t=e;return t.hi!==0?Math.clz32(t.hi):32+Math.clz32(t.lo)|0}function sP(e,t){const n=(e.acc>>>0)+((Math.imul(t,-1028477379)|0)>>>0)|0,o=17;e.acc=Math.imul(n<<o|(n>>>(32-o|0)|0),668265263)|0}function Ef(e,t){e.acc=(e.acc>>>0)+4|0,sP(e,t)}function li(e,t){Ef(e,t)}function oP(e,t){const n=t.length;let o=0;for(;;){const s=o;if(s<n){Ef(e,t.charCodeAt(s)),o=s+1|0;continue}else return}}function iP(e,t){oP(t,e)}function rP(e,t){li(t,e)}function Ua(e,t,n,o,s){if(s>=0&&o>=0&&(s+n|0)<=t.length&&(o+n|0)<=e.length){y6(t,s,e,o,n);return}else{Js(`bounds check failed: dst_offset = ${xn(s)}, src_offset = ${xn(o)}, len = ${xn(n)}, dst.length = ${xn(t.length)}, self.length = ${xn(e.length)}`);return}}function aP(e,t,n,o,s){if((s+n|0)<=t.length&&(o+n|0)<=e.length){v6(t,s,e,o,n);return}else{Js(`bounds check failed: dst_offset = ${xn(s)}, src_offset = ${xn(o)}, len = ${xn(n)}, dst.length = ${xn(t.length)}, self.length = ${xn(e.length)}`);return}}function ui(e){return e!==e?0:e>=2147483647?2147483647:e<=-2147483648?-2147483648:e|0}function Af(e){console.log(e)}function cP(e){return i2(e)}function B$(e){if(e.length!==0)return cP(e)}function lP(e,t){if(t>=0&&t<e.length){S(e,t);const n=e[t];return r2(e,t,1),n}else return DM(`index out of bounds: the len is from 0 to ${xn(e.length)} but the index is ${xn(t)}`)}function uP(e,t){const n=e.length;return t<n?e[t]:void 0}function Gf(){return{now:0}}function Qo(e){return e.now=e.now+1|0,e.now}function Rf(e){const t=Me([]);return $e(t,"cost",Cx(e.cost)),new ke(t)}function _P(e,t){switch(e){case 0:{t.method_0(t.self,"HeartCrystalDust");return}case 1:{t.method_0(t.self,"RecallGear");return}case 2:{t.method_0(t.self,"SpiritalSpark");return}case 3:{t.method_0(t.self,"RefinedCopper");return}default:{t.method_0(t.self,"ResonantCrystal");return}}}function Of(e,t){switch(e){case 0:return t===0;case 1:return t===1;case 2:return t===2;case 3:return t===3;default:return t===4}}function $P(e,t){switch(e){case 0:{li(t,0);return}case 1:{li(t,1);return}case 2:{li(t,2);return}case 3:{li(t,3);return}default:{li(t,4);return}}}function Pc(e){switch(e){case 0:{const t="HeartCrystalDust";return new Ee(t)}case 1:{const t="RecallGear";return new Ee(t)}case 2:{const t="SpiritalSpark";return new Ee(t)}case 3:{const t="RefinedCopper";return new Ee(t)}default:{const t="ResonantCrystal";return new Ee(t)}}}function Mt(e){return{cost:e}}function Lc(e){const t=Me([]);return $e(t,"health",In(e.health)),$e(t,"speed",Ge(e.speed)),$e(t,"attack",In(e.attack)),$e(t,"defense",In(e.defense)),$e(t,"dodge",In(e.dodge)),new ke(t)}function Df(e,t){let n,o=Xr,s=Xr,i=Xr,r=Xr;if(e.$tag===6){const v=e._0,y=le(v,"health");if(y!==void 0){const x=y,D="health",U=sa(x,new tt(t,D));let L;if(U.$tag===1)L=U._0;else return U;o=new zi(L)}const w=le(v,"speed");if(w!==void 0){const x=w,D="speed",U=io(x,new tt(t,D));let L;if(U.$tag===1)L=U._0;else return U;n=L}const k=le(v,"attack");if(k!==void 0){const x=k,D="attack",U=sa(x,new tt(t,D));let L;if(U.$tag===1)L=U._0;else return U;r=new zi(L)}const I=le(v,"defense");if(I!==void 0){const x=I,D="defense",U=sa(x,new tt(t,D));let L;if(U.$tag===1)L=U._0;else return U;i=new zi(L)}const P=le(v,"dodge");if(P!==void 0){const x=P,D="dodge",U=sa(x,new tt(t,D));let L;if(U.$tag===1)L=U._0;else return U;s=new zi(L)}}else return new Ao(new De({_0:t,_1:"Expected object to deserialize Attribute"}));const a=n;let c;if(a===void 0)return new Ao(new De({_0:t,_1:"Missing field speed"}));c=a;const l=o;let u;if(l.$tag===1)u=l._0;else return new Ao(new De({_0:t,_1:"Missing field health"}));const _=s;let $;if(_.$tag===1)$=_._0;else return new Ao(new De({_0:t,_1:"Missing field dodge"}));const d=i;let p;if(d.$tag===1)p=d._0;else return new Ao(new De({_0:t,_1:"Missing field defense"}));const b=r;let g;if(b.$tag===1)g=b._0;else return new Ao(new De({_0:t,_1:"Missing field attack"}));return new lm({health:u,speed:c,attack:g,defense:p,dodge:$})}function Wt(e,t,n,o,s){return{health:e,speed:t,attack:n,defense:o,dodge:s}}function su(e){const t=Me([]);return $e(t,"equipment_base",dP(e.equipment_base)),$e(t,"id",Ge(e.id)),new ke(t)}function ou(e,t){let n,o;if(e.$tag===6){const l=e._0,u=le(l,"equipment_base");if(u!==void 0){const d=u,p="equipment_base",b=pP(d,new tt(t,p));let g;if(b.$tag===1)g=b._0;else return b;o=g}const _=le(l,"id");if(_!==void 0){const d=_,p="id",b=io(d,new tt(t,p));let g;if(b.$tag===1)g=b._0;else return b;n=g}}else return new da(new De({_0:t,_1:"Expected object to deserialize Equipment"}));const s=n;let i;if(s===void 0)return new da(new De({_0:t,_1:"Missing field id"}));i=s;const r=o;let a;return r===void 0?new da(new De({_0:t,_1:"Missing field equipment_base"})):(a=r,new um({equipment_base:a,id:i}))}function dP(e){const t=Me([]),n=e.name;$e(t,"name",new Ee(n));const o=e.description;$e(t,"description",new Ee(o));const s=e.resource_url;return $e(t,"resource_url",new Ee(s)),$e(t,"attribute",Lc(e.attribute)),new ke(t)}function pP(e,t){let n,o,s,i;if(e.$tag===6){const b=e._0,g=le(b,"name");if(g!==void 0){const k=g,I="name",P=ws(k,new tt(t,I));let T;if(P.$tag===1)T=P._0;else return P;o=T}const m=le(b,"description");if(m!==void 0){const k=m,I="description",P=ws(k,new tt(t,I));let T;if(P.$tag===1)T=P._0;else return P;s=T}const v=le(b,"resource_url");if(v!==void 0){const k=v,I="resource_url",P=ws(k,new tt(t,I));let T;if(P.$tag===1)T=P._0;else return P;n=T}const y=le(b,"attribute");if(y!==void 0){const k=y,I="attribute",P=Df(k,new tt(t,I));let T;if(P.$tag===1)T=P._0;else return P;i=T}}else return new ai(new De({_0:t,_1:"Expected object to deserialize EquipmentBase"}));const r=n;let a;if(r===void 0)return new ai(new De({_0:t,_1:"Missing field resource_url"}));a=r;const c=o;let l;if(c===void 0)return new ai(new De({_0:t,_1:"Missing field name"}));l=c;const u=s;let _;if(u===void 0)return new ai(new De({_0:t,_1:"Missing field description"}));_=u;const $=i;let d;return $===void 0?new ai(new De({_0:t,_1:"Missing field attribute"})):(d=$,new _m({name:l,description:_,resource_url:a,attribute:d}))}function mP(e){const t=Me([]);$e(t,"id",Ge(e.id));const n=e.type_msg;$e(t,"type_msg",new Ee(n));const o=e.content;return $e(t,"content",new Ee(o)),new ke(t)}function fP(){return{history:[],callback:e=>{}}}function hP(e,t){e.callback=t}function nt(e,t){const n={id:Qo(TM),type_msg:t.type_msg,content:t.content};Lx(e.history,n);const o=e.callback;o(Xe(mP(n)))}function Ic(e){const t=Me([]);return $e(t,"id",Ge(e.id)),$e(t,"level",Ge(e.level)),$e(t,"suffix",Ge(e.suffix)),$e(t,"live_left",Ge(e.live_left)),$e(t,"attribute",Lc(e.attribute)),$e(t,"copper_type",Nf(e.copper_type)),$e(t,"equipment_slot",bP(e.equipment_slot)),$e(t,"copper_info",vP(e.copper_info)),new ke(t)}function gP(e,t){let n,o,s,i,r,a,c,l;if(e.$tag===6){const U=e._0,L=le(U,"id");if(L!==void 0){const O=L,X="id",W=io(O,new tt(t,X));let ve;if(W.$tag===1)ve=W._0;else return W;i=ve}const K=le(U,"level");if(K!==void 0){const O=K,X="level",W=io(O,new tt(t,X));let ve;if(W.$tag===1)ve=W._0;else return W;s=ve}const ge=le(U,"suffix");if(ge!==void 0){const O=ge,X="suffix",W=io(O,new tt(t,X));let ve;if(W.$tag===1)ve=W._0;else return W;n=ve}const ce=le(U,"live_left");if(ce!==void 0){const O=ce,X="live_left",W=io(O,new tt(t,X));let ve;if(W.$tag===1)ve=W._0;else return W;o=ve}const he=le(U,"attribute");if(he!==void 0){const O=he,X="attribute",W=Df(O,new tt(t,X));let ve;if(W.$tag===1)ve=W._0;else return W;l=ve}const q=le(U,"copper_type");if(q!==void 0){const O=q,X="copper_type",W=jf(O,new tt(t,X));let ve;if(W.$tag===1)ve=W._0;else return W;a=ve}const G=le(U,"equipment_slot");if(G!==void 0){const O=G,X="equipment_slot",W=yP(O,new tt(t,X));let ve;if(W.$tag===1)ve=W._0;else return W;r=ve}const J=le(U,"copper_info");if(J!==void 0){const O=J,X="copper_info",W=wP(O,new tt(t,X));let ve;if(W.$tag===1)ve=W._0;else return W;c=ve}}else return new ps(new De({_0:t,_1:"Expected object to deserialize Copper"}));const u=n;let _;if(u===void 0)return new ps(new De({_0:t,_1:"Missing field suffix"}));_=u;const $=o;let d;if($===void 0)return new ps(new De({_0:t,_1:"Missing field live_left"}));d=$;const p=s;let b;if(p===void 0)return new ps(new De({_0:t,_1:"Missing field level"}));b=p;const g=i;let m;if(g===void 0)return new ps(new De({_0:t,_1:"Missing field id"}));m=g;const v=r;let y;if(v===void 0)return new ps(new De({_0:t,_1:"Missing field equipment_slot"}));y=v;const w=a;let k;if(w===void 0)return new ps(new De({_0:t,_1:"Missing field copper_type"}));k=w;const I=c;let P;if(I===void 0)return new ps(new De({_0:t,_1:"Missing field copper_info"}));P=I;const T=l;let x;return T===void 0?new ps(new De({_0:t,_1:"Missing field attribute"})):(x=T,new $m({id:m,level:b,suffix:_,live_left:d,attribute:x,copper_type:k,equipment_slot:y,copper_info:P}))}function Nf(e){switch(e){case 0:{const t="IronWall";return new Ee(t)}case 1:{const t="Arcanist";return new Ee(t)}case 2:{const t="CraftsMan";return new Ee(t)}case 3:{const t="Mechanic";return new Ee(t)}default:{const t="Resonator";return new Ee(t)}}}function jf(e,t){let n;switch(e.$tag){case 4:{n=e._0;break}case 5:{const s=e._0,i=uP(s,0);if(i===void 0)return new Vi(new De({_0:t,_1:"Missing tag in array[0] when derserializing CopperType"}));{const a=i;if(a.$tag===4)n=a._0;else return new Vi(new De({_0:t,_1:"Expected string tag at array[0] when derserializing CopperType"}))}break}default:return new Vi(new De({_0:t,_1:"Expected string or array for tag in enum when derserializing CopperType"}))}switch(n){case"IronWall":return new ci(0);case"Arcanist":return new ci(1);case"CraftsMan":return new ci(2);case"Mechanic":return new ci(3);case"Resonator":return new ci(4);default:return new Vi(new De({_0:t,_1:`Unknown enum constructor ${n} when deserializing CopperType`}))}}function bP(e){const t=Me([]),n=e.slot1;n===void 0||$e(t,"slot1",su(n));const o=e.slot2;return o===void 0||$e(t,"slot2",su(o)),$e(t,"is_slot2_locked",Ln(e.is_slot2_locked)),new ke(t)}function yP(e,t){let n=r$,o=r$,s=-1;if(e.$tag===6){const $=e._0,d=le($,"slot1");if(d!==void 0){const m=d,v="slot1",y=ou(m,new tt(t,v));let w;if(y.$tag===1)w=y._0;else return y;o=new Ul(w)}const p=le($,"slot2");if(p!==void 0){const m=p,v="slot2",y=ou(m,new tt(t,v));let w;if(y.$tag===1)w=y._0;else return y;n=new Ul(w)}const b=le($,"is_slot2_locked");if(b!==void 0){const m=b,v="is_slot2_locked",y=V3(m,new tt(t,v));let w;if(y.$tag===1)w=y._0;else return y;s=w}}else return new Bl(new De({_0:t,_1:"Expected object to deserialize EquipmentSlot"}));const i=n;let r;i.$tag===1?r=i._0:r=void 0;const a=o;let c;a.$tag===1?c=a._0:c=void 0;const l=s;let u;return l===-1?new Bl(new De({_0:t,_1:"Missing field is_slot2_locked"})):(u=l,new dm({slot1:c,slot2:r,is_slot2_locked:u}))}function vP(e){const t=Me([]),n=e.name;$e(t,"name",new Ee(n)),$e(t,"copper_type",Nf(e.copper_type));const o=e.description;$e(t,"description",new Ee(o));const s=e.icon_url;$e(t,"icon_url",new Ee(s));const i=e.model_url;$e(t,"model_url",new Ee(i));const r=e.skill;r===void 0||$e(t,"skill",SP(r));const a=e.attack_range;return a===void 0||$e(t,"attack_range",Ge(a)),new ke(t)}function wP(e,t){let n=a2,o,s,i,r,a,c=mm;if(e.$tag===6){const T=e._0,x=le(T,"name");if(x!==void 0){const q=x,G="name",J=ws(q,new tt(t,G));let F;if(J.$tag===1)F=J._0;else return J;o=F}const D=le(T,"copper_type");if(D!==void 0){const q=D,G="copper_type",J=jf(q,new tt(t,G));let F;if(J.$tag===1)F=J._0;else return J;a=F}const U=le(T,"description");if(U!==void 0){const q=U,G="description",J=ws(q,new tt(t,G));let F;if(J.$tag===1)F=J._0;else return J;r=F}const L=le(T,"icon_url");if(L!==void 0){const q=L,G="icon_url",J=ws(q,new tt(t,G));let F;if(J.$tag===1)F=J._0;else return J;i=F}const K=le(T,"model_url");if(K!==void 0){const q=K,G="model_url",J=ws(q,new tt(t,G));let F;if(J.$tag===1)F=J._0;else return J;s=F}const ge=le(T,"skill");if(ge!==void 0){const q=ge,G="skill",J=kP(q,new tt(t,G));let F;if(J.$tag===1)F=J._0;else return J;n=new pm(F)}const ce=le(T,"attack_range");if(ce!==void 0){const q=ce,G="attack_range",J=io(q,new tt(t,G));let F;if(J.$tag===1)F=J._0;else return J;c=new Ru(F)}}else return new Go(new De({_0:t,_1:"Expected object to deserialize CopperInfo"}));const l=n;let u;l.$tag===1?u=l._0:u=void 0;const _=o;let $;if(_===void 0)return new Go(new De({_0:t,_1:"Missing field name"}));$=_;const d=s;let p;if(d===void 0)return new Go(new De({_0:t,_1:"Missing field model_url"}));p=d;const b=i;let g;if(b===void 0)return new Go(new De({_0:t,_1:"Missing field icon_url"}));g=b;const m=r;let v;if(m===void 0)return new Go(new De({_0:t,_1:"Missing field description"}));v=m;const y=a;let w;if(y===void 0)return new Go(new De({_0:t,_1:"Missing field copper_type"}));w=y;const k=c;let I;return k.$tag===1?I=k._0:I=void 0,new fm({name:$,copper_type:w,description:v,icon_url:g,model_url:p,skill:u,attack_range:I})}function SP(e){const t=Me([]),n=e.name;$e(t,"name",new Ee(n));const o=e.description;$e(t,"description",new Ee(o));const s=e.resource_url;$e(t,"resource_url",new Ee(s));const i=e.cool_down;return i===void 0||$e(t,"cool_down",Ge(i)),new ke(t)}function kP(e,t){let n,o,s,i=mm;if(e.$tag===6){const b=e._0,g=le(b,"name");if(g!==void 0){const k=g,I="name",P=ws(k,new tt(t,I));let T;if(P.$tag===1)T=P._0;else return P;o=T}const m=le(b,"description");if(m!==void 0){const k=m,I="description",P=ws(k,new tt(t,I));let T;if(P.$tag===1)T=P._0;else return P;s=T}const v=le(b,"resource_url");if(v!==void 0){const k=v,I="resource_url",P=ws(k,new tt(t,I));let T;if(P.$tag===1)T=P._0;else return P;n=T}const y=le(b,"cool_down");if(y!==void 0){const k=y,I="cool_down",P=io(k,new tt(t,I));let T;if(P.$tag===1)T=P._0;else return P;i=new Ru(T)}}else return new qi(new De({_0:t,_1:"Expected object to deserialize Skill"}));const r=n;let a;if(r===void 0)return new qi(new De({_0:t,_1:"Missing field resource_url"}));a=r;const c=o;let l;if(c===void 0)return new qi(new De({_0:t,_1:"Missing field name"}));l=c;const u=s;let _;if(u===void 0)return new qi(new De({_0:t,_1:"Missing field description"}));_=u;const $=i;let d;return $.$tag===1?d=$._0:d=void 0,new hm({name:l,description:_,resource_url:a,cool_down:d})}function Nt(e,t,n){return q3(Math.fround(e*Math.fround(S3(n,(t-1|0)+0))))}function Wu(e){switch(e){case 0:return Wt(Math.fround(150),2,Math.fround(15),Math.fround(20),Math.fround(10));case 1:return Wt(Math.fround(50),3,Math.fround(20),Math.fround(5),Math.fround(10));case 4:return Wt(Math.fround(100),3,Math.fround(10),Math.fround(10),Math.fround(10));case 3:return Wt(Math.fround(80),3,Math.fround(5),Math.fround(8),Math.fround(10));default:return Wt(Math.fround(80),4,Math.fround(0),Math.fround(8),Math.fround(10))}}function z$(e){const t=e.level+1|0,n=Wu(e.copper_type),o=e.attribute.speed;switch(e.copper_type){case 0:return Wt(Nt(n.health,t,Math.fround(1.35)),o,Nt(n.attack,t,Math.fround(1.28)),Nt(n.defense,t,Math.fround(1.37)),Nt(n.dodge,t,Math.fround(1.19)));case 1:return Wt(Nt(n.health,t,Math.fround(1.22)),o,Nt(n.attack,t,Math.fround(1.4)),Nt(n.defense,t,Math.fround(1.27)),Nt(n.dodge,t,Math.fround(1.19)));case 4:return Wt(Nt(n.health,t,Math.fround(1.38)),o,Nt(n.attack,t,Math.fround(1.16)),Nt(n.defense,t,Math.fround(1.27)),Nt(n.dodge,t,Math.fround(1.19)));case 3:return Wt(Nt(n.health,t,Math.fround(1.3)),o,Nt(n.attack,t,Math.fround(1.2)),Nt(n.defense,t,Math.fround(1.27)),Nt(n.dodge,t,Math.fround(1.19)));default:return Wt(Nt(n.health,t,Math.fround(1.3)),o,Nt(n.attack,t,Math.fround(1.27)),Nt(n.defense,t,Math.fround(1.16)),Nt(n.dodge,t,Math.fround(1.19)))}}function MP(e){return{slot1:e.slot1,slot2:e.slot2,is_slot2_locked:!1}}function CP(e){return e.level===4?{...e,attribute:z$(e),level:e.level+1|0,equipment_slot:MP(e.equipment_slot)}:{...e,attribute:z$(e),level:e.level+1|0}}function xP(e){let t;switch(e){case 1:{t=5;break}case 2:{t=10;break}case 3:{t=20;break}case 4:{t=30;break}default:nt(Qe,ew),t=0}return Mt([{_0:2,_1:t}])}function Hf(){return{slot1:void 0,slot2:void 0,is_slot2_locked:!0}}function ul(e){const t=sx(IM,e),n=Qo(Pi);return{id:n,level:1,suffix:n,live_left:5,attribute:Wu(t.copper_type),copper_type:t.copper_type,equipment_slot:Hf(),copper_info:t}}function co(e,t){return e+d6(vm,(t-e|0)+1|0)|0}function Pr(e){const t=p6(vm);return Af(`12121:${String(t)}`),t<=e}function PP(){return mf([tw,nw,sw,ow,iw])}function LP(){return mf([rw,aw,cw,lw,uw])}function Rn(e,t){const n=hf(e,t);return n===void 0?ee():n}function Ff(e,t,n){const o=hf(e,t);let s;if(o===void 0?s=ee():s=o,s<n){nt(Qe,_w);return}else{Bu(e,t,s-n|0);return}}function Tc(e,t){const n=t.cost,o=n.length;let s=0;for(;;){const i=s;if(i<o){const r=n[i],a=r._0,c=r._1;if(Rn(e,a)<c)return!1;s=i+1|0;continue}else break}return!0}function Ec(e,t){const n=t.cost,o=n.length;let s=0;for(;;){const i=s;if(i<o){const r=n[i],a=r._0,c=r._1;Ff(e,a,c),s=i+1|0;continue}else return}}function so(e,t,n){Bu(e,t,Rn(e,t)+n|0)}function IP(){return{resources:PP(),equipments:[]}}function TP(e,t){return{resources:e,equipments:t}}function Ku(e,t){const n=t.length;let o=0;for(;;){const s=o;if(s<n){const i=t[s],r=i.item_type;if(r.$tag===0){const c=r._0;so(e.resources,c,i.count)}else{const c=r._0;Ix(e.equipments,c)}o=s+1|0;continue}else return}}function EP(e,t){return{item_type:e,count:t}}function AP(){const e=ul(""),t=ul(""),n=ul("");return{coppers:ma(ma(ma(void 0,e.id,e),t.id,t),n.id,n)}}function GP(){return{coppers:void 0}}function Ju(e,t){return{coppers:ma(e.coppers,t.id,t)}}function ha(e,t){const n=b3(e.coppers,t);return n===void 0?ee():n}function Uf(e){return Fx(w3(e.coppers))}function RP(e,t){return{coppers:y3(e.coppers,t)}}function OP(){const e=Qo(Pi),t=co(0,or.length-1|0);S(or,t);const n=or[t],o=Wu(n.copper_type);return{id:e,level:1,suffix:e,live_left:5,attribute:o,copper_type:n.copper_type,equipment_slot:Hf(),copper_info:n}}function DP(e){if(Rn(e,2)>=10)return Ff(e,2,10),OP();nt(Qe,$w)}function NP(){const e=IP();return{warehouse:AP(),bag:e}}function jP(e,t){return{warehouse:e,bag:t}}function HP(e){const t=e.bag.resources,n=Me([{_0:"SpiritalSpark",_1:Ge(Rn(t,2))},{_0:"RecallGear",_1:Ge(Rn(t,1))},{_0:"ResonantCrystal",_1:Ge(Rn(t,4))},{_0:"RefinedCopper",_1:Ge(Rn(t,3))},{_0:"HeartCrystalDust",_1:Ge(Rn(t,0))}]);return Xe(new ke(n))}function FP(e){const t=e.warehouse,n=Me([{_0:"coppers",_1:vx(Uf(t))}]);return Xe(new ke(n))}function UP(e){const t=DP(e.bag.resources);let n;if(t===void 0){const o="error",s={_0:"type",_1:new Ee(o)},i="",r=Me([s,{_0:"content",_1:new Ee(i)}]);n=new ke(r)}else{const s=t;e.warehouse=Ju(e.warehouse,s);const i="success",r=Me([{_0:"type",_1:new Ee(i)},{_0:"copper",_1:Ic(s)}]);n=new ke(r)}return Xe(n)}function BP(e,t){const n=e.warehouse,o=ha(n,t),s=xP(o.level);let i;if(Tc(e.bag.resources,s)){const r=CP(o);Ec(e.bag.resources,s),e.warehouse=RP(e.warehouse,t),e.warehouse=Ju(e.warehouse,r);const a="success",c=Me([{_0:"type",_1:new Ee(a)}]);i=new ke(c)}else{const r="error",a={_0:"type",_1:new Ee(r)},c="",l=Me([a,{_0:"content",_1:new Ee(c)}]);i=new ke(l)}return Xe(i)}function zP(e){const t=Mt([dw,pw,mw,fw]);let n;if(Tc(e.bag.resources,t)){Ec(e.bag.resources,t),so(e.bag.resources,2,1);const o="success",s=Me([{_0:"type",_1:new Ee(o)}]);n=new ke(s)}else{const o="error",s={_0:"type",_1:new Ee(o)},i="",r=Me([s,{_0:"content",_1:new Ee(i)}]);n=new ke(r)}return Xe(n)}function Bf(e){const t=Me([]);return $e(t,"id",Ge(e.id)),$e(t,"original_id",Ge(e.original_id)),$e(t,"copper",Ic(e.copper)),$e(t,"can_move",Ln(e.can_move)),$e(t,"can_attack",Ln(e.can_attack)),$e(t,"can_summon",Ln(e.can_summon)),$e(t,"can_build",Ln(e.can_build)),$e(t,"position",yn(e.position)),$e(t,"now_health",In(e.now_health)),$e(t,"attribute",Lc(e.attribute)),new ke(t)}function zf(e){const t=Me([]);return $e(t,"id",Ge(e.id)),$e(t,"owned",Ln(e.owned)),$e(t,"can_move",Ln(e.can_move)),$e(t,"can_attack",Ln(e.can_attack)),$e(t,"position",yn(e.position)),$e(t,"now_health",In(e.now_health)),$e(t,"enemy_base",qf(e.enemy_base)),new ke(t)}function VP(e){const t=Me([]),n=e.name;$e(t,"name",new Ee(n)),$e(t,"resource_type",Pc(e.resource_type));const o=e.model_url;return $e(t,"model_url",new Ee(o)),new ke(t)}function Vf(e){const t=Me([]);$e(t,"id",Ge(e.id)),$e(t,"owned",Ln(e.owned)),$e(t,"position",yn(e.position)),$e(t,"can_attack",Ln(e.can_attack));const n=e.resource_type;return n===void 0||$e(t,"resource_type",Pc(n)),$e(t,"now_health",In(e.now_health)),$e(t,"structure_base",Wf(e.structure_base)),new ke(t)}function qf(e){const t=Me([]);$e(t,"level",Ge(e.level)),$e(t,"health",In(e.health)),$e(t,"attack",In(e.attack)),$e(t,"defense",In(e.defense)),$e(t,"dodge",In(e.dodge)),$e(t,"attack_range",Ge(e.attack_range)),$e(t,"speed",Ge(e.speed));const n=e.name;$e(t,"name",new Ee(n));const o=e.enemy_type;$e(t,"enemy_type",new Ee(o));const s=e.description;$e(t,"description",new Ee(s));const i=e.asset_url;$e(t,"asset_url",new Ee(i));const r=e.model_url;return $e(t,"model_url",new Ee(r)),$e(t,"drop_items",Mx(e.drop_items)),$e(t,"summon_cost",Rf(e.summon_cost)),new ke(t)}function qP(e){const t=Me([]);return $e(t,"id",Ge(e.id)),$e(t,"material_base",VP(e.material_base)),new ke(t)}function Wf(e){const t=Me([]),n=e.name;$e(t,"name",new Ee(n)),$e(t,"health",In(e.health)),$e(t,"can_move",Ln(e.can_move)),$e(t,"can_attack",Ln(e.can_attack)),$e(t,"attack_range",Ge(e.attack_range));const o=e.description;$e(t,"description",new Ee(o));const s=e.asset_url;$e(t,"asset_url",new Ee(s));const i=e.model_url;return $e(t,"model_url",new Ee(i)),$e(t,"attribute",Lc(e.attribute)),$e(t,"cost",Rf(e.cost)),new ke(t)}function WP(e,t){switch(e){case 0:{t.method_0(t.self,"PositiveX");return}case 1:{t.method_0(t.self,"NegativeX");return}case 2:{t.method_0(t.self,"PositiveY");return}default:{t.method_0(t.self,"NegativeY");return}}}function Kf(e,t,n,o){const s=Qo(Pi),i=e.can_attack,r=e.health,a={id:s,owned:t,position:o,can_attack:i,resource_type:n,now_health:r,structure_base:e};return uf(Ks,a.id,a),a}function Xu(e){const t=ex(Ks,e);return t===void 0?ee():t}function Yu(e){const t=Me([{_0:"id",_1:Ge(e)}]);nt(Qe,{type_msg:"clear_state",content:Xe(new ke(t))})}function Zu(e,t){const n={_0:"id",_1:Ge(e)},o=Sc(t),s=Me([n,{_0:"can_attack",_1:new Ee(o)}]);nt(Qe,{type_msg:"display_can_attack",content:Xe(new ke(s))})}function rr(e){if(Yu(e.id),e.structure_base.can_attack){Zu(e.id,!0);return}else return}function Ii(e){const t=[];let o=-e|0;for(;;){const s=o;if(s<=e){let r=-e|0;for(;;){const a=r;if(a<=e){const c=(s<0?-s|0:s)+(a<0?-a|0:a)|0;c<=e&&c!==0&&vo(t,{_0:s,_1:a}),r=a+1|0;continue}else break}o=s+1|0;continue}else break}return t}function Jf(e,t){const n=t._0,o=t._1,s=e.index_position,i=s._0,r=s._1;return n>=i&&n<(i+9|0)&&o>=r&&o<(r+9|0)}function ei(e,t){const n=e.rooms,o=n.length;let s=0;for(;;){const i=s;if(i<o){const r=n[i];if(Jf(r,t))return r;s=i+1|0;continue}else break}}function Us(e,t){const n=e.rooms,o=n.length;let s=0;for(;;){const i=s;if(i<o){const r=n[i];if(Jf(r,t)){const a=t._0-r.index_position._0|0,c=t._1-r.index_position._1|0;return{_0:r,_1:{_0:a,_1:c}}}s=i+1|0;continue}else break}}function Qu(e,t){const n=ei(e,t);if(n===void 0)return ee();{const s=n,i=Us(e,t);if(i===void 0)return ee();{const c=i._1;return{_0:s,_1:c}}}}function wo(e,t){const n=Qu(e,t),o=n._0,s=n._1;return yt(vt(o.blocks,s._0),s._1).occupant}function Uo(e,t){const n=ei(e,t);if(n!==void 0){const s=n,i=Us(e,t);if(i===void 0)ee();else{const c=i._1,l=yt(vt(s.blocks,c._0),c._1).occupant;let u;return l.$tag===4?u=!0:u=!1,!u}}return!1}function KP(e,t){const n=e.structure_base.attack_range,o=Ii(n),s=[],i=o.length;let r=0;for(;;){const a=r;if(a<i){const c=o[a],l={_0:e.position._0+c._0|0,_1:e.position._1+c._1|0};if(Uo(t,l)){const u=wo(t,l);if(e.owned)switch(u.$tag){case 1:{const $=u._0;e.structure_base.name===""&&Mn(s,new Ci($));break}case 0:{const $=u._0;$.owned===!1&&Mn(s,new qo($));break}case 3:{const $=u._0;$.owned===!1&&Mn(s,new Wo($));break}}else switch(u.$tag){case 1:{const $=u._0;Mn(s,new Ci($));break}case 0:{const $=u._0;$.owned===!0&&Mn(s,new qo($));break}case 3:{const $=u._0;$.owned===!0&&Mn(s,new Wo($));break}}}r=a+1|0;continue}else break}return s}function Ac(e,t){return e.now_health=Math.fround(e.now_health-t),Math.fround(e.now_health<=Math.fround(0))}function JP(e,t,n){const o=Me([{_0:"id",_1:Ge(t)},{_0:"position",_1:yn(n)},{_0:"copper",_1:Bf(e)}]);nt(Qe,{type_msg:"set_copper",content:Xe(new ke(o))})}function e_(e,t,n){const o=Me([{_0:"id",_1:Ge(t)},{_0:"position",_1:yn(n)},{_0:"enemy",_1:zf(e)}]);nt(Qe,{type_msg:"set_enemy",content:Xe(new ke(o))})}function Xf(e,t,n){const o=Me([{_0:"id",_1:Ge(t)},{_0:"position",_1:yn(n)},{_0:"structure",_1:Vf(e)}]);nt(Qe,{type_msg:"set_structure",content:Xe(new ke(o))})}function XP(e,t,n){const o=Me([{_0:"id",_1:Ge(t)},{_0:"position",_1:yn(n)},{_0:"material",_1:qP(e)}]);nt(Qe,{type_msg:"set_material",content:Xe(new ke(o))})}function as(e){const t=Me([{_0:"id",_1:Ge(e)}]);nt(Qe,{type_msg:"remove_unit",content:Xe(new ke(t))})}function Bo(e,t){const n={_0:"id",_1:Ge(e)},o=q6(t),s=Me([n,{_0:"direction",_1:new Ee(o)}]);nt(Qe,{type_msg:"change_direction",content:Xe(new ke(s))})}function Ba(e,t){const n=Me([{_0:"id",_1:Ge(e)},{_0:"to",_1:yn(t)}]);nt(Qe,{type_msg:"move_to",content:Xe(new ke(n))})}function Yf(e,t){const n={_0:"id",_1:Ge(e)},o=Sc(t),s=Me([n,{_0:"can_move",_1:new Ee(o)}]);nt(Qe,{type_msg:"display_can_move",content:Xe(new ke(s))})}function YP(e,t){const n={_0:"id",_1:Ge(e)},o=Sc(t),s=Me([n,{_0:"can_summon",_1:new Ee(o)}]);nt(Qe,{type_msg:"display_can_summon",content:Xe(new ke(s))})}function ZP(e,t){const n={_0:"id",_1:Ge(e)},o=Sc(t),s=Me([n,{_0:"can_build",_1:new Ee(o)}]);nt(Qe,{type_msg:"display_can_build",content:Xe(new ke(s))})}function Jo(e){const t=Me([{_0:"id",_1:Ge(e)}]);nt(Qe,{type_msg:"animate_move",content:Xe(new ke(t))})}function QP(){const e=Me([]);nt(Qe,{type_msg:"animate_reset",content:Xe(new ke(e))})}function eL(e,t){const n=Me([{_0:"room_position",_1:yn(e)},{_0:"size",_1:Ge(t)}]);nt(Qe,{type_msg:"put_room_blocks",content:Xe(new ke(n))})}function za(e){const t=Me([{_0:"position",_1:yn(e)}]);nt(Qe,{type_msg:"set_move_block",content:Xe(new ke(t))})}function oo(e){const t=Me([{_0:"position",_1:yn(e)}]);nt(Qe,{type_msg:"set_attack_block",content:Xe(new ke(t))})}function Va(e){const t=Me([{_0:"position",_1:yn(e)}]);nt(Qe,{type_msg:"set_can_summon_blocks",content:Xe(new ke(t))})}function an(e){const t=Me([{_0:"position",_1:yn(e)}]);nt(Qe,{type_msg:"clear_block",content:Xe(new ke(t))})}function t_(e){const t=Me([{_0:"id",_1:Ge(e)}]);nt(Qe,{type_msg:"attack_complete",content:Xe(new ke(t))})}function Hn(e,t,n){const o=Me([{_0:"id",_1:Ge(e)},{_0:"now_health",_1:In(t)},{_0:"max_health",_1:In(n)}]);nt(Qe,{type_msg:"update_health",content:Xe(new ke(o))})}function Zf(){const e=Me([]);nt(Qe,{type_msg:"game_over",content:Xe(new ke(e))})}function Qf(){const e=Me([]);nt(Qe,{type_msg:"success",content:Xe(new ke(e))})}function eh(e){const t=[],n=Aa.length;let o=0;for(;;){const i=o;if(i<n){const r=Aa[i];r.level<=e&&Ox(t,r),o=i+1|0;continue}else break}const s=t;return P6(s,co(0,s.length-1|0))}function _l(e){let t=co(0,8),n=co(0,8);for(;ms(e,{_0:t,_1:n});){t=co(0,8),n=co(0,8);continue}return{_0:t,_1:n}}function ar(e,t,n){const o=!n,s=!n,i=Qo(Pi),r=e.health,a={id:i,owned:n,can_move:o,can_attack:s,position:t,now_health:r,enemy_base:e};return lf(Fn,a.id,a),a}function tL(){return{occupant:gr}}function V$(e){return{id:Qo(Pi),material_base:e}}function th(e,t,n){let o=e;const s=[];let i=0;for(;;){const r=i;if(r<9){const a=[];let c=0;for(;;){const l=c;if(l<9){Ex(a,tL()),c=l+1|0;continue}else break}Ax(s,a),i=r+1|0;continue}else break}if(o===6&&vr.val===!1)yt(vt(s,3),4).occupant=new $o(ar(R$(ql,"BOSS"),{_0:t._0+3|0,_1:t._1+4|0},!1)),yt(vt(s,5),4).occupant=new $o(ar(R$(ql,"BOSS"),{_0:t._0+5|0,_1:t._1+4|0},!1)),vr.val=!0;else{o===6&&(o=5),yt(vt(s,4),4).occupant=new Ou(Kf(nx(km,""),!1,void 0,{_0:t._0+4|0,_1:t._1+4|0}));const r=Ns(Hw,o);let a=0;for(;;){const c=a;if(c<r){const l=eh(o),u=_l(n);rs(n,u);const _={_0:t._0+u._0|0,_1:t._1+u._1|0};yt(vt(s,u._0),u._1).occupant=new $o(ar(l,_,!1)),a=c+1|0;continue}else break}if(Pr(.4)){const c=_l(n);rs(n,c),yt(vt(s,c._0),c._1).occupant=new zl(V$(e5))}if(Pr(.4)){const c=_l(n);rs(n,c),yt(vt(s,c._0),c._1).occupant=new zl(V$(t5))}}return{level:o,index_position:t,blocks:s}}function nL(e){const t=e.blocks,n=t.length;let o=0;for(;;){const s=o;if(s<n){const i=t[s],r=i.length;let a=0;for(;;){const c=a;if(c<r){if(i[c].occupant.$tag===4)return!1;a=c+1|0;continue}else break}o=s+1|0;continue}else break}return!0}function sL(e){const t=[];let n=0;for(;;){const o=n;if(o<9){let s=0;for(;;){const i=s;if(i<9){yt(vt(e.blocks,o),i).occupant.$tag===4&&vo(t,{_0:o,_1:i}),s=i+1|0;continue}else break}n=o+1|0;continue}else break}return t}function oL(e,t){const n=t._0,o=t._1,s=e.index_position,i=s._0,r=s._1,a=n-i|0,c=o-r|0;return a<0?c<0?{_0:5,_1:{_0:i-9|0,_1:r}}:c>=9?{_0:4,_1:{_0:i-9|0,_1:r+9|0}}:{_0:0,_1:{_0:i-9|0,_1:r}}:a>=9?c<0?{_0:7,_1:{_0:i+9|0,_1:r}}:c>=9?{_0:6,_1:{_0:i+9|0,_1:r+9|0}}:{_0:1,_1:{_0:i+9|0,_1:r}}:c<0?{_0:3,_1:{_0:i,_1:r-9|0}}:{_0:2,_1:{_0:i,_1:r+9|0}}}function iL(e){const t=XC([]),n=e.rooms,o=n.length;let s=0;for(;;){const i=s;if(i<o){const r=n[i],a=r.index_position,c=a._0,l=a._1;let u=0;for(;;){const _=u;if(_<9){let $=0;for(;;){const d=$;if(d<9){const p={_0:c+_|0,_1:l+d|0};pf(t,p,yt(vt(r.blocks,_),d)),$=d+1|0;continue}else break}u=_+1|0;continue}else break}s=i+1|0;continue}else break}return t}function rL(e){const t=iL(e),n=ff([]),o={map:n},s=px(t);for(;;){const i=bx(s);if(i===void 0)break;{const a=i,c=a._0;a._1.occupant.$tag===4?Na(n,c,!0):Na(n,c,!1);continue}}return o}function aL(e,t){const n=gf(e.map,t);return n===-1?!1:n}function cL(e,t,n){const o=Ii(t),s=[],i=o.length;let r=0;for(;;){const a=r;if(a<i){const c=o[a],l={_0:n._0+c._0|0,_1:n._1+c._1|0};aL(e,l)&&vo(s,l),r=a+1|0;continue}else break}return s}function ia(e,t){const n=e._0>t._0?e._0-t._0|0:t._0-e._0|0,o=e._1>t._1?e._1-t._1|0:t._1-e._1|0;return n+o|0}function lL(e,t,n,o,s){if(t._0===n._0&&t._1===n._1)return t;const i=[{position:t,g_cost:0,h_cost:ia(t,n),f_cost:ia(t,n)}],r=ff([]),a=KC([]);for(;i.length>0;){let c=0,l=Zs(i,0);const u=i.length;let _=1;for(;;){const v=_;if(v<u){Zs(i,v).f_cost<l.f_cost&&(l=Zs(i,v),c=v),_=v+1|0;continue}else break}lP(i,c),Na(r,l.position,!0);const $=ia(l.position,n);let d;const p=l.position;if(p._0===n._0&&p._1===n._1?d=!0:d=$<=s,d){let v=l.position,y=l.position;for(;;){const w=tx(a,v);if(w===void 0)break;{const I=w;y=v,v=I;const P=v;if(P._0===t._0&&P._1===t._1)break;continue}}return y}const b=cL(e,o,l.position),g=b.length;let m=0;for(;;){const v=m;if(v<g){e:{const y=b[v];if(gf(r,y)!==-1)break e;const k=l.g_cost+1|0;let I=!1,P=0;const T=i.length;let x=0;for(;;){const D=x;if(D<T){const U=Zs(i,D).position;if(U._0===y._0&&U._1===y._1){I=!0,P=D;break}x=D+1|0;continue}else break}if(I)k<Zs(i,P).g_cost&&(Zs(i,P).g_cost=k,Zs(i,P).f_cost=k+Zs(i,P).h_cost|0,eu(a,y,l.position));else{const D=ia(y,n),U=k+D|0;Dx(i,{position:y,g_cost:k,h_cost:D,f_cost:U}),eu(a,y,l.position)}break e}m=v+1|0;continue}else break}continue}}function nh(e,t){Gx(e.rooms,t)}function uL(e){const t=th(1,n5,e),n={rooms:[]};return nh(n,t),n}function _L(e,t){const n=ei(e,t);if(n===void 0)return ee();{const s=n,i=Us(e,t);if(i===void 0)return ee();{const c=i._1;return yt(vt(s.blocks,c._0),c._1)}}}function n_(e,t){const n=ei(e,t);if(n!==void 0){const s=n,i=Us(e,t);if(i===void 0)ee();else{const c=i._1,l=yt(vt(s.blocks,c._0),c._1).occupant;let u;return l.$tag===4?u=!0:u=!1,!u}}return!0}function $l(e,t){if(ei(e,t)!==void 0)return 0;let o=999999;const s=e.rooms,i=s.length;let r=0;for(;;){const a=r;if(a<i){const l=s[a].index_position,u=l._0,_=l._1,$=t._0,d=t._1,p=$<u?u-$|0:$>=(u+9|0)?($-(u+9|0)|0)+1|0:0,b=d<_?_-d|0:d>=(_+9|0)?(d-(_+9|0)|0)+1|0:0,g=p>b?p:b;g<o&&(o=g),r=a+1|0;continue}else break}return o}function Jn(e,t){const n=Qu(e,t),o=n._0,s=n._1;yt(vt(o.blocks,s._0),s._1).occupant=gr}function s_(e,t,n){const o=Qu(e,t),s=o._0,i=o._1;yt(vt(s.blocks,i._0),i._1).occupant=n}function sh(e){const t=e.index_position,n=t._0,o=t._1;eL(e.index_position,9);let s=0;for(;;){const i=s;if(i<9){let r=0;for(;;){const a=r;if(a<9){const c={_0:n+i|0,_1:o+a|0},l=yt(vt(e.blocks,i),a).occupant;switch(l.$tag){case 4:break;case 0:{const _=l._0;e_(_,_.id,c),Hn(_.id,_.now_health,_.enemy_base.health);break}case 1:{const _=l._0;JP(_,_.id,c),Hn(_.id,_.now_health,_.copper.attribute.health);break}case 3:{const _=l._0;Xf(_,_.id,c);break}default:{const _=l._0;XP(_,_.id,c)}}r=a+1|0;continue}else break}s=i+1|0;continue}else return}}function $L(e){return((e/4|0)+1|0)>=6?6:(e/4|0)+1|0}function dL(){return{map:uL(Vm({buf:r5,start:0,end:3}))}}function es(e,t){if(t===0&&(ms(Gn,e)?za(e):ms(ir,e)?oo(e):ms(Cs,e)&&Va(e)),t===1&&(ms(Vt,e)||ms(ir,e)?oo(e):ms(Cs,e)&&Va(e)),t===2)if(ms(Vt,e)){oo(e);return}else if(ms(ir,e)){oo(e);return}else if(ms(Gn,e)){za(e);return}else return;else return}function pL(e){const t=Xu(e),n=Me([{_0:"structure",_1:Vf(t)}]);nt(Qe,{type_msg:"handle_on_click_structure",content:Xe(new ke(n))})}function Ts(){const e=on(Vt);for(;;){const t=rn(e);if(t===void 0)break;{const o=t;an(o),es(o,0);continue}}sn(Vt)}function Es(){const e=on(Gn);for(;;){const t=rn(e);if(t===void 0)break;{const o=t;an(o),es(o,1);continue}}sn(Gn)}function As(){const e=on(Cs);for(;;){const t=rn(e);if(t===void 0)break;{const o=t;an(o),es(o,2);continue}}sn(Cs)}function Gc(e){switch(e.$tag){case 0:return e._0.position;case 1:return e._0.position;default:return e._0.position}}function mL(e,t){Es(),Ts(),As();const n=Xu(t),o=KP(n,e),s=o.length;let i=0;for(;;){const r=i;if(r<s){const a=o[r],c=Gc(a);oo(c),rs(Vt,c),i=r+1|0;continue}else return}}function fL(){const e=on(Vt);for(;;){const t=rn(e);if(t===void 0)break;{const o=t;an(o),es(o,0);continue}}sn(Vt)}function oh(e,t){if(Pr(e.attribute.dodge/100))return!1;const n=e.attribute.defense,o=Math.fround(t/Math.fround(t+Math.fround(Math.fround(1)*n))),s=Math.fround(t*o);return e.now_health=Math.fround(e.now_health-s),Math.fround(e.now_health<=Math.fround(0))}function ih(e,t){if(e.now_health=Math.fround(e.now_health+t),Math.fround(e.now_health>e.attribute.health)){e.now_health=e.attribute.health;return}else return}function Rc(e,t){if(Pr(e.enemy_base.dodge/100))return!1;const n=e.enemy_base.defense,o=Math.fround(t/Math.fround(t+Math.fround(Math.fround(1)*n))),s=Math.fround(t*o);return e.now_health=Math.fround(e.now_health-s),Math.fround(e.now_health<=Math.fround(0))}function o_(e){const t=[],n=e.enemy_base.drop_items,o=n.length;let s=0;for(;;){const i=s;if(i<o){const r=n[i],a=co(r._1._0,r._1._1);Tx(t,EP(new gm(r._0),a)),s=i+1|0;continue}else break}return t}function hL(e,t,n){Jo(e);const o=Xu(e),s=wo(n,t);switch(s.$tag){case 0:{const c=s._0;Rc(c,o.structure_base.attribute.attack)?(Ku(Tt.val.bag,o_(c)),kc(Fn,c.id),as(c.id),Jn(n,c.position)):Hn(c.id,c.now_health,c.enemy_base.health),o.can_attack=!1,rr(o);break}case 1:{const c=s._0;o.owned?ih(c,o.structure_base.attribute.attack):(oh(c,o.structure_base.attribute.attack)&&(bf(bo,c.id),as(c.id),Jn(n,c.position)),bo.size===0&&Zf()),Hn(c.id,c.now_health,c.copper.attribute.health),o.can_attack=!1,rr(o);break}case 3:{const c=s._0;Ac(c,o.structure_base.attribute.attack)?(Mc(Ks,c.id),as(c.id),Jn(n,c.position)):Hn(c.id,c.now_health,c.structure_base.health),o.can_attack=!1,rr(o);break}case 4:break;default:Js()}const i=on(Vt);for(;;){const a=rn(i);if(a===void 0)break;{const l=a;an(l),es(l,0);continue}}sn(Vt);let r;if(s.$tag===4?r=!0:r=!1,!r){t_(e);return}}function dl(e,t,n){const o=e.copper_type;let s;switch(o){case 2:{s=!1;break}case 4:{s=!1;break}default:s=!0}const i=Qo(Pi),r=e.copper_type;let a;r===4?a=!0:a=!1;const c=e.copper_type;let l;c===2?l=!0:l=!1;const u=e.attribute.health,_=e.attribute,$={id:i,original_id:t,copper:e,can_move:!0,can_attack:s,can_summon:a,can_build:l,position:n,now_health:u,attribute:_};return BC(bo,$.id,$),$}function ks(e){Yu(e.id),Yf(e.id,e.can_move),Zu(e.id,e.can_attack),YP(e.id,e.can_summon),ZP(e.id,e.can_build)}function gL(e){const t=Tt.val.warehouse,n=dl(ha(t,Ns(e,0)),Ns(e,0),a5),o=dl(ha(t,Ns(e,1)),Ns(e,1),c5),s=dl(ha(t,Ns(e,2)),Ns(e,2),l5);It.val=dL();const i=It.val;let r;i===void 0?r=ee():r=i;const a=r.map,c=M6(a.rooms,0);yt(vt(c.blocks,0),3).occupant=new vi(n),yt(vt(c.blocks,0),4).occupant=new vi(o),yt(vt(c.blocks,0),5).occupant=new vi(s),sh(c),Bo(n.id,2),Bo(o.id,2),Bo(s.id,2),ks(n),ks(o),ks(s)}function qa(e){e:switch(e){case 0:return 1;case 1:return 0;case 2:return 2;case 3:return 3;case 4:break e;case 5:break e;case 6:break e;default:break e}return GM()}function Wa(e,t){const n=t._0-e._0|0,o=t._1-e._1|0;return n!==0?n>0?2:3:o>0?0:1}function bL(){return Ux(vf(bo))}function yL(e){const t=[],n=e.position,o=n._0,s=n._1,i=bL(),r=i.length;let a=0;for(;;){const p=a;if(p<r){const b=i[p];ll(t,{_0:b.position,_1:new Ci(b)}),a=p+1|0;continue}else break}zu(Fn)(p=>(p.id!==e.id&&p.owned&&ll(t,{_0:p.position,_1:new qo(p)}),1)),Vu(Ks)(p=>(p.owned===!0&&ll(t,{_0:p.position,_1:new Wo(p)}),1));let u=1e9,_;const $=t.length;let d=0;for(;;){const p=d;if(p<$){const b=t[p],g=b._0,m=g._0,v=g._1,y=b._1,w=m-o|0,k=w<0?-w|0:w,I=v-s|0,P=k+(I<0?-I|0:I)|0;P<u&&(u=P,_=y),d=p+1|0;continue}else break}return _}function i_(e,t){const n=e.enemy_base.attack_range,o=Ii(n),s=[],i=o.length;let r=0;for(;;){const a=r;if(a<i){const c=o[a],l={_0:e.position._0+c._0|0,_1:e.position._1+c._1|0};if(Uo(t,l)){const u=wo(t,l);if(e.owned)switch(u.$tag){case 0:{const $=u._0;$.owned===!1&&Mn(s,new qo($));break}case 3:{const $=u._0;$.owned===!1&&Mn(s,new Wo($));break}}else switch(u.$tag){case 1:{const $=u._0;Mn(s,new Ci($));break}case 0:{const $=u._0;$.owned===!0&&Mn(s,new qo($));break}case 3:{const $=u._0;$.owned===!0&&Mn(s,new Wo($));break}}}r=a+1|0;continue}else break}return s}function vL(e,t){const n=i_(t,e);if(n.length>0){const o=L6(n,0);switch(Jo(t.id),o.$tag){case 0:{const i=o._0;Rc(i,t.enemy_base.attack)?(kc(Fn,i.id),as(i.id),Jn(e,i.position)):Hn(i.id,i.now_health,i.enemy_base.health);break}case 1:{const i=o._0;if(oh(i,t.enemy_base.attack)){const a=i.copper;a.live_left=a.live_left-1|0,bf(bo,i.id),as(i.id),Jn(e,i.position),bo.size===0&&Zf()}else Hn(i.id,i.now_health,i.copper.attribute.health);break}default:{const i=o._0;Ac(i,t.enemy_base.attack)?(Mc(Ks,i.id),as(i.id),Jn(e,i.position)):Hn(i.id,i.now_health,i.structure_base.health)}}}else{const o=yL(t);if(o!==void 0){const r=Gc(o),a=rL(e),c=lL(a,t.position,r,t.enemy_base.speed,t.enemy_base.attack_range);if(c!==void 0){const u=c;Jo(t.id);const _=t.position;Jn(e,t.position),t.position=u,s_(e,t.position,new $o(t)),Bo(t.id,qa(Wa(_,u))),Ba(t.id,u)}}}return 1}function wL(){const e=It.val;let t;e===void 0?t=ee():t=e;const n=t.map;zu(Fn)(s=>s.owned===!1?vL(n,s):1)}function SL(){const e=on(Vt);for(;;){const s=rn(e);if(s===void 0)break;an(s)}sn(Vt);const t=on(Gn);for(;;){const s=rn(t);if(s===void 0)break;an(s)}sn(Gn);const n=on(ir);for(;;){const s=rn(n);if(s===void 0)break;an(s)}sn(ir);const o=on(Cs);for(;;){const s=rn(o);if(s===void 0)break;an(s)}sn(Cs)}function Lr(e){if(Yu(e.id),e.can_move&&Yf(e.id,!0),e.can_attack){Zu(e.id,!0);return}else return}function kL(){vf(bo)(o=>{o.can_move=!0;const s=o.copper.copper_type;let i;switch(s){case 2:{i=!1;break}case 4:{i=!1;break}default:i=!0}o.can_attack=i;const r=o.copper.copper_type;let a;r===4?a=!0:a=!1,o.can_summon=a;const c=o.copper.copper_type;let l;return c===2?l=!0:l=!1,o.can_build=l,ks(o),1}),zu(Fn)(o=>(o.owned&&(o.can_move=!0,o.can_attack=!0,Lr(o)),1)),Vu(Ks)(o=>(o.owned&&(o.structure_base.can_attack&&(o.can_attack=!0),rr(o)),1))}function ML(){Vu(Ks)(t=>{if(t.structure_base.name===""){const n=t.resource_type;if(n!==void 0){const s=n;so(Tt.val.bag.resources,s,2);const i={_0:"position",_1:yn(t.position)},r=W6(s),a={_0:"resource_type",_1:new Ee(r)},c=2,l=void 0,u=Me([i,a,{_0:"amount",_1:new Ar(c,l)}]);nt(Qe,{type_msg:"drill_resource_generate",content:Xe(new ke(u))})}}return 1})}function CL(){if(Pr(.2)){const e=It.val;let t;e===void 0?t=ee():t=e;const o=t.map.rooms,s=o.length;let i=0;for(;;){const r=i;if(r<s){e:{const a=o[r];if(nL(a))break e;const c=yt(vt(a.blocks,4),4).occupant;if(c.$tag===3&&c._0.structure_base.name===""){const _=a.level,$=eh(_),d=sL(a),p=C6(d,co(0,d.length-1|0)),b={_0:a.index_position._0+p._0|0,_1:a.index_position._1+p._1|0},g=ar($,b,!1);yt(vt(a.blocks,p._0),p._1).occupant=new $o(g),e_(g,g.id,b)}break e}i=r+1|0;continue}else return}}else return}function xL(){SL(),kL(),wL(),QP(),CL(),ML()}function PL(){It.val=void 0,vr.val=!1,wr.val=!1,Sr.val=!1}function LL(e){Es(),Ts(),As();const t=Nr(Fn,e);let n;t===void 0?n=ee():n=t;const o=It.val;let s;o===void 0?s=ee():s=o;const i=s.map,a=i_(n,i).length!==0,c=Me([{_0:"enemy",_1:zf(n)},{_0:"has_attack_targets",_1:Ln(a)}]);nt(Qe,{type_msg:"handle_on_click_enemy",content:Xe(new ke(c))})}function IL(e,t){Es(),Ts(),As();const n=Nr(Fn,t);let o;n===void 0?o=ee():o=n;const s=i_(o,e),i=s.length;let r=0;for(;;){const a=r;if(a<i){const c=s[a],l=Gc(c);oo(l),rs(Vt,l),r=a+1|0;continue}else return}}function TL(){const e=on(Vt);for(;;){const t=rn(e);if(t===void 0)break;{const o=t;an(o),es(o,0);continue}}sn(Vt)}function EL(e,t,n){Jo(e);const o=Nr(Fn,e);let s;o===void 0?s=ee():s=o;const i=wo(n,t);switch(i.$tag){case 0:{const l=i._0;Rc(l,s.enemy_base.attack)?(Ku(Tt.val.bag,o_(l)),kc(Fn,l.id),as(l.id),Jn(n,l.position),vr.val===!0&&(l.enemy_base.name==="BOSS"?wr.val=!0:l.enemy_base.name==="BOSS"&&(Sr.val=!0),wr.val===!0&&Sr.val===!0&&Qf())):Hn(l.id,l.now_health,l.enemy_base.health),s.can_attack=!1,Lr(s);break}case 3:{const l=i._0;Ac(l,s.enemy_base.attack)?(Mc(Ks,l.id),as(l.id),Jn(n,l.position)):Hn(l.id,l.now_health,l.structure_base.health),s.can_attack=!1,Lr(s);break}case 4:break;default:Js()}const r=on(Vt);for(;;){const c=rn(r);if(c===void 0)break;{const u=c;an(u),es(u,0);continue}}sn(Vt);let a;if(i.$tag===4?a=!0:a=!1,!a){t_(e);return}}function AL(e,t){const n=Ii(e.enemy_base.speed),o=[],s=n.length;let i=0;for(;;){const r=i;if(r<s){const a=n[r],c={_0:e.position._0+a._0|0,_1:e.position._1+a._1|0};n_(t,c)||vo(o,c),i=r+1|0;continue}else break}return o}function GL(e,t){Es(),Ts(),As();const n=Nr(Fn,t);let o;n===void 0?o=ee():o=n;const s=AL(o,e),i=s.length;let r=0;for(;;){const a=r;if(a<i){const c=s[a];za(c),rs(Gn,c),r=a+1|0;continue}else return}}function RL(){const e=on(Gn);for(;;){const t=rn(e);if(t===void 0)break;{const o=t;an(o),es(o,1);continue}}sn(Gn)}function OL(e,t,n){Jo(e);const o=Nr(Fn,e);let s;if(o===void 0?s=ee():s=o,ei(n,t)===void 0)Js();else{const a=s.position,c=Us(n,a);let l;c===void 0?l=ee():l=c;const u=l._0,_=l._1,$=Us(n,t);let d;$===void 0?d=ee():d=$;const p=d._0,b=d._1;yt(vt(u.blocks,_._0),_._1).occupant=gr,yt(vt(p.blocks,b._0),b._1).occupant=new $o(s),s.position=t,Bo(e,qa(Wa(a,t))),Ba(e,t)}s.can_move=!1,Lr(s);const r=on(Gn);for(;;){const a=rn(r);if(a===void 0)break;{const l=a;an(l),es(l,1);continue}}sn(Gn)}function xs(e){const t=QC(bo,e);return t===void 0?ee():t}function DL(e){const t=e.copper.copper_info.attack_range;if(t===void 0)switch(e.copper.copper_type){case 0:return 1;case 1:return 3;case 3:return 1;case 4:return 0;default:return 0}else return t}function rh(e,t){const n=DL(e),o=Ii(n),s=[],i=o.length;let r=0;for(;;){const a=r;if(a<i){const c=o[a],l={_0:e.position._0+c._0|0,_1:e.position._1+c._1|0};if(Uo(t,l)){const u=wo(t,l);switch(u.$tag){case 1:{const $=u._0;$.copper.copper_type===3&&Mn(s,new Ci($));break}case 3:{const $=u._0;$.owned===!1&&Mn(s,new Wo($));break}case 0:{const $=u._0;$.owned===!1&&Mn(s,new qo($));break}}}r=a+1|0;continue}else break}return s}function NL(e){Es(),Ts(),As();const t=xs(e),n=It.val;let o;n===void 0?o=ee():o=n;const s=o.map,r=rh(t,s).length!==0,a=Me([{_0:"copper",_1:Bf(xs(e))},{_0:"has_attack_targets",_1:Ln(r)}]);nt(Qe,{type_msg:"handle_on_click_copper",content:Xe(new ke(a))}),ks(t)}function jL(e,t){Es(),Ts(),As();const n=xs(t),o=rh(n,e),s=o.length;let i=0;for(;;){const r=i;if(r<s){const a=o[r],c=Gc(a);oo(c),rs(Vt,c),i=r+1|0;continue}else return}}function HL(e,t,n){Jo(e);const o=xs(e),s=wo(n,t);switch(s.$tag){case 0:{const c=s._0;if(Rc(c,o.attribute.attack)){Ku(Tt.val.bag,o_(c)),kc(Fn,c.id),as(c.id),Jn(n,c.position);const u=It.val;let _;u===void 0?_=ee():_=u;const $=_.map,d=wo($,c.position);let p;switch(d.$tag){case 4:{p="Empty";break}case 0:{p="Enemy";break}default:p="Other"}Af(`deeeebug${p}`),vr.val===!0&&(c.enemy_base.name==="BOSS"?wr.val=!0:c.enemy_base.name==="BOSS"&&(Sr.val=!0),wr.val===!0&&Sr.val===!0&&Qf())}else Hn(c.id,c.now_health,c.enemy_base.health);o.can_attack=!1,ks(o);break}case 1:{const c=s._0;ih(c,o.attribute.attack),Hn(c.id,c.now_health,c.copper.attribute.health),o.can_attack=!1,ks(o);break}case 3:{const c=s._0;Ac(c,o.attribute.attack)?(Mc(Ks,c.id),as(c.id),Jn(n,c.position)):Hn(c.id,c.now_health,c.structure_base.health),o.can_attack=!1,ks(o);break}case 4:break;default:Js()}const i=on(Vt);for(;;){const a=rn(i);if(a===void 0)break;{const l=a;an(l),es(l,0);continue}}sn(Vt);let r;if(s.$tag===4?r=!0:r=!1,!r){t_(e);return}}function FL(e,t){const n=Ii(e.attribute.speed),o=[],s=n.length;let i=0;for(;;){const r=i;if(r<s){e:{const a=n[r],c={_0:e.position._0+a._0|0,_1:e.position._1+a._1|0};if($l(t,c)>1||Uo(t,c))break e;const u=a._0,_=a._1;if(u!==0&&_!==0){const $={_0:e.position._0+u|0,_1:e.position._1},d={_0:e.position._0,_1:e.position._1+_|0},p=$l(t,$),b=$l(t,d),g=p<=1&&!Uo(t,$),m=b<=1&&!Uo(t,d);if(!g&&!m)break e}vo(o,c);break e}i=r+1|0;continue}else break}return o}function UL(e,t){Es(),Ts(),As();const n=xs(t),o=FL(n,e),s=o.length;let i=0;for(;;){const r=i;if(r<s){const a=o[r];za(a),rs(Gn,a),i=r+1|0;continue}else return}}function BL(e,t,n){Jo(e);const o=xs(e);if(ei(n,t)===void 0){const r=o.position,a=Us(n,r);let c;a===void 0?c=ee():c=a;const l=c._0,u=c._1,$=oL(l,t)._1,d=t._0-$._0|0,p=t._1-$._1|0,b=$L(n.rooms.length+1|0),m=th(b,$,Vm({buf:[{_0:d,_1:p}],start:0,end:1}));nh(n,m),yt(vt(l.blocks,u._0),u._1).occupant=gr,yt(vt(m.blocks,d),p).occupant=new vi(o),sh(m),Bo(e,qa(Wa(r,t))),o.position=t,Ba(e,t)}else{const r=o.position,a=Us(n,r);let c;a===void 0?c=ee():c=a;const l=c._0,u=c._1,_=Us(n,t);let $;_===void 0?$=ee():$=_;const d=$._0,p=$._1;yt(vt(l.blocks,u._0),u._1).occupant=gr,yt(vt(d.blocks,p._0),p._1).occupant=new vi(o),o.position=t,Bo(e,qa(Wa(r,t))),Ba(e,t)}o.can_move=!1,ks(o);const i=on(Gn);for(;;){const r=rn(i);if(r===void 0)break;{const c=r;an(c),es(c,1);continue}}sn(Gn)}function zL(e,t){const n=[],o=[u5,_5,$5,d5],s=o.length;let i=0;for(;;){const r=i;if(r<s){const a=o[r],c={_0:e.position._0+a._0|0,_1:e.position._1+a._1|0};n_(t,c)||vo(n,c),i=r+1|0;continue}else break}return n}function VL(e){Es(),Ts(),As();const t=xs(e),n=It.val;let o;n===void 0?o=ee():o=n;const s=o.map,i=zL(t,s),r=i.length;let a=0;for(;;){const c=a;if(c<r){const l=i[c];Va(l),rs(Cs,l),a=c+1|0;continue}else return}}function qL(e,t,n,o){const s=YC(ql,o);let i;s===void 0?i=ee():i=s;const r=i.summon_cost,a=xs(e);if(Tc(Tt.val.bag.resources,r)){Ec(Tt.val.bag.resources,r);const c=ar(i,t,!0);s_(n,t,new $o(c)),e_(c,c.id,t),Lr(c),a.can_summon=!1,ks(a);return}else{const c="",l=Me([{_0:"message",_1:new Ee(c)}]);nt(Qe,{type_msg:"resource_not_enough",content:Xe(new ke(l))});return}}function WL(){const e=Me([{_0:"contents",_1:kx(Aa)}]);nt(Qe,{type_msg:"get_summon_menu",content:Xe(new ke(e))})}function KL(){const e=Me([{_0:"contents",_1:xx(Vl)}]);nt(Qe,{type_msg:"get_structure_menu",content:Xe(new ke(e))})}function JL(e,t,n){const o=[],s=[p5,m5,f5,h5],i=s.length;let r=0;for(;;){const a=r;if(a<i){const c=s[a],l={_0:e.position._0+c._0|0,_1:e.position._1+c._1|0};n?Uo(t,l)&&_L(t,l).occupant.$tag===2&&vo(o,l):n_(t,l)||vo(o,l),r=a+1|0;continue}else break}return o}function XL(e,t){Es(),Ts(),As();const n=xs(e),o=It.val;let s;o===void 0?s=ee():s=o;const i=s.map,r=JL(n,i,t===""),a=r.length;let c=0;for(;;){const l=c;if(l<a){const u=r[l];Va(u),rs(Cs,u),c=l+1|0;continue}else return}}function iu(){const e=on(Cs);for(;;){const t=rn(e);if(t===void 0)break;{const o=t;an(o),es(o,2);continue}}sn(Cs)}function YL(e,t,n,o){const s=ZC(km,o);let i;s===void 0?i=ee():i=s;const r=i.cost,a=xs(e);if(Tc(Tt.val.bag.resources,r)){Ec(Tt.val.bag.resources,r);let c;if(o===""){const u=wo(n,t);if(u.$tag===2){const $=u._0;Jn(n,t),as($.id),c=$.material_base.resource_type}else c=ee()}else c=void 0;const l=Kf(i,!0,c,t);s_(n,t,new Ou(l)),Xf(l,l.id,t),a.can_build=!1,rr(l),iu();return}else{const c="",l=Me([{_0:"message",_1:new Ee(c)}]);nt(Qe,{type_msg:"resource_not_enough",content:Xe(new ke(l))}),iu();return}}function rt(e){e:{const t=fa(e);let n;t===void 0?n=ee():n=t;const o=KM({str:n,start:0,end:n.length});if(o.$tag===1)return o._0;o._0;break e}return ee()}function ZL(e){let t;e:{t:{const n=Om({str:e,start:0,end:e.length},1024);if(n.$tag===1)t=n._0;else{n._0;break t}break e}t=ee()}e:if(t.$tag===6){const o=t._0,s=le(o,"type");if(s===void 0)break e;{const r=s;if(r.$tag===4)switch(r._0){case"on_click_copper":{const l=le(o,"content");if(l===void 0)break e;{const _=l;if(_.$tag===6){const d=_._0,p=le(d,"id");if(p===void 0)break e;NL(rt(p));return}else break e}}case"on_attack_start":{const l=le(o,"content");if(l===void 0)break e;{const _=l;if(_.$tag===6){const d=_._0,p=le(d,"id");if(p===void 0)break e;{const g=p,m=It.val;let v;m===void 0?v=ee():v=m,jL(v.map,rt(g));return}}else break e}}case"on_attack_end":{Ts();return}case"on_attack_apply":{const l=le(o,"content");if(l===void 0)break e;{const _=l;if(_.$tag===6){const d=_._0,p=le(d,"id");if(p===void 0)break e;{const g=p,m=le(d,"position");if(m===void 0)break e;{const y=m;if(y.$tag===6){const k=y._0,I=le(k,"x");if(I===void 0)break e;{const T=I,x=le(k,"y");if(x===void 0)break e;{const U=x,L=rt(g),K={_0:rt(T),_1:rt(U)},ge=It.val;let ce;ge===void 0?ce=ee():ce=ge,HL(L,K,ce.map);return}}}else break e}}}else break e}}case"on_move_start":{const l=le(o,"content");if(l===void 0)break e;{const _=l;if(_.$tag===6){const d=_._0,p=le(d,"id");if(p===void 0)break e;{const g=p,m=It.val;let v;m===void 0?v=ee():v=m,UL(v.map,rt(g));return}}else break e}}case"on_move_end":{Es();return}case"on_move_apply":{const l=le(o,"content");if(l===void 0)break e;{const _=l;if(_.$tag===6){const d=_._0,p=le(d,"id");if(p===void 0)break e;{const g=p,m=le(d,"position");if(m===void 0)break e;{const y=m;if(y.$tag===6){const k=y._0,I=le(k,"x");if(I===void 0)break e;{const T=I,x=le(k,"y");if(x===void 0)break e;{const U=x,L=rt(g),K={_0:rt(T),_1:rt(U)},ge=It.val;let ce;ge===void 0?ce=ee():ce=ge,BL(L,K,ce.map);return}}}else break e}}}else break e}}case"on_game_start":{const l=le(o,"content");if(l===void 0)break e;{const _=l;if(_.$tag===6){const d=_._0,p=le(d,"ids");if(p===void 0)break e;{const m=Jm(Dm(p)),v=new Array(m.length),y=m.length;let w=0;for(;;){const k=w;if(k<y){const I=m[k];v[k]=rt(I),w=k+1|0;continue}else break}gL(v);return}}else break e}}case"on_game_round_pass":{xL();return}case"on_click_enemy":{const l=le(o,"content");if(l===void 0)break e;{const _=l;if(_.$tag===6){const d=_._0,p=le(d,"id");if(p===void 0)break e;LL(rt(p));return}else break e}}case"on_enemy_attack_start":{const l=le(o,"content");if(l===void 0)break e;{const _=l;if(_.$tag===6){const d=_._0,p=le(d,"id");if(p===void 0)break e;{const g=p,m=It.val;let v;m===void 0?v=ee():v=m,IL(v.map,rt(g));return}}else break e}}case"on_enemy_attack_end":{TL();return}case"on_enemy_attack_apply":{const l=le(o,"content");if(l===void 0)break e;{const _=l;if(_.$tag===6){const d=_._0,p=le(d,"id");if(p===void 0)break e;{const g=p,m=le(d,"position");if(m===void 0)break e;{const y=m;if(y.$tag===6){const k=y._0,I=le(k,"x");if(I===void 0)break e;{const T=I,x=le(k,"y");if(x===void 0)break e;{const U=x,L=rt(g),K={_0:rt(T),_1:rt(U)},ge=It.val;let ce;ge===void 0?ce=ee():ce=ge,EL(L,K,ce.map);return}}}else break e}}}else break e}}case"on_enemy_move_start":{const l=le(o,"content");if(l===void 0)break e;{const _=l;if(_.$tag===6){const d=_._0,p=le(d,"id");if(p===void 0)break e;{const g=p,m=It.val;let v;m===void 0?v=ee():v=m,GL(v.map,rt(g));return}}else break e}}case"on_enemy_move_end":{RL();return}case"on_enemy_move_apply":{const l=le(o,"content");if(l===void 0)break e;{const _=l;if(_.$tag===6){const d=_._0,p=le(d,"id");if(p===void 0)break e;{const g=p,m=le(d,"position");if(m===void 0)break e;{const y=m;if(y.$tag===6){const k=y._0,I=le(k,"x");if(I===void 0)break e;{const T=I,x=le(k,"y");if(x===void 0)break e;{const U=x,L=rt(g),K={_0:rt(T),_1:rt(U)},ge=It.val;let ce;ge===void 0?ce=ee():ce=ge,OL(L,K,ce.map);return}}}else break e}}}else break e}}case"on_get_summon_menu":{WL();return}case"on_summon_start":{const l=le(o,"content");if(l===void 0)break e;{const _=l;if(_.$tag===6){const d=_._0,p=le(d,"id");if(p===void 0)break e;VL(rt(p));return}else break e}}case"on_summon_apply":{const l=le(o,"content");if(l===void 0)break e;{const _=l;if(_.$tag===6){const d=_._0,p=le(d,"id");if(p===void 0)break e;{const g=p,m=le(d,"position");if(m===void 0)break e;{const y=m;if(y.$tag===6){const k=y._0,I=le(k,"x");if(I===void 0)break e;{const T=I,x=le(k,"y");if(x===void 0)break e;{const U=x,L=le(d,"name");if(L===void 0)break e;{const ge=L,ce=rt(g),he={_0:rt(T),_1:rt(U)},q=It.val;let G;q===void 0?G=ee():G=q;const J=G.map,F=fa(ge);let O;F===void 0?O=ee():O=F,qL(ce,he,J,O);return}}}}else break e}}}else break e}}case"on_summon_end":{As();return}case"on_click_structure":{const l=le(o,"content");if(l===void 0)break e;{const _=l;if(_.$tag===6){const d=_._0,p=le(d,"id");if(p===void 0)break e;pL(rt(p));return}else break e}}case"on_get_structure_menu":{KL();return}case"on_structure_build_start":{const l=le(o,"content");if(l===void 0)break e;{const _=l;if(_.$tag===6){const d=_._0,p=le(d,"id");if(p===void 0)break e;{const g=p,m=le(d,"name");if(m===void 0)break e;{const y=m,w=rt(g),k=fa(y);let I;k===void 0?I=ee():I=k,XL(w,I);return}}}else break e}}case"on_structure_build_apply":{const l=le(o,"content");if(l===void 0)break e;{const _=l;if(_.$tag===6){const d=_._0,p=le(d,"id");if(p===void 0)break e;{const g=p,m=le(d,"position");if(m===void 0)break e;{const y=m;if(y.$tag===6){const k=y._0,I=le(k,"x");if(I===void 0)break e;{const T=I,x=le(k,"y");if(x===void 0)break e;{const U=x,L=le(d,"name");if(L===void 0)break e;{const ge=L,ce=rt(g),he={_0:rt(T),_1:rt(U)},q=It.val;let G;q===void 0?G=ee():G=q;const J=G.map,F=fa(ge);let O;F===void 0?O=ee():O=F,YL(ce,he,J,O);return}}}}else break e}}}else break e}}case"on_structure_build_end":{iu();return}case"on_structure_attack_start":{const l=le(o,"content");if(l===void 0)break e;{const _=l;if(_.$tag===6){const d=_._0,p=le(d,"id");if(p===void 0)break e;{const g=p,m=It.val;let v;m===void 0?v=ee():v=m,mL(v.map,rt(g));return}}else break e}}case"on_structure_attack_end":{fL();return}case"on_structure_attack_apply":{const l=le(o,"content");if(l===void 0)break e;{const _=l;if(_.$tag===6){const d=_._0,p=le(d,"id");if(p===void 0)break e;{const g=p,m=le(d,"position");if(m===void 0)break e;{const y=m;if(y.$tag===6){const k=y._0,I=le(k,"x");if(I===void 0)break e;{const T=I,x=le(k,"y");if(x===void 0)break e;{const U=x,L=rt(g),K={_0:rt(T),_1:rt(U)},ge=It.val;let ce;ge===void 0?ce=ee():ce=ge,hL(L,K,ce.map);return}}}else break e}}}else break e}}case"on_game_over":{PL();return}default:break e}else break e}}else break e;Js()}function QL(e){const t=Uf(e),n=new Array(t.length),o=t.length;let s=0;for(;;){const i=s;if(i<o){const r=t[i];n[i]=Ic(r),s=i+1|0;continue}else break}return Sx(n)}function eI(){const e={_0:"warehouse",_1:QL(Tt.val.warehouse)},t=Me([{_0:"SpiritalSpark",_1:Ge(Rn(Tt.val.bag.resources,2))},{_0:"RecallGear",_1:Ge(Rn(Tt.val.bag.resources,1))},{_0:"ResonantCrystal",_1:Ge(Rn(Tt.val.bag.resources,4))},{_0:"RefinedCopper",_1:Ge(Rn(Tt.val.bag.resources,3))},{_0:"HeartCrystalDust",_1:Ge(Rn(Tt.val.bag.resources,0))}]),n=Me([{_0:"resources",_1:new ke(t)},{_0:"equipments",_1:wx(Tt.val.bag.equipments)}]),o=Me([e,{_0:"bag",_1:new ke(n)}]);return Xe(new ke(o))}function tI(e){let t=GP();if(e.$tag===5){const o=e._0,s=o.length;let i=0;for(;;){const r=i;if(r<s){const a=o[r];let c;e:{t:{const l=B3(a);if(l.$tag===1)c=l._0;else{l._0;break t}break e}c=ee()}t=Ju(t,c),i=r+1|0;continue}else break}return t}else return ee()}function nI(e){const t=Nm(e);let n;t===void 0?n=ee():n=t;const o=LP(),s=yf(n);for(;;){const i=wf(s);if(i===void 0)break;{const a=i,c=a._0,l=a._1;switch(c){case"SpiritalSpark":{so(o,2,ui(Ni(Di(l))));break}case"RecallGear":{so(o,1,ui(Ni(Di(l))));break}case"ResonantCrystal":{so(o,4,ui(Ni(Di(l))));break}case"RefinedCopper":{so(o,3,ui(Ni(Di(l))));break}case"HeartCrystalDust":{so(o,0,ui(Ni(Di(l))));break}}continue}}return o}function sI(e){if(e.$tag===6){const n=e._0,o=nI(ja(n,"resources")),s=Jm(Dm(ja(n,"equipments"))),i=new Array(s.length),r=s.length;let a=0;for(;;){const l=a;if(l<r){const u=s[l];let _;e:{t:{const $=z3(u);if($.$tag===1)_=$._0;else{$._0;break t}break e}_=ee()}i[l]=_,a=l+1|0;continue}else break}return TP(o,i)}else return ee()}function oI(e){let t;e:{t:{const i=Om({str:e,start:0,end:e.length},1024);let r;if(i.$tag===1)r=i._0;else{i._0;break t}const a=Nm(r);a===void 0?t=ee():t=a;break e}t=ee()}const n=tI(ja(t,"warehouse")),o=sI(ja(t,"bag")),s=jP(n,o);Tt.val=s}function iI(){return HP(Tt.val)}function rI(){return zP(Tt.val)}function aI(){return FP(Tt.val)}function cI(){return UP(Tt.val)}function lI(e){return BP(Tt.val,e)}function uI(e){hP(Qe,e)}function _I(e){oI(e)}function $I(){return eI()}function dI(e){ZL(e)}m1();function pI(){return JSON.parse(cI())}function Oc(){return JSON.parse(iI())}function mI(){return JSON.parse(rI())}function ga(){return JSON.parse(aI())}function fI(e){return JSON.parse(lI(e))}function ah(e){uI(t=>{const n=JSON.parse(t);e(n),je.enqueue(n)})}function hI(e){_I(e)}function gI(){return JSON.parse($I())}function Fe(e){dI(e)}const bI={class:"draw-screen"},yI={class:"draw-screen__body"},vI={class:"draw-card"},wI={class:"card-face card-back"},SI=["src"],kI={class:"card-face card-front"},MI=["src"],CI={key:1,class:"card-icon"},xI=["src"],PI={class:"draw-cost"},LI=["src"],II=["disabled","title"],TI={key:0,class:"toast"},EI={__name:"DrawScreen",emits:["draw"],setup(e,{emit:t}){const n=t,o=oe(!1),s=oe(!0),i=oe(!1),r=oe(""),a=oe(""),c=oe(""),l=oe({left:0,top:0,width:0,height:0}),u=oe(!1),_=oe(!1),$=oe(!1),d=oe("");function p(v){d.value=v||"",$.value=!0,setTimeout(()=>{$.value=!1},1800)}async function b(){try{const y=Oc(),w=Number((y==null?void 0:y.SpiritalSpark)??0);s.value=w>=10}catch{s.value=!1}}function g(){i.value=!1,u.value=!1,_.value=!1}function m(){if(o.value)return;if(b(),!s.value){p("");return}o.value=!0,f("[DrawScreen] runDrawSequence start");const v=document.querySelector(".draw-card");if(v){v.classList.add("is-shaking"),setTimeout(()=>v.classList.remove("is-shaking"),500);const y=v.getBoundingClientRect();l.value={left:Math.round(y.left),top:Math.round(y.top),width:Math.round(y.width),height:Math.round(y.height)}}setTimeout(async()=>{i.value=!0,u.value=!1,_.value=!0;try{const y=pI();if(y&&y.type==="success"&&y.copper&&y.copper.copper_info){const w=y.copper.copper_info;r.value=w.name||"",a.value="",c.value=Y(w.icon_url||""),f("[DrawScreen] tempImage resolved:",c.value),await _r(),setTimeout(()=>{_.value=!1,setTimeout(()=>{u.value=!0},350)},450),n("draw",{name:w.name,image:w.icon_url||""}),b()}else y&&y.type==="error"&&(i.value=!1,u.value=!1,_.value=!1,p(y.content||""),n("draw",{error:!0}),b())}catch{i.value=!1,u.value=!1,_.value=!1,p(""),n("draw",{error:!0}),b()}finally{setTimeout(()=>{o.value=!1},800)}},600)}return(v,y)=>(V(),Z("div",bI,[h("div",yI,[h("div",vI,[i.value?(V(),Z("div",{key:0,class:"draw-temp",onClick:g},[y[3]||(y[3]=h("div",{class:"dim-backdrop"},null,-1)),h("div",{class:"temp-stack",style:zn({left:l.value.left+"px",top:l.value.top+"px",width:l.value.width+"px",height:l.value.height+"px"}),onClick:y[2]||(y[2]=Fs(()=>{},["stop"]))},[h("div",{class:kt(["card",{flipped:_.value}]),onClick:y[0]||(y[0]=Fs(w=>_.value=!_.value,["stop"]))},[h("div",wI,[h("img",{src:ye(Y)("frontend_resource/gacha.png"),alt:"back"},null,8,SI)]),h("div",kI,[c.value?(V(),Z("img",{key:0,src:c.value,alt:"copper",class:"card-front-img"},null,8,MI)):(V(),Z("div",CI,_e(a.value||""),1))])],2),h("div",{class:kt(["card-name-below",{show:u.value}]),onClick:y[1]||(y[1]=Fs(()=>{},["stop"]))},_e(r.value),3)],4)])):Ie("",!0),h("img",{class:"draw-card__img",src:ye(Y)("frontend_resource/gacha.png"),alt:"card"},null,8,xI)]),h("div",PI,[h("img",{class:"draw-cost__icon",src:ye(Y)("resource/spiritual_spark.png"),alt:"cost"},null,8,LI),y[4]||(y[4]=h("span",{class:"draw-cost__times"},"X 10",-1))]),h("button",{class:"draw-action",disabled:o.value||!s.value,title:s.value?"":"",onClick:m},"  ",8,II),$.value?(V(),Z("div",TI,_e(d.value),1)):Ie("",!0)])]))}},AI=qt(EI,[["__scopeId","data-v-ab83db3b"]]);function q$(e,t){if(t===Yh)return console.warn("THREE.BufferGeometryUtils.toTrianglesDrawMode(): Geometry already defined as triangles."),e;if(t===yl||t===id){let n=e.getIndex();if(n===null){const r=[],a=e.getAttribute("position");if(a!==void 0){for(let c=0;c<a.count;c++)r.push(c);e.setIndex(r),n=e.getIndex()}else return console.error("THREE.BufferGeometryUtils.toTrianglesDrawMode(): Undefined position attribute. Processing not possible."),e}const o=n.count-2,s=[];if(t===yl)for(let r=1;r<=o;r++)s.push(n.getX(0)),s.push(n.getX(r)),s.push(n.getX(r+1));else for(let r=0;r<o;r++)r%2===0?(s.push(n.getX(r)),s.push(n.getX(r+1)),s.push(n.getX(r+2))):(s.push(n.getX(r+2)),s.push(n.getX(r+1)),s.push(n.getX(r)));s.length/3!==o&&console.error("THREE.BufferGeometryUtils.toTrianglesDrawMode(): Unable to generate correct amount of triangles.");const i=e.clone();return i.setIndex(s),i.clearGroups(),i}else return console.error("THREE.BufferGeometryUtils.toTrianglesDrawMode(): Unknown draw mode:",t),e}class Dc extends rd{constructor(t){super(t),this.dracoLoader=null,this.ktx2Loader=null,this.meshoptDecoder=null,this.pluginCallbacks=[],this.register(function(n){return new NI(n)}),this.register(function(n){return new jI(n)}),this.register(function(n){return new KI(n)}),this.register(function(n){return new JI(n)}),this.register(function(n){return new XI(n)}),this.register(function(n){return new FI(n)}),this.register(function(n){return new UI(n)}),this.register(function(n){return new BI(n)}),this.register(function(n){return new zI(n)}),this.register(function(n){return new DI(n)}),this.register(function(n){return new VI(n)}),this.register(function(n){return new HI(n)}),this.register(function(n){return new WI(n)}),this.register(function(n){return new qI(n)}),this.register(function(n){return new RI(n)}),this.register(function(n){return new YI(n)}),this.register(function(n){return new ZI(n)})}load(t,n,o,s){const i=this;let r;if(this.resourcePath!=="")r=this.resourcePath;else if(this.path!==""){const l=Wi.extractUrlBase(t);r=Wi.resolveURL(l,this.path)}else r=Wi.extractUrlBase(t);this.manager.itemStart(t);const a=function(l){s?s(l):console.error(l),i.manager.itemError(t),i.manager.itemEnd(t)},c=new ba(this.manager);c.setPath(this.path),c.setResponseType("arraybuffer"),c.setRequestHeader(this.requestHeader),c.setWithCredentials(this.withCredentials),c.load(t,function(l){try{i.parse(l,r,function(u){n(u),i.manager.itemEnd(t)},a)}catch(u){a(u)}},o,a)}setDRACOLoader(t){return this.dracoLoader=t,this}setKTX2Loader(t){return this.ktx2Loader=t,this}setMeshoptDecoder(t){return this.meshoptDecoder=t,this}register(t){return this.pluginCallbacks.indexOf(t)===-1&&this.pluginCallbacks.push(t),this}unregister(t){return this.pluginCallbacks.indexOf(t)!==-1&&this.pluginCallbacks.splice(this.pluginCallbacks.indexOf(t),1),this}parse(t,n,o,s){let i;const r={},a={},c=new TextDecoder;if(typeof t=="string")i=JSON.parse(t);else if(t instanceof ArrayBuffer)if(c.decode(new Uint8Array(t,0,4))===ch){try{r[Ye.KHR_BINARY_GLTF]=new QI(t)}catch(_){s&&s(_);return}i=JSON.parse(r[Ye.KHR_BINARY_GLTF].content)}else i=JSON.parse(c.decode(t));else i=t;if(i.asset===void 0||i.asset.version[0]<2){s&&s(new Error("THREE.GLTFLoader: Unsupported asset. glTF versions >=2.0 are supported."));return}const l=new $7(i,{path:n||this.resourcePath||"",crossOrigin:this.crossOrigin,requestHeader:this.requestHeader,manager:this.manager,ktx2Loader:this.ktx2Loader,meshoptDecoder:this.meshoptDecoder});l.fileLoader.setRequestHeader(this.requestHeader);for(let u=0;u<this.pluginCallbacks.length;u++){const _=this.pluginCallbacks[u](l);_.name||console.error("THREE.GLTFLoader: Invalid plugin found: missing name"),a[_.name]=_,r[_.name]=!0}if(i.extensionsUsed)for(let u=0;u<i.extensionsUsed.length;++u){const _=i.extensionsUsed[u],$=i.extensionsRequired||[];switch(_){case Ye.KHR_MATERIALS_UNLIT:r[_]=new OI;break;case Ye.KHR_DRACO_MESH_COMPRESSION:r[_]=new e7(i,this.dracoLoader);break;case Ye.KHR_TEXTURE_TRANSFORM:r[_]=new t7;break;case Ye.KHR_MESH_QUANTIZATION:r[_]=new n7;break;default:$.indexOf(_)>=0&&a[_]===void 0&&console.warn('THREE.GLTFLoader: Unknown extension "'+_+'".')}}l.setExtensions(r),l.setPlugins(a),l.parse(o,s)}parseAsync(t,n){const o=this;return new Promise(function(s,i){o.parse(t,n,s,i)})}}function GI(){let e={};return{get:function(t){return e[t]},add:function(t,n){e[t]=n},remove:function(t){delete e[t]},removeAll:function(){e={}}}}const Ye={KHR_BINARY_GLTF:"KHR_binary_glTF",KHR_DRACO_MESH_COMPRESSION:"KHR_draco_mesh_compression",KHR_LIGHTS_PUNCTUAL:"KHR_lights_punctual",KHR_MATERIALS_CLEARCOAT:"KHR_materials_clearcoat",KHR_MATERIALS_DISPERSION:"KHR_materials_dispersion",KHR_MATERIALS_IOR:"KHR_materials_ior",KHR_MATERIALS_SHEEN:"KHR_materials_sheen",KHR_MATERIALS_SPECULAR:"KHR_materials_specular",KHR_MATERIALS_TRANSMISSION:"KHR_materials_transmission",KHR_MATERIALS_IRIDESCENCE:"KHR_materials_iridescence",KHR_MATERIALS_ANISOTROPY:"KHR_materials_anisotropy",KHR_MATERIALS_UNLIT:"KHR_materials_unlit",KHR_MATERIALS_VOLUME:"KHR_materials_volume",KHR_TEXTURE_BASISU:"KHR_texture_basisu",KHR_TEXTURE_TRANSFORM:"KHR_texture_transform",KHR_MESH_QUANTIZATION:"KHR_mesh_quantization",KHR_MATERIALS_EMISSIVE_STRENGTH:"KHR_materials_emissive_strength",EXT_MATERIALS_BUMP:"EXT_materials_bump",EXT_TEXTURE_WEBP:"EXT_texture_webp",EXT_TEXTURE_AVIF:"EXT_texture_avif",EXT_MESHOPT_COMPRESSION:"EXT_meshopt_compression",EXT_MESH_GPU_INSTANCING:"EXT_mesh_gpu_instancing"};class RI{constructor(t){this.parser=t,this.name=Ye.KHR_LIGHTS_PUNCTUAL,this.cache={refs:{},uses:{}}}_markDefs(){const t=this.parser,n=this.parser.json.nodes||[];for(let o=0,s=n.length;o<s;o++){const i=n[o];i.extensions&&i.extensions[this.name]&&i.extensions[this.name].light!==void 0&&t._addNodeRef(this.cache,i.extensions[this.name].light)}}_loadLight(t){const n=this.parser,o="light:"+t;let s=n.cache.get(o);if(s)return s;const i=n.json,c=((i.extensions&&i.extensions[this.name]||{}).lights||[])[t];let l;const u=new cs(16777215);c.color!==void 0&&u.setRGB(c.color[0],c.color[1],c.color[2],Ms);const _=c.range!==void 0?c.range:0;switch(c.type){case"directional":l=new vs(u),l.target.position.set(0,0,-1),l.add(l.target);break;case"point":l=new _i(u),l.distance=_;break;case"spot":l=new Zh(u),l.distance=_,c.spot=c.spot||{},c.spot.innerConeAngle=c.spot.innerConeAngle!==void 0?c.spot.innerConeAngle:0,c.spot.outerConeAngle=c.spot.outerConeAngle!==void 0?c.spot.outerConeAngle:Math.PI/4,l.angle=c.spot.outerConeAngle,l.penumbra=1-c.spot.innerConeAngle/c.spot.outerConeAngle,l.target.position.set(0,0,-1),l.add(l.target);break;default:throw new Error("THREE.GLTFLoader: Unexpected light type: "+c.type)}return l.position.set(0,0,0),hs(l,c),c.intensity!==void 0&&(l.intensity=c.intensity),l.name=n.createUniqueName(c.name||"light_"+t),s=Promise.resolve(l),n.cache.add(o,s),s}getDependency(t,n){if(t==="light")return this._loadLight(n)}createNodeAttachment(t){const n=this,o=this.parser,i=o.json.nodes[t],a=(i.extensions&&i.extensions[this.name]||{}).light;return a===void 0?null:this._loadLight(a).then(function(c){return o._getNodeRef(n.cache,a,c)})}}class OI{constructor(){this.name=Ye.KHR_MATERIALS_UNLIT}getMaterialType(){return zt}extendParams(t,n,o){const s=[];t.color=new cs(1,1,1),t.opacity=1;const i=n.pbrMetallicRoughness;if(i){if(Array.isArray(i.baseColorFactor)){const r=i.baseColorFactor;t.color.setRGB(r[0],r[1],r[2],Ms),t.opacity=r[3]}i.baseColorTexture!==void 0&&s.push(o.assignTexture(t,"map",i.baseColorTexture,tn))}return Promise.all(s)}}class DI{constructor(t){this.parser=t,this.name=Ye.KHR_MATERIALS_EMISSIVE_STRENGTH}extendMaterialParams(t,n){const s=this.parser.json.materials[t];if(!s.extensions||!s.extensions[this.name])return Promise.resolve();const i=s.extensions[this.name].emissiveStrength;return i!==void 0&&(n.emissiveIntensity=i),Promise.resolve()}}class NI{constructor(t){this.parser=t,this.name=Ye.KHR_MATERIALS_CLEARCOAT}getMaterialType(t){const o=this.parser.json.materials[t];return!o.extensions||!o.extensions[this.name]?null:Ps}extendMaterialParams(t,n){const o=this.parser,s=o.json.materials[t];if(!s.extensions||!s.extensions[this.name])return Promise.resolve();const i=[],r=s.extensions[this.name];if(r.clearcoatFactor!==void 0&&(n.clearcoat=r.clearcoatFactor),r.clearcoatTexture!==void 0&&i.push(o.assignTexture(n,"clearcoatMap",r.clearcoatTexture)),r.clearcoatRoughnessFactor!==void 0&&(n.clearcoatRoughness=r.clearcoatRoughnessFactor),r.clearcoatRoughnessTexture!==void 0&&i.push(o.assignTexture(n,"clearcoatRoughnessMap",r.clearcoatRoughnessTexture)),r.clearcoatNormalTexture!==void 0&&(i.push(o.assignTexture(n,"clearcoatNormalMap",r.clearcoatNormalTexture)),r.clearcoatNormalTexture.scale!==void 0)){const a=r.clearcoatNormalTexture.scale;n.clearcoatNormalScale=new $n(a,a)}return Promise.all(i)}}class jI{constructor(t){this.parser=t,this.name=Ye.KHR_MATERIALS_DISPERSION}getMaterialType(t){const o=this.parser.json.materials[t];return!o.extensions||!o.extensions[this.name]?null:Ps}extendMaterialParams(t,n){const s=this.parser.json.materials[t];if(!s.extensions||!s.extensions[this.name])return Promise.resolve();const i=s.extensions[this.name];return n.dispersion=i.dispersion!==void 0?i.dispersion:0,Promise.resolve()}}class HI{constructor(t){this.parser=t,this.name=Ye.KHR_MATERIALS_IRIDESCENCE}getMaterialType(t){const o=this.parser.json.materials[t];return!o.extensions||!o.extensions[this.name]?null:Ps}extendMaterialParams(t,n){const o=this.parser,s=o.json.materials[t];if(!s.extensions||!s.extensions[this.name])return Promise.resolve();const i=[],r=s.extensions[this.name];return r.iridescenceFactor!==void 0&&(n.iridescence=r.iridescenceFactor),r.iridescenceTexture!==void 0&&i.push(o.assignTexture(n,"iridescenceMap",r.iridescenceTexture)),r.iridescenceIor!==void 0&&(n.iridescenceIOR=r.iridescenceIor),n.iridescenceThicknessRange===void 0&&(n.iridescenceThicknessRange=[100,400]),r.iridescenceThicknessMinimum!==void 0&&(n.iridescenceThicknessRange[0]=r.iridescenceThicknessMinimum),r.iridescenceThicknessMaximum!==void 0&&(n.iridescenceThicknessRange[1]=r.iridescenceThicknessMaximum),r.iridescenceThicknessTexture!==void 0&&i.push(o.assignTexture(n,"iridescenceThicknessMap",r.iridescenceThicknessTexture)),Promise.all(i)}}class FI{constructor(t){this.parser=t,this.name=Ye.KHR_MATERIALS_SHEEN}getMaterialType(t){const o=this.parser.json.materials[t];return!o.extensions||!o.extensions[this.name]?null:Ps}extendMaterialParams(t,n){const o=this.parser,s=o.json.materials[t];if(!s.extensions||!s.extensions[this.name])return Promise.resolve();const i=[];n.sheenColor=new cs(0,0,0),n.sheenRoughness=0,n.sheen=1;const r=s.extensions[this.name];if(r.sheenColorFactor!==void 0){const a=r.sheenColorFactor;n.sheenColor.setRGB(a[0],a[1],a[2],Ms)}return r.sheenRoughnessFactor!==void 0&&(n.sheenRoughness=r.sheenRoughnessFactor),r.sheenColorTexture!==void 0&&i.push(o.assignTexture(n,"sheenColorMap",r.sheenColorTexture,tn)),r.sheenRoughnessTexture!==void 0&&i.push(o.assignTexture(n,"sheenRoughnessMap",r.sheenRoughnessTexture)),Promise.all(i)}}class UI{constructor(t){this.parser=t,this.name=Ye.KHR_MATERIALS_TRANSMISSION}getMaterialType(t){const o=this.parser.json.materials[t];return!o.extensions||!o.extensions[this.name]?null:Ps}extendMaterialParams(t,n){const o=this.parser,s=o.json.materials[t];if(!s.extensions||!s.extensions[this.name])return Promise.resolve();const i=[],r=s.extensions[this.name];return r.transmissionFactor!==void 0&&(n.transmission=r.transmissionFactor),r.transmissionTexture!==void 0&&i.push(o.assignTexture(n,"transmissionMap",r.transmissionTexture)),Promise.all(i)}}class BI{constructor(t){this.parser=t,this.name=Ye.KHR_MATERIALS_VOLUME}getMaterialType(t){const o=this.parser.json.materials[t];return!o.extensions||!o.extensions[this.name]?null:Ps}extendMaterialParams(t,n){const o=this.parser,s=o.json.materials[t];if(!s.extensions||!s.extensions[this.name])return Promise.resolve();const i=[],r=s.extensions[this.name];n.thickness=r.thicknessFactor!==void 0?r.thicknessFactor:0,r.thicknessTexture!==void 0&&i.push(o.assignTexture(n,"thicknessMap",r.thicknessTexture)),n.attenuationDistance=r.attenuationDistance||1/0;const a=r.attenuationColor||[1,1,1];return n.attenuationColor=new cs().setRGB(a[0],a[1],a[2],Ms),Promise.all(i)}}class zI{constructor(t){this.parser=t,this.name=Ye.KHR_MATERIALS_IOR}getMaterialType(t){const o=this.parser.json.materials[t];return!o.extensions||!o.extensions[this.name]?null:Ps}extendMaterialParams(t,n){const s=this.parser.json.materials[t];if(!s.extensions||!s.extensions[this.name])return Promise.resolve();const i=s.extensions[this.name];return n.ior=i.ior!==void 0?i.ior:1.5,Promise.resolve()}}class VI{constructor(t){this.parser=t,this.name=Ye.KHR_MATERIALS_SPECULAR}getMaterialType(t){const o=this.parser.json.materials[t];return!o.extensions||!o.extensions[this.name]?null:Ps}extendMaterialParams(t,n){const o=this.parser,s=o.json.materials[t];if(!s.extensions||!s.extensions[this.name])return Promise.resolve();const i=[],r=s.extensions[this.name];n.specularIntensity=r.specularFactor!==void 0?r.specularFactor:1,r.specularTexture!==void 0&&i.push(o.assignTexture(n,"specularIntensityMap",r.specularTexture));const a=r.specularColorFactor||[1,1,1];return n.specularColor=new cs().setRGB(a[0],a[1],a[2],Ms),r.specularColorTexture!==void 0&&i.push(o.assignTexture(n,"specularColorMap",r.specularColorTexture,tn)),Promise.all(i)}}class qI{constructor(t){this.parser=t,this.name=Ye.EXT_MATERIALS_BUMP}getMaterialType(t){const o=this.parser.json.materials[t];return!o.extensions||!o.extensions[this.name]?null:Ps}extendMaterialParams(t,n){const o=this.parser,s=o.json.materials[t];if(!s.extensions||!s.extensions[this.name])return Promise.resolve();const i=[],r=s.extensions[this.name];return n.bumpScale=r.bumpFactor!==void 0?r.bumpFactor:1,r.bumpTexture!==void 0&&i.push(o.assignTexture(n,"bumpMap",r.bumpTexture)),Promise.all(i)}}class WI{constructor(t){this.parser=t,this.name=Ye.KHR_MATERIALS_ANISOTROPY}getMaterialType(t){const o=this.parser.json.materials[t];return!o.extensions||!o.extensions[this.name]?null:Ps}extendMaterialParams(t,n){const o=this.parser,s=o.json.materials[t];if(!s.extensions||!s.extensions[this.name])return Promise.resolve();const i=[],r=s.extensions[this.name];return r.anisotropyStrength!==void 0&&(n.anisotropy=r.anisotropyStrength),r.anisotropyRotation!==void 0&&(n.anisotropyRotation=r.anisotropyRotation),r.anisotropyTexture!==void 0&&i.push(o.assignTexture(n,"anisotropyMap",r.anisotropyTexture)),Promise.all(i)}}class KI{constructor(t){this.parser=t,this.name=Ye.KHR_TEXTURE_BASISU}loadTexture(t){const n=this.parser,o=n.json,s=o.textures[t];if(!s.extensions||!s.extensions[this.name])return null;const i=s.extensions[this.name],r=n.options.ktx2Loader;if(!r){if(o.extensionsRequired&&o.extensionsRequired.indexOf(this.name)>=0)throw new Error("THREE.GLTFLoader: setKTX2Loader must be called before loading KTX2 textures");return null}return n.loadTextureImage(t,i.source,r)}}class JI{constructor(t){this.parser=t,this.name=Ye.EXT_TEXTURE_WEBP}loadTexture(t){const n=this.name,o=this.parser,s=o.json,i=s.textures[t];if(!i.extensions||!i.extensions[n])return null;const r=i.extensions[n],a=s.images[r.source];let c=o.textureLoader;if(a.uri){const l=o.options.manager.getHandler(a.uri);l!==null&&(c=l)}return o.loadTextureImage(t,r.source,c)}}class XI{constructor(t){this.parser=t,this.name=Ye.EXT_TEXTURE_AVIF}loadTexture(t){const n=this.name,o=this.parser,s=o.json,i=s.textures[t];if(!i.extensions||!i.extensions[n])return null;const r=i.extensions[n],a=s.images[r.source];let c=o.textureLoader;if(a.uri){const l=o.options.manager.getHandler(a.uri);l!==null&&(c=l)}return o.loadTextureImage(t,r.source,c)}}class YI{constructor(t){this.name=Ye.EXT_MESHOPT_COMPRESSION,this.parser=t}loadBufferView(t){const n=this.parser.json,o=n.bufferViews[t];if(o.extensions&&o.extensions[this.name]){const s=o.extensions[this.name],i=this.parser.getDependency("buffer",s.buffer),r=this.parser.options.meshoptDecoder;if(!r||!r.supported){if(n.extensionsRequired&&n.extensionsRequired.indexOf(this.name)>=0)throw new Error("THREE.GLTFLoader: setMeshoptDecoder must be called before loading compressed files");return null}return i.then(function(a){const c=s.byteOffset||0,l=s.byteLength||0,u=s.count,_=s.byteStride,$=new Uint8Array(a,c,l);return r.decodeGltfBufferAsync?r.decodeGltfBufferAsync(u,_,$,s.mode,s.filter).then(function(d){return d.buffer}):r.ready.then(function(){const d=new ArrayBuffer(u*_);return r.decodeGltfBuffer(new Uint8Array(d),u,_,$,s.mode,s.filter),d})})}else return null}}class ZI{constructor(t){this.name=Ye.EXT_MESH_GPU_INSTANCING,this.parser=t}createNodeMesh(t){const n=this.parser.json,o=n.nodes[t];if(!o.extensions||!o.extensions[this.name]||o.mesh===void 0)return null;const s=n.meshes[o.mesh];for(const l of s.primitives)if(l.mode!==Bn.TRIANGLES&&l.mode!==Bn.TRIANGLE_STRIP&&l.mode!==Bn.TRIANGLE_FAN&&l.mode!==void 0)return null;const r=o.extensions[this.name].attributes,a=[],c={};for(const l in r)a.push(this.parser.getDependency("accessor",r[l]).then(u=>(c[l]=u,c[l])));return a.length<1?null:(a.push(this.parser.createNodeMesh(t)),Promise.all(a).then(l=>{const u=l.pop(),_=u.isGroup?u.children:[u],$=l[0].count,d=[];for(const p of _){const b=new jo,g=new Ue,m=new Si,v=new Ue(1,1,1),y=new ad(p.geometry,p.material,$);for(let w=0;w<$;w++)c.TRANSLATION&&g.fromBufferAttribute(c.TRANSLATION,w),c.ROTATION&&m.fromBufferAttribute(c.ROTATION,w),c.SCALE&&v.fromBufferAttribute(c.SCALE,w),y.setMatrixAt(w,b.compose(g,m,v));for(const w in c)if(w==="_COLOR_0"){const k=c[w];y.instanceColor=new Qh(k.array,k.itemSize,k.normalized)}else w!=="TRANSLATION"&&w!=="ROTATION"&&w!=="SCALE"&&p.geometry.setAttribute(w,c[w]);cd.prototype.copy.call(y,p),this.parser.assignFinalMaterial(y),d.push(y)}return u.isGroup?(u.clear(),u.add(...d),u):d[0]}))}}const ch="glTF",ji=12,W$={JSON:1313821514,BIN:5130562};class QI{constructor(t){this.name=Ye.KHR_BINARY_GLTF,this.content=null,this.body=null;const n=new DataView(t,0,ji),o=new TextDecoder;if(this.header={magic:o.decode(new Uint8Array(t.slice(0,4))),version:n.getUint32(4,!0),length:n.getUint32(8,!0)},this.header.magic!==ch)throw new Error("THREE.GLTFLoader: Unsupported glTF-Binary header.");if(this.header.version<2)throw new Error("THREE.GLTFLoader: Legacy binary file detected.");const s=this.header.length-ji,i=new DataView(t,ji);let r=0;for(;r<s;){const a=i.getUint32(r,!0);r+=4;const c=i.getUint32(r,!0);if(r+=4,c===W$.JSON){const l=new Uint8Array(t,ji+r,a);this.content=o.decode(l)}else if(c===W$.BIN){const l=ji+r;this.body=t.slice(l,l+a)}r+=a}if(this.content===null)throw new Error("THREE.GLTFLoader: JSON content not found.")}}class e7{constructor(t,n){if(!n)throw new Error("THREE.GLTFLoader: No DRACOLoader instance provided.");this.name=Ye.KHR_DRACO_MESH_COMPRESSION,this.json=t,this.dracoLoader=n,this.dracoLoader.preload()}decodePrimitive(t,n){const o=this.json,s=this.dracoLoader,i=t.extensions[this.name].bufferView,r=t.extensions[this.name].attributes,a={},c={},l={};for(const u in r){const _=ru[u]||u.toLowerCase();a[_]=r[u]}for(const u in t.attributes){const _=ru[u]||u.toLowerCase();if(r[u]!==void 0){const $=o.accessors[t.attributes[u]],d=wi[$.componentType];l[_]=d.name,c[_]=$.normalized===!0}}return n.getDependency("bufferView",i).then(function(u){return new Promise(function(_,$){s.decodeDracoFile(u,function(d){for(const p in d.attributes){const b=d.attributes[p],g=c[p];g!==void 0&&(b.normalized=g)}_(d)},a,l,Ms,$)})})}}class t7{constructor(){this.name=Ye.KHR_TEXTURE_TRANSFORM}extendTexture(t,n){return(n.texCoord===void 0||n.texCoord===t.channel)&&n.offset===void 0&&n.rotation===void 0&&n.scale===void 0||(t=t.clone(),n.texCoord!==void 0&&(t.channel=n.texCoord),n.offset!==void 0&&t.offset.fromArray(n.offset),n.rotation!==void 0&&(t.rotation=n.rotation),n.scale!==void 0&&t.repeat.fromArray(n.scale),t.needsUpdate=!0),t}}class n7{constructor(){this.name=Ye.KHR_MESH_QUANTIZATION}}class lh extends w0{constructor(t,n,o,s){super(t,n,o,s)}copySampleValue_(t){const n=this.resultBuffer,o=this.sampleValues,s=this.valueSize,i=t*s*3+s;for(let r=0;r!==s;r++)n[r]=o[i+r];return n}interpolate_(t,n,o,s){const i=this.resultBuffer,r=this.sampleValues,a=this.valueSize,c=a*2,l=a*3,u=s-n,_=(o-n)/u,$=_*_,d=$*_,p=t*l,b=p-l,g=-2*d+3*$,m=d-$,v=1-g,y=m-$+_;for(let w=0;w!==a;w++){const k=r[b+w+a],I=r[b+w+c]*u,P=r[p+w+a],T=r[p+w]*u;i[w]=v*k+y*I+g*P+m*T}return i}}const s7=new Si;class o7 extends lh{interpolate_(t,n,o,s){const i=super.interpolate_(t,n,o,s);return s7.fromArray(i).normalize().toArray(i),i}}const Bn={POINTS:0,LINES:1,LINE_LOOP:2,LINE_STRIP:3,TRIANGLES:4,TRIANGLE_STRIP:5,TRIANGLE_FAN:6},wi={5120:Int8Array,5121:Uint8Array,5122:Int16Array,5123:Uint16Array,5125:Uint32Array,5126:Float32Array},K$={9728:ud,9729:vl,9984:o0,9985:s0,9986:n0,9987:ld},J$={33071:r0,33648:i0,10497:Bs},pl={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16},ru={POSITION:"position",NORMAL:"normal",TANGENT:"tangent",TEXCOORD_0:"uv",TEXCOORD_1:"uv1",TEXCOORD_2:"uv2",TEXCOORD_3:"uv3",COLOR_0:"color",WEIGHTS_0:"skinWeight",JOINTS_0:"skinIndex"},Qs={scale:"scale",translation:"position",rotation:"quaternion",weights:"morphTargetInfluences"},i7={CUBICSPLINE:void 0,LINEAR:dd,STEP:b0},ml={OPAQUE:"OPAQUE",MASK:"MASK",BLEND:"BLEND"};function r7(e){return e.DefaultMaterial===void 0&&(e.DefaultMaterial=new Bt({color:16777215,emissive:0,metalness:1,roughness:1,transparent:!1,depthTest:!0,side:v0})),e.DefaultMaterial}function Io(e,t,n){for(const o in n.extensions)e[o]===void 0&&(t.userData.gltfExtensions=t.userData.gltfExtensions||{},t.userData.gltfExtensions[o]=n.extensions[o])}function hs(e,t){t.extras!==void 0&&(typeof t.extras=="object"?Object.assign(e.userData,t.extras):console.warn("THREE.GLTFLoader: Ignoring primitive type .extras, "+t.extras))}function a7(e,t,n){let o=!1,s=!1,i=!1;for(let l=0,u=t.length;l<u;l++){const _=t[l];if(_.POSITION!==void 0&&(o=!0),_.NORMAL!==void 0&&(s=!0),_.COLOR_0!==void 0&&(i=!0),o&&s&&i)break}if(!o&&!s&&!i)return Promise.resolve(e);const r=[],a=[],c=[];for(let l=0,u=t.length;l<u;l++){const _=t[l];if(o){const $=_.POSITION!==void 0?n.getDependency("accessor",_.POSITION):e.attributes.position;r.push($)}if(s){const $=_.NORMAL!==void 0?n.getDependency("accessor",_.NORMAL):e.attributes.normal;a.push($)}if(i){const $=_.COLOR_0!==void 0?n.getDependency("accessor",_.COLOR_0):e.attributes.color;c.push($)}}return Promise.all([Promise.all(r),Promise.all(a),Promise.all(c)]).then(function(l){const u=l[0],_=l[1],$=l[2];return o&&(e.morphAttributes.position=u),s&&(e.morphAttributes.normal=_),i&&(e.morphAttributes.color=$),e.morphTargetsRelative=!0,e})}function c7(e,t){if(e.updateMorphTargets(),t.weights!==void 0)for(let n=0,o=t.weights.length;n<o;n++)e.morphTargetInfluences[n]=t.weights[n];if(t.extras&&Array.isArray(t.extras.targetNames)){const n=t.extras.targetNames;if(e.morphTargetInfluences.length===n.length){e.morphTargetDictionary={};for(let o=0,s=n.length;o<s;o++)e.morphTargetDictionary[n[o]]=o}else console.warn("THREE.GLTFLoader: Invalid extras.targetNames length. Ignoring names.")}}function l7(e){let t;const n=e.extensions&&e.extensions[Ye.KHR_DRACO_MESH_COMPRESSION];if(n?t="draco:"+n.bufferView+":"+n.indices+":"+fl(n.attributes):t=e.indices+":"+fl(e.attributes)+":"+e.mode,e.targets!==void 0)for(let o=0,s=e.targets.length;o<s;o++)t+=":"+fl(e.targets[o]);return t}function fl(e){let t="";const n=Object.keys(e).sort();for(let o=0,s=n.length;o<s;o++)t+=n[o]+":"+e[n[o]]+";";return t}function au(e){switch(e){case Int8Array:return 1/127;case Uint8Array:return 1/255;case Int16Array:return 1/32767;case Uint16Array:return 1/65535;default:throw new Error("THREE.GLTFLoader: Unsupported normalized accessor component type.")}}function u7(e){return e.search(/\.jpe?g($|\?)/i)>0||e.search(/^data\:image\/jpeg/)===0?"image/jpeg":e.search(/\.webp($|\?)/i)>0||e.search(/^data\:image\/webp/)===0?"image/webp":e.search(/\.ktx2($|\?)/i)>0||e.search(/^data\:image\/ktx2/)===0?"image/ktx2":"image/png"}const _7=new jo;class $7{constructor(t={},n={}){this.json=t,this.extensions={},this.plugins={},this.options=n,this.cache=new GI,this.associations=new Map,this.primitiveCache={},this.nodeCache={},this.meshCache={refs:{},uses:{}},this.cameraCache={refs:{},uses:{}},this.lightCache={refs:{},uses:{}},this.sourceCache={},this.textureCache={},this.nodeNamesUsed={};let o=!1,s=-1,i=!1,r=-1;if(typeof navigator<"u"){const a=navigator.userAgent;o=/^((?!chrome|android).)*safari/i.test(a)===!0;const c=a.match(/Version\/(\d+)/);s=o&&c?parseInt(c[1],10):-1,i=a.indexOf("Firefox")>-1,r=i?a.match(/Firefox\/([0-9]+)\./)[1]:-1}typeof createImageBitmap>"u"||o&&s<17||i&&r<98?this.textureLoader=new ki(this.options.manager):this.textureLoader=new e0(this.options.manager),this.textureLoader.setCrossOrigin(this.options.crossOrigin),this.textureLoader.setRequestHeader(this.options.requestHeader),this.fileLoader=new ba(this.options.manager),this.fileLoader.setResponseType("arraybuffer"),this.options.crossOrigin==="use-credentials"&&this.fileLoader.setWithCredentials(!0)}setExtensions(t){this.extensions=t}setPlugins(t){this.plugins=t}parse(t,n){const o=this,s=this.json,i=this.extensions;this.cache.removeAll(),this.nodeCache={},this._invokeAll(function(r){return r._markDefs&&r._markDefs()}),Promise.all(this._invokeAll(function(r){return r.beforeRoot&&r.beforeRoot()})).then(function(){return Promise.all([o.getDependencies("scene"),o.getDependencies("animation"),o.getDependencies("camera")])}).then(function(r){const a={scene:r[0][s.scene||0],scenes:r[0],animations:r[1],cameras:r[2],asset:s.asset,parser:o,userData:{}};return Io(i,a,s),hs(a,s),Promise.all(o._invokeAll(function(c){return c.afterRoot&&c.afterRoot(a)})).then(function(){for(const c of a.scenes)c.updateMatrixWorld();t(a)})}).catch(n)}_markDefs(){const t=this.json.nodes||[],n=this.json.skins||[],o=this.json.meshes||[];for(let s=0,i=n.length;s<i;s++){const r=n[s].joints;for(let a=0,c=r.length;a<c;a++)t[r[a]].isBone=!0}for(let s=0,i=t.length;s<i;s++){const r=t[s];r.mesh!==void 0&&(this._addNodeRef(this.meshCache,r.mesh),r.skin!==void 0&&(o[r.mesh].isSkinnedMesh=!0)),r.camera!==void 0&&this._addNodeRef(this.cameraCache,r.camera)}}_addNodeRef(t,n){n!==void 0&&(t.refs[n]===void 0&&(t.refs[n]=t.uses[n]=0),t.refs[n]++)}_getNodeRef(t,n,o){if(t.refs[n]<=1)return o;const s=o.clone(),i=(r,a)=>{const c=this.associations.get(r);c!=null&&this.associations.set(a,c);for(const[l,u]of r.children.entries())i(u,a.children[l])};return i(o,s),s.name+="_instance_"+t.uses[n]++,s}_invokeOne(t){const n=Object.values(this.plugins);n.push(this);for(let o=0;o<n.length;o++){const s=t(n[o]);if(s)return s}return null}_invokeAll(t){const n=Object.values(this.plugins);n.unshift(this);const o=[];for(let s=0;s<n.length;s++){const i=t(n[s]);i&&o.push(i)}return o}getDependency(t,n){const o=t+":"+n;let s=this.cache.get(o);if(!s){switch(t){case"scene":s=this.loadScene(n);break;case"node":s=this._invokeOne(function(i){return i.loadNode&&i.loadNode(n)});break;case"mesh":s=this._invokeOne(function(i){return i.loadMesh&&i.loadMesh(n)});break;case"accessor":s=this.loadAccessor(n);break;case"bufferView":s=this._invokeOne(function(i){return i.loadBufferView&&i.loadBufferView(n)});break;case"buffer":s=this.loadBuffer(n);break;case"material":s=this._invokeOne(function(i){return i.loadMaterial&&i.loadMaterial(n)});break;case"texture":s=this._invokeOne(function(i){return i.loadTexture&&i.loadTexture(n)});break;case"skin":s=this.loadSkin(n);break;case"animation":s=this._invokeOne(function(i){return i.loadAnimation&&i.loadAnimation(n)});break;case"camera":s=this.loadCamera(n);break;default:if(s=this._invokeOne(function(i){return i!=this&&i.getDependency&&i.getDependency(t,n)}),!s)throw new Error("Unknown type: "+t);break}this.cache.add(o,s)}return s}getDependencies(t){let n=this.cache.get(t);if(!n){const o=this,s=this.json[t+(t==="mesh"?"es":"s")]||[];n=Promise.all(s.map(function(i,r){return o.getDependency(t,r)})),this.cache.add(t,n)}return n}loadBuffer(t){const n=this.json.buffers[t],o=this.fileLoader;if(n.type&&n.type!=="arraybuffer")throw new Error("THREE.GLTFLoader: "+n.type+" buffer type is not supported.");if(n.uri===void 0&&t===0)return Promise.resolve(this.extensions[Ye.KHR_BINARY_GLTF].body);const s=this.options;return new Promise(function(i,r){o.load(Wi.resolveURL(n.uri,s.path),i,void 0,function(){r(new Error('THREE.GLTFLoader: Failed to load buffer "'+n.uri+'".'))})})}loadBufferView(t){const n=this.json.bufferViews[t];return this.getDependency("buffer",n.buffer).then(function(o){const s=n.byteLength||0,i=n.byteOffset||0;return o.slice(i,i+s)})}loadAccessor(t){const n=this,o=this.json,s=this.json.accessors[t];if(s.bufferView===void 0&&s.sparse===void 0){const r=pl[s.type],a=wi[s.componentType],c=s.normalized===!0,l=new a(s.count*r);return Promise.resolve(new Ki(l,r,c))}const i=[];return s.bufferView!==void 0?i.push(this.getDependency("bufferView",s.bufferView)):i.push(null),s.sparse!==void 0&&(i.push(this.getDependency("bufferView",s.sparse.indices.bufferView)),i.push(this.getDependency("bufferView",s.sparse.values.bufferView))),Promise.all(i).then(function(r){const a=r[0],c=pl[s.type],l=wi[s.componentType],u=l.BYTES_PER_ELEMENT,_=u*c,$=s.byteOffset||0,d=s.bufferView!==void 0?o.bufferViews[s.bufferView].byteStride:void 0,p=s.normalized===!0;let b,g;if(d&&d!==_){const m=Math.floor($/d),v="InterleavedBuffer:"+s.bufferView+":"+s.componentType+":"+m+":"+s.count;let y=n.cache.get(v);y||(b=new l(a,m*d,s.count*d/u),y=new t0(b,d/u),n.cache.add(v,y)),g=new y0(y,c,$%d/u,p)}else a===null?b=new l(s.count*c):b=new l(a,$,s.count*c),g=new Ki(b,c,p);if(s.sparse!==void 0){const m=pl.SCALAR,v=wi[s.sparse.indices.componentType],y=s.sparse.indices.byteOffset||0,w=s.sparse.values.byteOffset||0,k=new v(r[1],y,s.sparse.count*m),I=new l(r[2],w,s.sparse.count*c);a!==null&&(g=new Ki(g.array.slice(),g.itemSize,g.normalized)),g.normalized=!1;for(let P=0,T=k.length;P<T;P++){const x=k[P];if(g.setX(x,I[P*c]),c>=2&&g.setY(x,I[P*c+1]),c>=3&&g.setZ(x,I[P*c+2]),c>=4&&g.setW(x,I[P*c+3]),c>=5)throw new Error("THREE.GLTFLoader: Unsupported itemSize in sparse BufferAttribute.")}g.normalized=p}return g})}loadTexture(t){const n=this.json,o=this.options,i=n.textures[t].source,r=n.images[i];let a=this.textureLoader;if(r.uri){const c=o.manager.getHandler(r.uri);c!==null&&(a=c)}return this.loadTextureImage(t,i,a)}loadTextureImage(t,n,o){const s=this,i=this.json,r=i.textures[t],a=i.images[n],c=(a.uri||a.bufferView)+":"+r.sampler;if(this.textureCache[c])return this.textureCache[c];const l=this.loadImageSource(n,o).then(function(u){u.flipY=!1,u.name=r.name||a.name||"",u.name===""&&typeof a.uri=="string"&&a.uri.startsWith("data:image/")===!1&&(u.name=a.uri);const $=(i.samplers||{})[r.sampler]||{};return u.magFilter=K$[$.magFilter]||vl,u.minFilter=K$[$.minFilter]||ld,u.wrapS=J$[$.wrapS]||Bs,u.wrapT=J$[$.wrapT]||Bs,u.generateMipmaps=!u.isCompressedTexture&&u.minFilter!==ud&&u.minFilter!==vl,s.associations.set(u,{textures:t}),u}).catch(function(){return null});return this.textureCache[c]=l,l}loadImageSource(t,n){const o=this,s=this.json,i=this.options;if(this.sourceCache[t]!==void 0)return this.sourceCache[t].then(_=>_.clone());const r=s.images[t],a=self.URL||self.webkitURL;let c=r.uri||"",l=!1;if(r.bufferView!==void 0)c=o.getDependency("bufferView",r.bufferView).then(function(_){l=!0;const $=new Blob([_],{type:r.mimeType});return c=a.createObjectURL($),c});else if(r.uri===void 0)throw new Error("THREE.GLTFLoader: Image "+t+" is missing URI and bufferView");const u=Promise.resolve(c).then(function(_){return new Promise(function($,d){let p=$;n.isImageBitmapLoader===!0&&(p=function(b){const g=new $_(b);g.needsUpdate=!0,$(g)}),n.load(Wi.resolveURL(_,i.path),p,void 0,d)})}).then(function(_){return l===!0&&a.revokeObjectURL(c),hs(_,r),_.userData.mimeType=r.mimeType||u7(r.uri),_}).catch(function(_){throw console.error("THREE.GLTFLoader: Couldn't load texture",c),_});return this.sourceCache[t]=u,u}assignTexture(t,n,o,s){const i=this;return this.getDependency("texture",o.index).then(function(r){if(!r)return null;if(o.texCoord!==void 0&&o.texCoord>0&&(r=r.clone(),r.channel=o.texCoord),i.extensions[Ye.KHR_TEXTURE_TRANSFORM]){const a=o.extensions!==void 0?o.extensions[Ye.KHR_TEXTURE_TRANSFORM]:void 0;if(a){const c=i.associations.get(r);r=i.extensions[Ye.KHR_TEXTURE_TRANSFORM].extendTexture(r,a),i.associations.set(r,c)}}return s!==void 0&&(r.colorSpace=s),t[n]=r,r})}assignFinalMaterial(t){const n=t.geometry;let o=t.material;const s=n.attributes.tangent===void 0,i=n.attributes.color!==void 0,r=n.attributes.normal===void 0;if(t.isPoints){const a="PointsMaterial:"+o.uuid;let c=this.cache.get(a);c||(c=new a0,Bc.prototype.copy.call(c,o),c.color.copy(o.color),c.map=o.map,c.sizeAttenuation=!1,this.cache.add(a,c)),o=c}else if(t.isLine){const a="LineBasicMaterial:"+o.uuid;let c=this.cache.get(a);c||(c=new c0,Bc.prototype.copy.call(c,o),c.color.copy(o.color),c.map=o.map,this.cache.add(a,c)),o=c}if(s||i||r){let a="ClonedMaterial:"+o.uuid+":";s&&(a+="derivative-tangents:"),i&&(a+="vertex-colors:"),r&&(a+="flat-shading:");let c=this.cache.get(a);c||(c=o.clone(),i&&(c.vertexColors=!0),r&&(c.flatShading=!0),s&&(c.normalScale&&(c.normalScale.y*=-1),c.clearcoatNormalScale&&(c.clearcoatNormalScale.y*=-1)),this.cache.add(a,c),this.associations.set(c,this.associations.get(o))),o=c}t.material=o}getMaterialType(){return Bt}loadMaterial(t){const n=this,o=this.json,s=this.extensions,i=o.materials[t];let r;const a={},c=i.extensions||{},l=[];if(c[Ye.KHR_MATERIALS_UNLIT]){const _=s[Ye.KHR_MATERIALS_UNLIT];r=_.getMaterialType(),l.push(_.extendParams(a,i,n))}else{const _=i.pbrMetallicRoughness||{};if(a.color=new cs(1,1,1),a.opacity=1,Array.isArray(_.baseColorFactor)){const $=_.baseColorFactor;a.color.setRGB($[0],$[1],$[2],Ms),a.opacity=$[3]}_.baseColorTexture!==void 0&&l.push(n.assignTexture(a,"map",_.baseColorTexture,tn)),a.metalness=_.metallicFactor!==void 0?_.metallicFactor:1,a.roughness=_.roughnessFactor!==void 0?_.roughnessFactor:1,_.metallicRoughnessTexture!==void 0&&(l.push(n.assignTexture(a,"metalnessMap",_.metallicRoughnessTexture)),l.push(n.assignTexture(a,"roughnessMap",_.metallicRoughnessTexture))),r=this._invokeOne(function($){return $.getMaterialType&&$.getMaterialType(t)}),l.push(Promise.all(this._invokeAll(function($){return $.extendMaterialParams&&$.extendMaterialParams(t,a)})))}i.doubleSided===!0&&(a.side=Pn);const u=i.alphaMode||ml.OPAQUE;if(u===ml.BLEND?(a.transparent=!0,a.depthWrite=!1):(a.transparent=!1,u===ml.MASK&&(a.alphaTest=i.alphaCutoff!==void 0?i.alphaCutoff:.5)),i.normalTexture!==void 0&&r!==zt&&(l.push(n.assignTexture(a,"normalMap",i.normalTexture)),a.normalScale=new $n(1,1),i.normalTexture.scale!==void 0)){const _=i.normalTexture.scale;a.normalScale.set(_,_)}if(i.occlusionTexture!==void 0&&r!==zt&&(l.push(n.assignTexture(a,"aoMap",i.occlusionTexture)),i.occlusionTexture.strength!==void 0&&(a.aoMapIntensity=i.occlusionTexture.strength)),i.emissiveFactor!==void 0&&r!==zt){const _=i.emissiveFactor;a.emissive=new cs().setRGB(_[0],_[1],_[2],Ms)}return i.emissiveTexture!==void 0&&r!==zt&&l.push(n.assignTexture(a,"emissiveMap",i.emissiveTexture,tn)),Promise.all(l).then(function(){const _=new r(a);return i.name&&(_.name=i.name),hs(_,i),n.associations.set(_,{materials:t}),i.extensions&&Io(s,_,i),_})}createUniqueName(t){const n=l0.sanitizeNodeName(t||"");return n in this.nodeNamesUsed?n+"_"+ ++this.nodeNamesUsed[n]:(this.nodeNamesUsed[n]=0,n)}loadGeometries(t){const n=this,o=this.extensions,s=this.primitiveCache;function i(a){return o[Ye.KHR_DRACO_MESH_COMPRESSION].decodePrimitive(a,n).then(function(c){return X$(c,a,n)})}const r=[];for(let a=0,c=t.length;a<c;a++){const l=t[a],u=l7(l),_=s[u];if(_)r.push(_.promise);else{let $;l.extensions&&l.extensions[Ye.KHR_DRACO_MESH_COMPRESSION]?$=i(l):$=X$(new _d,l,n),s[u]={primitive:l,promise:$},r.push($)}}return Promise.all(r)}loadMesh(t){const n=this,o=this.json,s=this.extensions,i=o.meshes[t],r=i.primitives,a=[];for(let c=0,l=r.length;c<l;c++){const u=r[c].material===void 0?r7(this.cache):this.getDependency("material",r[c].material);a.push(u)}return a.push(n.loadGeometries(r)),Promise.all(a).then(function(c){const l=c.slice(0,c.length-1),u=c[c.length-1],_=[];for(let d=0,p=u.length;d<p;d++){const b=u[d],g=r[d];let m;const v=l[d];if(g.mode===Bn.TRIANGLES||g.mode===Bn.TRIANGLE_STRIP||g.mode===Bn.TRIANGLE_FAN||g.mode===void 0)m=i.isSkinnedMesh===!0?new u0(b,v):new St(b,v),m.isSkinnedMesh===!0&&m.normalizeSkinWeights(),g.mode===Bn.TRIANGLE_STRIP?m.geometry=q$(m.geometry,id):g.mode===Bn.TRIANGLE_FAN&&(m.geometry=q$(m.geometry,yl));else if(g.mode===Bn.LINES)m=new _0(b,v);else if(g.mode===Bn.LINE_STRIP)m=new $0(b,v);else if(g.mode===Bn.LINE_LOOP)m=new d0(b,v);else if(g.mode===Bn.POINTS)m=new p0(b,v);else throw new Error("THREE.GLTFLoader: Primitive mode unsupported: "+g.mode);Object.keys(m.geometry.morphAttributes).length>0&&c7(m,i),m.name=n.createUniqueName(i.name||"mesh_"+t),hs(m,i),g.extensions&&Io(s,m,g),n.assignFinalMaterial(m),_.push(m)}for(let d=0,p=_.length;d<p;d++)n.associations.set(_[d],{meshes:t,primitives:d});if(_.length===1)return i.extensions&&Io(s,_[0],i),_[0];const $=new ns;i.extensions&&Io(s,$,i),n.associations.set($,{meshes:t});for(let d=0,p=_.length;d<p;d++)$.add(_[d]);return $})}loadCamera(t){let n;const o=this.json.cameras[t],s=o[o.type];if(!s){console.warn("THREE.GLTFLoader: Missing camera parameters.");return}return o.type==="perspective"?n=new Ir($d.radToDeg(s.yfov),s.aspectRatio||1,s.znear||1,s.zfar||2e6):o.type==="orthographic"&&(n=new m0(-s.xmag,s.xmag,s.ymag,-s.ymag,s.znear,s.zfar)),o.name&&(n.name=this.createUniqueName(o.name)),hs(n,o),Promise.resolve(n)}loadSkin(t){const n=this.json.skins[t],o=[];for(let s=0,i=n.joints.length;s<i;s++)o.push(this._loadNodeShallow(n.joints[s]));return n.inverseBindMatrices!==void 0?o.push(this.getDependency("accessor",n.inverseBindMatrices)):o.push(null),Promise.all(o).then(function(s){const i=s.pop(),r=s,a=[],c=[];for(let l=0,u=r.length;l<u;l++){const _=r[l];if(_){a.push(_);const $=new jo;i!==null&&$.fromArray(i.array,l*16),c.push($)}else console.warn('THREE.GLTFLoader: Joint "%s" could not be found.',n.joints[l])}return new f0(a,c)})}loadAnimation(t){const n=this.json,o=this,s=n.animations[t],i=s.name?s.name:"animation_"+t,r=[],a=[],c=[],l=[],u=[];for(let _=0,$=s.channels.length;_<$;_++){const d=s.channels[_],p=s.samplers[d.sampler],b=d.target,g=b.node,m=s.parameters!==void 0?s.parameters[p.input]:p.input,v=s.parameters!==void 0?s.parameters[p.output]:p.output;b.node!==void 0&&(r.push(this.getDependency("node",g)),a.push(this.getDependency("accessor",m)),c.push(this.getDependency("accessor",v)),l.push(p),u.push(b))}return Promise.all([Promise.all(r),Promise.all(a),Promise.all(c),Promise.all(l),Promise.all(u)]).then(function(_){const $=_[0],d=_[1],p=_[2],b=_[3],g=_[4],m=[];for(let y=0,w=$.length;y<w;y++){const k=$[y],I=d[y],P=p[y],T=b[y],x=g[y];if(k===void 0)continue;k.updateMatrix&&k.updateMatrix();const D=o._createAnimationTracks(k,I,P,T,x);if(D)for(let U=0;U<D.length;U++)m.push(D[U])}const v=new h0(i,void 0,m);return hs(v,s),v})}createNodeMesh(t){const n=this.json,o=this,s=n.nodes[t];return s.mesh===void 0?null:o.getDependency("mesh",s.mesh).then(function(i){const r=o._getNodeRef(o.meshCache,s.mesh,i);return s.weights!==void 0&&r.traverse(function(a){if(a.isMesh)for(let c=0,l=s.weights.length;c<l;c++)a.morphTargetInfluences[c]=s.weights[c]}),r})}loadNode(t){const n=this.json,o=this,s=n.nodes[t],i=o._loadNodeShallow(t),r=[],a=s.children||[];for(let l=0,u=a.length;l<u;l++)r.push(o.getDependency("node",a[l]));const c=s.skin===void 0?Promise.resolve(null):o.getDependency("skin",s.skin);return Promise.all([i,Promise.all(r),c]).then(function(l){const u=l[0],_=l[1],$=l[2];$!==null&&u.traverse(function(d){d.isSkinnedMesh&&d.bind($,_7)});for(let d=0,p=_.length;d<p;d++)u.add(_[d]);return u})}_loadNodeShallow(t){const n=this.json,o=this.extensions,s=this;if(this.nodeCache[t]!==void 0)return this.nodeCache[t];const i=n.nodes[t],r=i.name?s.createUniqueName(i.name):"",a=[],c=s._invokeOne(function(l){return l.createNodeMesh&&l.createNodeMesh(t)});return c&&a.push(c),i.camera!==void 0&&a.push(s.getDependency("camera",i.camera).then(function(l){return s._getNodeRef(s.cameraCache,i.camera,l)})),s._invokeAll(function(l){return l.createNodeAttachment&&l.createNodeAttachment(t)}).forEach(function(l){a.push(l)}),this.nodeCache[t]=Promise.all(a).then(function(l){let u;if(i.isBone===!0?u=new g0:l.length>1?u=new ns:l.length===1?u=l[0]:u=new cd,u!==l[0])for(let _=0,$=l.length;_<$;_++)u.add(l[_]);if(i.name&&(u.userData.name=i.name,u.name=r),hs(u,i),i.extensions&&Io(o,u,i),i.matrix!==void 0){const _=new jo;_.fromArray(i.matrix),u.applyMatrix4(_)}else i.translation!==void 0&&u.position.fromArray(i.translation),i.rotation!==void 0&&u.quaternion.fromArray(i.rotation),i.scale!==void 0&&u.scale.fromArray(i.scale);if(!s.associations.has(u))s.associations.set(u,{});else if(i.mesh!==void 0&&s.meshCache.refs[i.mesh]>1){const _=s.associations.get(u);s.associations.set(u,{..._})}return s.associations.get(u).nodes=t,u}),this.nodeCache[t]}loadScene(t){const n=this.extensions,o=this.json.scenes[t],s=this,i=new ns;o.name&&(i.name=s.createUniqueName(o.name)),hs(i,o),o.extensions&&Io(n,i,o);const r=o.nodes||[],a=[];for(let c=0,l=r.length;c<l;c++)a.push(s.getDependency("node",r[c]));return Promise.all(a).then(function(c){for(let u=0,_=c.length;u<_;u++)i.add(c[u]);const l=u=>{const _=new Map;for(const[$,d]of s.associations)($ instanceof Bc||$ instanceof $_)&&_.set($,d);return u.traverse($=>{const d=s.associations.get($);d!=null&&_.set($,d)}),_};return s.associations=l(i),i})}_createAnimationTracks(t,n,o,s,i){const r=[],a=t.name?t.name:t.uuid,c=[];Qs[i.path]===Qs.weights?t.traverse(function($){$.morphTargetInfluences&&c.push($.name?$.name:$.uuid)}):c.push(a);let l;switch(Qs[i.path]){case Qs.weights:l=p_;break;case Qs.rotation:l=m_;break;case Qs.translation:case Qs.scale:l=d_;break;default:switch(o.itemSize){case 1:l=p_;break;case 2:case 3:default:l=d_;break}break}const u=s.interpolation!==void 0?i7[s.interpolation]:dd,_=this._getArrayFromAccessor(o);for(let $=0,d=c.length;$<d;$++){const p=new l(c[$]+"."+Qs[i.path],n.array,_,u);s.interpolation==="CUBICSPLINE"&&this._createCubicSplineTrackInterpolant(p),r.push(p)}return r}_getArrayFromAccessor(t){let n=t.array;if(t.normalized){const o=au(n.constructor),s=new Float32Array(n.length);for(let i=0,r=n.length;i<r;i++)s[i]=n[i]*o;n=s}return n}_createCubicSplineTrackInterpolant(t){t.createInterpolant=function(o){const s=this instanceof m_?o7:lh;return new s(this.times,this.values,this.getValueSize()/3,o)},t.createInterpolant.isInterpolantFactoryMethodGLTFCubicSpline=!0}}function d7(e,t,n){const o=t.attributes,s=new pn;if(o.POSITION!==void 0){const a=n.json.accessors[o.POSITION],c=a.min,l=a.max;if(c!==void 0&&l!==void 0){if(s.set(new Ue(c[0],c[1],c[2]),new Ue(l[0],l[1],l[2])),a.normalized){const u=au(wi[a.componentType]);s.min.multiplyScalar(u),s.max.multiplyScalar(u)}}else{console.warn("THREE.GLTFLoader: Missing min/max properties for accessor POSITION.");return}}else return;const i=t.targets;if(i!==void 0){const a=new Ue,c=new Ue;for(let l=0,u=i.length;l<u;l++){const _=i[l];if(_.POSITION!==void 0){const $=n.json.accessors[_.POSITION],d=$.min,p=$.max;if(d!==void 0&&p!==void 0){if(c.setX(Math.max(Math.abs(d[0]),Math.abs(p[0]))),c.setY(Math.max(Math.abs(d[1]),Math.abs(p[1]))),c.setZ(Math.max(Math.abs(d[2]),Math.abs(p[2]))),$.normalized){const b=au(wi[$.componentType]);c.multiplyScalar(b)}a.max(c)}else console.warn("THREE.GLTFLoader: Missing min/max properties for accessor POSITION.")}}s.expandByVector(a)}e.boundingBox=s;const r=new S0;s.getCenter(r.center),r.radius=s.min.distanceTo(s.max)/2,e.boundingSphere=r}function X$(e,t,n){const o=t.attributes,s=[];function i(r,a){return n.getDependency("accessor",r).then(function(c){e.setAttribute(a,c)})}for(const r in o){const a=ru[r]||r.toLowerCase();a in e.attributes||s.push(i(o[r],a))}if(t.indices!==void 0&&!e.index){const r=n.getDependency("accessor",t.indices).then(function(a){e.setIndex(a)});s.push(r)}return wl.workingColorSpace!==Ms&&"COLOR_0"in o&&console.warn(`THREE.GLTFLoader: Converting vertex colors from "srgb-linear" to "${wl.workingColorSpace}" not supported.`),hs(e,t),d7(e,t,n),Promise.all(s).then(function(){return t.targets!==void 0?a7(e,t.targets,n):e})}const hl=new WeakMap;class Nc extends rd{constructor(t){super(t),this.decoderPath="",this.decoderConfig={},this.decoderBinary=null,this.decoderPending=null,this.workerLimit=4,this.workerPool=[],this.workerNextTaskID=1,this.workerSourceURL="",this.defaultAttributeIDs={position:"POSITION",normal:"NORMAL",color:"COLOR",uv:"TEX_COORD"},this.defaultAttributeTypes={position:"Float32Array",normal:"Float32Array",color:"Float32Array",uv:"Float32Array"}}setDecoderPath(t){return this.decoderPath=t,this}setDecoderConfig(t){return this.decoderConfig=t,this}setWorkerLimit(t){return this.workerLimit=t,this}load(t,n,o,s){const i=new ba(this.manager);i.setPath(this.path),i.setResponseType("arraybuffer"),i.setRequestHeader(this.requestHeader),i.setWithCredentials(this.withCredentials),i.load(t,r=>{this.parse(r,n,s)},o,s)}parse(t,n,o=()=>{}){this.decodeDracoFile(t,n,null,null,tn,o).catch(o)}decodeDracoFile(t,n,o,s,i=Ms,r=()=>{}){const a={attributeIDs:o||this.defaultAttributeIDs,attributeTypes:s||this.defaultAttributeTypes,useUniqueIDs:!!o,vertexColorSpace:i};return this.decodeGeometry(t,a).then(n).catch(r)}decodeGeometry(t,n){const o=JSON.stringify(n);if(hl.has(t)){const c=hl.get(t);if(c.key===o)return c.promise;if(t.byteLength===0)throw new Error("THREE.DRACOLoader: Unable to re-decode a buffer with different settings. Buffer has already been transferred.")}let s;const i=this.workerNextTaskID++,r=t.byteLength,a=this._getWorker(i,r).then(c=>(s=c,new Promise((l,u)=>{s._callbacks[i]={resolve:l,reject:u},s.postMessage({type:"decode",id:i,taskConfig:n,buffer:t},[t])}))).then(c=>this._createGeometry(c.geometry));return a.catch(()=>!0).then(()=>{s&&i&&this._releaseTask(s,i)}),hl.set(t,{key:o,promise:a}),a}_createGeometry(t){const n=new _d;t.index&&n.setIndex(new Ki(t.index.array,1));for(let o=0;o<t.attributes.length;o++){const s=t.attributes[o],i=s.name,r=s.array,a=s.itemSize,c=new Ki(r,a);i==="color"&&(this._assignVertexColorSpace(c,s.vertexColorSpace),c.normalized=!(r instanceof Float32Array)),n.setAttribute(i,c)}return n}_assignVertexColorSpace(t,n){if(n!==tn)return;const o=new cs;for(let s=0,i=t.count;s<i;s++)o.fromBufferAttribute(t,s),wl.colorSpaceToWorking(o,tn),t.setXYZ(s,o.r,o.g,o.b)}_loadLibrary(t,n){const o=new ba(this.manager);return o.setPath(this.decoderPath),o.setResponseType(n),o.setWithCredentials(this.withCredentials),new Promise((s,i)=>{o.load(t,s,void 0,i)})}preload(){return this._initDecoder(),this}_initDecoder(){if(this.decoderPending)return this.decoderPending;const t=typeof WebAssembly!="object"||this.decoderConfig.type==="js",n=[];return t?n.push(this._loadLibrary("draco_decoder.js","text")):(n.push(this._loadLibrary("draco_wasm_wrapper.js","text")),n.push(this._loadLibrary("draco_decoder.wasm","arraybuffer"))),this.decoderPending=Promise.all(n).then(o=>{const s=o[0];t||(this.decoderConfig.wasmBinary=o[1]);const i=p7.toString(),r=["/* draco decoder */",s,"","/* worker */",i.substring(i.indexOf("{")+1,i.lastIndexOf("}"))].join(`
`);this.workerSourceURL=URL.createObjectURL(new Blob([r]))}),this.decoderPending}_getWorker(t,n){return this._initDecoder().then(()=>{if(this.workerPool.length<this.workerLimit){const s=new Worker(this.workerSourceURL);s._callbacks={},s._taskCosts={},s._taskLoad=0,s.postMessage({type:"init",decoderConfig:this.decoderConfig}),s.onmessage=function(i){const r=i.data;switch(r.type){case"decode":s._callbacks[r.id].resolve(r);break;case"error":s._callbacks[r.id].reject(r);break;default:console.error('THREE.DRACOLoader: Unexpected message, "'+r.type+'"')}},this.workerPool.push(s)}else this.workerPool.sort(function(s,i){return s._taskLoad>i._taskLoad?-1:1});const o=this.workerPool[this.workerPool.length-1];return o._taskCosts[t]=n,o._taskLoad+=n,o})}_releaseTask(t,n){t._taskLoad-=t._taskCosts[n],delete t._callbacks[n],delete t._taskCosts[n]}debug(){console.log("Task load: ",this.workerPool.map(t=>t._taskLoad))}dispose(){for(let t=0;t<this.workerPool.length;++t)this.workerPool[t].terminate();return this.workerPool.length=0,this.workerSourceURL!==""&&URL.revokeObjectURL(this.workerSourceURL),this}}function p7(){let e,t;onmessage=function(r){const a=r.data;switch(a.type){case"init":e=a.decoderConfig,t=new Promise(function(u){e.onModuleLoaded=function(_){u({draco:_})},DracoDecoderModule(e)});break;case"decode":const c=a.buffer,l=a.taskConfig;t.then(u=>{const _=u.draco,$=new _.Decoder;try{const d=n(_,$,new Int8Array(c),l),p=d.attributes.map(b=>b.array.buffer);d.index&&p.push(d.index.array.buffer),self.postMessage({type:"decode",id:a.id,geometry:d},p)}catch(d){console.error(d),self.postMessage({type:"error",id:a.id,error:d.message})}finally{_.destroy($)}});break}};function n(r,a,c,l){const u=l.attributeIDs,_=l.attributeTypes;let $,d;const p=a.GetEncodedGeometryType(c);if(p===r.TRIANGULAR_MESH)$=new r.Mesh,d=a.DecodeArrayToMesh(c,c.byteLength,$);else if(p===r.POINT_CLOUD)$=new r.PointCloud,d=a.DecodeArrayToPointCloud(c,c.byteLength,$);else throw new Error("THREE.DRACOLoader: Unexpected geometry type.");if(!d.ok()||$.ptr===0)throw new Error("THREE.DRACOLoader: Decoding failed: "+d.error_msg());const b={index:null,attributes:[]};for(const g in u){const m=self[_[g]];let v,y;if(l.useUniqueIDs)y=u[g],v=a.GetAttributeByUniqueId($,y);else{if(y=a.GetAttributeId($,r[u[g]]),y===-1)continue;v=a.GetAttribute($,y)}const w=s(r,a,$,g,m,v);g==="color"&&(w.vertexColorSpace=l.vertexColorSpace),b.attributes.push(w)}return p===r.TRIANGULAR_MESH&&(b.index=o(r,a,$)),r.destroy($),b}function o(r,a,c){const u=c.num_faces()*3,_=u*4,$=r._malloc(_);a.GetTrianglesUInt32Array(c,_,$);const d=new Uint32Array(r.HEAPF32.buffer,$,u).slice();return r._free($),{array:d,itemSize:1}}function s(r,a,c,l,u,_){const $=_.num_components(),p=c.num_points()*$,b=p*u.BYTES_PER_ELEMENT,g=i(r,u),m=r._malloc(b);a.GetAttributeDataArrayForAllPoints(c,_,g,b,m);const v=new u(r.HEAPF32.buffer,m,p).slice();return r._free(m),{name:l,array:v,itemSize:$}}function i(r,a){switch(a){case Float32Array:return r.DT_FLOAT32;case Int8Array:return r.DT_INT8;case Int16Array:return r.DT_INT16;case Int32Array:return r.DT_INT32;case Uint8Array:return r.DT_UINT8;case Uint16Array:return r.DT_UINT16;case Uint32Array:return r.DT_UINT32}}}class m7{constructor(){this.gltfCache=new Map,this.modelPool=new Map,this.instancedMeshes=new Map,this.gltfLoader=null,this.dracoLoader=null,this.maxCacheSize=50,this.maxInstancesPerModel=1e3,this.preloadStatus=new Map,this.preloadQueue=[],this.initLoaders()}initLoaders(){this.gltfLoader||(this.gltfLoader=new Dc,this.gltfLoader.setCrossOrigin("anonymous"),this.dracoLoader=new Nc,this.dracoLoader.setDecoderPath("https://www.gstatic.com/draco/versioned/decoders/1.5.6/"),this.dracoLoader.setCrossOrigin("anonymous"),this.gltfLoader.setDRACOLoader(this.dracoLoader),f("[ModelCache] GLTFDraco"))}async loadModel(t,n=!0){if(n&&this.modelPool.has(t)){const i=this.modelPool.get(t);return f(`[ModelCache] : ${t}`),i.clone(!0)}let o;if(this.gltfCache.has(t))f(`[ModelCache] GLTF: ${t}`),o=this.gltfCache.get(t);else try{const r=await(await Ep(t)).arrayBuffer();f(`[ModelCache] GLTF: ${t}`),o=await new Promise((a,c)=>{this.gltfLoader.parse(r,"",l=>a(l),l=>c(l))}),this.cacheGLTF(t,o)}catch(i){throw f(`[ModelCache] : ${t}`,i),i}const s=o.scene.clone(!0);return n&&this.addToModelPool(t,s),s}async createInstancedMesh(t,n=100){if(this.instancedMeshes.has(t))return f(`[ModelCache] : ${t}`),this.instancedMeshes.get(t);const o=await this.loadModel(t,!0),s=[];if(o.traverse(c=>{c.isMesh&&s.push(c)}),s.length===0)throw new Error(`[ModelCache] : ${t}`);const i=s[0],r=new ad(i.geometry,i.material,n),a=new jo;for(let c=0;c<n;c++)a.setPosition(0,-1e3,0),r.setMatrixAt(c,a);return r.instanceMatrix.needsUpdate=!0,this.instancedMeshes.set(t,r),f(`[ModelCache] : ${t}, : ${n}`),r}updateInstancedMeshInstance(t,n,o,s,i){const r=this.instancedMeshes.get(t);if(!r){f(`[ModelCache] : ${t}`);return}if(n>=r.count){f(`[ModelCache] : ${n}/${r.count}`);return}const a=new jo;a.compose(o,new Si().setFromEuler(s),i),r.setMatrixAt(n,a),r.instanceMatrix.needsUpdate=!0}hideInstancedMeshInstance(t,n){const o=this.instancedMeshes.get(t);if(!o)return;const s=new jo;s.setPosition(0,-1e3,0),o.setMatrixAt(n,s),o.instanceMatrix.needsUpdate=!0}cacheGLTF(t,n){if(this.gltfCache.size>=this.maxCacheSize){const o=this.gltfCache.keys().next().value;this.gltfCache.delete(o),f(`[ModelCache] GLTF: ${o}`)}this.gltfCache.set(t,n),f(`[ModelCache] GLTF: ${t}`)}addToModelPool(t,n){if(this.modelPool.size>=this.maxCacheSize){const o=this.modelPool.keys().next().value,s=this.modelPool.get(o);this.disposeModel(s),this.modelPool.delete(o),f(`[ModelCache] : ${o}`)}this.modelPool.set(t,n),f(`[ModelCache] : ${t}`)}async preloadModels(t,n=null){f(`[ModelCache]  ${t.length} `);const o=t.length;let s=0;const i=t.filter(a=>{const c=this.preloadStatus.get(a);return!c||c==="failed"});f(`[ModelCache]  ${i.length} `);const r=3;for(let a=0;a<i.length;a+=r){const l=i.slice(a,a+r).map(async u=>{try{this.preloadStatus.set(u,"loading"),await this.loadModel(u,!0),this.preloadStatus.set(u,"loaded"),s++,n&&n(s,o,Math.round(s/o*100)),f(`[ModelCache] : ${u} (${s}/${o})`)}catch(_){f(`[ModelCache] : ${u}`,_),this.preloadStatus.set(u,"failed"),s++,n&&n(s,o,Math.round(s/o*100))}});await Promise.all(l),a+r<i.length&&await new Promise(u=>setTimeout(u,100))}f(`[ModelCache] : ${s}/${o} `)}isPreloaded(t){return this.preloadStatus.get(t)==="loaded"}getPreloadStatus(){const t={total:this.preloadStatus.size,loaded:0,loading:0,failed:0};for(const n of this.preloadStatus.values())t[n]++;return t}disposeModel(t){t&&t.traverse(n=>{n.isMesh&&(n.geometry&&n.geometry.dispose(),n.material&&(Array.isArray(n.material)?n.material.forEach(o=>{o.map&&o.map.dispose(),o.dispose&&o.dispose()}):(n.material.map&&n.material.map.dispose(),n.material.dispose&&n.material.dispose())))})}clearCache(){f("[ModelCache] ..."),this.modelPool.forEach(t=>{this.disposeModel(t)}),this.modelPool.clear(),this.instancedMeshes.forEach(t=>{this.disposeModel(t)}),this.instancedMeshes.clear(),this.gltfCache.clear(),this.preloadStatus.clear(),f("[ModelCache] ")}getCacheStatus(){return{gltfCacheSize:this.gltfCache.size,modelPoolSize:this.modelPool.size,instancedMeshesSize:this.instancedMeshes.size,preloadStatus:this.getPreloadStatus(),maxCacheSize:this.maxCacheSize,maxInstancesPerModel:this.maxInstancesPerModel,gltfLoaderInitialized:!!this.gltfLoader,dracoLoaderInitialized:!!this.dracoLoader}}updateConfig(t){t.maxCacheSize!==void 0&&(this.maxCacheSize=Math.max(10,t.maxCacheSize)),t.maxInstancesPerModel!==void 0&&(this.maxInstancesPerModel=Math.max(10,t.maxInstancesPerModel)),f("[ModelCache] :",this.getCacheStatus())}}const On=new m7,f7={class:"model-wrapper"},h7={key:0,class:"model-loading"},g7={__name:"PuppetModelView",props:{puppet:{type:Object,default:null}},setup(e){const t=e,n=oe(null),o=oe(!1);let s=null,i=null,r=null,a=0,c=null,l=null,u=new M0,_=null,$=null,d=0,p=!1;window.__GLTF_MEMORY_CACHE__||(window.__GLTF_MEMORY_CACHE__=new Map,f("[PuppetModelView] Initialized global GLTF memory cache"));function b(){if(p)return;const y=n.value;if(!y){f("[PuppetModelView] Container not ready for Three.js initialization");return}f("[PuppetModelView] Initializing Three.js..."),i=new Ka,r=new Ir(45,1,.1,1e3),r.position.set(0,1,3),s=new Ja({antialias:!0,alpha:!0}),s.setPixelRatio(window.devicePixelRatio||1),s.outputColorSpace=tn,$=new Nc,$.setDecoderPath("https://www.gstatic.com/draco/versioned/decoders/1.5.6/"),$.setCrossOrigin("anonymous"),f("[PuppetModelView] Draco loader initialized:",!!$),y.innerHTML="",y.appendChild(s.domElement);const w=new Xa(16777215,1.2),k=new vs(16777215,1.5);k.position.set(3,5,2);const I=new vs(16777215,.8);I.position.set(-2,3,4);const P=new _i(16777215,1,10);P.position.set(0,2,3),i.add(w,k,I,P);const T=()=>{if(!y||!s)return;let D=y.clientWidth,U=y.clientHeight;if(!D||!U){const L=y.getBoundingClientRect();if(D=L.width||200,U=L.height||200,!L.width||!L.height){requestAnimationFrame(T);return}}s.setSize(D,U,!0),r.aspect=D/Math.max(1,U),r.updateProjectionMatrix()};T(),_=new ResizeObserver(T),_.observe(y),requestAnimationFrame(()=>{T(),requestAnimationFrame(()=>{T(),requestAnimationFrame(T)})});const x=()=>{if(!s||!i||!r)return;a=requestAnimationFrame(x);const D=u.getDelta();l&&l.update(D),c&&(c.rotation.y+=D*.6),s.render(i,r)};x(),p=!0,f("[PuppetModelView] Three.js initialized successfully, container size:",y.clientWidth,"x",y.clientHeight)}function g(){l&&(l.stopAllAction(),l=null),c&&(i.remove(c),c.traverse(y=>{y.isMesh&&(y.geometry&&y.geometry.dispose(),Array.isArray(y.material)?y.material.forEach(w=>{w.map&&w.map.dispose(),w&&w.dispose&&w.dispose()}):y.material&&(y.material.map&&y.material.map.dispose(),y.material.dispose&&y.material.dispose()))}),c=null)}function m(y){const w=new pn().setFromObject(y),k=new Ue,I=new Ue;w.getSize(k),w.getCenter(I),y.position.sub(I),y.position.add(new Ue(0,0,0)),y.scale.multiplyScalar(.8);const T=s==null?void 0:s.domElement,x=T?T.clientWidth||T.width:200,D=T?T.clientHeight||T.height:200,U=Math.max(1e-6,x/Math.max(1,D)),L=r.fov*(Math.PI/180),K=2*Math.atan(Math.tan(L/2)*U),ge=1.05,ce=k.y/2/Math.tan(L/2),he=k.x/2/Math.tan(K/2),q=ge*Math.max(ce,he,.1);r.position.set(0,0,q),r.lookAt(0,0,0)}async function v(y){var I;if(!y)return;f("[PuppetModelView] Loading puppet:",y.name),o.value=!0,b(),g();const w=++d;f("[PuppetModelView] ");let k=y.modelUrl||"";if(f("[PuppetModelView] Original modelUrl:",k),f("[PuppetModelView] Puppet image:",y.image),f("[PuppetModelView] Puppet name:",y.name),f("[PuppetModelView] Puppet data:",y),!k||k.trim()===""){f("[PuppetModelView] No model URL found");return}f("[PuppetModelView] Final Model URL:",k);try{f("[PuppetModelView] Starting to load:",k),f("[PuppetModelView] Cache status:",On.getCacheStatus());const P=await On.loadModel(k);if(f("[PuppetModelView] Model loaded from cache manager:",P),w!==d){f("[PuppetModelView] Ignoring outdated load result for:",y.name),gltf&&gltf.scene&&gltf.scene.traverse(T=>{T.isMesh&&(T.geometry&&T.geometry.dispose(),Array.isArray(T.material)?T.material.forEach(x=>{x.map&&x.map.dispose(),x.dispose&&x.dispose()}):T.material&&(T.material.map&&T.material.map.dispose(),T.material.dispose&&T.material.dispose()))});return}if(f("[PuppetModelView] Applying model for:",y.name),!i){f("[PuppetModelView] Scene not ready, initializing..."),b();let T=0;for(;!i&&T<40;)await new Promise(x=>setTimeout(x,50)),T++;if(!i){f("[PuppetModelView] Scene initialization timeout");return}}if(c=P,!c){f("[PuppetModelView] No model instance received");return}i.add(c),m(c),f("[PuppetModelView] Model loaded successfully:",y.name,"Scene children:",i.children.length),o.value=!1}catch(P){if(f("[PuppetModelView] Load failed:",P),f("[PuppetModelView] Failed URL:",k),f("[PuppetModelView] Puppet data:",y),typeof(P==null?void 0:P.message)=="string"&&P.message.includes("DRACOLoader")){f("[PuppetModelView] Retrying without Draco decoder...");try{const T=new Dc;T.setCrossOrigin("anonymous");const x=await T.loadAsync(k);if(w===d&&(c=x.scene||((I=x.scenes)==null?void 0:I[0]),c)){i.add(c),x.animations&&x.animations.length&&(l=new k0(c),l.clipAction(x.animations[0]).play()),m(c),f("[PuppetModelView] Model loaded successfully without Draco:",y.name);return}}catch(T){f("[PuppetModelView] Fallback load also failed:",T)}}if(w===d){const T=new gs(1,1,1),x=new Bt({color:8947967});c=new St(T,x),i.add(c),m(c)}o.value=!1}}return Tn(()=>t.puppet,async y=>{await _r(),v(y)},{immediate:!1}),gn(()=>{f("[PuppetModelView] Component mounted"),_r(()=>{n.value&&(b(),t.puppet&&setTimeout(()=>{v(t.puppet)},0))})}),Ls(()=>{if(f("[PuppetModelView] Cleaning up..."),cancelAnimationFrame(a),g(),_&&n.value)try{_.unobserve(n.value)}catch{}const y=i,w=s;s=null,i=null,r=null,p=!1,d=0;const k=()=>{if(f("[PuppetModelView] Starting deferred cleanup..."),y&&y.traverse(I=>{if(I.isMesh)try{if(I.geometry&&I.geometry.dispose(),Array.isArray(I.material))I.material.forEach(P=>{try{P.map&&P.map.dispose(),P.dispose&&P.dispose()}catch{}});else if(I.material)try{I.material.map&&I.material.map.dispose(),I.material.dispose&&I.material.dispose()}catch{}}catch{}}),w)try{w.dispose(),w.forceContextLoss&&w.forceContextLoss()}catch{}f("[PuppetModelView] Deferred cleanup completed")};typeof window<"u"&&window.requestIdleCallback?window.requestIdleCallback(k,{timeout:1e3}):setTimeout(k,100),f("[PuppetModelView] Quick cleanup completed, heavy cleanup deferred")}),(y,w)=>(V(),Z("div",f7,[h("div",{ref_key:"mountEl",ref:n,class:"model-canvas"},null,512),o.value?(V(),Z("div",h7,[...w[0]||(w[0]=[h("div",{class:"loading-spinner"},null,-1)])])):Ie("",!0)]))}},b7=qt(g7,[["__scopeId","data-v-33527bae"]]),y7={class:"warehouse"},v7={class:"warehouse__resources"},w7={class:"resource-icon"},S7=["src","alt"],k7={class:"resource-value"},M7={class:"resource-tooltip"},C7={key:0,class:"warehouse__main"},x7={class:"warehouse__sidebar"},P7={class:"puppet-list"},L7=["onClick","onMouseenter"],I7={class:"puppet-card__quantity"},T7={class:"puppet-card__image"},E7=["src","alt"],A7={class:"puppet-card__info"},G7={class:"puppet-card__name"},R7={class:"puppet-card__level"},O7={class:"puppet-detail__header"},D7={class:"puppet-detail__name"},N7={class:"puppet-detail__content"},j7={class:"puppet-detail__row"},H7={class:"puppet-detail__model"},F7={class:"puppet-detail__description"},U7={class:"puppet-detail__row"},B7={class:"puppet-detail__stats"},z7={class:"stats-section"},V7={class:"stat-item"},q7={class:"stat-value"},W7={class:"stat-item"},K7={class:"stat-value"},J7={class:"stat-item"},X7={class:"stat-value"},Y7={class:"stat-item"},Z7={class:"stat-value"},Q7={class:"stat-item"},eT={class:"stat-value"},tT={class:"stat-item"},nT={class:"stat-value"},sT={class:"stat-item"},oT={class:"stat-value"},iT={class:"equipment-section"},rT={class:"equipment-slots"},aT=["src","alt"],cT=["src"],lT=["src"],uT={key:3,class:"equipment-icon"},_T={key:0,class:"skill-section"},$T={class:"skill-info"},dT={class:"skill-text"},pT={class:"skill-name"},mT={class:"skill-cooldown"},fT={class:"skill-effect"},hT={class:"skill-icon"},gT=["src","alt"],bT={key:1},yT={class:"puppet-detail__upgrade"},vT={class:"upgrade-cost"},wT=["src"],ST={class:"cost-amount"},kT=["disabled"],MT=["src"],CT={class:"warehouse__placeholder",key:"placeholder"},xT=["src"],PT={__name:"Warehouse",props:{musicOn:{type:Boolean,default:!0}},setup(e,{expose:t}){Qn(q=>({fdb82c0e:ge,v4f1f7bb6:K,v4f1e1e99:D,v4f1e92f8:U,v4f1f0757:L}));const n=e,o=["SpiritalSpark","RecallGear","ResonantCrystal","RefinedCopper","HeartCrystalDust"];function s(q){return o.map(G=>({icon:Kn[G].icon,name:Kn[G].name,value:Number((q==null?void 0:q[G])??0)}))}const i={IronWall:"",Arcanist:"",CraftsMan:"",Mechanic:"",Resonator:""};function r(q){const G=Number(q??1);return G===1?5:G===2?10:G===3?20:G===4?30:0}function a(q){return(q||[]).map((G,J)=>{var se,Q,R,ue,ie,re;const F=(G==null?void 0:G.copper_info)||{},O=(F==null?void 0:F.skill)||{},X=(G==null?void 0:G.equipment_slot)||{},W=(X==null?void 0:X.slot1)||null,ve=(X==null?void 0:X.slot2)||null,Ne=(G==null?void 0:G.attribute)||{},Ze=((se=W==null?void 0:W.equipment_base)==null?void 0:se.attribute)||{},He=((Q=ve==null?void 0:ve.equipment_base)==null?void 0:Q.attribute)||{},lt=Number(Ze.attack||0)+Number(He.attack||0),et=Number(Ze.defense||0)+Number(He.defense||0),at=Number(Ze.dodge||0)+Number(He.dodge||0),Rt=G==null?void 0:G.copper_type,C=(G==null?void 0:G.level)??1,E=(F==null?void 0:F.model_url)||"",B=E?Y(E):"";return{id:Number((G==null?void 0:G.id)??J+1),name:(F==null?void 0:F.name)??"",level:C,suffix:(G==null?void 0:G.suffix)??0,image:Y((F==null?void 0:F.icon_url)||""),modelUrl:B,quantity:1,description:(F==null?void 0:F.description)||"",stats:{level:`${C}/5`,health:Number(Ne.health||0),live_left:Number((G==null?void 0:G.live_left)??0),attack:{base:Number(Ne.attack||0),bonus:lt},defense:{base:Number(Ne.defense||0),bonus:et},dodge:{base:Number(Ne.dodge||0),bonus:at},class:i[Rt]||""},equipment:[W?{name:((R=W.equipment_base)==null?void 0:R.name)||"",icon:Y(((ue=W.equipment_base)==null?void 0:ue.resource_url)||""),equipped:!0,locked:!1}:{name:"",icon:"",equipped:!1,locked:!1},X!=null&&X.is_slot2_locked?{name:"",icon:"",equipped:!1,locked:!0}:ve?{name:((ie=ve.equipment_base)==null?void 0:ie.name)||"",icon:Y(((re=ve.equipment_base)==null?void 0:re.resource_url)||""),equipped:!0,locked:!1}:{name:"",icon:"",equipped:!1,locked:!1}],skill:{name:(O==null?void 0:O.name)||"",cooldown:(O==null?void 0:O.cool_down)!=null?`${O.cool_down}`:"",effect:(O==null?void 0:O.description)||"",icon:Y((O==null?void 0:O.resource_url)||"")},upgradeCost:r(C)}})}function c(q,G,J=[]){if(!q||typeof q!="object")return null;if(Object.prototype.hasOwnProperty.call(q,G))return[...J,G];if(Array.isArray(q)){for(let F=0;F<q.length;F++){const O=c(q[F],G,[...J,F]);if(O)return O}return null}for(const F of Object.keys(q)){const O=c(q[F],G,[...J,F]);if(O)return O}return null}function l(q,G){return G.reduce((J,F)=>J!=null?J[F]:void 0,q)}const u=oe([]);async function _(){try{const q=Oc();q&&(u.value=s(q))}catch(q){console.error("[Warehouse] :",q),u.value=s({})}}gn(()=>{_(),_c(kn.UPDATE_RESOURCES,_)});function $(q){let G=q;if(typeof q=="string")try{G=JSON.parse(q)}catch{}G&&G.type_msg&&(G.type_msg==="upgrade_cost_error"?alert(G.content||""):f("[GlobalInfo]",G))}gn(()=>{try{ah($)}catch{}n.musicOn&&ce.value&&setTimeout(()=>{if(ce.value.readyState>=2)ce.value.play().then(()=>{f("[Warehouse] ")}).catch(G=>{f("[Warehouse] :",G)});else{const G=()=>{ce.value.play().then(()=>{f("[Warehouse] ")}).catch(J=>{f("[Warehouse] :",J)}),ce.value.removeEventListener("canplay",G)};ce.value.addEventListener("canplay",G,{once:!0})}},200)}),Tn(()=>n.musicOn,q=>{if(ce.value)if(q)if(ce.value.readyState>=2)ce.value.play().catch(G=>{f("[Warehouse] :",G)});else{const G=()=>{ce.value.play().catch(J=>{f("[Warehouse] :",J)}),ce.value.removeEventListener("canplay",G)};ce.value.addEventListener("canplay",G)}else ce.value.pause()}),Ls(()=>{ce.value&&ce.value.pause(),Pu(kn.UPDATE_RESOURCES,_)});const d=oe([]);gn(async()=>{try{const q=ga();let G=q&&Array.isArray(q.coppers)?q.coppers:[];if(!Array.isArray(G)){const J=c(q,"coppers");if(f("[Warehouse] copper key path:",J),J){const F=l(q,J);f("[Warehouse] copper found by path:",F),Array.isArray(F)&&(G=F)}!Array.isArray(G)&&q&&q.entries&&f("[Warehouse] copper entries sample:",q.entries)}Array.isArray(G)||f("[Warehouse] copper list not array"),d.value=a(G),Array.isArray(d.value)&&d.value.length>0&&(p.value=d.value[0]),!p.value&&Array.isArray(d.value)&&d.value.length>0&&(p.value=d.value[0])}catch{d.value=[]}});const p=oe(null),b=oe([]),g=oe(null),m=oe(null),v=oe(null);function y(q,G){q&&(b.value[G]=q)}async function w(q,G){p.value=q,await _r();const J=b.value[G];if(J&&typeof J.scrollIntoView=="function"&&J.scrollIntoView({block:"nearest",inline:"nearest",behavior:"smooth"}),g.value=G,m.value)try{m.value.scrollTo({top:0,behavior:"smooth"})}catch{m.value.scrollTop=0}setTimeout(()=>{g.value===G&&(g.value=null)},320)}const k=oe(!1);function I(){k.value=!0}function P(){return k.value?(k.value=!1,!0):!1}t({handleBack:P});async function T(q){try{await _();const G=ga(),J=Array.isArray(G==null?void 0:G.coppers)?G.coppers:[];d.value=a(J)}catch{}}async function x(){if(!p.value)return;if(Number(p.value.level||0)>=5){alert("");return}const q=p.value.id,G=fI(q);if(!G||G.type!=="success"){alert(G&&G.content?G.content:"");return}try{await _();const J=ga(),F=Array.isArray(J==null?void 0:J.coppers)?J.coppers:[];d.value=a(F);const O=d.value.find(X=>X.id===q);O&&(p.value=O)}catch{}}const D=`url('${Y("@assets/ui/panel2.png")}')`,U=`url('${Y("@assets/ui/panel3.png")}')`,L=`url('${Y("@assets/ui/panel4.png")}')`,K=`url('${Y("@assets/ui/panel5.png")}')`,ge=`url('${Y("@assets/frontend_resource/Gemini_Generated_Image_e03q5oe03q5oe03q.png")}')`,ce=oe(null),he=Y("assets/warehouse.mp3");return(q,G)=>(V(),Z("div",y7,[h("div",v7,[(V(!0),Z(ht,null,Yn(u.value,J=>(V(),Z("div",{class:"resource-item",key:J.name},[h("div",w7,[h("img",{src:J.icon,alt:J.name},null,8,S7)]),h("div",k7,_e(J.value),1),h("div",M7,_e(J.name),1)]))),128))]),k.value?Ie("",!0):(V(),Z("div",C7,[h("div",x7,[G[2]||(G[2]=h("div",{class:"warehouse__title"},"",-1)),h("div",P7,[(V(!0),Z(ht,null,Yn(d.value,(J,F)=>{var O;return V(),Z("div",{class:kt(["puppet-card",{"puppet-card--selected":((O=p.value)==null?void 0:O.id)===J.id,"puppet-card--pulse":g.value===F,"puppet-card--hover":v.value===F}]),key:J.id,ref_for:!0,ref:X=>y(X,F),onClick:X=>w(J,F),onMouseenter:X=>v.value=F,onMouseleave:G[0]||(G[0]=X=>v.value=null)},[h("div",I7,_e(J.level),1),h("div",T7,[h("img",{src:J.image,alt:J.name},null,8,E7)]),h("div",A7,[h("div",G7,_e(J.name)+_e(J.suffix),1),h("div",R7,_e(J.level)+"",1)])],42,L7)}),128)),h("div",{class:"puppet-card puppet-card--add",onClick:I},[...G[1]||(G[1]=[h("div",{class:"puppet-card__add-icon"},"+",-1),h("div",{class:"puppet-card__add-text"},"",-1)])])])]),h("div",{class:"warehouse__detail",ref_key:"detailWrap",ref:m},[xt(Ab,{name:"fade-slide",mode:"out-in"},{default:qd(()=>{var J,F,O,X;return[p.value?(V(),Z("div",{class:"puppet-detail",key:((J=p.value)==null?void 0:J.id)||"none"},[h("div",O7,[h("h2",D7,_e(p.value.name),1)]),h("div",N7,[h("div",j7,[h("div",H7,[xt(b7,{puppet:p.value},null,8,["puppet"])]),h("div",F7,_e(p.value.description),1)]),h("div",U7,[h("div",B7,[h("div",z7,[h("div",V7,[G[3]||(G[3]=h("span",{class:"stat-label"},":",-1)),h("span",q7,_e(p.value.stats.health),1)]),h("div",W7,[G[4]||(G[4]=h("span",{class:"stat-label"},":",-1)),h("span",K7,_e(p.value.stats.level),1)]),h("div",J7,[G[5]||(G[5]=h("span",{class:"stat-label"},":",-1)),h("span",X7,_e(p.value.stats.live_left),1)]),h("div",Y7,[G[6]||(G[6]=h("span",{class:"stat-label"},":",-1)),h("span",Z7,_e(p.value.stats.attack.base),1)]),h("div",Q7,[G[7]||(G[7]=h("span",{class:"stat-label"},":",-1)),h("span",eT,_e(p.value.stats.defense.base),1)]),h("div",tT,[G[8]||(G[8]=h("span",{class:"stat-label"},":",-1)),h("span",nT,_e(p.value.stats.dodge.base)+"% ",1)]),h("div",sT,[G[9]||(G[9]=h("span",{class:"stat-label"},":",-1)),h("span",oT,_e(p.value.stats.class),1)])])]),h("div",iT,[G[10]||(G[10]=h("h4",{class:"section-title"},"",-1)),h("div",rT,[(V(!0),Z(ht,null,Yn(p.value.equipment,(W,ve)=>(V(),Z("div",{key:ve,class:kt(["equipment-slot",{"equipment-slot--empty":!W.equipped&&!W.locked,"equipment-slot--locked":W.locked}])},[W.equipped&&W.icon&&(W.icon.startsWith("/")||W.icon.startsWith("http"))?(V(),Z("img",{key:0,src:W.icon,alt:W.name,class:"equipment-icon"},null,8,aT)):W.locked?(V(),Z("img",{key:1,src:ye(Y)("@assets/ui/lock.png"),alt:"",class:"equipment-icon"},null,8,cT)):W.icon===""?(V(),Z("img",{key:2,src:ye(Y)("@assets/ui/jia.png"),alt:"",class:"equipment-icon"},null,8,lT)):(V(),Z("span",uT,_e(W.icon),1))],2))),128))])])]),((O=(F=p.value)==null?void 0:F.stats)==null?void 0:O.class)!==""?(V(),Z("div",_T,[G[11]||(G[11]=h("h4",{class:"section-title"},"",-1)),h("div",$T,[h("div",dT,[h("div",pT,_e(p.value.skill.name),1),h("div",mT," : "+_e(p.value.skill.cooldown),1),h("div",fT,_e(p.value.skill.effect),1)]),h("div",hT,[p.value.skill.icon&&(p.value.skill.icon.startsWith("/")||p.value.skill.icon.startsWith("http"))?(V(),Z("img",{key:0,src:p.value.skill.icon,alt:p.value.skill.name,class:"skill-icon-img"},null,8,gT)):(V(),Z("span",bT,_e(p.value.skill.icon),1))])])])):Ie("",!0)]),h("div",yT,[h("div",vT,[p.value.level<5?(V(),Z("img",{key:0,src:ye(Kn).SpiritalSpark.icon,alt:"",class:"cost-icon-img"},null,8,wT)):Ie("",!0),h("span",ST,_e(p.value.level>=5?"":"X "+p.value.upgradeCost),1)]),h("button",{class:"upgrade-btn",onClick:x,disabled:((X=p.value)==null?void 0:X.level)>=5},[h("img",{src:ye(Y)("@assets/ui/upgrade.png"),class:"upgrade-icon",alt:""},null,8,MT)],8,kT)])])):(V(),Z("div",CT,[...G[12]||(G[12]=[h("p",null,"",-1)])]))]}),_:1})],512)])),k.value?(V(),Cn(AI,{key:1,onDraw:T})):Ie("",!0),h("audio",{ref_key:"audioRef",ref:ce,src:ye(he),loop:"",preload:"auto"},null,8,xT)]))}},LT=qt(PT,[["__scopeId","data-v-6aa3978d"]]),IT={class:"panel",style:{left:"24px",right:"auto"}},TT=["title"],ET={key:0,width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg"},AT={key:1,width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg"},GT={class:"sr-only"},RT={__name:"TopLeftPanel",props:{musicOn:{type:Boolean,default:!0}},emits:["back","open-settings","toggle-music"],setup(e,{emit:t}){return(n,o)=>(V(),Z("div",IT,[h("button",{class:"btn",onClick:o[0]||(o[0]=s=>n.$emit("back")),title:""},[...o[3]||(o[3]=[h("svg",{width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg"},[h("path",{d:"M15 18L9 12L15 6",stroke:"#ffffff","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"})],-1),h("span",{class:"sr-only"},"",-1)])]),h("button",{class:"btn",onClick:o[1]||(o[1]=s=>n.$emit("toggle-music")),title:e.musicOn?"":""},[e.musicOn?(V(),Z("svg",ET,[...o[4]||(o[4]=[h("path",{d:"M9 18V5L21 3V16",stroke:"#ffffff","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"},null,-1),h("circle",{cx:"6",cy:"18",r:"3",stroke:"#ffffff","stroke-width":"2"},null,-1),h("circle",{cx:"18",cy:"16",r:"3",stroke:"#ffffff","stroke-width":"2"},null,-1)])])):(V(),Z("svg",AT,[...o[5]||(o[5]=[h("path",{d:"M9 18V5L21 3V16",stroke:"#ffffff","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"},null,-1),h("circle",{cx:"6",cy:"18",r:"3",stroke:"#ffffff","stroke-width":"2"},null,-1),h("circle",{cx:"18",cy:"16",r:"3",stroke:"#ffffff","stroke-width":"2"},null,-1),h("line",{x1:"2",y1:"2",x2:"22",y2:"22",stroke:"#ffffff","stroke-width":"2","stroke-linecap":"round"},null,-1)])])),h("span",GT,_e(e.musicOn?"":""),1)],8,TT),h("button",{class:"btn",onClick:o[2]||(o[2]=s=>n.$emit("open-settings")),title:""},[...o[6]||(o[6]=[h("svg",{width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg"},[h("path",{d:"M12 15.5C13.933 15.5 15.5 13.933 15.5 12C15.5 10.067 13.933 8.5 12 8.5C10.067 8.5 8.5 10.067 8.5 12C8.5 13.933 10.067 15.5 12 15.5Z",stroke:"#ffffff","stroke-width":"2"}),h("path",{d:"M19.4 15A7.964 7.964 0 0 0 20 12C20 11.49 19.95 10.99 19.86 10.5L22 8.5L20 5.5L17.34 6.07C16.78 5.58 16.14 5.18 15.44 4.9L15 2H9L8.56 4.9C7.86 5.18 7.22 5.58 6.66 6.07L4 5.5L2 8.5L4.14 10.5C4.05 10.99 4 11.49 4 12C4 12.51 4.05 13.01 4.14 13.5L2 15.5L4 18.5L6.66 17.93C7.22 18.42 7.86 18.82 8.56 19.1L9 22H15L15.44 19.1C16.14 18.82 16.78 18.42 17.34 17.93L20 18.5L22 15.5L19.86 13.5C19.95 13.01 20 12.51 20 12",stroke:"#ffffff","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"})],-1),h("span",{class:"sr-only"},"",-1)])])]))}},Y$=qt(RT,[["__scopeId","data-v-8380a348"]]),OT=["automatic_loading_gun","charging_coil","heart_source_mineral_drill","mirro_light_refraction_tower","repair_workshop","resonance_alarm_bell","rivet_barrier","steam_mining_car","storm_anvil"];function DT(){const e=[],t=[{type:"arcanist",name:"bubble"},{type:"craftsman",name:"coil"},{type:"iron_wall",name:"bell"},{type:"mechanic",name:"gyro"},{type:"resonator",name:"clawster"}];for(const o of t){const s=cc(o.type,o.name);e.push(s)}const n=["goblin","guard","demon"];for(const o of n){const s=lc(o);e.push(s)}return f(`[ModelPreloadConfig]  ${e.length} URL`),e}function NT(){const e=[],t=[{type:"arcanist",name:"glimmer"},{type:"arcanist",name:"spark"},{type:"craftsman",name:"artifex"},{type:"craftsman",name:"wrench"},{type:"iron_wall",name:"chief"},{type:"iron_wall",name:"rocky"},{type:"mechanic",name:"karin"},{type:"mechanic",name:"tricky"},{type:"resonator",name:"diggs"},{type:"resonator",name:"hive"}];for(const o of t){const s=cc(o.type,o.name);e.push(s)}const n=["assassin","boxer","cruiser","devourer","glutton"];for(const o of n){const s=lc(o);e.push(s)}return f(`[ModelPreloadConfig]  ${e.length} URL`),e}function jT(){const e=[],t=[{type:"arcanist",name:"syrup"},{type:"arcanist",name:"turner"},{type:"craftsman",name:"drillbit"},{type:"craftsman",name:"quickhand"},{type:"iron_wall",name:"tumble"},{type:"iron_wall",name:"wesley"},{type:"mechanic",name:"pendulum"},{type:"mechanic",name:"yoyo"},{type:"resonator",name:"melody"},{type:"resonator",name:"murmur"}];for(const o of t){const s=cc(o.type,o.name);e.push(s)}const n=["horn","mirror","scout","shatra","variant"];for(const o of n){const s=lc(o);e.push(s)}for(const o of OT){const s=Ap(o);e.push(s)}return f(`[ModelPreloadConfig]  ${e.length} URL`),e}function HT(e=["high","medium"]){const t=[];for(const o of e)switch(o){case"high":t.push(...DT());break;case"medium":t.push(...NT());break;case"low":t.push(...jT());break}const n=[...new Set(t)];return f(`[ModelPreloadConfig]  ${e.join(", ")}  ${n.length} URL`),n}class FT{constructor(){this.isPreloading=!1,this.preloadProgress=0,this.preloadCallbacks=[]}async startPreload(t=["high","medium"],n=null){if(this.isPreloading){f("[ModelPreloadManager] ");return}this.isPreloading=!0,this.preloadProgress=0;try{const o=HT(t);f(`[ModelPreloadManager]  ${o.length}  (: ${t.join(", ")})`),n&&this.preloadCallbacks.push(n),await On.preloadModels(o,(s,i,r)=>{this.preloadProgress=r,this.notifyProgress(s,i,r)}),f("[ModelPreloadManager] ")}catch(o){f("[ModelPreloadManager] :",o)}finally{this.isPreloading=!1,this.preloadCallbacks=[]}}notifyProgress(t,n,o){this.preloadCallbacks.forEach(s=>{try{s(t,n,o)}catch(i){f("[ModelPreloadManager] :",i)}})}getStatus(){return{isPreloading:this.isPreloading,progress:this.preloadProgress,cacheStatus:On.getCacheStatus()}}isModelPreloaded(t){return On.isPreloaded(t)}async preloadModel(t){try{await On.loadModel(t,!0),f(`[ModelPreloadManager] : ${t}`)}catch(n){f(`[ModelPreloadManager] : ${t}`,n)}}async preloadModels(t){const n=t.map(o=>this.preloadModel(o));await Promise.all(n),f(`[ModelPreloadManager] : ${t.length} `)}}const Z$=new FT,uh="mgpic_game_settings",Q$={controlMode:"mobile",mouseSensitivity:.002};function _h(){try{const e=localStorage.getItem(uh);if(e){const t=JSON.parse(e);return{...Q$,...t}}}catch(e){console.error("[GameSettings] :",e)}return{...Q$}}function UT(e){try{return localStorage.setItem(uh,JSON.stringify(e)),!0}catch(t){return console.error("[GameSettings] :",t),!1}}function BT(e,t){const n=_h();return n[e]=t,UT(n)}const zT={class:"startmenu"},VT={key:0,class:"download-banner"},qT={key:1,class:"settings-local"},WT={class:"settings-local__card"},KT={class:"settings-local__content"},JT={class:"settings-local__row"},XT={class:"setting-options"},YT={__name:"StartMenu",props:{visible:{type:Boolean,default:!0}},emits:["started"],setup(e,{emit:t}){Qn(L=>({c38888f0:g}));const n=e,o=oe(null);let s=null,i=null,r=null,a=null,c=null,l=1.2;const u=oe(!1),_=oe(!1),$=oe(!1),d=oe("touchpad"),p=oe(!1),b=oe(Y("ui/Gemini_Generated_Image_gtrehogtrehogtre (1).png")),g=`url('${Y("@assets/ui/panel4.png")}')`,m=t;Tn(()=>n.visible,L=>{L&&s&&c?k():L||w()});function v(){if(a=requestAnimationFrame(v),c){const L=Date.now()*.001;c.position.y=Math.sin(L*.8)*.1,c.rotation.y=Math.sin(L*.6)*.1;const K=l+Math.sin(L*1.2)*.04;c.scale.setScalar(K)}r&&r.render(s,i)}function y(){!r||!i||(i.aspect=window.innerWidth/window.innerHeight,i.updateProjectionMatrix(),r.setSize(window.innerWidth,window.innerHeight))}function w(){a&&(cancelAnimationFrame(a),a=null),r&&r.setAnimationLoop(null)}function k(){a||v()}function I(){try{w()}catch{}try{window.removeEventListener("resize",y)}catch{}try{s&&(s.traverse(L=>{if(L.isMesh){L.geometry&&L.geometry.dispose&&L.geometry.dispose();const K=L.material;Array.isArray(K)?K.forEach(ge=>ge&&ge.dispose&&ge.dispose()):K&&K.dispose&&K.dispose()}}),s.clear())}catch{}try{if(r){r.clear(!0,!0,!0),r.dispose();const L=r.getContext&&r.getContext(),K=L&&L.getExtension&&L.getExtension("WEBGL_lose_context");K&&K.loseContext&&K.loseContext()}}catch{}s=null,i=null,r=null,c=null}async function P(L=null){try{window.getAssetUrl=Y,window.precacheAllResources=jl,window.getCacheStatus=a1}catch{}if(!s||!r){f("[StartMenu] Scene or renderer not initialized in onMounted");return}if(L&&L(0,100,20),!s.children.some(ce=>ce.isLight)){const ce=new Xa(4210752,.4);s.add(ce);const he=new vs(16777215,12.5);he.position.set(-5,-2,1),s.add(he)}L&&L(0,100,50);const ge=Y("logo.glb");try{L&&L(0,100,60),f("[StartMenu] Logo...");const ce=await On.loadModel(ge,!0);L&&L(0,100,80),ce.position.set(0,0,0),s.add(ce);const q=new pn().setFromObject(ce).getCenter(new Ue);ce.position.set(-q.x,-q.y,-q.z-.3);try{ce.scale.setScalar(l)}catch{}c=ce,L&&L(0,100,80),f("[StartMenu] Logo ...");try{await Z$.startPreload(["high","medium"],(G,J,F)=>{const O=80+F*.15;L&&L(0,100,Math.round(O)),f(`[StartMenu] : ${G}/${J} (${F}%)`)}),f("[StartMenu] ")}catch(G){f("[StartMenu] :",G)}L&&L(0,100,100),u.value=!0,f("[StartMenu] "),_.value=!0}catch(ce){f("[StartMenu] 3D",ce);const he=new gs(1,1,1),q=new zt({color:16096779}),G=new St(he,q);s.add(G),c=G,f("[StartMenu] ...");try{await Z$.startPreload(["high","medium"],(J,F,O)=>{const X=80+O*.15;L&&L(0,100,Math.round(X)),f(`[StartMenu] : ${J}/${F} (${O}%)`)}),f("[StartMenu] ")}catch(J){f("[StartMenu] :",J)}L&&L(0,100,100),u.value=!0,f("[StartMenu] "),_.value=!0}window.__START_MENU_PAUSE__=()=>w(),window.__START_MENU_RESUME__=()=>k()}function T(){m("started"),w()}function x(){const L=_h();d.value=L.controlMode,$.value=!0}function D(){$.value=!1}function U(L){d.value=L,BT("controlMode",L),window.updateControlMode&&window.updateControlMode(L),f(`[StartMenu] : ${L}`)}return gn(()=>{var L;_.value=!1,u.value=!1,p.value=typeof window<"u"&&(window.navigator.userAgent.toLowerCase().includes("electron")||((L=window.process)==null?void 0:L.type)==="renderer"||!!(window.require&&window.process&&window.process.versions&&window.process.versions.electron)),f("[StartMenu] ..."),f("[StartMenu] Electron :",p.value),!s&&o.value?(s=new Ka,s.background=null,i=new Ir(50,window.innerWidth/window.innerHeight,.1,1e3),i.position.set(-3.655,.2,-.006),i.rotation.set(-1.618275,-1.538307,-1.6183,"XYZ"),r=new Ja({antialias:!0,alpha:!0,canvas:o.value}),r.setSize(window.innerWidth,window.innerHeight),r.setPixelRatio(window.devicePixelRatio),r.setClearColor(0,0),window.addEventListener("resize",y),v(),f("[StartMenu] ")):s&&!c?f("[StartMenu] "):c&&(f("[StartMenu] Logo"),_.value=!0,u.value=!0),window.__INIT_THREE_SCENE__=async K=>{if(s&&c){f("[StartMenu] Logo"),_.value=!0,u.value=!0;return}f("[StartMenu] 3D..."),await P(K)}}),Ls(()=>{I()}),(L,K)=>(V(),Z("div",zT,[p.value?Ie("",!0):(V(),Z("div",VT,[...K[2]||(K[2]=[h("span",{class:"download-banner__text"},"  ",-1),h("a",{href:"https://github.com/MGPIC-2025/Cross/releases",target:"_blank",rel:"noopener noreferrer",class:"download-banner__link"},"  ",-1)])])),h("div",{class:"startmenu__bg",style:zn({backgroundImage:`url('${b.value}')`})},null,4),h("canvas",{ref_key:"canvasRef",ref:o,class:"startmenu__canvas"},null,512),Wd(h("div",{class:kt(["startmenu-ui",{"fade-in":_.value}])},[h("button",{id:"start-btn",class:"startmenu-btn","aria-label":"",onClick:T},"  "),h("button",{id:"settings-btn",class:"startmenu-btn","aria-label":"",onClick:x},"  ")],2),[[Ip,_.value]]),$.value?(V(),Z("div",qT,[h("div",WT,[h("div",{class:"settings-local__header"},[K[3]||(K[3]=h("div",{class:"settings-local__title"},"",-1)),h("button",{class:"settings-local__close",onClick:D,"aria-label":""},"  ")]),h("div",KT,[h("div",JT,[K[6]||(K[6]=h("div",{class:"setting-label"},"",-1)),h("div",XT,[h("button",{class:kt(["option-btn",{active:d.value==="touchpad"}]),onClick:K[0]||(K[0]=ge=>U("touchpad"))},[...K[4]||(K[4]=[h("span",{class:"option-title"},"",-1),h("span",{class:"option-desc"},"",-1)])],2),h("button",{class:kt(["option-btn",{active:d.value==="mouse"}]),onClick:K[1]||(K[1]=ge=>U("mouse"))},[...K[5]||(K[5]=[h("span",{class:"option-title"},"",-1),h("span",{class:"option-desc"},"",-1)])],2)])])])])])):Ie("",!0)]))}},ZT=qt(YT,[["__scopeId","data-v-b236fd15"]]),ed={type:"change"},r_={type:"start"},$h={type:"end"},ra=new x0,td=new pd,QT=Math.cos(70*$d.DEG2RAD),Ft=new Ue,wn=2*Math.PI,pt={NONE:-1,ROTATE:0,DOLLY:1,PAN:2,TOUCH_ROTATE:3,TOUCH_PAN:4,TOUCH_DOLLY_PAN:5,TOUCH_DOLLY_ROTATE:6},gl=1e-6;class eE extends C0{constructor(t,n=null){super(t,n),this.state=pt.NONE,this.target=new Ue,this.cursor=new Ue,this.minDistance=0,this.maxDistance=1/0,this.minZoom=0,this.maxZoom=1/0,this.minTargetRadius=0,this.maxTargetRadius=1/0,this.minPolarAngle=0,this.maxPolarAngle=Math.PI,this.minAzimuthAngle=-1/0,this.maxAzimuthAngle=1/0,this.enableDamping=!1,this.dampingFactor=.05,this.enableZoom=!0,this.zoomSpeed=1,this.enableRotate=!0,this.rotateSpeed=1,this.keyRotateSpeed=1,this.enablePan=!0,this.panSpeed=1,this.screenSpacePanning=!0,this.keyPanSpeed=7,this.zoomToCursor=!1,this.autoRotate=!1,this.autoRotateSpeed=2,this.keys={LEFT:"ArrowLeft",UP:"ArrowUp",RIGHT:"ArrowRight",BOTTOM:"ArrowDown"},this.mouseButtons={LEFT:di.ROTATE,MIDDLE:di.DOLLY,RIGHT:di.PAN},this.touches={ONE:$i.ROTATE,TWO:$i.DOLLY_PAN},this.target0=this.target.clone(),this.position0=this.object.position.clone(),this.zoom0=this.object.zoom,this._domElementKeyEvents=null,this._lastPosition=new Ue,this._lastQuaternion=new Si,this._lastTargetPosition=new Ue,this._quat=new Si().setFromUnitVectors(t.up,new Ue(0,1,0)),this._quatInverse=this._quat.clone().invert(),this._spherical=new f_,this._sphericalDelta=new f_,this._scale=1,this._panOffset=new Ue,this._rotateStart=new $n,this._rotateEnd=new $n,this._rotateDelta=new $n,this._panStart=new $n,this._panEnd=new $n,this._panDelta=new $n,this._dollyStart=new $n,this._dollyEnd=new $n,this._dollyDelta=new $n,this._dollyDirection=new Ue,this._mouse=new $n,this._performCursorZoom=!1,this._pointers=[],this._pointerPositions={},this._controlActive=!1,this._onPointerMove=nE.bind(this),this._onPointerDown=tE.bind(this),this._onPointerUp=sE.bind(this),this._onContextMenu=uE.bind(this),this._onMouseWheel=rE.bind(this),this._onKeyDown=aE.bind(this),this._onTouchStart=cE.bind(this),this._onTouchMove=lE.bind(this),this._onMouseDown=oE.bind(this),this._onMouseMove=iE.bind(this),this._interceptControlDown=_E.bind(this),this._interceptControlUp=$E.bind(this),this.domElement!==null&&this.connect(this.domElement),this.update()}connect(t){super.connect(t),this.domElement.addEventListener("pointerdown",this._onPointerDown),this.domElement.addEventListener("pointercancel",this._onPointerUp),this.domElement.addEventListener("contextmenu",this._onContextMenu),this.domElement.addEventListener("wheel",this._onMouseWheel,{passive:!1}),this.domElement.getRootNode().addEventListener("keydown",this._interceptControlDown,{passive:!0,capture:!0}),this.domElement.style.touchAction="none"}disconnect(){this.domElement.removeEventListener("pointerdown",this._onPointerDown),this.domElement.removeEventListener("pointermove",this._onPointerMove),this.domElement.removeEventListener("pointerup",this._onPointerUp),this.domElement.removeEventListener("pointercancel",this._onPointerUp),this.domElement.removeEventListener("wheel",this._onMouseWheel),this.domElement.removeEventListener("contextmenu",this._onContextMenu),this.stopListenToKeyEvents(),this.domElement.getRootNode().removeEventListener("keydown",this._interceptControlDown,{capture:!0}),this.domElement.style.touchAction="auto"}dispose(){this.disconnect()}getPolarAngle(){return this._spherical.phi}getAzimuthalAngle(){return this._spherical.theta}getDistance(){return this.object.position.distanceTo(this.target)}listenToKeyEvents(t){t.addEventListener("keydown",this._onKeyDown),this._domElementKeyEvents=t}stopListenToKeyEvents(){this._domElementKeyEvents!==null&&(this._domElementKeyEvents.removeEventListener("keydown",this._onKeyDown),this._domElementKeyEvents=null)}saveState(){this.target0.copy(this.target),this.position0.copy(this.object.position),this.zoom0=this.object.zoom}reset(){this.target.copy(this.target0),this.object.position.copy(this.position0),this.object.zoom=this.zoom0,this.object.updateProjectionMatrix(),this.dispatchEvent(ed),this.update(),this.state=pt.NONE}update(t=null){const n=this.object.position;Ft.copy(n).sub(this.target),Ft.applyQuaternion(this._quat),this._spherical.setFromVector3(Ft),this.autoRotate&&this.state===pt.NONE&&this._rotateLeft(this._getAutoRotationAngle(t)),this.enableDamping?(this._spherical.theta+=this._sphericalDelta.theta*this.dampingFactor,this._spherical.phi+=this._sphericalDelta.phi*this.dampingFactor):(this._spherical.theta+=this._sphericalDelta.theta,this._spherical.phi+=this._sphericalDelta.phi);let o=this.minAzimuthAngle,s=this.maxAzimuthAngle;isFinite(o)&&isFinite(s)&&(o<-Math.PI?o+=wn:o>Math.PI&&(o-=wn),s<-Math.PI?s+=wn:s>Math.PI&&(s-=wn),o<=s?this._spherical.theta=Math.max(o,Math.min(s,this._spherical.theta)):this._spherical.theta=this._spherical.theta>(o+s)/2?Math.max(o,this._spherical.theta):Math.min(s,this._spherical.theta)),this._spherical.phi=Math.max(this.minPolarAngle,Math.min(this.maxPolarAngle,this._spherical.phi)),this._spherical.makeSafe(),this.enableDamping===!0?this.target.addScaledVector(this._panOffset,this.dampingFactor):this.target.add(this._panOffset),this.target.sub(this.cursor),this.target.clampLength(this.minTargetRadius,this.maxTargetRadius),this.target.add(this.cursor);let i=!1;if(this.zoomToCursor&&this._performCursorZoom||this.object.isOrthographicCamera)this._spherical.radius=this._clampDistance(this._spherical.radius);else{const r=this._spherical.radius;this._spherical.radius=this._clampDistance(this._spherical.radius*this._scale),i=r!=this._spherical.radius}if(Ft.setFromSpherical(this._spherical),Ft.applyQuaternion(this._quatInverse),n.copy(this.target).add(Ft),this.object.lookAt(this.target),this.enableDamping===!0?(this._sphericalDelta.theta*=1-this.dampingFactor,this._sphericalDelta.phi*=1-this.dampingFactor,this._panOffset.multiplyScalar(1-this.dampingFactor)):(this._sphericalDelta.set(0,0,0),this._panOffset.set(0,0,0)),this.zoomToCursor&&this._performCursorZoom){let r=null;if(this.object.isPerspectiveCamera){const a=Ft.length();r=this._clampDistance(a*this._scale);const c=a-r;this.object.position.addScaledVector(this._dollyDirection,c),this.object.updateMatrixWorld(),i=!!c}else if(this.object.isOrthographicCamera){const a=new Ue(this._mouse.x,this._mouse.y,0);a.unproject(this.object);const c=this.object.zoom;this.object.zoom=Math.max(this.minZoom,Math.min(this.maxZoom,this.object.zoom/this._scale)),this.object.updateProjectionMatrix(),i=c!==this.object.zoom;const l=new Ue(this._mouse.x,this._mouse.y,0);l.unproject(this.object),this.object.position.sub(l).add(a),this.object.updateMatrixWorld(),r=Ft.length()}else console.warn("WARNING: OrbitControls.js encountered an unknown camera type - zoom to cursor disabled."),this.zoomToCursor=!1;r!==null&&(this.screenSpacePanning?this.target.set(0,0,-1).transformDirection(this.object.matrix).multiplyScalar(r).add(this.object.position):(ra.origin.copy(this.object.position),ra.direction.set(0,0,-1).transformDirection(this.object.matrix),Math.abs(this.object.up.dot(ra.direction))<QT?this.object.lookAt(this.target):(td.setFromNormalAndCoplanarPoint(this.object.up,this.target),ra.intersectPlane(td,this.target))))}else if(this.object.isOrthographicCamera){const r=this.object.zoom;this.object.zoom=Math.max(this.minZoom,Math.min(this.maxZoom,this.object.zoom/this._scale)),r!==this.object.zoom&&(this.object.updateProjectionMatrix(),i=!0)}return this._scale=1,this._performCursorZoom=!1,i||this._lastPosition.distanceToSquared(this.object.position)>gl||8*(1-this._lastQuaternion.dot(this.object.quaternion))>gl||this._lastTargetPosition.distanceToSquared(this.target)>gl?(this.dispatchEvent(ed),this._lastPosition.copy(this.object.position),this._lastQuaternion.copy(this.object.quaternion),this._lastTargetPosition.copy(this.target),!0):!1}_getAutoRotationAngle(t){return t!==null?wn/60*this.autoRotateSpeed*t:wn/60/60*this.autoRotateSpeed}_getZoomScale(t){const n=Math.abs(t*.01);return Math.pow(.95,this.zoomSpeed*n)}_rotateLeft(t){this._sphericalDelta.theta-=t}_rotateUp(t){this._sphericalDelta.phi-=t}_panLeft(t,n){Ft.setFromMatrixColumn(n,0),Ft.multiplyScalar(-t),this._panOffset.add(Ft)}_panUp(t,n){this.screenSpacePanning===!0?Ft.setFromMatrixColumn(n,1):(Ft.setFromMatrixColumn(n,0),Ft.crossVectors(this.object.up,Ft)),Ft.multiplyScalar(t),this._panOffset.add(Ft)}_pan(t,n){const o=this.domElement;if(this.object.isPerspectiveCamera){const s=this.object.position;Ft.copy(s).sub(this.target);let i=Ft.length();i*=Math.tan(this.object.fov/2*Math.PI/180),this._panLeft(2*t*i/o.clientHeight,this.object.matrix),this._panUp(2*n*i/o.clientHeight,this.object.matrix)}else this.object.isOrthographicCamera?(this._panLeft(t*(this.object.right-this.object.left)/this.object.zoom/o.clientWidth,this.object.matrix),this._panUp(n*(this.object.top-this.object.bottom)/this.object.zoom/o.clientHeight,this.object.matrix)):(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - pan disabled."),this.enablePan=!1)}_dollyOut(t){this.object.isPerspectiveCamera||this.object.isOrthographicCamera?this._scale/=t:(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - dolly/zoom disabled."),this.enableZoom=!1)}_dollyIn(t){this.object.isPerspectiveCamera||this.object.isOrthographicCamera?this._scale*=t:(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - dolly/zoom disabled."),this.enableZoom=!1)}_updateZoomParameters(t,n){if(!this.zoomToCursor)return;this._performCursorZoom=!0;const o=this.domElement.getBoundingClientRect(),s=t-o.left,i=n-o.top,r=o.width,a=o.height;this._mouse.x=s/r*2-1,this._mouse.y=-(i/a)*2+1,this._dollyDirection.set(this._mouse.x,this._mouse.y,1).unproject(this.object).sub(this.object.position).normalize()}_clampDistance(t){return Math.max(this.minDistance,Math.min(this.maxDistance,t))}_handleMouseDownRotate(t){this._rotateStart.set(t.clientX,t.clientY)}_handleMouseDownDolly(t){this._updateZoomParameters(t.clientX,t.clientX),this._dollyStart.set(t.clientX,t.clientY)}_handleMouseDownPan(t){this._panStart.set(t.clientX,t.clientY)}_handleMouseMoveRotate(t){this._rotateEnd.set(t.clientX,t.clientY),this._rotateDelta.subVectors(this._rotateEnd,this._rotateStart).multiplyScalar(this.rotateSpeed);const n=this.domElement;this._rotateLeft(wn*this._rotateDelta.x/n.clientHeight),this._rotateUp(wn*this._rotateDelta.y/n.clientHeight),this._rotateStart.copy(this._rotateEnd),this.update()}_handleMouseMoveDolly(t){this._dollyEnd.set(t.clientX,t.clientY),this._dollyDelta.subVectors(this._dollyEnd,this._dollyStart),this._dollyDelta.y>0?this._dollyOut(this._getZoomScale(this._dollyDelta.y)):this._dollyDelta.y<0&&this._dollyIn(this._getZoomScale(this._dollyDelta.y)),this._dollyStart.copy(this._dollyEnd),this.update()}_handleMouseMovePan(t){this._panEnd.set(t.clientX,t.clientY),this._panDelta.subVectors(this._panEnd,this._panStart).multiplyScalar(this.panSpeed),this._pan(this._panDelta.x,this._panDelta.y),this._panStart.copy(this._panEnd),this.update()}_handleMouseWheel(t){this._updateZoomParameters(t.clientX,t.clientY),t.deltaY<0?this._dollyIn(this._getZoomScale(t.deltaY)):t.deltaY>0&&this._dollyOut(this._getZoomScale(t.deltaY)),this.update()}_handleKeyDown(t){let n=!1;switch(t.code){case this.keys.UP:t.ctrlKey||t.metaKey||t.shiftKey?this.enableRotate&&this._rotateUp(wn*this.keyRotateSpeed/this.domElement.clientHeight):this.enablePan&&this._pan(0,this.keyPanSpeed),n=!0;break;case this.keys.BOTTOM:t.ctrlKey||t.metaKey||t.shiftKey?this.enableRotate&&this._rotateUp(-wn*this.keyRotateSpeed/this.domElement.clientHeight):this.enablePan&&this._pan(0,-this.keyPanSpeed),n=!0;break;case this.keys.LEFT:t.ctrlKey||t.metaKey||t.shiftKey?this.enableRotate&&this._rotateLeft(wn*this.keyRotateSpeed/this.domElement.clientHeight):this.enablePan&&this._pan(this.keyPanSpeed,0),n=!0;break;case this.keys.RIGHT:t.ctrlKey||t.metaKey||t.shiftKey?this.enableRotate&&this._rotateLeft(-wn*this.keyRotateSpeed/this.domElement.clientHeight):this.enablePan&&this._pan(-this.keyPanSpeed,0),n=!0;break}n&&(t.preventDefault(),this.update())}_handleTouchStartRotate(t){if(this._pointers.length===1)this._rotateStart.set(t.pageX,t.pageY);else{const n=this._getSecondPointerPosition(t),o=.5*(t.pageX+n.x),s=.5*(t.pageY+n.y);this._rotateStart.set(o,s)}}_handleTouchStartPan(t){if(this._pointers.length===1)this._panStart.set(t.pageX,t.pageY);else{const n=this._getSecondPointerPosition(t),o=.5*(t.pageX+n.x),s=.5*(t.pageY+n.y);this._panStart.set(o,s)}}_handleTouchStartDolly(t){const n=this._getSecondPointerPosition(t),o=t.pageX-n.x,s=t.pageY-n.y,i=Math.sqrt(o*o+s*s);this._dollyStart.set(0,i)}_handleTouchStartDollyPan(t){this.enableZoom&&this._handleTouchStartDolly(t),this.enablePan&&this._handleTouchStartPan(t)}_handleTouchStartDollyRotate(t){this.enableZoom&&this._handleTouchStartDolly(t),this.enableRotate&&this._handleTouchStartRotate(t)}_handleTouchMoveRotate(t){if(this._pointers.length==1)this._rotateEnd.set(t.pageX,t.pageY);else{const o=this._getSecondPointerPosition(t),s=.5*(t.pageX+o.x),i=.5*(t.pageY+o.y);this._rotateEnd.set(s,i)}this._rotateDelta.subVectors(this._rotateEnd,this._rotateStart).multiplyScalar(this.rotateSpeed);const n=this.domElement;this._rotateLeft(wn*this._rotateDelta.x/n.clientHeight),this._rotateUp(wn*this._rotateDelta.y/n.clientHeight),this._rotateStart.copy(this._rotateEnd)}_handleTouchMovePan(t){if(this._pointers.length===1)this._panEnd.set(t.pageX,t.pageY);else{const n=this._getSecondPointerPosition(t),o=.5*(t.pageX+n.x),s=.5*(t.pageY+n.y);this._panEnd.set(o,s)}this._panDelta.subVectors(this._panEnd,this._panStart).multiplyScalar(this.panSpeed),this._pan(this._panDelta.x,this._panDelta.y),this._panStart.copy(this._panEnd)}_handleTouchMoveDolly(t){const n=this._getSecondPointerPosition(t),o=t.pageX-n.x,s=t.pageY-n.y,i=Math.sqrt(o*o+s*s);this._dollyEnd.set(0,i),this._dollyDelta.set(0,Math.pow(this._dollyEnd.y/this._dollyStart.y,this.zoomSpeed)),this._dollyOut(this._dollyDelta.y),this._dollyStart.copy(this._dollyEnd);const r=(t.pageX+n.x)*.5,a=(t.pageY+n.y)*.5;this._updateZoomParameters(r,a)}_handleTouchMoveDollyPan(t){this.enableZoom&&this._handleTouchMoveDolly(t),this.enablePan&&this._handleTouchMovePan(t)}_handleTouchMoveDollyRotate(t){this.enableZoom&&this._handleTouchMoveDolly(t),this.enableRotate&&this._handleTouchMoveRotate(t)}_addPointer(t){this._pointers.push(t.pointerId)}_removePointer(t){delete this._pointerPositions[t.pointerId];for(let n=0;n<this._pointers.length;n++)if(this._pointers[n]==t.pointerId){this._pointers.splice(n,1);return}}_isTrackingPointer(t){for(let n=0;n<this._pointers.length;n++)if(this._pointers[n]==t.pointerId)return!0;return!1}_trackPointer(t){let n=this._pointerPositions[t.pointerId];n===void 0&&(n=new $n,this._pointerPositions[t.pointerId]=n),n.set(t.pageX,t.pageY)}_getSecondPointerPosition(t){const n=t.pointerId===this._pointers[0]?this._pointers[1]:this._pointers[0];return this._pointerPositions[n]}_customWheelEvent(t){const n=t.deltaMode,o={clientX:t.clientX,clientY:t.clientY,deltaY:t.deltaY};switch(n){case 1:o.deltaY*=16;break;case 2:o.deltaY*=100;break}return t.ctrlKey&&!this._controlActive&&(o.deltaY*=10),o}}function tE(e){this.enabled!==!1&&(this._pointers.length===0&&(this.domElement.setPointerCapture(e.pointerId),this.domElement.addEventListener("pointermove",this._onPointerMove),this.domElement.addEventListener("pointerup",this._onPointerUp)),!this._isTrackingPointer(e)&&(this._addPointer(e),e.pointerType==="touch"?this._onTouchStart(e):this._onMouseDown(e)))}function nE(e){this.enabled!==!1&&(e.pointerType==="touch"?this._onTouchMove(e):this._onMouseMove(e))}function sE(e){switch(this._removePointer(e),this._pointers.length){case 0:this.domElement.releasePointerCapture(e.pointerId),this.domElement.removeEventListener("pointermove",this._onPointerMove),this.domElement.removeEventListener("pointerup",this._onPointerUp),this.dispatchEvent($h),this.state=pt.NONE;break;case 1:const t=this._pointers[0],n=this._pointerPositions[t];this._onTouchStart({pointerId:t,pageX:n.x,pageY:n.y});break}}function oE(e){let t;switch(e.button){case 0:t=this.mouseButtons.LEFT;break;case 1:t=this.mouseButtons.MIDDLE;break;case 2:t=this.mouseButtons.RIGHT;break;default:t=-1}switch(t){case di.DOLLY:if(this.enableZoom===!1)return;this._handleMouseDownDolly(e),this.state=pt.DOLLY;break;case di.ROTATE:if(e.ctrlKey||e.metaKey||e.shiftKey){if(this.enablePan===!1)return;this._handleMouseDownPan(e),this.state=pt.PAN}else{if(this.enableRotate===!1)return;this._handleMouseDownRotate(e),this.state=pt.ROTATE}break;case di.PAN:if(e.ctrlKey||e.metaKey||e.shiftKey){if(this.enableRotate===!1)return;this._handleMouseDownRotate(e),this.state=pt.ROTATE}else{if(this.enablePan===!1)return;this._handleMouseDownPan(e),this.state=pt.PAN}break;default:this.state=pt.NONE}this.state!==pt.NONE&&this.dispatchEvent(r_)}function iE(e){switch(this.state){case pt.ROTATE:if(this.enableRotate===!1)return;this._handleMouseMoveRotate(e);break;case pt.DOLLY:if(this.enableZoom===!1)return;this._handleMouseMoveDolly(e);break;case pt.PAN:if(this.enablePan===!1)return;this._handleMouseMovePan(e);break}}function rE(e){this.enabled===!1||this.enableZoom===!1||this.state!==pt.NONE||(e.preventDefault(),this.dispatchEvent(r_),this._handleMouseWheel(this._customWheelEvent(e)),this.dispatchEvent($h))}function aE(e){this.enabled!==!1&&this._handleKeyDown(e)}function cE(e){switch(this._trackPointer(e),this._pointers.length){case 1:switch(this.touches.ONE){case $i.ROTATE:if(this.enableRotate===!1)return;this._handleTouchStartRotate(e),this.state=pt.TOUCH_ROTATE;break;case $i.PAN:if(this.enablePan===!1)return;this._handleTouchStartPan(e),this.state=pt.TOUCH_PAN;break;default:this.state=pt.NONE}break;case 2:switch(this.touches.TWO){case $i.DOLLY_PAN:if(this.enableZoom===!1&&this.enablePan===!1)return;this._handleTouchStartDollyPan(e),this.state=pt.TOUCH_DOLLY_PAN;break;case $i.DOLLY_ROTATE:if(this.enableZoom===!1&&this.enableRotate===!1)return;this._handleTouchStartDollyRotate(e),this.state=pt.TOUCH_DOLLY_ROTATE;break;default:this.state=pt.NONE}break;default:this.state=pt.NONE}this.state!==pt.NONE&&this.dispatchEvent(r_)}function lE(e){switch(this._trackPointer(e),this.state){case pt.TOUCH_ROTATE:if(this.enableRotate===!1)return;this._handleTouchMoveRotate(e),this.update();break;case pt.TOUCH_PAN:if(this.enablePan===!1)return;this._handleTouchMovePan(e),this.update();break;case pt.TOUCH_DOLLY_PAN:if(this.enableZoom===!1&&this.enablePan===!1)return;this._handleTouchMoveDollyPan(e),this.update();break;case pt.TOUCH_DOLLY_ROTATE:if(this.enableZoom===!1&&this.enableRotate===!1)return;this._handleTouchMoveDollyRotate(e),this.update();break;default:this.state=pt.NONE}}function uE(e){this.enabled!==!1&&e.preventDefault()}function _E(e){e.key==="Control"&&(this._controlActive=!0,this.domElement.getRootNode().addEventListener("keyup",this._interceptControlUp,{passive:!0,capture:!0}))}function $E(e){e.key==="Control"&&(this._controlActive=!1,this.domElement.getRootNode().removeEventListener("keyup",this._interceptControlUp,{passive:!0,capture:!0}))}const dE={class:"startgame-modal"},pE={class:"card"},mE={class:"card__header"},fE=["src"],hE={class:"card__body"},gE={class:"card__content"},bE={key:0,class:"loading"},yE={key:1,class:"error"},vE={key:2,class:"list"},wE=["onClick"],SE={class:"item__img"},kE=["src","alt"],ME={class:"item__meta"},CE={class:"item__name"},xE={class:"item__level"},PE={class:"preview"},LE={class:"preview__info"},IE={key:0,class:"preview__empty"},TE={key:1,class:"preview__names"},EE={class:"preview__name-number"},AE={class:"preview__name-text"},GE={class:"card__footer"},RE=["disabled"],OE=["src"],DE={__name:"StartGame",props:{musicOn:{type:Boolean,default:!0},paused:{type:Boolean,default:!1}},emits:["confirm","close"],setup(e,{emit:t}){Qn(O=>({v5a78398b:K,v5a792249:ce,v5a7bdc83:J,v1702c6a6:F,v5a7a7f66:he,v5a7b6824:G,v5a78adea:ge,v5a7af3c5:q}));const n=t,o=e,s=oe(!0),i=oe(""),r=oe([]),a=oe(new Set),c=oe(null),l=oe(null),u=Y("@assets/frontend_resource/startgame.mp3");let _,$,d,p,b;const g=new Map,m=Je(()=>a.value.size===3),v=Je(()=>r.value.filter(O=>a.value.has(O.id)));function y(){if(!c.value)return;_=new Ka,_.background=new cs(1710618),$=new Ir(45,c.value.clientWidth/c.value.clientHeight,.1,100),$.position.set(0,3,8),d=new Ja({antialias:!0}),d.setSize(c.value.clientWidth,c.value.clientHeight),d.setPixelRatio(window.devicePixelRatio),c.value.appendChild(d.domElement),p=new eE($,d.domElement),p.enableDamping=!0,p.dampingFactor=.05,p.target.set(0,1,0);const O=new Xa(16777215,.5);_.add(O);const X=new vs(16777215,1);X.position.set(0,5,10),_.add(X);const W=new vs(11193599,.4);W.position.set(-5,3,5),_.add(W);const ve=new vs(16764074,.4);ve.position.set(5,3,5),_.add(ve);const Ne=new vs(16777215,.3);Ne.position.set(0,5,-5),_.add(Ne);const Ze=new cr(20,20),He=new Bt({color:2763306,side:Pn}),lt=new St(Ze,He);lt.rotation.x=-Math.PI/2,lt.position.y=0,_.add(lt),b=new Dc;const et=new Nc;et.setDecoderPath("https://www.gstatic.com/draco/versioned/decoders/1.5.6/"),b.setDRACOLoader(et),w(),window.addEventListener("resize",k)}function w(){requestAnimationFrame(w),p&&p.update(),d&&_&&$&&d.render(_,$)}function k(){!c.value||!$||!d||($.aspect=c.value.clientWidth/c.value.clientHeight,$.updateProjectionMatrix(),d.setSize(c.value.clientWidth,c.value.clientHeight))}function I(O){const X=a.value;if(X.has(O))X.delete(O);else{if(X.size>=3)return;X.add(O)}a.value=new Set(X)}async function P(O,X){if(!_||!b)return;let W=O.modelUrl;f(`[StartGame] model_url: ${O.name}, URL: ${W}`);try{const ve=await On.loadModel(W,!0);f(`[StartGame] : ${O.name}`);const Ze=new pn().setFromObject(ve).getSize(new Ue),He=new ns;He.add(ve);const lt=2.5,et=-(v.value.length-1)*lt/2;He.position.set(et+X*lt,0,0),He.scale.set(1,1,1),He.rotation.y=-Math.PI/2;const at=new pn().setFromObject(He);He.position.y=-at.min.y,_.add(He),g.set(O.id,He),f(`[StartGame] : ${O.name}`)}catch(ve){f(`[StartGame] : ${O.name}`,ve),T(O,X)}}function T(O,X){if(!_)return;const W=new gs(.8,.8,.8),ve=new Bt({color:4491519}),Ne=new St(W,ve),Ze=2.5,He=-(v.value.length-1)*Ze/2;Ne.position.set(He+X*Ze,.8,0),Ne.rotation.y=-Math.PI/2,_.add(Ne),g.set(O.id,Ne)}function x(){_&&(g.forEach(O=>{_.remove(O),O.geometry&&O.geometry.dispose(),O.material&&(Array.isArray(O.material)?O.material.forEach(X=>X.dispose()):O.material.dispose())}),g.clear(),v.value.forEach((O,X)=>{P(O,X)}))}async function D(){s.value=!0,i.value="";try{const O=ga(),X=Array.isArray(O==null?void 0:O.coppers)?O.coppers:[];r.value=(X||[]).map((W,ve)=>{var Ze,He,lt,et,at,Rt;const Ne=(Ze=W==null?void 0:W.copper_info)==null?void 0:Ze.model_url;return f(`[StartGame] Copper ${((He=W==null?void 0:W.copper_info)==null?void 0:He.name)||ve+1}: model_url=${Ne}`),{id:Number((W==null?void 0:W.id)??ve+1),name:((lt=W==null?void 0:W.copper_info)==null?void 0:lt.name)||`#${ve+1}`,icon:Y(((et=W==null?void 0:W.copper_info)==null?void 0:et.icon_url)||""),level:Number((W==null?void 0:W.level)??1),copperType:(W==null?void 0:W.copper_type)||"Arcanist",modelName:((Rt=(at=W==null?void 0:W.copper_info)==null?void 0:at.name)==null?void 0:Rt.toLowerCase())||"",modelUrl:Ne?Y(Ne):""}})}catch(O){f("[StartGame] ",O),i.value=""}finally{s.value=!1}}async function U(){if(a.value.size!==3)return;const O=Array.from(a.value).map(X=>String(X));window.__ACTUAL_COPPER_IDS__=O,f("[StartGame] ID:",O),n("confirm",{ids:O})}function L(){n("close")}Tn(v,()=>{x()},{deep:!0}),gn(()=>{D(),setTimeout(()=>{y()},100),o.musicOn&&!o.paused&&l.value&&setTimeout(()=>{if(l.value.readyState>=2)l.value.play().then(()=>{f("[StartGame] ")}).catch(X=>{f("[StartGame] :",X)});else{const X=()=>{l.value.play().then(()=>{f("[StartGame] ")}).catch(W=>{f("[StartGame] :",W)}),l.value.removeEventListener("canplay",X)};l.value.addEventListener("canplay",X,{once:!0})}},200)}),Tn(()=>o.musicOn,O=>{if(l.value)if(O&&!o.paused)if(l.value.readyState>=2)l.value.play().catch(X=>{f("[StartGame] :",X)});else{const X=()=>{l.value.play().catch(W=>{f("[StartGame] :",W)}),l.value.removeEventListener("canplay",X)};l.value.addEventListener("canplay",X)}else l.value.pause()}),Tn(()=>o.paused,O=>{if(l.value){if(O)l.value.pause(),f("[StartGame] ");else if(o.musicOn){if(l.value.readyState>=2)l.value.play().catch(X=>{f("[StartGame] :",X)});else{const X=()=>{l.value.play().catch(W=>{f("[StartGame] :",W)}),l.value.removeEventListener("canplay",X)};l.value.addEventListener("canplay",X)}f("[StartGame] ")}}}),Ls(()=>{window.removeEventListener("resize",k),l.value&&l.value.pause(),g.forEach(O=>{_&&_.remove(O)}),g.clear(),d&&d.dispose(),p&&p.dispose()});const K=`url('${Y("@assets/ui/panel1.png")}')`,ge=`url('${Y("@assets/ui/panel2.png")}')`,ce=`url('${Y("@assets/ui/panel3.png")}')`,he=`url('${Y("@assets/ui/panel6.png")}')`,q=`url('${Y("@assets/ui/panel7.png")}')`,G=`url('${Y("@assets/ui/panel8.png")}')`,J=`url('${Y("@assets/ui/panel9.png")}')`,F=`url('${Y("@assets/ui/panel10.png")}')`;return(O,X)=>(V(),Z("div",dE,[h("div",pE,[h("div",mE,[X[0]||(X[0]=h("div",{class:"card__title"},"",-1)),h("button",{class:"card__close",onClick:L,"aria-label":""},[h("img",{src:ye(Y)("@assets/ui/close.png"),alt:""},null,8,fE)])]),h("div",hE,[h("div",gE,[s.value?(V(),Z("div",bE,"...")):i.value?(V(),Z("div",yE,_e(i.value),1)):(V(),Z("div",vE,[(V(!0),Z(ht,null,Yn(r.value,W=>(V(),Z("div",{key:W.id,class:kt(["item",{"item--selected":a.value.has(W.id)}]),onClick:ve=>I(W.id)},[h("div",SE,[h("img",{src:W.icon,alt:W.name},null,8,kE)]),h("div",ME,[h("div",CE,_e(W.name),1),h("div",xE,"Lv. "+_e(W.level),1)])],10,wE))),128))])),X[1]||(X[1]=h("div",{class:"hint"},"3",-1))]),h("div",PE,[X[2]||(X[2]=h("div",{class:"preview__title"},"",-1)),h("div",{ref_key:"previewContainer",ref:c,class:"preview__scene"},null,512),h("div",LE,[v.value.length===0?(V(),Z("div",IE,"  ")):(V(),Z("div",TE,[(V(!0),Z(ht,null,Yn(v.value,(W,ve)=>(V(),Z("div",{key:W.id,class:"preview__name"},[h("span",EE,_e(ve+1),1),h("span",AE,_e(W.name),1)]))),128))]))])])]),h("div",GE,[h("button",{class:"btn btn--primary",disabled:!m.value,onClick:U},"  ",8,RE),h("button",{class:"btn",onClick:L},"")])]),h("audio",{ref_key:"audioRef",ref:l,src:ye(u),loop:"",preload:"auto"},null,8,OE)]))}},NE=qt(DE,[["__scopeId","data-v-a6884db3"]]),jE={:"spark",:"syrup",:"bubble",:"glimmer",:"turner",:"wrench",:"artifex",:"coil",:"drillbit",:"quickhand",:"rocky",:"wesley",:"bell",:"tumble",:"chief",:"gyro",:"tricky",:"pendulum",:"yoyo",:"karin",:"murmur",:"melody",:"clawster",:"diggs",:"hive"},HE={IronWall:"iron_wall",Arcanist:"arcanist",Mechanic:"mechanic",Resonator:"resonator",CraftsMan:"craftsman"};function FE(e){return jE[e]||e.toLowerCase()}function UE(e){return HE[e]||e.toLowerCase()}const BE={:"rivet_barrier",:"gear_arrow_tower",:"heart_source_mineral_drill",:"steam_mining_car",:"charging_coil",:"repair_workshop",:"mirro_light_refraction_tower",:"resonance_alarm_bell",:"storm_anvil",:"automatic_loading_gun"};function zE(e){return BE[e]||e.toLowerCase().replace(/\s+/g,"_")}function VE(e,t){const n=new Map;function o(l,u,_){if(n.has(l)){const k=n.get(l);k.maxHp=_,s(l,u,_);return}const $=1,d=.1,p=new cr($,d),b=new zt({color:4456448,side:Pn,depthTest:!1,depthWrite:!1,transparent:!1,toneMapped:!1}),g=new St(p,b),m=new cr($,d),v=new zt({color:i(u,_),side:Pn,depthTest:!1,depthWrite:!1,transparent:!1,toneMapped:!1}),y=new St(m,v);y.position.z=.001;const w=new ns;w.add(g),w.add(y),w.renderOrder=999,g.renderOrder=999,y.renderOrder=1e3,e.add(w),n.set(l,{bar:y,background:g,container:w,maxHp:_}),s(l,u,_)}function s(l,u,_){const $=n.get(l);if(!$)return;const{bar:d}=$,p=Math.max(0,Math.min(1,u/_));d.scale.x=p,d.position.x=-(1-p)*.5,d.material.color.setHex(i(u,_))}function i(l,u){const _=l/u;return _>.6?65280:_>.3?16776960:16711680}function r(l){const u=n.get(l);if(!u)return;const{bar:_,background:$,container:d}=u;_.geometry.dispose(),_.material.dispose(),$.geometry.dispose(),$.material.dispose(),e.remove(d),n.delete(l)}function a(l){n.forEach((u,_)=>{const $=l.find(d=>d.id===_);if($&&$.object){const{container:d}=u,p=$.object.position.clone();p.y+=1.5,d.position.copy(p),d.lookAt(t.position)}})}function c(){n.forEach((l,u)=>{r(u)}),n.clear()}return{healthBars:n,createOrUpdateHealthBar:o,updateHealthBarValue:s,removeHealthBar:r,updateHealthBarsPosition:a,dispose:c}}const qE={url:Y("@assets/ui/skybox.jpg"),radius:1e3,segments:32,hemisphere:!1},WE={ambient:{color:16777215,intensity:.5},mainDirectional:{color:16777215,intensity:1.2,position:{x:0,y:20,z:5},castShadow:!0},topLight:{color:16777215,intensity:.8,position:{x:0,y:30,z:0}},hemisphere:{skyColor:16777215,groundColor:4473924,intensity:.6,position:{x:0,y:20,z:0}}};function KE(){return{...qE}}const JE={fov:60,near:.1,far:2e3,position:{x:0,y:5,z:10}},XE={antialias:!0},YE={decoderPath:"https://www.gstatic.com/draco/versioned/decoders/1.5.6/"},ZE={moveSpeed:.2,rotationSpeed:.003,focusLerpFactor:.08},QE={enabled:!0,units:[{id:1,name:"1",color:4491519,position:{x:.5,y:.4,z:.5},size:.8},{id:2,name:"2",color:16729156,position:{x:4.5,y:.4,z:4.5},size:.8}]},e8={enabled:!0,materialType:"standard",basic:{color:4868682,opacity:.8},standard:{color:5921386,roughness:.3,metalness:.7,opacity:.8},texture:{url:null,repeat:{x:1,y:1}},size:.95,height:.05,yOffset:-.02},t8={enabled:!1,size:100,materialType:"standard",texture:{url:null,repeat:{x:10,y:10},wrapS:"RepeatWrapping",wrapT:"RepeatWrapping"},color:{value:2763306},standard:{color:3815994,roughness:.8,metalness:.1,normalMap:null,normalScale:{x:1,y:1},roughnessMap:null,aoMap:null},position:{x:0,y:0,z:0},rotation:{x:-Math.PI/2,y:0,z:0}};function n8(){return{...WE}}function s8(){return{...JE}}function o8(){return{...XE}}function i8(){return{...YE}}function nd(){return{...ZE}}function r8(){return{...QE}}function a8(){return{...t8}}function dh(){return{...e8}}function c8(e){const t={move:[],attack:[],summon:[]},n=dh();function o(_={}){var d;const $={...n,..._};if(!$.enabled)return new zt({transparent:!0,opacity:0});if($.materialType==="texture"&&$.texture.url){const b=new ki().load($.texture.url);return b.colorSpace=tn,b.wrapS=Bs,b.wrapT=Bs,b.repeat.set($.texture.repeat.x,$.texture.repeat.y),new Bt({map:b,side:Pn,transparent:!0,opacity:((d=$.standard)==null?void 0:d.opacity)||1})}else return $.materialType==="standard"?new Bt({color:$.standard.color,roughness:$.standard.roughness,metalness:$.standard.metalness,side:Pn,transparent:!0,opacity:$.standard.opacity}):new zt({color:$.basic.color,side:Pn,transparent:!0,opacity:$.basic.opacity})}const s={move:{color:4521796,opacity:.6},attack:{color:16729156,opacity:.6},summon:{color:16776960,opacity:.6}};function i(_,$="move"){const[d,p]=_,b=s[$]||s.move,g=n.size||.9,m=n.height||.08,v=new cr(g,g),y=new zt({color:b.color,side:Pn,transparent:!0,opacity:b.opacity}),w=new St(v,y);return w.rotation.x=-Math.PI/2,w.position.set(d,m,p),w.userData={position:_,type:$},e.add(w),t[$].push(w),w}function r(_){const[$,d]=_;let p=!1;return Object.keys(t).forEach(b=>{const g=t[b].findIndex(m=>{const v=m.userData.position;return v[0]===$&&v[1]===d});if(g!==-1){const m=t[b][g];e.remove(m),m.geometry.dispose(),m.material.dispose(),t[b].splice(g,1),p=!0}}),p}function a(_){t[_]&&(t[_].forEach($=>{e.remove($),$.geometry.dispose(),$.material.dispose()}),t[_]=[])}function c(){Object.keys(t).forEach(_=>{a(_)})}function l(_,$){var b;const[d,p]=_;return(b=t[$])==null?void 0:b.some(g=>{const m=g.userData.position;return m[0]===d&&m[1]===p})}function u(){c()}return{indicators:t,createIndicator:i,createCellMaterial:o,clearIndicatorAt:r,clearIndicators:a,clearAllIndicators:c,hasIndicatorAt:l,dispose:u}}function l8(){const e={geometries:[],materials:[],meshes:[],maxSize:10},t={geometries:[],materials:[],meshes:[],maxSize:10};function n(a){let c;if(e.meshes.length>0)c=e.meshes.pop(),c.geometry.dispose(),c.geometry=new ya(.05,.05,a,8),c.material.opacity=.9;else{const l=new ya(.05,.05,a,8),u=new zt({color:16729156,transparent:!0,opacity:.9,emissive:16729156,emissiveIntensity:.5});c=new St(l,u)}return c}function o(a){e.meshes.length<e.maxSize?e.meshes.push(a):(a.geometry.dispose(),a.material.dispose())}function s(){let a;if(t.meshes.length>0)a=t.meshes.pop(),a.scale.set(1,1,1),a.material.opacity=.8;else{const c=new Sl(.2,.4,32),l=new zt({color:16711680,side:Pn,transparent:!0,opacity:.8,emissive:16711680,emissiveIntensity:.5});a=new St(c,l),a.rotation.x=-Math.PI/2}return a}function i(a){t.meshes.length<t.maxSize?t.meshes.push(a):(a.geometry.dispose(),a.material.dispose())}function r(){e.meshes.forEach(a=>{a.geometry.dispose(),a.material.dispose()}),e.meshes=[],e.geometries=[],e.materials=[],t.meshes.forEach(a=>{a.geometry.dispose(),a.material.dispose()}),t.meshes=[],t.geometries=[],t.materials=[]}return{getAttackRay:n,recycleAttackRay:o,getExplosionRing:s,recycleExplosionRing:i,dispose:r}}function u8(e){const t=l8();function n(i,r){const a=new Ue(i[0],.5,i[1]),c=new Ue(r[0],.5,r[1]),l=a.distanceTo(c),u=t.getAttackRay(l),_=new Ue().addVectors(a,c).multiplyScalar(.5);u.position.copy(_);const $=new Ue().subVectors(c,a).normalize(),d=new Si;d.setFromUnitVectors(new Ue(0,1,0),$),u.quaternion.copy(d),e.add(u);let p=.9;const b=()=>{p-=.05,u.material.opacity=p,p<=0?(e.remove(u),t.recycleAttackRay(u)):requestAnimationFrame(b)};setTimeout(b,300);const g=t.getExplosionRing();g.position.set(r[0],.1,r[1]),e.add(g);let m=1,v=.8;const y=()=>{m+=.1,v-=.08,g.scale.set(m,m,1),g.material.opacity=v,v<=0?(e.remove(g),t.recycleExplosionRing(g)):requestAnimationFrame(y)};y()}function o(i,r){const a=Object.entries(r).filter(([w,k])=>k>0).map(([w,k])=>{const I=Qt(w);return`+${k} ${I}`});if(a.length===0)return;const c=a.join(`
`),l=document.createElement("canvas"),u=l.getContext("2d");l.width=512,l.height=256,u.fillStyle="rgba(0, 0, 0, 0)",u.fillRect(0,0,l.width,l.height),u.font="bold 48px Arial",u.fillStyle="#ffff00",u.strokeStyle="#000000",u.lineWidth=4,u.textAlign="center",u.textBaseline="middle";const _=c.split(`
`),$=60,d=l.height/2-(_.length-1)*$/2;_.forEach((w,k)=>{const I=d+k*$;u.strokeText(w,l.width/2,I),u.fillText(w,l.width/2,I)});const p=new P0(l),b=new L0({map:p,transparent:!0,opacity:1}),g=new I0(b);g.scale.set(2,1,1),g.position.set(i[0],1.5,i[1]),e.add(g);let m=1.5,v=1;const y=()=>{m+=.02,v-=.01,g.position.y=m,g.material.opacity=v,v<=0?(e.remove(g),g.material.map.dispose(),g.material.dispose()):requestAnimationFrame(y)};y()}function s(){t.dispose()}return{createAttackEffect:n,createResourceGainEffect:o,dispose:s}}const _8={gameScene:Y("@assets/frontend_resource/gamescene.mp3")},$8={move:Y("@assets/frontend_resource/move.mp3"),moveEnemy:Y("@assets/frontend_resource/move_enemy.mp3"),attack:Y("@assets/frontend_resource/attack.mp3"),attackEnemy:Y("@assets/frontend_resource/attack_enemy.mp3"),meHurt:Y("@assets/frontend_resource/me_hurt.mp3"),enemyHurt:Y("@assets/frontend_resource/enemy_hurt.mp3")};function d8(e){return _8[e]||""}function ii(e){return $8[e]||""}let Gt=null;function p8(e,t,n={}){const{radius:o=1e3,segments:s=32,hemisphere:i=!1}=n;Gt&&(e.remove(Gt),Gt.geometry&&Gt.geometry.dispose(),Gt.material&&(Gt.material.map&&Gt.material.map.dispose(),Gt.material.dispose()),Gt=null),new ki().load(t,a=>{a.colorSpace=tn;const c=i?new kl(o,s,s,0,Math.PI*2,0,Math.PI/2):new kl(o,s,s),l=new zt({map:a,side:E0,depthWrite:!1});Gt=new St(c,l),Gt.position.set(0,0,0),e.add(Gt),f(`[SceneUtils] ${i?"":""}${o}`)},void 0,a=>{f("[SceneUtils] ",a),e.background=new cs(2236962)})}function m8(e,t){if(!t||!t.url){e.background=new cs(2236962);return}p8(e,t.url,{radius:t.radius||1e3,segments:t.segments||32,hemisphere:t.hemisphere||!1})}function f8(e,t){const n=new Xa(t.ambient.color,t.ambient.intensity);e.add(n);const o=new vs(t.mainDirectional.color,t.mainDirectional.intensity);o.position.set(t.mainDirectional.position.x,t.mainDirectional.position.y,t.mainDirectional.position.z),o.castShadow=t.mainDirectional.castShadow,e.add(o);const s=new vs(t.topLight.color,t.topLight.intensity);s.position.set(t.topLight.position.x,t.topLight.position.y,t.topLight.position.z),e.add(s);const i=new T0(t.hemisphere.skyColor,t.hemisphere.groundColor,t.hemisphere.intensity);i.position.set(t.hemisphere.position.x,t.hemisphere.position.y,t.hemisphere.position.z),e.add(i)}function h8(e={}){const t={...s8(),...e},n=window.innerWidth/window.innerHeight,o=new Ir(t.fov,n,t.near,t.far);return o.position.set(t.position.x,t.position.y,t.position.z),o}function g8(e,t={}){const n={...o8(),...t},o=t.width||window.innerWidth,s=t.height||window.innerHeight,i=new Ja({antialias:n.antialias});return i.setSize(o,s),i.setPixelRatio(window.devicePixelRatio),e.appendChild(i.domElement),i}function b8(e=null){const t=i8(),n=e||t.decoderPath,o=new Dc,s=new Nc;return s.setDecoderPath(n),o.setDRACOLoader(s),o}function y8(e,t){const n=r8();n.enabled&&(n.units.forEach(o=>{const s=new gs(o.size,o.size,o.size),i=new Bt({color:o.color}),r=new St(s,i);r.position.set(o.position.x,o.position.y,o.position.z),e.add(r),t.push({id:o.id,object:r,name:o.name,type:"test"})}),f("[SceneUtils] :",t.map(o=>`ID=${o.id}`)))}function v8(e,t={}){const n={...a8(),...t};if(!n.enabled)return null;const o=new cr(n.size,n.size);let s;if(n.materialType==="texture"&&n.texture.url){const a=new ki().load(n.texture.url);a.colorSpace=tn,a.wrapS=h_[n.texture.wrapS]||Bs,a.wrapT=h_[n.texture.wrapT]||Bs,a.repeat.set(n.texture.repeat.x,n.texture.repeat.y),s=new Bt({map:a,side:Pn})}else if(n.materialType==="color")s=new zt({color:n.color.value,side:Pn});else{const r={color:n.standard.color,roughness:n.standard.roughness,metalness:n.standard.metalness,side:Pn},a=new ki;if(n.standard.normalMap){const c=a.load(n.standard.normalMap);c.colorSpace=tn,r.normalMap=c,r.normalScale=new $n(n.standard.normalScale.x,n.standard.normalScale.y)}if(n.standard.roughnessMap){const c=a.load(n.standard.roughnessMap);c.colorSpace=tn,r.roughnessMap=c}if(n.standard.aoMap){const c=a.load(n.standard.aoMap);c.colorSpace=tn,r.aoMap=c}s=new Bt(r)}const i=new St(o,s);return i.position.set(n.position.x,n.position.y,n.position.z),i.rotation.set(n.rotation.x,n.rotation.y,n.rotation.z),i.renderOrder=-200,e.add(i),f(`[SceneUtils] ${n.materialType}${n.size}`),i}function w8(e){Gt&&e&&(e.remove(Gt),Gt.geometry&&Gt.geometry.dispose(),Gt.material&&(Gt.material.map&&Gt.material.map.dispose(),Gt.material.dispose()),Gt=null)}const S8={key:0,class:"diamond-name"},k8={class:"diamond-row diamond-row--top"},M8=["title","aria-disabled"],C8={class:"diamond border-orange-red"},x8={class:"diamond-content"},P8={class:"diamond-text"},L8={class:"diamond-value"},I8={class:"diamond-row diamond-row--bottom"},T8={class:"diamond border-orange-red"},E8={class:"diamond-content"},A8={class:"diamond-text"},G8={class:"diamond-value"},R8={class:"diamond border-green"},O8={class:"diamond-content"},D8={class:"diamond-text"},N8={class:"diamond-value"},j8={class:"diamond border-blue"},H8={class:"diamond-content"},F8={class:"diamond-text"},U8={class:"diamond-value"},B8={__name:"DiamondPanel",props:{copperInfo:{type:Object,required:!0},inventoryItems:{type:Array,default:()=>[]},inventoryCapacity:{type:Number,default:5}},emits:["inventory-click"],setup(e,{emit:t}){Qn(m=>({e06679e6:$,bff86908:n,ec019c62:o,v7deac64f:s}));const n=`url('${Y("ui/border-blue.png")}')`,o=`url('${Y("ui/border-green.png")}')`,s=`url('${Y("ui/border-orange-red.png")}')`,i=e,r=t,a=Je(()=>{var m;return(((m=i.copperInfo)==null?void 0:m.name)||"").trim()}),c=Je(()=>{var m,v;return((m=i.copperInfo)==null?void 0:m.isOwnedEnemy)===!0||((v=i.copperInfo)==null?void 0:v.isEnemy)===!0}),l=Je(()=>c.value&&a.value!==""),u=Je(()=>{var v;const m=(v=i.copperInfo)==null?void 0:v.position;return!Array.isArray(m)||m.length<2?"--":`${m[0]},${m[1]}`}),_=Je(()=>c.value===!0),$=`url('${Y("@assets/ui/panel4.png")}')`,d=oe({SpiritalSpark:0,RecallGear:0,ResonantCrystal:0,RefinedCopper:0,HeartCrystalDust:0});async function p(){try{const m=Oc();m&&Object.keys(d.value).forEach(v=>{d.value[v]=m[v]||0})}catch(m){console.error("[DiamondPanel] :",m)}}Je(()=>Object.values(d.value).filter(m=>m>0).length);function b(){_.value||r("inventory-click")}const g=oe(null);return gn(async()=>{if(p(),_c(kn.UPDATE_RESOURCES,p),!g.value)return;function m(y){return new Promise((w,k)=>{const I=new Image;I.onload=()=>w(I),I.onerror=()=>k(),I.src=y})}function v(y,w){g.value&&g.value.style.setProperty(y,String(w))}try{const[y,w,k]=await Promise.all([m(Y("ui/border-blue.png")),m(Y("ui/border-green.png")),m(Y("ui/border-orange-red.png"))]),I=Math.max(3,Math.round(y.naturalHeight/4)),P=Math.max(3,Math.round(w.naturalHeight/4)),T=Math.max(3,Math.round(k.naturalHeight/4));v("--border-blue-slice",I),v("--border-green-slice",P),v("--border-orange-red-slice",T)}catch{v("--border-blue-slice","8"),v("--border-green-slice","8"),v("--border-orange-red-slice","8")}}),(m,v)=>(V(),Z("div",{ref_key:"diamondPanelRef",ref:g,class:"diamond-panel"},[l.value?(V(),Z("div",S8,_e(a.value),1)):Ie("",!0),h("div",k8,[h("div",{class:kt(["diamond","border-blue",{"diamond--disabled":_.value}]),onClick:b,title:_.value?"":"","aria-disabled":_.value?"true":"false"},[...v[0]||(v[0]=[h("div",{class:"diamond-content"},[h("div",{class:"diamond-text"},[h("div",{class:"diamond-label"},"")])],-1)])],10,M8),h("div",C8,[h("div",x8,[h("div",P8,[v[1]||(v[1]=h("div",{class:"diamond-label"},"",-1)),h("div",L8,_e(u.value),1)])])])]),h("div",I8,[h("div",T8,[h("div",E8,[h("div",A8,[v[2]||(v[2]=h("div",{class:"diamond-label"},"",-1)),h("div",G8,_e(e.copperInfo.attack),1)])])]),h("div",R8,[h("div",O8,[h("div",D8,[v[3]||(v[3]=h("div",{class:"diamond-label"},"",-1)),h("div",N8,_e(e.copperInfo.defense),1)])])]),h("div",j8,[h("div",H8,[h("div",F8,[v[4]||(v[4]=h("div",{class:"diamond-label"},"",-1)),h("div",U8,_e(e.copperInfo.speed),1)])])])])],512))}},z8=qt(B8,[["__scopeId","data-v-fb57740a"]]),V8={class:"minecraft-inventory"},q8={class:"inventory-layout"},W8={class:"inventory-section"},K8={class:"equipment-header-mc"},J8={class:"copper-name"},X8={class:"inventory-grid"},Y8={class:"slot-icon"},Z8=["src","alt"],Q8=["src"],eA=["src"],tA={key:3,class:"equipment-icon"},nA={class:"slot-tooltip"},sA={class:"tooltip-name"},oA={__name:"InventoryModal",props:{visible:{type:Boolean,default:!1},copperName:{type:String,default:""},equipment:{type:Array,default:()=>[]}},emits:["close"],setup(e,{emit:t}){const n=e,o=Je(()=>n.equipment||[]),s=t;function i(){s("close")}return(r,a)=>e.visible?(V(),Z("div",{key:0,class:"inventory-modal",onClick:Fs(i,["self"])},[h("div",V8,[h("div",q8,[h("div",W8,[h("div",K8,[h("h4",null,[h("span",J8,_e(e.copperName),1),a[0]||(a[0]=zo("  ",-1))])]),h("div",X8,[(V(),Z(ht,null,Yn(2,(c,l)=>{var u,_,$,d,p,b,g,m,v,y;return h("div",{key:l,class:kt(["inv-slot",{"has-item":l<o.value.length&&((u=o.value[l])==null?void 0:u.equipped),"slot-locked":(_=o.value[l])==null?void 0:_.locked}])},[l<o.value.length?(V(),Z(ht,{key:0},[h("div",Y8,[($=o.value[l])!=null&&$.equipped&&((d=o.value[l])!=null&&d.icon)&&o.value[l].icon!==""&&(o.value[l].icon.startsWith("/")||o.value[l].icon.startsWith("http")||o.value[l].icon.includes("."))?(V(),Z("img",{key:0,src:o.value[l].icon,alt:((p=o.value[l])==null?void 0:p.name)||"",class:"equipment-icon"},null,8,Z8)):(b=o.value[l])!=null&&b.locked?(V(),Z("img",{key:1,src:ye(Y)("@assets/ui/lock.png"),alt:"",class:"equipment-icon"},null,8,Q8)):((g=o.value[l])==null?void 0:g.icon)===""?(V(),Z("img",{key:2,src:ye(Y)("@assets/ui/jia.png"),alt:"",class:"equipment-icon"},null,8,eA)):(V(),Z("span",tA,_e(((m=o.value[l])==null?void 0:m.icon)||""),1))]),h("div",nA,[h("div",sA,_e(((v=o.value[l])==null?void 0:v.name)||((y=o.value[l])!=null&&y.locked?"":"")),1)])],64)):Ie("",!0)],2)}),64))])])])])])):Ie("",!0)}},iA=qt(oA,[["__scopeId","data-v-10271215"]]),rA={class:"health-bar","aria-label":"Health Bar"},aA={class:"health-bar__border"},cA={class:"health-bar__border-left"},lA=["src"],uA={class:"health-bar__border-right"},_A=["src"],$A={class:"health-bar__text"},dA={__name:"HealthBar",props:{hp:{type:Number,default:0},maxHp:{type:Number,default:100}},setup(e){Qn(c=>({v3bf30af6:s,v3ceb41be:i}));const t=e,n=Y("ui/blood-border-left.png"),o=Y("ui/blood-border-right.png"),s=`url('${Y("ui/blood-border-middle.png")}')`,i=`url('${Y("ui/blood-bar.png")}')`,r=Je(()=>{if(!t.maxHp||t.maxHp===0)return 0;const l=Math.max(0,Math.min(t.hp,t.maxHp))/t.maxHp*100;return Math.max(0,Math.min(100,l))}),a=Je(()=>{const c=Math.max(0,Math.min(t.hp,t.maxHp)),l=t.maxHp||100;return`${Math.round(c)}/${Math.round(l)}`});return(c,l)=>(V(),Z("div",rA,[h("div",aA,[h("div",cA,[h("img",{src:ye(n),alt:""},null,8,lA)]),l[0]||(l[0]=h("div",{class:"health-bar__border-middle"},null,-1)),h("div",uA,[h("img",{src:ye(o),alt:""},null,8,_A)]),h("div",{class:"health-bar__fill",style:zn({width:`calc(${r.value}% + 20px)`})},null,4),h("div",$A,_e(a.value),1)])]))}},pA=qt(dA,[["__scopeId","data-v-7b5f9ec2"]]),mA={class:"tri-panel"},fA={class:"diamond","aria-label":""},hA=["src"],gA=["src"],bA=["title"],yA=["src"],vA=["src"],wA=["title"],SA=["src"],kA=["src","alt"],MA={__name:"TriPanel",props:{copperType:{type:String,default:""},canMove:{type:Boolean,default:!0},canAttack:{type:Boolean,default:!0},canSummon:{type:Boolean,default:!1}},emits:["move","wait","attack","summon","build"],setup(e,{emit:t}){const n=e,o=t,s=Je(()=>n.copperType==="CraftsMan"?"build":n.copperType==="Resonator"?"summon":"attack"),i=Je(()=>s.value==="build"?n.canSummon?"":"":s.value==="summon"?n.canSummon?"":"":n.canAttack?"":""),r=Je(()=>s.value==="build"||s.value==="summon"?!n.canSummon:!n.canAttack),a=Y("ui/your-image.png"),c=Y("ui/boot.png"),l=Y("ui/mushroom.png"),u=Y("ui/sword.png"),_=Y("@assets/ui/summon.png"),$=Y("@assets/ui/build.png");function d(){n.canMove&&o("move")}function p(){o("wait")}function b(){if(s.value==="build"){if(!n.canSummon)return;o("build")}else if(s.value==="summon"){if(!n.canSummon)return;o("summon")}else{if(!n.canAttack)return;o("attack")}}return(g,m)=>(V(),Z("div",mA,[h("div",fA,[h("div",{class:"hex top",title:"",onClick:p},[h("img",{class:"hex-bg",src:ye(a),alt:""},null,8,hA),h("img",{class:"hex-icon",src:ye(c),alt:""},null,8,gA)]),h("div",{class:kt(["hex left",{"is-locked":e.canMove===!1}]),title:e.canMove?"":"",onClick:d},[h("img",{class:"hex-bg",src:ye(a),alt:""},null,8,yA),h("img",{class:"hex-icon",src:ye(l),alt:""},null,8,vA)],10,bA),h("div",{class:kt(["hex right",{"is-locked":r.value}]),title:i.value,onClick:b},[h("img",{class:"hex-bg",src:ye(a),alt:""},null,8,SA),h("img",{class:"hex-icon",src:s.value==="build"?ye($):s.value==="summon"?ye(_):ye(u),alt:s.value==="build"?"":s.value==="summon"?"":""},null,8,kA)],10,wA)])]))}},CA=qt(MA,[["__scopeId","data-v-38a09e87"]]),xA={class:"modal-header"},PA=["src"],LA={class:"modal-info"},IA={class:"info-text"},TA={class:"copper-name"},EA={class:"modal-body"},AA={class:"structure-list"},GA=["onClick"],RA={class:"structure-header"},OA={class:"structure-name-row"},DA={class:"structure-name"},NA={class:"structure-type"},jA={class:"structure-stats"},HA={class:"stat"},FA={class:"stat-value"},UA={class:"stat"},BA={class:"stat-value"},zA={class:"stat"},VA={class:"stat-value"},qA={class:"stat"},WA={class:"stat-value"},KA={class:"structure-cost"},JA={class:"cost-value"},XA={class:"structure-desc"},YA={key:0,class:"selected-badge"},ZA={class:"modal-footer"},QA=["disabled"],eG={__name:"BuildModal",props:{visible:{type:Boolean,default:!1},copperName:{type:String,default:""},structureList:{type:Array,default:()=>[]},position:{type:Array,default:null}},emits:["close","build"],setup(e,{emit:t}){Qn(g=>({b71f15e0:_,v26ebd2fa:p,v26e918c0:d,v26ea017e:$,b71e2d22:b}));const n=e,o=t,s=oe(null),i=Je(()=>[...n.structureList].sort((g,m)=>{const v=y=>{var k;const w=((k=y.cost)==null?void 0:k.cost)||y.cost;return!Array.isArray(w)||w.length===0?0:Array.isArray(w[0])?w[0][1]:w[0].count};return v(g)-v(m)}));function r(g){s.value=g}function a(){if(!s.value){f("[BuildModal] ");return}f("[BuildModal] :",s.value.name),o("build",s.value.name),c()}function c(){s.value=null,o("close")}function l(g){return{:"",:"",:"",:""}[g]||""}function u(g){if(!g)return"";const m=g.cost||g;return!Array.isArray(m)||m.length===0?"":m.map(v=>{var y;if(Array.isArray(v)){const w=v[0],k=v[1];return`${((y=Kn[w])==null?void 0:y.name)||w} x${k}`}return`${uc(v)} x${v.count}`}).join(", ")}const _=`url('${Y("@assets/ui/panel11.png")}')`,$=`url('${Y("@assets/ui/panel7.png")}')`,d=`url('${Y("@assets/ui/panel8.png")}')`,p=`url('${Y("@assets/ui/panel5.png")}')`,b=`url('${Y("@assets/ui/panel12.png")}')`;return(g,m)=>(V(),Cn(Yd,{to:"body"},[e.visible?(V(),Z("div",{key:0,class:"modal-overlay",onClick:Fs(c,["self"])},[h("div",{class:"build-modal",onClick:m[0]||(m[0]=Fs(()=>{},["stop"]))},[h("div",xA,[m[1]||(m[1]=h("h2",{class:"modal-title"}," ",-1)),h("button",{class:"close-btn",onClick:c,title:""},[h("img",{src:ye(Y)("@assets/ui/close.png"),alt:""},null,8,PA)])]),h("div",LA,[h("p",IA,[h("span",TA,_e(e.copperName),1),m[2]||(m[2]=zo("  ",-1))]),m[3]||(m[3]=h("p",{class:"tip-text"},"   ",-1))]),h("div",EA,[h("div",AA,[(V(!0),Z(ht,null,Yn(i.value,v=>{var y,w,k;return V(),Z("div",{key:v.name,class:kt(["structure-card",{selected:((y=s.value)==null?void 0:y.name)===v.name}]),onClick:I=>r(v)},[h("div",RA,[h("div",OA,[h("span",DA,_e(v.name),1)]),h("span",NA,_e(l(v.name)),1)]),h("div",jA,[h("div",HA,[m[4]||(m[4]=h("span",{class:"stat-label"},"",-1)),h("span",FA,_e(v.health),1)]),h("div",UA,[m[5]||(m[5]=h("span",{class:"stat-label"},"",-1)),h("span",BA,_e(((w=v.attribute)==null?void 0:w.attack)||""),1)]),h("div",zA,[m[6]||(m[6]=h("span",{class:"stat-label"},"",-1)),h("span",VA,_e(v.has_storage?"":""),1)]),h("div",qA,[m[7]||(m[7]=h("span",{class:"stat-label"},"",-1)),h("span",WA,_e(v.attack_range||""),1)])]),h("div",KA,[m[8]||(m[8]=h("span",{class:"cost-label"}," ",-1)),h("span",JA,_e(u(v.cost)),1)]),h("div",XA,_e(v.description),1),((k=s.value)==null?void 0:k.name)===v.name?(V(),Z("div",YA,"  ")):Ie("",!0)],10,GA)}),128))])]),h("div",ZA,[h("button",{class:"btn btn-cancel",onClick:c},""),h("button",{class:"btn btn-confirm",disabled:!s.value,onClick:a},"  ",8,QA)])])])):Ie("",!0)]))}},tG=qt(eG,[["__scopeId","data-v-96b14c10"]]),nG={key:0,class:"copper-panel-parent"},sG={key:0,class:"minimized-content"},oG=["src"],iG={class:"minimized-info"},rG={class:"minimized-name"},aG={class:"minimized-action"},cG=["src"],lG={class:"panel-content"},uG={key:0,class:"resources"},_G={class:"resources-list"},$G=["onClick"],dG={class:"resource-name"},pG={class:"resource-count"},mG={key:2,class:"enemy-info-tip"},fG={__name:"ActionPanel",props:{copper:{type:Object,default:null},resources:{type:Array,default:()=>[]},hasAttackTargets:{type:Boolean,default:!0},onSelectCopper:{type:Function,default:null}},emits:["close","action","selectCopper"],setup(e,{expose:t,emit:n}){Qn(F=>({v9d0cc038:i.value,v4d912a72:r.value,dc9c48e6:a.value,d8c1fd80:c.value,v64ea23bc:u.value,v065590d6:l.value}));const o=e,s=n,i=Je(()=>`url('${Y("ui/sword.png")}')`),r=Je(()=>`url('${Y("ui/red.png")}')`),a=Je(()=>`url('${Y("ui/boot.png")}')`),c=Je(()=>`url('${Y("ui/green.png")}')`),l=Je(()=>`url('${Y("@assets/ui/build.png")}')`),u=Je(()=>`url('${Y("@assets/ui/summon.png")}')`),_=Y("@assets/ui/close.png"),$=oe("full"),d=oe(null),p=oe(!1),b=oe(!1),g=oe([]),m=Je(()=>{var O,X,W,ve,Ne,Ze,He,lt,et,at,Rt,C,E,B,se,Q,R,ue,ie,re,ne,we,ae,Se,Ce,Ae,st,qe,At,ze,ot,be,Ot,vn,Lt;if(!o.copper)return null;const F=((X=(O=o.copper.copper)==null?void 0:O.copper_info)==null?void 0:X.name)||((ve=(W=o.copper.enemy)==null?void 0:W.enemy_base)==null?void 0:ve.name)||((Ne=o.copper.enemy_base)==null?void 0:Ne.name)||o.copper.name||` #${o.copper.id}`;return{id:o.copper.id,name:F,level:((Ze=o.copper.copper)==null?void 0:Ze.level)??((He=o.copper.enemy)==null?void 0:He.level)??((lt=o.copper.enemy_base)==null?void 0:lt.level)??1,hp:o.copper.now_health,maxHp:((at=(et=o.copper.copper)==null?void 0:et.attribute)==null?void 0:at.health)??((C=(Rt=o.copper.enemy)==null?void 0:Rt.enemy_base)==null?void 0:C.health)??((E=o.copper.enemy_base)==null?void 0:E.health)??100,attack:((se=(B=o.copper.copper)==null?void 0:B.attribute)==null?void 0:se.attack)??((R=(Q=o.copper.enemy)==null?void 0:Q.enemy_base)==null?void 0:R.attack)??((ue=o.copper.enemy_base)==null?void 0:ue.attack)??0,defense:((re=(ie=o.copper.copper)==null?void 0:ie.attribute)==null?void 0:re.defense)??((we=(ne=o.copper.enemy)==null?void 0:ne.enemy_base)==null?void 0:we.defense)??((ae=o.copper.enemy_base)==null?void 0:ae.defense)??0,speed:((Ce=(Se=o.copper.copper)==null?void 0:Se.attribute)==null?void 0:Ce.speed)??((st=(Ae=o.copper.enemy)==null?void 0:Ae.enemy_base)==null?void 0:st.speed)??((qe=o.copper.enemy_base)==null?void 0:qe.speed)??0,canMove:o.copper.can_move,canAttack:o.copper.can_attack,canSummon:o.copper.can_summon,position:Array.isArray(o.copper.position)&&o.copper.position.length>=2?o.copper.position:Array.isArray((At=o.copper.enemy)==null?void 0:At.position)&&o.copper.enemy.position.length>=2?o.copper.enemy.position:Array.isArray((ze=o.copper.enemy_base)==null?void 0:ze.position)&&o.copper.enemy_base.position.length>=2?o.copper.enemy_base.position:[0,0],inventoryCapacity:((ot=o.copper.inventory)==null?void 0:ot.capacity)||0,copperType:((be=o.copper.copper)==null?void 0:be.copper_type)||((vn=(Ot=o.copper.enemy)==null?void 0:Ot.enemy_base)==null?void 0:vn.enemy_type)||((Lt=o.copper.enemy_base)==null?void 0:Lt.enemy_type)||"",isOwnedEnemy:o.copper.isOwnedEnemy===!0,isEnemy:o.copper.isEnemy===!0}}),v=Je(()=>{var W,ve,Ne,Ze,He;if(!o.copper)return[];const F=((W=o.copper.copper)==null?void 0:W.equipment_slot)||{},O=(F==null?void 0:F.slot1)||null,X=(F==null?void 0:F.slot2)||null;return[O?{name:((ve=O.equipment_base)==null?void 0:ve.name)||"",icon:Y(((Ne=O.equipment_base)==null?void 0:Ne.resource_url)||""),equipped:!0,locked:!1}:{name:"",icon:"",equipped:!1,locked:!1},F!=null&&F.is_slot2_locked?{name:"",icon:"",equipped:!1,locked:!0}:X?{name:((Ze=X.equipment_base)==null?void 0:Ze.name)||"",icon:Y(((He=X.equipment_base)==null?void 0:He.resource_url)||""),equipped:!0,locked:!1}:{name:"",icon:"",equipped:!1,locked:!1}]});Tn(()=>{var F;return(F=o.copper)==null?void 0:F.id},(F,O)=>{F!==O&&($.value="full",d.value=null,p.value=!1,b.value=!1)});async function y(){if(!m.value.canMove)return;f("[ActionPanel] ");const F=o.copper.isOwnedEnemy===!0,O=F?"on_enemy_move_start":"on_move_start";f(`[ActionPanel] : ${F?"":""}, : ${O}`);const X=JSON.stringify({type:O,content:{id:String(m.value.id)}});Fe(X),$.value="minimized",d.value="moving",s("action",{type:"moveStart",copperId:m.value.id})}async function w(){if(f("[ActionPanel] ",{canAttack:m.value.canAttack,copperId:m.value.id,name:m.value.name}),!m.value.canAttack){f("[ActionPanel] : ");return}f("[ActionPanel] ");const F=o.copper.isOwnedEnemy===!0,O=F?"on_enemy_attack_start":"on_attack_start";f(`[ActionPanel] : ${F?"":""}, : ${O}`);const X=JSON.stringify({type:O,content:{id:String(m.value.id)}});Fe(X),$.value="minimized",d.value="attacking",s("action",{type:"attackStart",copperId:m.value.id})}async function k(){if(f("[ActionPanel] ",{canSummon:m.value.canSummon,copperId:m.value.id,name:m.value.name}),!m.value.canSummon){f("[ActionPanel] : ");return}f("[ActionPanel] ");const F=JSON.stringify({type:"on_summon_start",content:{id:String(m.value.id)}});Fe(F),$.value="minimized",d.value="summoning",s("action",{type:"summonStart",copperId:m.value.id})}async function I(){if(f("[ActionPanel] ",{copperId:m.value.id,name:m.value.name}),!m.value.canSummon){f("[ActionPanel] : /");return}s("action",{type:"buildRequest",copperId:m.value.id})}function P(F){f("[ActionPanel] ",(F==null?void 0:F.length)||0,""),g.value=F||[],b.value=!0}async function T(F){f("[ActionPanel] :",F),b.value=!1;const O=JSON.stringify({type:"on_structure_build_start",content:{id:String(m.value.id),name:F}});Fe(O),$.value="minimized",d.value="building",s("action",{type:"buildStart",copperId:m.value.id,structureName:F})}function x(){f("[ActionPanel] "),p.value=!0}async function D(F){f(`[ActionPanel] : index=${F}`);const O=JSON.stringify({type:"on_copper_pick_up",content:{id:String(m.value.id),index:String(F)}});Fe(O),await K()}async function U(){f("[ActionPanel] ");const F=JSON.stringify({type:"on_copper_craft",content:{id:String(m.value.id)}});Fe(F),await K()}async function L(){await U()}async function K(){const O=o.copper.isOwnedEnemy===!0?"on_click_enemy":"on_click_copper",X=JSON.stringify({type:O,content:{id:String(m.value.id)}});Fe(X)}function ge(){f("[ActionPanel] "),s("action",{type:"wait",copperId:m.value.id})}function ce(){$.value="full",d.value=null,p.value=!1,s("close")}function he(){p.value=!1}function q(){$.value="full",d.value=null,s("action",{type:"cancel",copperId:m.value.id})}function G(){q(),ce()}async function J(F){o.onSelectCopper?await o.onSelectCopper(F):s("selectCopper",F)}return t({cancelAction:q,handleSelectCopper:J,showBuildMenu:P}),(F,O)=>{var X,W,ve,Ne,Ze,He,lt,et;return V(),Z(ht,null,[e.copper?(V(),Z("div",nG,[xt(z8,{"copper-info":m.value,"inventory-items":[],"inventory-capacity":5,onInventoryClick:x},null,8,["copper-info"]),xt(pA,{hp:((X=m.value)==null?void 0:X.hp)||0,"max-hp":((W=m.value)==null?void 0:W.maxHp)||100},null,8,["hp","max-hp"]),$.value==="minimized"||e.resources&&e.resources.length>0&&$.value==="full"?(V(),Z("div",{key:0,class:kt(["copper-panel",{"copper-panel--minimized":$.value==="minimized","copper-panel--min-attack":$.value==="minimized"&&d.value==="attacking","copper-panel--min-move":$.value==="minimized"&&d.value==="moving","copper-panel--min-summon":$.value==="minimized"&&d.value==="summoning","copper-panel--min-build":$.value==="minimized"&&d.value==="building"}]),onClick:O[0]||(O[0]=Fs(()=>{},["stop"]))},[$.value==="minimized"?(V(),Z("div",sG,[h("button",{class:"minimized-close",type:"button",onClick:G,title:""},[h("img",{src:ye(_),alt:""},null,8,oG)]),h("div",iG,[h("span",rG,_e(m.value.name),1),h("span",aG,_e(d.value==="moving"?"...":d.value==="attacking"?"...":d.value==="summoning"?"...":d.value==="building"?"...":""),1)])])):(V(),Z(ht,{key:1},[h("button",{class:"close-btn",onClick:ce,title:""},[h("img",{src:ye(_),alt:""},null,8,cG)]),h("div",lG,[e.resources&&e.resources.length>0?(V(),Z("div",uG,[O[3]||(O[3]=h("div",{class:"resources-header"}," ",-1)),h("div",_G,[(V(!0),Z(ht,null,Yn(e.resources,(at,Rt)=>(V(),Z("div",{key:Rt,class:"resource-item",onClick:C=>D(Rt),title:""},[h("span",dG,_e(ye(uc)(at)),1),h("span",pG,"x"+_e(at.count||1),1),O[2]||(O[2]=h("span",{class:"resource-pickup"},"",-1))],8,$G))),128))])])):Ie("",!0)])],64))],2)):Ie("",!0),o.copper.isEnemy?Ie("",!0):(V(),Cn(CA,{key:1,"copper-type":(ve=m.value)==null?void 0:ve.copperType,"can-move":((Ne=m.value)==null?void 0:Ne.canMove)!==!1,"can-attack":((Ze=m.value)==null?void 0:Ze.canAttack)!==!1,"can-summon":((He=m.value)==null?void 0:He.canSummon)!==!1,onMove:y,onWait:ge,onAttack:w,onSummon:k,onBuild:I},null,8,["copper-type","can-move","can-attack","can-summon"])),o.copper.isEnemy?(V(),Z("div",mG,[...O[4]||(O[4]=[h("span",null," ",-1)])])):Ie("",!0)])):Ie("",!0),xt(iA,{visible:p.value,"copper-name":((lt=m.value)==null?void 0:lt.name)||"",equipment:v.value,onClose:he,onCraft:L},null,8,["visible","copper-name","equipment"]),xt(tG,{visible:b.value,"copper-name":((et=m.value)==null?void 0:et.name)||"","structure-list":g.value,onClose:O[1]||(O[1]=at=>b.value=!1),onBuild:T},null,8,["visible","copper-name","structure-list"])],64)}}},hG=qt(fG,[["__scopeId","data-v-5073d991"]]),gG={class:"panel"},bG={class:"panel-inner"},yG={class:"section section-header"},vG=["aria-label"],wG={class:"section section-body"},SG={class:"current-doll",role:"status","aria-live":"polite"},kG={key:0},MG={class:"section section-choices",role:"group","aria-label":"Character Queue"},CG=["aria-pressed","data-copper-id","title","onClick"],xG=["alt","src","data-default-src","data-selected-src"],PG={class:"actions"},LG=["disabled"],IG=["disabled"],TG={__name:"TurnSystem",props:{currentCopperId:{type:Number,default:null},copperList:{type:Array,default:()=>[]},roundNumber:{type:Number,default:1},isEnemyMoving:{type:Boolean,default:!1}},emits:["nextCopper","endRound","selectCopper"],setup(e,{emit:t}){Qn(v=>({v13e8edbe:a,a5a1de32:l,v6d6dcd30:c,dca1506e:u,v0788e5d0:_,d6662956:$,v5e671a9e:d}));const n=e,o=t,s=oe(null),i=Y("ui/choice.png"),r=Y("ui/choice-active.png"),a=`url('${Y("ui/ribbon-left.png")}')`,c=`url('${Y("ui/ribbon-middle.png")}')`,l=`url('${Y("ui/ribbon-right.png")}')`,u=`url('${Y("ui/panel.png")}')`,_=`url('${Y("ui/round1.png")}')`,$=`url('${Y("ui/currentcupper.png")}')`,d=`url('${Y("ui/btn.png")}')`,p=Je(()=>{if(!n.currentCopperId)return null;const v=n.copperList.find(y=>y.id===n.currentCopperId);return v?{id:v.id,name:v.name||` #${v.id}`,level:v.level??0,isSummon:v.type==="summon"}:null});function b(){o("nextCopper")}async function g(){const v=JSON.stringify({type:"on_game_round_pass"});Fe(v),o("endRound")}function m(v){o("selectCopper",v)}return gn(async()=>{if(!s.value)return;function v(w){return new Promise((k,I)=>{const P=new Image;P.onload=()=>k(P),P.onerror=T=>{f(":",w,T),I(T)},P.src=w})}function y(w,k){s.value&&(s.value.style.setProperty(w,String(k)),f(` CSS  ${w} = ${k}`))}try{const[w,k,I]=await Promise.all([v(Y("ui/panel.png")),v(Y("ui/btn.png")),v(Y("ui/currentcupper.png"))]),P=Math.max(4,Math.round(w.naturalHeight/4)),T=Math.max(3,Math.round(k.naturalHeight/3)),x=Math.max(3,Math.round(I.naturalHeight/4));f(":",{panelSlice:P,btnSlice:T,currentSlice:x,currentImgSize:`${I.naturalWidth}x${I.naturalHeight}`}),y("--panel-slice",P),y("--btn-slice",T),y("--current-slice",x),setTimeout(()=>{const D=getComputedStyle(s.value);f("CSS :",{"--current-slice":D.getPropertyValue("--current-slice"),"--panel-slice":D.getPropertyValue("--panel-slice"),"--btn-slice":D.getPropertyValue("--btn-slice")})},100)}catch(w){f(":",w),y("--panel-slice","8"),y("--btn-slice","11"),y("--current-slice","8")}}),(v,y)=>(V(),Z("div",{ref_key:"turnSystemRef",ref:s,class:"turn-system"},[y[0]||(y[0]=h("div",{class:"ribbon","aria-hidden":"true"},[h("div",{class:"ribbon-cap left"}),h("div",{class:"ribbon-fill"},"CONTROL"),h("div",{class:"ribbon-cap right"})],-1)),h("div",gG,[h("div",bG,[h("section",yG,[h("div",{class:"round-header",role:"img","aria-label":`Round ${e.roundNumber}`}," Round "+_e(e.roundNumber),9,vG)]),h("section",wG,[h("div",SG,[h("span",null,_e(p.value?`${p.value.name||` #${e.currentCopperId}`}`:""),1),p.value&&!p.value.isSummon?(V(),Z("span",kG," Lv."+_e(p.value.level??0)+" ",1)):Ie("",!0)])]),h("section",MG,[(V(!0),Z(ht,null,Yn(e.copperList,w=>(V(),Z("button",{key:w.id,class:"choice",type:"button","aria-pressed":String(w.id===e.currentCopperId),"data-copper-id":w.id,title:w.name||` #${w.id}`,onClick:k=>m(w.id)},[h("img",{alt:w.name||`Character ${w.id}`,src:w.id===e.currentCopperId?ye(r):ye(i),"data-default-src":ye(i),"data-selected-src":ye(r)},null,8,xG)],8,CG))),128))])])]),h("div",PG,[h("button",{class:"btn btn-primary",onClick:b,disabled:!e.currentCopperId||e.isEnemyMoving},"  ",8,LG),h("button",{class:"btn btn-secondary",onClick:g,disabled:e.isEnemyMoving},"  ",8,IG)])],512))}},EG=qt(TG,[["__scopeId","data-v-bbcf8c05"]]),AG={class:"modal-info"},GG={class:"info-text"},RG={class:"copper-name"},OG={class:"modal-body"},DG={class:"enemy-list"},NG=["onClick"],jG={class:"enemy-header"},HG={class:"enemy-name-row"},FG={class:"enemy-name"},UG={class:"enemy-level"},BG={class:"enemy-type"},zG={class:"enemy-stats"},VG={class:"stat"},qG={class:"stat-value"},WG={class:"stat"},KG={class:"stat-value"},JG={class:"stat"},XG={class:"stat-value"},YG={class:"stat"},ZG={class:"stat-value"},QG={class:"stat"},eR={class:"stat-value"},tR={class:"enemy-cost"},nR={class:"cost-value"},sR={class:"enemy-desc"},oR={key:0,class:"selected-badge"},iR={class:"modal-footer"},rR=["disabled"],aR={__name:"SummonModal",props:{visible:{type:Boolean,default:!1},copperName:{type:String,default:""},enemyList:{type:Array,default:()=>[]},position:{type:Array,default:null}},emits:["close","summon"],setup(e,{emit:t}){Qn($=>({bad9e2a0:n}));const n=`url('${Y("@assets/ui/panel6.png")}')`,o=e,s=t,i=oe(null),r=Je(()=>[...o.enemyList].sort(($,d)=>$.level-d.level));function a($){i.value=$}function c(){if(!i.value){f("[SummonModal] ");return}f("[SummonModal] :",i.value.name),s("summon",i.value.name),l()}function l(){i.value=null,s("close")}function u($){return{goblin:"",cruiser:"",scout:"",boxer:"",horn:"",assassin:"",devourer:"",mirror:"",guard:"",demon:"",variant:"",shatra:"BOSS",glutton:"BOSS"}[$]||$}function _($){if(!$)return"";const d=$.cost||$;return!Array.isArray(d)||d.length===0?"":d.map(p=>{var b;if(Array.isArray(p)){const g=p[0],m=p[1];return`${((b=Kn[g])==null?void 0:b.name)||g} x${m}`}return`${uc(p)} x${p.count}`}).join(", ")}return($,d)=>(V(),Cn(Yd,{to:"body"},[e.visible?(V(),Z("div",{key:0,class:"modal-overlay",onClick:Fs(l,["self"])},[h("div",{class:"summon-modal",onClick:d[0]||(d[0]=Fs(()=>{},["stop"]))},[h("div",{class:"modal-header"},[d[1]||(d[1]=h("h2",{class:"modal-title"}," ",-1)),h("button",{class:"close-btn",onClick:l,title:""},"")]),h("div",AG,[h("p",GG,[h("span",RG,_e(e.copperName),1),d[2]||(d[2]=zo("  ",-1))])]),h("div",OG,[h("div",DG,[(V(!0),Z(ht,null,Yn(r.value,p=>{var b,g;return V(),Z("div",{key:p.name,class:kt(["enemy-card",{selected:((b=i.value)==null?void 0:b.name)===p.name}]),onClick:m=>a(p)},[h("div",jG,[h("div",HG,[h("span",FG,_e(p.name),1),h("span",UG,"Lv."+_e(p.level),1)]),h("span",BG,_e(u(p.enemy_type)),1)]),h("div",zG,[h("div",VG,[d[3]||(d[3]=h("span",{class:"stat-label"},"",-1)),h("span",qG,_e(p.health),1)]),h("div",WG,[d[4]||(d[4]=h("span",{class:"stat-label"},"",-1)),h("span",KG,_e(p.attack),1)]),h("div",JG,[d[5]||(d[5]=h("span",{class:"stat-label"},"",-1)),h("span",XG,_e(p.defense),1)]),h("div",YG,[d[6]||(d[6]=h("span",{class:"stat-label"},"",-1)),h("span",ZG,_e(p.attack_range),1)]),h("div",QG,[d[7]||(d[7]=h("span",{class:"stat-label"},"",-1)),h("span",eR,_e(p.move_range),1)])]),h("div",tR,[d[8]||(d[8]=h("span",{class:"cost-label"}," ",-1)),h("span",nR,_e(_(p.summon_cost)),1)]),h("div",sR,_e(p.description),1),((g=i.value)==null?void 0:g.name)===p.name?(V(),Z("div",oR,"   ")):Ie("",!0)],10,NG)}),128))])]),h("div",iR,[h("button",{class:"btn btn-cancel",onClick:l},""),h("button",{class:"btn btn-confirm",disabled:!i.value,onClick:c},"  ",8,rR)])])])):Ie("",!0)]))}},cR=qt(aR,[["__scopeId","data-v-2e41e79c"]]),lR={key:0,class:"minimized-content"},uR={class:"minimized-info"},_R={class:"minimized-name"},$R={class:"minimized-action"},dR={key:1},pR={class:"structure-panel__header"},mR={class:"structure-panel__title"},fR={class:"structure-panel__body"},hR={class:"structure-panel__health"},gR={class:"structure-panel__health-bar"},bR={class:"structure-panel__health-text"},yR={key:0,class:"structure-panel__storage"},vR={class:"structure-panel__storage-content"},wR={key:0,class:"structure-panel__storage-item"},SR={class:"structure-panel__storage-name"},kR={class:"structure-panel__storage-count"},MR={key:1,class:"structure-panel__storage-empty"},CR={key:1,class:"structure-panel__ground-resources"},xR={class:"structure-panel__ground-list"},PR={class:"structure-panel__resource-name"},LR={class:"structure-panel__resource-count"},IR={key:2,class:"structure-panel__actions"},TR={__name:"StructurePanel",props:{structure:{type:Object,required:!0},resources:{type:Array,default:()=>[]},actionMode:{type:String,default:null}},emits:["close","action","cancel"],setup(e,{emit:t}){Qn(w=>({v31b4b180:p}));const n=e,o=t,s=Je(()=>{var w;return((w=n.structure.structure_base)==null?void 0:w.name)||""}),i=Je(()=>n.structure.owned||!1),r=Je(()=>{var w;return((w=n.structure.structure_base)==null?void 0:w.has_storage)||!1}),a=Je(()=>n.structure.storage||null),c=Je(()=>n.structure.can_move||!1),l=Je(()=>n.structure.can_attack||!1),u=Je(()=>n.structure.now_health||0),_=Je(()=>{var w;return((w=n.structure.structure_base)==null?void 0:w.health)||100}),$=Je(()=>_.value===0?0:Math.max(0,Math.min(100,u.value/_.value*100))),d=Je(()=>{const w=$.value;return w>60?"#4ade80":w>30?"#facc15":"#ef4444"});Y("@assets/ui/panel.png");const p=`url('${Y("@assets/ui/panel11.png")}')`,b=Je(()=>n.actionMode!==null),g=Je(()=>n.actionMode==="move"?"...":n.actionMode==="attack"?"...":n.actionMode==="extract"?"...":n.actionMode==="transfer"?"...":"");function m(w){f(`[StructurePanel] : ${w}`),o("action",{type:w})}function v(){f("[StructurePanel] "),o("cancel")}function y(){o("close")}return(w,k)=>(V(),Z("div",{class:kt(["structure-panel",{"structure-panel--minimized":b.value}])},[b.value?(V(),Z("div",lR,[h("div",uR,[h("span",_R,_e(s.value),1),h("span",$R,_e(g.value),1)]),h("div",{class:"minimized-actions"},[h("button",{class:"mini-btn mini-btn--cancel",onClick:v,title:""},"  ")])])):(V(),Z("div",dR,[h("div",pR,[h("div",mR,[zo(_e(s.value)+" ",1),h("span",{class:kt(["structure-panel__badge",{"structure-panel__badge--owned":i.value}])},_e(i.value?"":""),3)]),h("button",{class:"structure-panel__close",onClick:y,"aria-label":""},"  ")]),h("div",fR,[h("div",hR,[k[4]||(k[4]=h("div",{class:"structure-panel__health-label"},"",-1)),h("div",gR,[h("div",{class:"structure-panel__health-fill",style:zn({width:$.value+"%",backgroundColor:d.value})},null,4)]),h("div",bR,_e(Math.ceil(u.value))+" / "+_e(Math.ceil(_.value)),1)]),r.value?(V(),Z("div",yR,[k[5]||(k[5]=h("div",{class:"structure-panel__storage-label"},"",-1)),h("div",vR,[a.value?(V(),Z("div",wR,[h("span",SR,_e(ye(uc)(a.value)),1),h("span",kR,"x"+_e(a.value.count||0),1)])):(V(),Z("div",MR,""))])])):Ie("",!0),e.resources&&e.resources.length>0?(V(),Z("div",CR,[k[6]||(k[6]=h("div",{class:"structure-panel__ground-label"},"",-1)),h("div",xR,[(V(!0),Z(ht,null,Yn(e.resources,(I,P)=>(V(),Z("div",{key:P,class:"structure-panel__ground-item"},[h("span",PR,_e(I.name||""),1),h("span",LR,"x"+_e(I.count||0),1)]))),128))])])):Ie("",!0),i.value?(V(),Z("div",IR,[c.value?(V(),Z("button",{key:0,class:"structure-panel__action-btn structure-panel__action-btn--move",onClick:k[0]||(k[0]=I=>m("move"))},"  ")):Ie("",!0),l.value?(V(),Z("button",{key:1,class:"structure-panel__action-btn structure-panel__action-btn--attack",onClick:k[1]||(k[1]=I=>m("attack"))},"  ")):Ie("",!0),r.value&&a.value?(V(),Z("button",{key:2,class:"structure-panel__action-btn structure-panel__action-btn--transfer",onClick:k[2]||(k[2]=I=>m("transfer"))},"  ")):Ie("",!0),r.value?(V(),Z("button",{key:3,class:"structure-panel__action-btn structure-panel__action-btn--extract",onClick:k[3]||(k[3]=I=>m("extract"))},"  ")):Ie("",!0)])):Ie("",!0)])]))],2))}},ER=qt(TR,[["__scopeId","data-v-c3c198e2"]]),AR={class:"resource-panel"},GR={class:"resource-list"},RR={class:"resource-layout"},OR={class:"row row-top"},DR=["title"],NR=["src","alt"],jR={class:"resource-count"},HR={class:"resource-tooltip"},FR=["title"],UR=["src","alt"],BR={class:"resource-count"},zR={class:"resource-tooltip"},VR={class:"row row-middle"},qR=["title"],WR=["src","alt"],KR={class:"resource-count"},JR={class:"resource-tooltip"},XR={class:"row row-bottom"},YR=["title"],ZR=["src","alt"],QR={class:"resource-count"},e9={class:"resource-tooltip"},t9=["title"],n9=["src","alt"],s9={class:"resource-count"},o9={class:"resource-tooltip"},i9={class:"crafting-section"},r9={class:"crafting-grid"},a9=["src"],c9={class:"craft-count"},l9={class:"craft-arrow-group"},u9=["src","alt"],_9={class:"craft-result"},$9={class:"recipe-display"},d9=["src"],p9={class:"craft-count"},m9={__name:"ResourcePanel",setup(e,{expose:t}){Qn(_=>({a63b29f0:o}));const o=`url('${Y("@assets/ui/panel5.png")}')`,s=oe({SpiritalSpark:0,RecallGear:0,ResonantCrystal:0,RefinedCopper:0,HeartCrystalDust:0}),i=["HeartCrystalDust","RecallGear","ResonantCrystal","RefinedCopper"],r=oe(!1),a=oe({visible:!1,success:!0,text:""});function c(_,$=!0,d=1500){a.value={visible:!0,success:$,text:_},window.clearTimeout(c._timer),c._timer=window.setTimeout(()=>{a.value.visible=!1},d)}async function l(){if(!r.value){r.value=!0;try{const _=mI();Oo(kn.UPDATE_RESOURCES),(_==null?void 0:_.type)==="error"?(console.warn("[ResourcePanel] :",(_==null?void 0:_.content)||_),c("",!1)):(console.log("[ResourcePanel] :",_),c("",!0))}catch(_){console.error("[ResourcePanel] :",_),c("",!1)}finally{r.value=!1}}}async function u(){try{const _=Oc();if(_){const $={},d={};return Object.keys(s.value).forEach(p=>{const b=s.value[p],g=_[p]||0;d[p]=g;const m=g-b;m>0&&($[p]=m)}),s.value=d,Oo(kn.RESOURCES_UPDATED,$),$}}catch(_){console.error("[ResourcePanel] :",_)}return{}}return gn(()=>{u(),_c(kn.UPDATE_RESOURCES,u)}),Ls(()=>{Pu(kn.UPDATE_RESOURCES,u)}),t({updateResources:u}),(_,$)=>{var d;return V(),Z("div",AR,[$[0]||($[0]=h("div",{class:"resource-header"},[h("span",{class:"header-text"},"")],-1)),h("div",GR,[h("div",RR,[h("div",OR,[h("div",{class:"resource-slot small",title:ye(Qt)("RecallGear")},[ye($s)("RecallGear")?(V(),Z("img",{key:0,src:ye($s)("RecallGear"),alt:ye(Qt)("RecallGear"),class:"resource-icon"},null,8,NR)):Ie("",!0),h("div",jR,_e(s.value.RecallGear||0),1),h("div",HR,_e(ye(Qt)("RecallGear")),1)],8,DR),h("div",{class:"resource-slot small",title:ye(Qt)("HeartCrystalDust")},[ye($s)("HeartCrystalDust")?(V(),Z("img",{key:0,src:ye($s)("HeartCrystalDust"),alt:ye(Qt)("HeartCrystalDust"),class:"resource-icon"},null,8,UR)):Ie("",!0),h("div",BR,_e(s.value.HeartCrystalDust||0),1),h("div",zR,_e(ye(Qt)("HeartCrystalDust")),1)],8,FR)]),h("div",VR,[h("div",{class:"resource-slot large",title:ye(Qt)("SpiritalSpark")},[ye($s)("SpiritalSpark")?(V(),Z("img",{key:0,src:ye($s)("SpiritalSpark"),alt:ye(Qt)("SpiritalSpark"),class:"resource-icon"},null,8,WR)):Ie("",!0),h("div",KR,_e(s.value.SpiritalSpark||0),1),h("div",JR,_e(ye(Qt)("SpiritalSpark")),1)],8,qR)]),h("div",XR,[h("div",{class:"resource-slot small",title:ye(Qt)("ResonantCrystal")},[ye($s)("ResonantCrystal")?(V(),Z("img",{key:0,src:ye($s)("ResonantCrystal"),alt:ye(Qt)("ResonantCrystal"),class:"resource-icon"},null,8,ZR)):Ie("",!0),h("div",QR,_e(s.value.ResonantCrystal||0),1),h("div",e9,_e(ye(Qt)("ResonantCrystal")),1)],8,YR),h("div",{class:"resource-slot small",title:ye(Qt)("RefinedCopper")},[ye($s)("RefinedCopper")?(V(),Z("img",{key:0,src:ye($s)("RefinedCopper"),alt:ye(Qt)("RefinedCopper"),class:"resource-icon"},null,8,n9)):Ie("",!0),h("div",s9,_e(s.value.RefinedCopper||0),1),h("div",o9,_e(ye(Qt)("RefinedCopper")),1)],8,t9)])])]),h("div",i9,[h("div",r9,[(V(),Z(ht,null,Yn(i,(p,b)=>{var g;return h("div",{class:"craft-slot",key:b},[(g=ye(Kn)[p])!=null&&g.icon?(V(),Z("img",{key:0,src:ye(Kn)[p].icon,class:"craft-icon"},null,8,a9)):Ie("",!0),h("div",c9,_e(s.value[p]||0),1)])}),64))]),h("div",l9,[h("img",{class:kt(["craft-arrow-img",{disabled:r.value}]),src:ye(Y)("@assets/ui/upgrade.png"),alt:r.value?"":"",onClick:l},null,10,u9),a.value.visible?(V(),Z("div",{key:0,class:kt(["craft-toast",{success:a.value.success,error:!a.value.success}])},_e(a.value.text),3)):Ie("",!0)]),h("div",_9,[h("div",$9,[(d=ye(Kn).SpiritalSpark)!=null&&d.icon?(V(),Z("img",{key:0,src:ye(Kn).SpiritalSpark.icon,class:"recipe-icon"},null,8,d9)):Ie("",!0),h("div",p9,_e(s.value.SpiritalSpark||0),1)])])])])}}},f9=qt(m9,[["__scopeId","data-v-5ca294fa"]]),h9={class:"game-scene"},g9={key:6,class:"info-panel"},b9={key:7,class:"game-over-overlay"},y9={key:8,class:"game-over-overlay"},v9={key:9,class:"credits-overlay"},w9={key:10,class:"game-over-overlay"},S9={class:"game-over-dialog"},k9={class:"game-over-message"},M9={key:11,class:"game-over-overlay"},C9=["src"],x9=["src"],P9=["src"],L9=["src"],I9=["src"],T9=["src"],E9=["src"],A9={__name:"GameScene",props:{isGameMode:{type:Boolean,default:!1},musicOn:{type:Boolean,default:!0}},emits:["back"],setup(e,{emit:t}){Qn(j=>({v493cc025:Jh,v493d3484:Xh}));const n=e,o=oe(null),s=t,i=oe(null),r=d8("gameScene"),a=oe(null),c=oe(null),l=oe(null),u=oe(null),_=oe(null),$=oe(null),d=ii("move"),p=ii("moveEnemy"),b=ii("attack"),g=ii("attackEnemy"),m=ii("meHurt"),v=ii("enemyHurt");let y,w,k,I,P=[],x={focusPosition:null,focusTarget:null,lerpFactor:nd().focusLerpFactor},D=null,U=new $n,L=null,K=null,ge=null;const ce=new Map,he={w:!1,a:!1,s:!1,d:!1,shift:!1,space:!1},G=nd().moveSpeed,J=oe("mobile"),F=oe(.002),O=oe({x:0,y:0}),X=oe({x:0,y:0}),W=oe({up:!1,down:!1});window.updateControlMode=j=>{J.value=j,f(`[GameScene] : ${j}`)},window.updateMouseSensitivity=j=>{F.value=j};function ve(j){const N=j.key.toLowerCase();N==="w"||N==="a"||N==="s"||N==="d"?he[N]=!0:N==="shift"?he.shift=!0:N===" "?(he.space=!0,j.preventDefault()):N==="escape"&&document.pointerLockElement&&document.exitPointerLock()}function Ne(j){const N=j.key.toLowerCase();N==="w"||N==="a"||N==="s"||N==="d"?he[N]=!1:N==="shift"?he.shift=!1:N===" "&&(he.space=!1)}let Ze=!1,He=0,lt=0,et=0,at=0,Rt=!1;function C(j){j.button===0&&(J.value==="mouse"&&o.value&&o.value.requestPointerLock(),Ze=!0,He=j.clientX,lt=j.clientY)}function E(){Ze=!1}function B(j){if(J.value==="touchpad"){if(!Ze)return;const N=j.clientX-He,te=j.clientY-lt;at-=N*F.value,et-=te*F.value,He=j.clientX,lt=j.clientY}else if(J.value==="mouse"&&Rt){const N=j.movementX||0,te=j.movementY||0;at-=N*F.value,et-=te*F.value}et=Math.max(-Math.PI/2,Math.min(Math.PI/2,et)),w.rotation.order="YXZ",w.rotation.y=at,w.rotation.x=et}function se(){Rt=document.pointerLockElement===o.value,f(Rt?"[GameScene] ":"[GameScene] ")}function Q(){f("[GameScene] ")}const R=oe(null),ue=oe([]),ie=oe(null),re=oe(!1),ne=oe([]),we=oe([]),ae=oe(null),Se=oe(null),Ce=oe(!1),Ae=oe(null),st=oe([]),qe=oe(null),At=oe(1),ze=oe([]),ot=oe(-1),be=oe(null),Ot=oe(!1),vn=oe(new Set),Lt=oe(!1),un=new Map,ti=oe(!1),ni=oe(!1),jr=oe(!1),Hr=oe(!1),jc=oe(!1),Hc=oe(""),mh=Je(()=>{if(ze.value.length===0||ot.value<0||ot.value>=ze.value.length)return null;const j=ze.value[ot.value];return j?j.id:null});gn(async()=>{var j;if(f("[GameScene] "),fh(),f("[GameScene] "),yh(),f("[GameScene] "),(j=je.sceneContext)!=null&&j.setTestMode&&je.sceneContext.setTestMode("eventloop"),window.__ACTUAL_COPPER_IDS__){const N=window.__ACTUAL_COPPER_IDS__;f("[GameScene] ID:",N);const te=JSON.stringify({type:"on_game_start",content:{ids:N}});Fe(te),delete window.__ACTUAL_COPPER_IDS__}else f("[GameScene] ID");window.addEventListener("keydown",ve),window.addEventListener("keyup",Ne),window.addEventListener("mousedown",C),window.addEventListener("mouseup",E),window.addEventListener("mousemove",B),document.addEventListener("pointerlockchange",se),document.addEventListener("pointerlockerror",Q),c_(),n.musicOn&&i.value&&setTimeout(()=>{if(i.value.readyState>=2)i.value.play().then(()=>{f("[GameScene] ")}).catch(te=>{f("[GameScene] :",te)});else{const te=()=>{i.value.play().then(()=>{f("[GameScene] ")}).catch(pe=>{f("[GameScene] :",pe)}),i.value.removeEventListener("canplay",te)};i.value.addEventListener("canplay",te,{once:!0})}},200)}),Tn(()=>n.musicOn,j=>{if(i.value)if(j)if(i.value.readyState>=2)i.value.play().catch(N=>{f("[GameScene] :",N)});else{const N=()=>{i.value.play().catch(te=>{f("[GameScene] :",te)}),i.value.removeEventListener("canplay",N)};i.value.addEventListener("canplay",N)}else i.value.pause()}),Ls(()=>{window.removeEventListener("resize",a_),window.removeEventListener("click",l_),window.removeEventListener("keydown",ve),window.removeEventListener("keyup",Ne),window.removeEventListener("mousedown",C),window.removeEventListener("mouseup",E),window.removeEventListener("mousemove",B),document.removeEventListener("pointerlockchange",se),document.removeEventListener("pointerlockerror",Q),document.pointerLockElement&&document.exitPointerLock(),i.value&&i.value.pause(),L&&L.dispose(),K&&K.dispose(),ge&&ge.dispose(),y&&w8(y),k&&k.dispose()});function fh(){y=new Ka;const j=KE();m8(y,j),w=h8(),D=new g_,k=g8(o.value),I=null;const N=n8();f8(y,N),v8(y),b8(),n.isGameMode&&window.addEventListener("click",l_),y8(y,P),L=VE(y,w),K=c8(y),ge=u8(y),f("[GameScene] "),f('[GameScene] - /(ID=1,2)""'),f("[GameScene] - EventLoop"),window.addEventListener("resize",a_)}async function hh(j,N,te,pe=1){const Te=cc(j,N);try{const M=await On.loadModel(Te,!0);f(`[GameScene] : ${N}`);const A=M.clone(!0);A.traverse(Pe=>{Pe.material&&(Array.isArray(Pe.material)?Pe.material=Pe.material.map(Le=>Le.clone()):Pe.material=Pe.material.clone())});const de=new pn().setFromObject(A).getSize(new Ue),me=new ns;me.add(A),me.position.set(te[0],0,te[1]),me.scale.set(pe,pe,pe),me.rotation.y=0;const xe=new pn().setFromObject(me);return me.position.y=-xe.min.y,f(`[GameScene] : ${N}, URL: ${Te}`),me}catch(M){return f(`[GameScene] : ${N}`,M),null}}async function gh(j,N,te=1,pe="model"){try{const Te=await On.loadModel(j,!0);f(`[GameScene] : ${pe}, url=${j}`);const M=Te.clone(!0);M.traverse(me=>{me.material&&(Array.isArray(me.material)?me.material=me.material.map(xe=>xe.clone()):me.material=me.material.clone())});const z=new pn().setFromObject(M).getSize(new Ue),de=new ns;return de.add(M),de.position.set(N[0],0,N[1]),de.scale.set(te,te,te),de}catch(Te){return f(`[GameScene] : ${pe}, url=${j}, error=${Te}`),null}}async function bh(j,N,te=1){const pe=lc(j);try{const Te=await On.loadModel(pe,!0);f(`[GameScene] : ${j}`);const M=Te.clone(!0);M.traverse(Pe=>{Pe.material&&(Array.isArray(Pe.material)?Pe.material=Pe.material.map(Le=>Le.clone()):Pe.material=Pe.material.clone())});const z=new pn().setFromObject(M).getSize(new Ue),de=new ns;de.add(M),de.position.set(N[0],0,N[1]),de.scale.set(te,te,te),de.rotation.y=0;const me=new pn().setFromObject(de);de.position.y=-me.min.y;const xe=new _i(16729156,2.5,12);return xe.position.set(0,z.y*te*.8,0),de.add(xe),f(`[GameScene] : ${j}, URL: ${pe}`),de}catch(Te){return f(`[GameScene] : ${j}`,Te),null}}let Fr=null;function yh(){const j=new Map,N=new Map,te=new Map;function pe(M,A,z){const de=P.find(Le=>Le.id===M);if(!de||!de.object)return;let me,xe;A==="move"?(me=65280,xe=.8):A==="attack"?(me=16711680,xe=1):A==="summon"?(me=16776960,xe=1.2):(me=16777215,xe=1),j.has(M)||j.set(M,{});const Pe=j.get(M);if(Pe[A]&&(y.remove(Pe[A]),Pe[A].geometry.dispose(),Pe[A].material.dispose(),delete Pe[A]),z){const Le=new Sl(xe-.1,xe,32),Ve=new zt({color:me,side:Pn,transparent:!0,opacity:.6}),We=new St(Le,Ve);We.rotation.x=-Math.PI/2,We.position.set(de.object.position.x,.1,de.object.position.z),y.add(We),Pe[A]=We}}const Te=M=>{if(P.forEach(A=>{A.object&&(A.object.scale.set(1,1,1),A.object.traverse(z=>{var de;z.material&&((de=z.material.emissive)==null||de.setHex(0),z.material.emissiveIntensity!==void 0&&(z.material.emissiveIntensity=0))}))}),M!==null){const A=P.find(z=>z.id===M);if(A){A.object.scale.set(1.1,1.1,1.1),A.object.traverse(de=>{de.material&&de.material.emissive&&(de.material.emissive.setHex(16755200),de.material.emissiveIntensity=.5)});const z=A.type==="summon"?"":A.type==="copper"?"":"";f(`[GameScene] ${z}: ${A.name} (ID=${M})`)}}};Fr=(M,A)=>{const z=P.find(Dt=>Dt.id===M);if(!z)return;const de=new Map;z.object.traverse(Dt=>{Dt.material&&Dt.material.emissive&&(de.set(Dt,{color:Dt.material.emissive.getHex(),intensity:Dt.material.emissiveIntensity||0}),Dt.material.emissive.setHex(16711680),Dt.material.emissiveIntensity=.8)}),setTimeout(()=>{de.forEach((Dt,ts)=>{ts.material&&ts.material.emissive&&(ts.material.emissive.setHex(Dt.color),ts.material.emissiveIntensity=Dt.intensity)})},500);const me=new Ue(z.object.position.x,.5,z.object.position.z),xe=new Ue(A[0],.5,A[1]),Pe=new Ue().subVectors(xe,me),Le=Pe.length(),Ve=new Ue().addVectors(me,xe).multiplyScalar(.5),We=new ya(.05,.05,Le,8),Oe=new zt({color:16729156,transparent:!0,opacity:.9,emissive:16729156,emissiveIntensity:.5}),Ke=new St(We,Oe);Ke.position.copy(Ve),Ke.quaternion.setFromUnitVectors(new Ue(0,1,0),Pe.normalize()),y.add(Ke);const it=new Sl(.2,.4,32),_t=new zt({color:16711680,side:Pn,transparent:!0,opacity:.8,emissive:16711680,emissiveIntensity:.5}),Zt=new St(it,_t);Zt.rotation.x=-Math.PI/2,Zt.position.copy(xe),y.add(Zt);const Mo=performance.now(),jt=300;function Ht(){const ts=(performance.now()-Mo)/jt;if(ts<1){const Ei=1-ts;Oe&&(Oe.opacity=Ei),_t&&(_t.opacity=Ei),Zt.scale.set(1+ts*2,1+ts*2,1),requestAnimationFrame(Ht)}else y.remove(Ke),y.remove(Zt),We.dispose(),Oe.dispose(),it.dispose(),_t.dispose()}Ht(),f(`[GameScene] : ID=${M}, =${me.x.toFixed(1)},${me.z.toFixed(1)}  [${A[0]},${A[1]}]`)},je.setSceneContext({scene:y,camera:w,controls:I,models:P,gridCellSize:1,focusState:x,focusOnModel:vh,onShowCopperInfo:(M,A,z)=>{var me,xe,Pe,Le,Ve,We,Oe,Ke,it,_t,Zt;f(`[GameScene] onShowCopperInfo : type=${(me=M.copper)==null?void 0:me.copper_type}, can_build=${M.can_build}, can_summon=${M.can_summon}`),((xe=M.copper)==null?void 0:xe.copper_type)==="CraftsMan"&&M.id!==void 0&&un.set(M.id,M.can_build===!0);const de=((Le=(Pe=M.copper)==null?void 0:Pe.copper_info)==null?void 0:Le.name)||M.name||((We=(Ve=M.enemy)==null?void 0:Ve.enemy_base)==null?void 0:We.name)||((Ke=(Oe=M.enemy)==null?void 0:Oe.enemy_base)==null?void 0:Ke.enemy_type)||((it=M.enemy_base)==null?void 0:it.name)||((_t=M.enemy_base)==null?void 0:_t.enemy_type)||` #${M.id}`;((Zt=M.copper)==null?void 0:Zt.copper_type)==="CraftsMan"?(f(`[GameScene]  can_build=${M.can_build}  can_summon`),R.value={...M,name:de,can_summon:M.can_build===!0}):R.value={...M,name:de},ue.value=A||[],re.value=z||!1,f(`[GameScene] : ID=${R.value.id}, has_attack_targets=${re.value}, can_summon=${R.value.can_summon}`)},onShowStructureInfo:(M,A)=>{var z;ae.value=M,Se.value={structure:M,resources:A},f(`[GameScene] : ID=${M.id}, =${(z=M.structure_base)==null?void 0:z.name}, =${M.now_health}/${M.structure_base.health}`)},highlightSelectedCopper:Te,createAttackEffect:Fr,onMoveStart:(M,A)=>{n.isGameMode&&Ot.value&&(A==null?void 0:A.type)==="enemy"&&!(A!=null&&A.isOwned)&&(f(`[GameScene]  ${M} `),vn.value.add(M))},onMoveComplete:M=>{if(!n.isGameMode)return;const A=P.find(xe=>xe.id===M);if((A==null?void 0:A.type)==="structure"){f("[GameScene] "),be.value=null,Lt.value=!1,setTimeout(async()=>{await Ti(M)},300);return}if((A==null?void 0:A.type)==="enemy"&&!(A!=null&&A.isOwned)){Ot.value&&vn.value.has(M)?(f(`[GameScene]  ${M} `),vn.value.delete(M),vn.value.size===0&&(f("[GameScene] "),Ot.value=!1)):f(`[GameScene]  ${M} `);return}const de=ze.value.some(xe=>xe.id===M),me=(A==null?void 0:A.type)==="summon"||(A==null?void 0:A.isOwned);!de&&!me||(Lt.value=!1,f("[GameScene] "),be.value=null,ie.value&&ie.value.cancelAction(),setTimeout(async()=>{(A==null?void 0:A.type)==="summon"?await Ur(M,!1):await ko(M),setTimeout(()=>{if(ue.value&&ue.value.length>0){f("[GameScene] ");return}__()},100)},300))},onCraftResult:(M,A)=>{f(`[GameScene] : ${M?"":""} - ${A}`),alert(A)},onResourceNotEnough:M=>{f(`[GameScene] : ${M}`),Hc.value=M,jc.value=!0,be.value=null,qe.value=null,Ce.value=!1,Ae.value=null},onSummonFailed:M=>{f(`[GameScene] : ${M}`),alert(` ${M}`),be.value=null,Ce.value=!1,Ae.value=null},onShowSummonMenu:M=>{f("[GameScene] :",M),st.value=M||[]},onShowStructureMenu:M=>{var A;f("[GameScene] ",(M==null?void 0:M.length)||0,""),(A=ie.value)!=null&&A.showBuildMenu?ie.value.showBuildMenu(M||[]):f("[GameScene]  copperActionPanelRef.value.showBuildMenu ")},onRemoveCopper:M=>{const A=ze.value.findIndex(z=>z.id===M);A>-1&&(f(`[GameScene] : ID=${M}`),ze.value.splice(A,1),R.value&&R.value.id===M&&Fc(),ze.value.length===0||ot.value===A?ot.value=-1:ot.value>A?ot.value-=1:ot.value>=ze.value.length&&(ot.value=ze.value.length-1))},onShowResourceGain:(M,A)=>{f("[GameScene] :",M,A),ge&&Object.keys(A).length>0&&ge.createResourceGainEffect(M,A)},onGameOver:()=>{f("[GameScene] "),ti.value=!0},onGameSuccess:()=>{f("[GameScene] "),ni.value=!0},onAttackComplete:M=>{if(!n.isGameMode)return;const A=P.find(de=>de.id===M);if((A==null?void 0:A.type)==="structure"){f("[GameScene] "),be.value=null,setTimeout(async()=>{await Ti(M)},300);return}if(!ze.value.some(de=>de.id===M)){f("[GameScene] ");return}f("[GameScene] "),be.value=null,ie.value&&ie.value.cancelAction(),setTimeout(async()=>{(A==null?void 0:A.type)==="summon"?await Ur(M,!1):await ko(M),setTimeout(()=>{if(ue.value&&ue.value.length>0){f("[GameScene] ");return}__()},100)},300)},onSetMoveBlock:M=>{K&&K.createIndicator(M,"move"),f(`[GameScene] : =${M}`)},onSetAttackBlock:M=>{if(be.value==="transferring"){ne.value.push(M);const A=P.find(z=>{if(z.type==="copper"&&z.object){const de=z.object.position;return Math.abs(de.x-M[0])<.1&&Math.abs(de.z-M[1])<.1}return!1});if(A){const z=ze.value.find(me=>me.id===A.id);we.value.find(me=>me.id===A.id)||(we.value.push({id:A.id,name:A.name||(z?z.name:` #${A.id}`)||` #${A.id}`,position:M}),f(`[GameScene] : ${A.name||A.id} (ID=${A.id}), =${we.value.length}`))}else f(`[GameScene]  ${M} `)}else K&&K.createIndicator(M,"attack"),re.value=!0,f(`[GameScene] : ${M}`)},onSetCanSummonBlock:M=>{K&&K.createIndicator(M,"summon"),f(`[GameScene] : =${M}`)},onClearBlock:M=>{K&&K.clearIndicatorAt(M)},onSetCopper:async(M,A,z)=>{var Oe,Ke,it,_t,Zt,Mo;if(f(`[GameScene] : id=${z.id}, pos=${A}`),P.find(jt=>jt.id===z.id)){f(`[GameScene] ID=${z.id}`);return}if(((Oe=z.copper)==null?void 0:Oe.copper_type)==="CraftsMan"&&(un.set(z.id,z.can_build===!0),f(`[GameScene]  can_build : id=${z.id}, can_build=${z.can_build}`)),n.isGameMode){const jt={id:z.id,name:((Ke=z.copper.copper_info)==null?void 0:Ke.name)||` #${z.id}`,level:Number(((it=z.copper)==null?void 0:it.level)??0),turnDone:!1};ze.value.find(Ht=>Ht.id===z.id)||(ze.value.push(jt),f(`[GameScene] : ${jt.name}`))}const me=z.copper.copper_type||"Arcanist",xe=((_t=z.copper.copper_info)==null?void 0:_t.name)||"default",Pe=(Zt=z.copper.copper_info)==null?void 0:Zt.model_url;let Le=1;switch(me){case"IronWall":Le=1.2;break;case"Arcanist":Le=1;break;case"Mechanic":Le=1.1;break;case"Resonator":Le=1;break;case"CraftsMan":Le=1;break;default:Le=1}let Ve;if(Pe&&Pe.includes("/enemy/")){const jt=Y(Pe);if(f(`[GameScene] URL: ${Pe} -> ${jt}`),Ve=await gh(jt,A,Le,xe),Ve){const Dt=new pn().setFromObject(Ve).getSize(new Ue),ts=new pn().setFromObject(Ve);Ve.position.y=-ts.min.y;const Ei=new _i(4474111,2.5,12);Ei.position.set(0,Dt.y*Le*.8,0),Ve.add(Ei)}}else{const jt=FE(xe),Ht=UE(me);f(`[GameScene] : =${xe}, =${jt}, type=${me}, typeFolder=${Ht}`),Ve=await hh(Ht,jt,A,Le)}if(!Ve){f(`[GameScene] : ${xe}`);const jt=new gs(.8,.8,.8);let Ht=4491519;switch(me){case"IronWall":Ht=8947848;break;case"Arcanist":Ht=16729224;break;case"Mechanic":Ht=4521864;break;case"Resonator":Ht=16755268;break;case"CraftsMan":Ht=4474111;break}const Dt=new Bt({color:Ht});Ve=new St(jt,Dt),Ve.position.set(A[0],.4,A[1])}Ve.userData.modelId=z.id,y.add(Ve);const We={id:z.id,object:Ve,name:((Mo=z.copper.copper_info)==null?void 0:Mo.name)||`Copper_${z.id}`,type:"copper"};P.push(We),f(`[GameScene] : ${We.name} (ID=${z.id})`)},onSetEnemy:async(M,A,z)=>{var Ke,it,_t,Zt,Mo;const de=z.id,me=z.owned||!1;if(f(`[GameScene] : id=${de}, pos=${A}, owned=${me}`),P.find(jt=>jt.id===de)){f(`[GameScene] ID=${de}`);return}const Le=(((Ke=z.enemy_base)==null?void 0:Ke.enemy_type)||"").toLowerCase()||"goblin";let Ve=1;switch(Le){case"demon":case"glutton":case"devourer":Ve=1.5;break;case"guard":case"horn":Ve=1.2;break;default:Ve=1}const We={id:de,object:null,name:((it=z.enemy_base)==null?void 0:it.enemy_type)||`Enemy_${de}`,type:me?"summon":"enemy",position:A,isOwned:me,isLoading:!0};P.push(We);let Oe=await bh(Le,A,Ve);if(!Oe){f(`[GameScene] : ${Le}`);const jt=new gs(.8,.8,.8),Ht=new Bt({color:me?4474111:16711680});Oe=new St(jt,Ht),Oe.position.set(A[0],.4,A[1])}if(me&&Oe){const Ht=new pn().setFromObject(Oe).getSize(new Ue),Dt=new _i(4474111,2.5,12);Dt.position.set(0,Ht.y*Ve*.8,0),Oe.add(Dt),f(`[GameScene] : ${Le}`)}Oe.userData.modelId=de,y.add(Oe),We.object=Oe,We.isLoading=!1,z.now_health!==void 0&&((_t=z.enemy_base)==null?void 0:_t.health)!==void 0&&L&&(L.createOrUpdateHealthBar(de,z.now_health,z.enemy_base.health),f(`[GameScene] : ${Le} (${z.now_health}/${z.enemy_base.health})`)),me&&(ze.value.push({id:de,name:((Zt=z.enemy_base)==null?void 0:Zt.name)||Le,type:"summon",enemy:z}),f(`[GameScene] : ${Le} (ID=${de})`)),f(`[GameScene] : ${((Mo=z.enemy_base)==null?void 0:Mo.enemy_type)||de}, owned=${me}`)},onSetMaterial:async(M,A,z)=>{var Ve,We,Oe;if(f(`[GameScene] : id=${M}, pos=${A}, name=${(Ve=z.material_base)==null?void 0:Ve.name}`),P.find(Ke=>Ke.id===M)){f(`[GameScene] ID=${M}`);return}const me=((We=z.material_base)==null?void 0:We.name)||"",xe=(Oe=z.material_base)==null?void 0:Oe.model_url;if(!xe){f("[GameScene] model_url");const Ke=new gs(.5,.5,.5),it=new Bt({color:16755200,metalness:.3,roughness:.7}),_t=new St(Ke,it);_t.position.set(A[0],.25,A[1]),_t.userData.modelId=M,y.add(_t),P.push({id:M,object:_t,name:me||`Material_${M}`,type:"material"});return}const Pe=c1(xe);let Le=null;try{const Ke=await On.loadModel(Pe,!0),it=new ns;it.add(Ke),it.position.set(A[0],0,A[1]),it.scale.set(1,1,1),it.rotation.y=0;const _t=new pn().setFromObject(it);it.position.y=-_t.min.y,Le=it,f(`[GameScene] : ${me}, URL: ${Pe}`)}catch(Ke){f(`[GameScene] : ${me}`,Ke);const it=new gs(.5,.5,.5),_t=new Bt({color:16755200,metalness:.3,roughness:.7});Le=new St(it,_t),Le.position.set(A[0],.25,A[1])}Le.userData.modelId=M,y.add(Le),P.push({id:M,object:Le,name:me||`Material_${M}`,type:"material"}),f(`[GameScene] : ${me}`)},onSetStructure:async(M,A,z)=>{var Ve,We;if(f(`[GameScene] : id=${M}, pos=${A}`),P.find(Oe=>Oe.id===M)){f(`[GameScene] ID=${M}`);return}const me=((Ve=z.structure_base)==null?void 0:Ve.name)||"",xe=zE(me),Pe=Ap(xe);let Le=null;try{const Oe=await On.loadModel(Pe,!0),Ke=new ns;Ke.add(Oe),Ke.position.set(A[0],0,A[1]),Ke.scale.set(1,1,1),Ke.rotation.y=0;const it=new pn().setFromObject(Ke);Ke.position.y=-it.min.y,Le=Ke,f(`[GameScene] : ${me}, URL: ${Pe}`)}catch(Oe){f(`[GameScene] : ${me}`,Oe);const Ke=new gs(.9,1.2,.9),it=new Bt({color:6710886,metalness:.5,roughness:.6});Le=new St(Ke,it),Le.position.set(A[0],.6,A[1])}Le.userData.modelId=M,y.add(Le),P.push({id:M,object:Le,name:me||`Structure_${M}`,type:"structure"}),f(`[GameScene] : ${me}`),z.now_health!==void 0&&((We=z.structure_base)!=null&&We.health)&&L&&(L.createOrUpdateHealthBar(M,z.now_health,z.structure_base.health),f(`[GameScene] : ${me} (${z.now_health}/${z.structure_base.health})`))},onPutResourceMarker:M=>{const A=`${M[0]},${M[1]}`;if(te.has(A)){const it=te.get(A);y.remove(it),it.traverse(_t=>{_t.geometry&&_t.geometry.dispose(),_t.material&&(Array.isArray(_t.material)?_t.material.forEach(Zt=>Zt.dispose()):_t.material.dispose())}),te.delete(A)}const z=new ns,de=new ya(.15,.2,.25,8),me=new Bt({color:16766720,emissive:16755200,emissiveIntensity:.6,metalness:.7,roughness:.3}),xe=new St(de,me);xe.position.y=.125,z.add(xe);const Pe=new kl(.08,8,8),Le=new Bt({color:16776960,emissive:16776960,emissiveIntensity:1}),Ve=new St(Pe,Le);Ve.position.y=.3,z.add(Ve);const We=M[0],Oe=M[1];z.position.set(We,.15,Oe);const Ke=new _i(16766720,1.5,3);Ke.position.set(0,.3,0),z.add(Ke),y.add(z),te.set(A,z)},onClearResourceMarker:M=>{const A=`${M[0]},${M[1]}`;if(te.has(A)){const z=te.get(A);y.remove(z),z.traverse(de=>{de.geometry&&de.geometry.dispose(),de.material&&(Array.isArray(de.material)?de.material.forEach(me=>me.dispose()):de.material.dispose())}),te.delete(A)}},onDisplayCanMove:(M,A)=>{f(`[GameScene] : id=${M}, show=${A}`),pe(M,"move",A),R.value&&R.value.id===M&&(R.value={...R.value,can_move:A},f(`[GameScene] selectedCopper.can_move=${A}`))},onDisplayCanAttack:(M,A)=>{f(`[GameScene] : id=${M}, show=${A}`),pe(M,"attack",A),R.value&&R.value.id===M&&(R.value={...R.value,can_attack:A},f(`[GameScene] selectedCopper.can_attack=${A}`))},onDisplayCanSummon:(M,A)=>{var xe;let z=A,de=!1,me=!1;R.value&&R.value.id===M?(de=((xe=R.value.copper)==null?void 0:xe.copper_type)==="CraftsMan",me=R.value.can_build===!0):un.has(M)&&(de=!0,me=un.get(M)),de&&(z=me,f(`[GameScene] : id=${M}, can_build=${z}`)),f(`[GameScene] /: id=${M}, show=${z}`),pe(M,"summon",z),R.value&&R.value.id===M&&(R.value={...R.value,can_summon:z},f(`[GameScene] selectedCopper.can_summon=${z}`))},onClearState:M=>{if(f(`[GameScene] : id=${M}`),j.has(M)){const A=j.get(M);A.move&&(y.remove(A.move),A.move.geometry.dispose(),A.move.material.dispose(),delete A.move),A.attack&&(y.remove(A.attack),A.attack.geometry.dispose(),A.attack.material.dispose(),delete A.attack),A.summon&&(y.remove(A.summon),A.summon.geometry.dispose(),A.summon.material.dispose(),delete A.summon),j.delete(M)}},onUpdateHealth:(M,A,z)=>{f(`[GameScene] : id=${M}, hp=${A}/${z}`);const de=ce.get(M);if(de!==void 0&&A<de&&A>0){const me=P.find(xe=>xe.id===M);if(me){const xe=me.type==="copper",Pe=xe?_.value:$.value;Pe&&(Pe.currentTime=0,Pe.play().catch(Le=>{f(`[GameScene]  (${xe?"":""}):`,Le)}),f(`[GameScene] : ${xe?"":""} (ID=${M})`))}}ce.set(M,A),L&&L.createOrUpdateHealthBar(M,A,z)},onRemoveHealthBar:M=>{f(`[GameScene] : id=${M}`),L&&L.removeHealthBar(M),ce.delete(M)},onPutMapBlock:M=>{const A=`${M[0]},${M[1]}`;if(N.has(A)){const We=N.get(A);y.remove(We),We.geometry.dispose(),We.material&&(We.material.map&&We.material.map.dispose(),Array.isArray(We.material)?We.material.forEach(Oe=>{Oe.map&&Oe.map.dispose(),Oe.dispose()}):We.material.dispose())}const z=dh();if(!z.enabled)return;const de=z.size||.9,me=.05,xe=new gs(de,me,de);let Pe;if(z.materialType==="texture"&&z.texture.url){const Oe=new ki().load(z.texture.url);Oe.colorSpace=tn,Oe.wrapS=Bs,Oe.wrapT=Bs,Oe.repeat.set(z.texture.repeat.x,z.texture.repeat.y);const Ke=1;Pe=new Bt({map:Oe,transparent:!1,opacity:Ke,depthTest:!0,depthWrite:!0})}else z.materialType==="standard"?Pe=new Bt({color:z.standard.color,roughness:z.standard.roughness,metalness:z.standard.metalness,transparent:!1,opacity:1,depthTest:!0,depthWrite:!0}):Pe=new zt({color:z.basic.color,transparent:!1,opacity:1,depthTest:!0,depthWrite:!0});const Le=new St(xe,Pe);Le.renderOrder=-100;const Ve=z.yOffset||0;Le.position.set(M[0],me/2+Ve,M[1]),y.add(Le),N.set(A,Le)},animateModelMove:(M,A,z)=>{if(!M||!M.object)return;const de=M.type==="enemy",me=de?c.value:a.value;me&&(me.currentTime=0,me.play().catch(Oe=>{f(`[GameScene]  (${de?"":""}):`,Oe)})),M.isMoving=!0;const xe=M.object.position.clone(),Pe=new Ue(A.x,A.y,A.z),Le=500,Ve=performance.now();function We(){if(!M||!M.object){z&&z();return}const Oe=performance.now()-Ve,Ke=Math.min(Oe/Le,1),it=1-Math.pow(1-Ke,2);M.object.position.lerpVectors(xe,Pe,it),Ke<1?requestAnimationFrame(We):(M.object.position.copy(Pe),M.isMoving=!1,z&&z())}We()},setTestMode:M=>{f(`[GameScene] ${M==="backend"?"":"EventLoop"}`),P.forEach(A=>{A.type==="test"?A.object.visible=M==="backend":(A.type==="copper"||A.type==="enemy")&&(A.object.visible=M==="eventloop")}),f(`[GameScene] ${M==="backend"?"":""}${M==="eventloop"?"":""}EventLoop`)}}),f("[GameScene] ")}function vh(j,N,te){const pe=new Ue;j.getWorldPosition(pe);const Te=window.cameraFocusDistance||8,M=window.cameraFocusHeight||6,A=0,z=Te;return{focusPosition:new Ue(pe.x+A,pe.y+M,pe.z+z).clone(),focusTarget:pe.clone(),lerpFactor:.1}}function a_(){w.aspect=window.innerWidth/window.innerHeight,w.updateProjectionMatrix(),k.setSize(window.innerWidth,window.innerHeight)}function c_(){requestAnimationFrame(c_);const j=he.w||he.a||he.s||he.d||he.shift||he.space,N=J.value==="mobile"&&(Math.abs(O.value.x)>.01||Math.abs(O.value.y)>.01||W.value.up||W.value.down);if(j||N){const te=new Ue;he.w&&(te.z-=1),he.s&&(te.z+=1),he.a&&(te.x-=1),he.d&&(te.x+=1),J.value==="mobile"&&(te.x+=O.value.x,te.z+=O.value.y),he.shift&&(te.y-=1),he.space&&(te.y+=1),J.value==="mobile"&&(W.value.up&&(te.y+=1),W.value.down&&(te.y-=1)),te.applyQuaternion(w.quaternion),he.shift||he.space||J.value==="mobile"&&(W.value.up||W.value.down)?te.y=he.shift||J.value==="mobile"&&W.value.down?-1:1:te.y=0,w.position.add(te.multiplyScalar(G))}J.value==="mobile"&&(Math.abs(X.value.x)>.01||Math.abs(X.value.y)>.01)&&(at-=X.value.x*.05,et-=X.value.y*.05,et=Math.max(-Math.PI/2,Math.min(Math.PI/2,et)),w.rotation.order="YXZ",w.rotation.y=at,w.rotation.x=et),x.focusPosition&&x.focusTarget&&(w.position.lerp(x.focusPosition,x.lerpFactor),w.lookAt(x.focusTarget),at=w.rotation.y,et=w.rotation.x,w.position.distanceTo(x.focusPosition)<.5&&(f("[GameScene] "),x.focusPosition=null,x.focusTarget=null)),L&&L.updateHealthBarsPosition(P),k.render(y,w)}function l_(j){if(j.target.tagName!=="CANVAS")return;if(U.x=j.clientX/window.innerWidth*2-1,U.y=-(j.clientY/window.innerHeight)*2+1,D.setFromCamera(U,w),be.value==="moving"||be.value==="attacking"||be.value==="summoning"||be.value==="building"||be.value==="transferring"||be.value==="structureMoving"||be.value==="structureAttacking"||be.value==="structureExtract"||be.value==="structureTransfer"){wh(U);return}const N=P.filter(pe=>(pe.type==="copper"||pe.type==="summon"||pe.type==="enemy"||pe.type==="structure")&&pe.object).map(pe=>pe.object),te=D.intersectObjects(N,!0);if(te.length>0){let pe=te[0].object;for(;pe.parent&&!pe.userData.modelId;)pe=pe.parent;const Te=pe.userData.modelId;if(Te!==void 0){const M=P.find(de=>de.id===Te),z={copper:"",summon:"",enemy:"",structure:""}[M==null?void 0:M.type]||"";f(`[GameScene] ${z}ID:`,Te),(M==null?void 0:M.type)==="summon"||(M==null?void 0:M.type)==="enemy"?Ur(Te,(M==null?void 0:M.type)==="enemy"):(M==null?void 0:M.type)==="structure"?Ti(Te):ko(Te)}}else R.value=null,ae.value=null}async function wh(j){const N=new pd(new Ue(0,1,0),0),te=new g_;if(te.setFromCamera(j,w),be.value==="moving"&&Lt.value){f("[GameScene] ");return}const pe=new Ue;if(te.ray.intersectPlane(N,pe),pe){const Te=Math.round(pe.x),M=Math.round(pe.z);f(`[GameScene] : (${Te}, ${M})`);const A={moving:"move",attacking:"attack",summoning:"summon",building:"summon",structureMoving:"move",structureAttacking:"attack",structureExtract:"attack",structureTransfer:"attack"}[be.value];if(!K||!K.hasIndicatorAt([Te,M],A)){f(`[GameScene]  (${Te}, ${M}) `);return}be.value==="moving"?await Sh(Te,M):be.value==="attacking"?await kh(Te,M):be.value==="summoning"?await Mh(Te,M):be.value==="building"?await Ch(Te,M):be.value==="structureMoving"?await Rh(Te,M):be.value==="structureAttacking"?await Oh(Te,M):be.value==="structureExtract"?await Dh(Te,M):be.value==="structureTransfer"&&await Nh(Te,M)}}async function Sh(j,N){if(!R.value)return;if(Lt.value){f("[GameScene] ");return}const te=R.value.isOwnedEnemy===!0,pe=te?"on_enemy_move_apply":"on_move_apply";f(`[GameScene] : (${j}, ${N}), =${te?"":""}, =${pe}`);const Te=JSON.stringify({type:pe,content:{id:String(R.value.id),position:{x:String(j),y:String(N)}}});Lt.value=!0,await Fe(Te)}async function kh(j,N){if(!R.value)return;const te=R.value.isOwnedEnemy===!0,pe=te?"on_enemy_attack_apply":"on_attack_apply";f(`[GameScene] : (${j}, ${N}), =${te?"":""}, =${pe}`);const Te=R.value.id,M=P.find(z=>z.id===Te);if(M){const z=M.type==="enemy",de=z?u.value:l.value;de&&(de.currentTime=0,de.play().catch(me=>{f(`[GameScene]  (${z?"":""}):`,me)})),Fr&&Fr(Te,[j,N])}const A=JSON.stringify({type:pe,content:{id:String(R.value.id),position:{x:String(j),y:String(N)}}});await Fe(A)}async function Mh(j,N){if(!R.value)return;f(`[GameScene] : (${j}, ${N})`),Ae.value=[j,N];const te=JSON.stringify({type:"on_get_summon_menu"});await Fe(te),await new Promise(pe=>setTimeout(pe,100)),Ce.value=!0}async function Ch(j,N){if(!R.value||!qe.value)return;f(`[GameScene]  ${qe.value} : (${j}, ${N})`);const te=R.value.id,pe=JSON.stringify({type:"on_structure_build_apply",content:{id:String(te),position:{x:String(j),y:String(N)},name:qe.value}});await Fe(pe),be.value=null,qe.value=null,ie.value&&ie.value.cancelAction(),await new Promise(Te=>setTimeout(Te,100)),f("[GameScene] "),await ko(te)}async function xh(j){if(!R.value||!Ae.value)return;const[N,te]=Ae.value;f(`[GameScene]  ${j} : (${N}, ${te})`);try{const pe=JSON.stringify({type:"on_summon_apply",content:{id:String(R.value.id),position:{x:String(N),y:String(te)},name:j}});await Fe(pe)}catch(pe){f("[GameScene] :",pe)}finally{Ce.value=!1,be.value=null,Ae.value=null,ie.value&&ie.value.cancelAction();try{const pe=JSON.stringify({type:"on_summon_end"});await Fe(pe)}catch(pe){f("[GameScene] :",pe)}}}function Ph(){Ce.value=!1,Ae.value=null,be.value=null;const j=JSON.stringify({type:"on_summon_end"});Fe(j).catch(N=>{f("[GameScene] ",N)})}function u_(){if(f("[GameScene] "),be.value==="structureMoving"){const j=JSON.stringify({type:"on_structure_move_end"});Fe(j).catch(N=>{f("[GameScene] ",N)})}else if(be.value==="structureAttacking"){const j=JSON.stringify({type:"on_structure_attack_end"});Fe(j).catch(N=>{f("[GameScene] ",N)})}else if(be.value==="structureExtract"){const j=JSON.stringify({type:"on_structure_extract_end"});Fe(j).catch(N=>{f("[GameScene] ",N)})}else if(be.value==="structureTransfer"){const j=JSON.stringify({type:"on_structure_transfer_end"});Fe(j).catch(N=>{f("[GameScene] ",N)})}be.value=null}function Lh(){u_(),ae.value=null,Se.value=null,f("[GameScene] ")}async function Ih(j){if(!ae.value)return;const N=ae.value.id;switch(f(`[GameScene] : ${j.type}, ID=${N}`),j.type){case"move":await Th(N);break;case"attack":await Eh(N);break;case"transfer":await Gh(N);break;case"extract":await Ah(N);break;default:f("[GameScene] :",j.type)}}async function Th(j){f(`[GameScene]  ${j} `);const N=JSON.stringify({type:"on_structure_move_start",content:{id:String(j)}});await Fe(N),be.value="structureMoving"}async function Eh(j){f(`[GameScene]  ${j} `);const N=JSON.stringify({type:"on_structure_attack_start",content:{id:String(j)}});await Fe(N),be.value="structureAttacking"}async function Ah(j){f(`[GameScene]  ${j} `);const N=JSON.stringify({type:"on_structure_extract_start",content:{id:String(j)}});await Fe(N),be.value="structureExtract"}async function Gh(j){f(`[GameScene]  ${j} `);const N=JSON.stringify({type:"on_structure_transfer_start",content:{id:String(j)}});await Fe(N),be.value="structureTransfer"}async function Rh(j,N){if(!ae.value)return;f(`[GameScene]  ${ae.value.id}  (${j}, ${N})`);const te=JSON.stringify({type:"on_structure_move_apply",content:{id:String(ae.value.id),position:{x:String(j),y:String(N)}}});await Fe(te),be.value=null}async function Oh(j,N){if(!ae.value)return;f(`[GameScene]  ${ae.value.id}  (${j}, ${N})`);const te=JSON.stringify({type:"on_structure_attack_apply",content:{id:String(ae.value.id),position:{x:String(j),y:String(N)}}});await Fe(te),be.value=null}async function Dh(j,N){if(!ae.value)return;f(`[GameScene]  ${ae.value.id}  (${j}, ${N}) `);const te=ae.value.id,pe=JSON.stringify({type:"on_structure_extract_apply",content:{id:String(te),position:{x:String(j),y:String(N)}}});await Fe(pe),f("[GameScene] ");const Te=JSON.stringify({type:"on_structure_extract_end"});await Fe(Te),await new Promise(M=>setTimeout(M,100)),f("[GameScene] "),be.value=null,setTimeout(async()=>{f("[GameScene] "),await Ti(te)},300)}async function Nh(j,N){if(!ae.value)return;f(`[GameScene]  ${ae.value.id}  (${j}, ${N}) `);const te=ae.value.id,pe=JSON.stringify({type:"on_structure_transfer_apply",content:{id:String(te),position:{x:String(j),y:String(N)}}});await Fe(pe),f("[GameScene] ");const Te=JSON.stringify({type:"on_structure_transfer_end"});await Fe(Te),await new Promise(M=>setTimeout(M,100)),f("[GameScene] "),be.value=null,setTimeout(async()=>{f("[GameScene] "),await Ti(te)},300)}async function ko(j){const N=ze.value.findIndex(pe=>pe.id===j);N!==-1&&(ot.value=N),ae.value=null;const te=JSON.stringify({type:"on_click_copper",content:{id:String(j)}});await Fe(te)}async function Ti(j){f(`[GameScene] : ID=${j}`),R.value=null;const N=JSON.stringify({type:"on_click_structure",content:{id:String(j)}});await Fe(N)}async function Ur(j,N=!1){if(N)ot.value=-1,Fc();else{const pe=ze.value.findIndex(Te=>Te.id===j);pe!==-1&&(ot.value=pe)}ae.value=null;const te=JSON.stringify({type:"on_click_enemy",content:{id:String(j)}});await Fe(te)}function Fc(){R.value=null,ue.value=[],be.value=null}async function jh(j){if(f("[GameScene] :",j),j.type==="moveStart")be.value="moving";else if(j.type==="attackStart")be.value="attacking";else if(j.type==="summonStart")be.value="summoning";else if(j.type==="buildRequest"){f("[GameScene] ");const N=JSON.stringify({type:"on_get_structure_menu"});await Fe(N)}else if(j.type==="buildStart")be.value="building",qe.value=j.structureName||null;else if(j.type==="transferring"||j.type==="transferStart")be.value="transferring",ne.value=[],we.value=[];else if(j.type==="transferComplete")be.value=null,ne.value=[],we.value=[];else if(j.type==="cancel"){const N=be.value;if(N==="moving"){const te=JSON.stringify({type:"on_move_end"});Fe(te).catch(pe=>{f("[GameScene] ",pe)})}else if(N==="attacking"){const te=JSON.stringify({type:"on_attack_end"});Fe(te).catch(pe=>{f("[GameScene] ",pe)})}else if(N==="transferring"){const te=JSON.stringify({type:"on_transfer_end"});Fe(te).catch(pe=>{f("[GameScene] ",pe)}),ne.value=[],we.value=[]}else if(N==="summoning"){const te=JSON.stringify({type:"on_summon_end"});Fe(te).catch(pe=>{f("[GameScene] ",pe)}),Ce.value=!1}else if(N==="building"){const te=JSON.stringify({type:"on_structure_build_end"});Fe(te).catch(pe=>{f("[GameScene] ",pe)}),qe.value=null,Ae.value=null}be.value=null}else j.type==="wait"&&(f("[GameScene] "),Uc())}function __(){if(ze.value.length!==0){if(R.value){const j=R.value.can_move,N=R.value.can_attack,te=R.value.can_summon;if(f(`[GameScene] : ID=${R.value.id}, can_move=${j}, can_attack=${N}, can_summon=${te}, hasAttackTargets=${re.value}`),j||N&&re.value||te){f("[GameScene] ");return}}f("[GameScene] "),Uc()}}async function Uc(){var te,pe,Te;if(ze.value.length===0)return;R.value=null,be.value=null,ot.value;let j=0;const N=ze.value.length;for(;j<N;){ot.value=(ot.value+1)%ze.value.length;const M=ze.value[ot.value];f(`[GameScene] : ${M.name||M.id} ( ${j+1}/${N})`),await new Promise(xe=>{setTimeout(async()=>{const Pe=P.find(Ve=>Ve.id===M.id);(Pe==null?void 0:Pe.type)==="summon"?await Ur(M.id,!1):await ko(M.id),xe()},300)}),await new Promise(xe=>setTimeout(xe,200));const A=((te=R.value)==null?void 0:te.can_move)||!1,z=((pe=R.value)==null?void 0:pe.can_attack)||!1,de=((Te=R.value)==null?void 0:Te.can_summon)||!1,me=A||z&&re.value||de;if(f(`[GameScene]  ${M.name}: can_move=${A}, can_attack=${z}, can_summon=${de}, hasTargets=${re.value}, valid=${me}`),R.value&&me){f(`[GameScene] : ${M.name||M.id}`);return}j++}f("[GameScene] "),R.value=null,n.isGameMode&&f('[GameScene] ""')}function Hh(){At.value++,ot.value=-1,R.value=null,be.value=null,ze.value.forEach(N=>N.turnDone=!1),f(`[GameScene]  ${At.value}`);const j=P.filter(N=>N.type==="enemy"&&!N.isOwned);if(f(`[GameScene]  ${j.length} `),j.length===0)f("[GameScene] "),Ot.value=!1;else{Ot.value=!0,vn.value.clear(),f("[GameScene] ");let N=setTimeout(()=>{Ot.value&&vn.value.size>0&&(f("[GameScene] "),Ot.value=!1,vn.value.clear())},3e3),te=setInterval(()=>{Ot.value||(clearTimeout(N),clearInterval(te))},100);setTimeout(()=>{Ot.value&&vn.value.size===0&&(f("[GameScene] "),Ot.value=!1,clearTimeout(N),clearInterval(te))},1e3)}}async function Fh(){f("[GameScene] "),ti.value=!1;const j=JSON.stringify({type:"on_game_over"});await Fe(j),s("back")}async function Uh(){f("[GameScene] game over"),ni.value=!1;const j=JSON.stringify({type:"on_game_over"});await Fe(j),Bh()}function Bh(){f("[GameScene] "),jr.value=!0,setTimeout(()=>{f("[GameScene] "),jr.value=!1,s("back")},5e3)}function zh(){f("[GameScene] "),jr.value=!1,s("back")}function Vh(){f("[GameScene] "),Hr.value=!0}function qh(){f("[GameScene] "),Hr.value=!1}async function Wh(){f("[GameScene]  game_over "),Hr.value=!1;const j=JSON.stringify({type:"on_game_over"});await Fe(j),s("back")}function Kh(){f("[GameScene] "),jc.value=!1,Hc.value=""}const Jh=`url('${Y("@assets/ui/panel7.png")}')`,Xh=`url('${Y("@assets/ui/panel8.png")}')`;return(j,N)=>{var te,pe,Te,M;return V(),Z("div",h9,[h("div",{ref_key:"container",ref:o,class:"scene-container"},null,512),e.isGameMode?(V(),Cn(EG,{key:0,currentCopperId:mh.value,copperList:ze.value,roundNumber:At.value,isEnemyMoving:Ot.value,onNextCopper:Uc,onEndRound:Hh,onSelectCopper:ko},null,8,["currentCopperId","copperList","roundNumber","isEnemyMoving"])):Ie("",!0),e.isGameMode?(V(),Z("button",{key:1,class:"withdraw-button",onClick:Vh},"  ")):Ie("",!0),e.isGameMode?(V(),Cn(f9,{key:2})):Ie("",!0),e.isGameMode&&R.value?(V(),Cn(hG,{key:3,ref_key:"copperActionPanelRef",ref:ie,copper:R.value,resources:ue.value,hasAttackTargets:re.value,transferTargets:we.value,onSelectCopper:ko,onClose:Fc,onAction:jh},null,8,["copper","resources","hasAttackTargets","transferTargets"])):Ie("",!0),e.isGameMode?(V(),Cn(cR,{key:4,visible:Ce.value,"copper-name":((Te=(pe=(te=R.value)==null?void 0:te.copper)==null?void 0:pe.copper_info)==null?void 0:Te.name)||"","enemy-list":st.value,position:Ae.value,onClose:Ph,onSummon:xh},null,8,["visible","copper-name","enemy-list","position"])):Ie("",!0),e.isGameMode&&ae.value?(V(),Cn(ER,{key:5,structure:ae.value,resources:((M=Se.value)==null?void 0:M.resources)||[],"action-mode":be.value==="structureMoving"?"move":be.value==="structureAttacking"?"attack":be.value==="structureExtract"?"extract":be.value==="structureTransfer"?"transfer":null,onClose:Lh,onAction:Ih,onCancel:u_},null,8,["structure","resources","action-mode"])):Ie("",!0),e.isGameMode?Ie("",!0):(V(),Z("div",g9,[...N[0]||(N[0]=[La('<h3 data-v-1fca4a0f>3D</h3><p style="color:#ffd700;font-weight:600;" data-v-1fca4a0f> </p><div style="margin:8px 0;padding:8px;background:rgba(255, 255, 255, 0.1);border-radius:6px;" data-v-1fca4a0f><p style="font-weight:600;" data-v-1fca4a0f> </p><p style="font-size:12px;" data-v-1fca4a0f>  = ID:1</p><p style="font-size:12px;" data-v-1fca4a0f>  = ID:2</p></div><div style="margin:8px 0;padding:8px;background:rgba(255, 255, 255, 0.1);border-radius:6px;" data-v-1fca4a0f><p style="font-weight:600;" data-v-1fca4a0f> EventLoop</p><p style="font-size:12px;" data-v-1fca4a0f>1.   EventLoop</p><p style="font-size:12px;" data-v-1fca4a0f>2. &quot; &quot;</p><p style="font-size:12px;" data-v-1fca4a0f>3. 3</p><p style="font-size:11px;" data-v-1fca4a0f>  =IronWall  =Arcanist  =CraftsMan </p></div>',4)])])),ti.value?(V(),Z("div",b9,[h("div",{class:"game-over-dialog"},[N[1]||(N[1]=h("h2",{class:"game-over-title"},"",-1)),N[2]||(N[2]=h("p",{class:"game-over-message"},"",-1)),h("button",{class:"game-over-button",onClick:Fh},"  ")])])):Ie("",!0),ni.value?(V(),Z("div",y9,[h("div",{class:"game-over-dialog success-dialog"},[N[3]||(N[3]=h("h2",{class:"success-title"},"  ",-1)),N[4]||(N[4]=h("p",{class:"game-over-message"},"",-1)),h("button",{class:"game-over-button success-button",onClick:Uh},"  ")])])):Ie("",!0),jr.value?(V(),Z("div",v9,[h("div",{class:"credits-container"},[N[5]||(N[5]=La('<h1 class="credits-title" data-v-1fca4a0f></h1><div class="credits-content" data-v-1fca4a0f><div class="credits-section" data-v-1fca4a0f><h2 data-v-1fca4a0f></h2><p data-v-1fca4a0f>MGPIC Team</p></div><div class="credits-section" data-v-1fca4a0f><h2 data-v-1fca4a0f></h2><p data-v-1fca4a0f>Backend Developer</p><p data-v-1fca4a0f>Frontend Developer</p></div><div class="credits-section" data-v-1fca4a0f><h2 data-v-1fca4a0f></h2><p data-v-1fca4a0f>3D Artist</p><p data-v-1fca4a0f>UI Designer</p></div><div class="credits-section" data-v-1fca4a0f><h2 data-v-1fca4a0f></h2><p data-v-1fca4a0f>Sound Designer</p></div><div class="credits-section" data-v-1fca4a0f><h2 data-v-1fca4a0f></h2><p data-v-1fca4a0f></p></div></div>',2)),h("button",{class:"skip-credits-button",onClick:zh},"")])])):Ie("",!0),jc.value?(V(),Z("div",w9,[h("div",S9,[N[6]||(N[6]=h("h2",{class:"withdraw-title"},"",-1)),h("p",k9,_e(Hc.value),1),h("div",{class:"dialog-buttons"},[h("button",{class:"dialog-button confirm-button",onClick:Kh},"  ")])])])):Ie("",!0),Hr.value?(V(),Z("div",M9,[h("div",{class:"game-over-dialog"},[N[7]||(N[7]=h("h2",{class:"withdraw-title"},"",-1)),N[8]||(N[8]=h("p",{class:"game-over-message"},[zo(""),h("br"),zo("")],-1)),h("div",{class:"dialog-buttons"},[h("button",{class:"dialog-button cancel-button",onClick:qh},"  "),h("button",{class:"dialog-button confirm-button",onClick:Wh},"  ")])])])):Ie("",!0),h("audio",{ref_key:"audioRef",ref:i,src:ye(r),loop:"",preload:"auto"},null,8,C9),h("audio",{ref_key:"moveSoundRef",ref:a,src:ye(d),preload:"auto"},null,8,x9),h("audio",{ref_key:"moveEnemySoundRef",ref:c,src:ye(p),preload:"auto"},null,8,P9),h("audio",{ref_key:"attackSoundRef",ref:l,src:ye(b),preload:"auto"},null,8,L9),h("audio",{ref_key:"attackEnemySoundRef",ref:u,src:ye(g),preload:"auto"},null,8,I9),h("audio",{ref_key:"meHurtSoundRef",ref:_,src:ye(m),preload:"auto"},null,8,T9),h("audio",{ref_key:"enemyHurtSoundRef",ref:$,src:ye(v),preload:"auto"},null,8,E9)])}}},G9=qt(A9,[["__scopeId","data-v-1fca4a0f"]]),R9={class:"stage"},O9={key:0,style:{position:"relative",width:"100%",height:"100%"}},D9={key:2,class:"modal"},N9={class:"modal-title"},j9={key:2,class:"overlay",style:{"z-index":"30000","align-items":"flex-start","justify-content":"flex-start",background:"rgba(0, 0, 0, 0.25)"}},H9={class:"settings"},F9={class:"settings__header"},U9=["src"],B9={class:"settings__content"},z9={__name:"App",setup(e){const t=oe(!1),n=oe(null),o=oe(!1),s=oe(null),i=oe([]);oe(0);const r=oe(!0),a=oe(!1),c=oe(!1);let l=null;function u(T){n.value!==T&&(i.value.push(n.value),n.value=T),window.__START_MENU_PAUSE__&&window.__START_MENU_PAUSE__(),t.value=!0}function _(){r.value=!1,l&&clearTimeout(l),l=setTimeout(()=>{r.value||(f("[App] StartMenu"),c.value=!0)},5*60*1e3)}function $(){n.value=null,i.value=[],window.__START_MENU_RESUME__&&window.__START_MENU_RESUME__(),t.value=!1}function d(T){f("[App] ID:",T.ids),$(),a.value=!0,f("[App] ")}function p(){a.value=!1}function b(){o.value=!0,t.value=!0}function g(){o.value=!1,n.value||(window.__START_MENU_RESUME__&&window.__START_MENU_RESUME__(),t.value=!1)}function m(){if(o.value){g();return}if(n.value){if(n.value==="warehouse"&&s.value&&s.value.handleBack&&s.value.handleBack())return;const T=i.value.pop()??null;n.value=T,T||(t.value=!1);return}if(!r.value){l&&(clearTimeout(l),l=null),c.value&&(c.value=!1,f("[App] StartMenu")),r.value=!0,setTimeout(()=>{window.__INIT_THREE_SCENE__?window.__INIT_THREE_SCENE__().then(()=>{window.__START_MENU_RESUME__&&window.__START_MENU_RESUME__()}).catch(()=>{window.__START_MENU_RESUME__&&window.__START_MENU_RESUME__()}):window.__START_MENU_RESUME__&&window.__START_MENU_RESUME__()},100),t.value=!1;return}}const v=oe(!0),y=oe(null);function w(){v.value=!v.value,f("[App] :",v.value?"":"")}async function k(){try{f("[App] ...");const T=gI();if(T.type==="error"){f("[App] :",T.content),alert(": "+T.content);return}f("[App] ...");const x=new Blob([JSON.stringify(T,null,2)],{type:"application/json"}),D=document.createElement("a");D.href=URL.createObjectURL(x);const U=new Date().toISOString().replace(/[:.]/g,"-").slice(0,-5);D.download=`mgpic-save-${U}.json`,D.click(),URL.revokeObjectURL(D.href),f("[App] ")}catch(T){f("[App] :",T),alert("")}}function I(){try{y.value&&y.value.click()}catch{}}async function P(T){try{const x=T.target&&T.target.files&&T.target.files[0];if(!x)return;f("[App] ...");const D=new FileReader;D.onload=async()=>{try{const U=String(D.result||"{}"),L=JSON.parse(U);f("[App] ..."),hI(U),f("[App] "),alert("")}catch(U){f("[App] :",U),alert(": "+U.message)}T.target.value=""},D.onerror=()=>{f("[App] "),alert(""),T.target.value=""},D.readAsText(x)}catch(x){f("[App] :",x),alert("")}}return gn(()=>{ah(T=>{})}),Ls(()=>{l&&(clearTimeout(l),l=null)}),(T,x)=>(V(),Z("div",R9,[a.value?(V(),Cn(G9,{key:0,isGameMode:!0,"music-on":v.value,onBack:p},null,8,["music-on"])):Ie("",!0),a.value?Ie("",!0):(V(),Z(ht,{key:1},[c.value?Ie("",!0):Wd((V(),Cn(ZT,{key:0,visible:r.value,onStarted:_},null,8,["visible"])),[[Ip,r.value]]),r.value?Ie("",!0):(V(),Cn(Y$,{key:1,"music-on":v.value,onBack:m,onOpenSettings:b,onToggleMusic:w},null,8,["music-on"])),xt($1,{"music-on":v.value,paused:n.value==="start"||n.value==="warehouse"||a.value,onStartGame:x[0]||(x[0]=D=>u("start")),onOpenWarehouse:x[1]||(x[1]=D=>u("warehouse")),onOpenTutorial:x[2]||(x[2]=D=>u("tutorial")),onOpenEncyclopedia:x[3]||(x[3]=D=>u("encyclopedia")),onToggleMusic:w},null,8,["music-on","paused"]),n.value?(V(),Z("div",{key:2,class:kt(["overlay",{"overlay--warehouse":n.value==="warehouse"}])},[n.value==="warehouse"?(V(),Z("div",O9,[xt(Y$,{"music-on":v.value,onBack:m,onOpenSettings:b,onToggleMusic:w},null,8,["music-on"]),xt(LT,{ref_key:"warehouseRef",ref:s,"music-on":v.value},null,8,["music-on"])])):n.value==="start"?(V(),Cn(NE,{key:1,"music-on":v.value,paused:a.value,onClose:$,onConfirm:d},null,8,["music-on","paused"])):(V(),Z("div",D9,[h("h2",N9,_e(n.value==="warehouse"?"  Copper Warehouse":n.value==="tutorial"?"  Tutorial":n.value==="encyclopedia"?"  Game Encyclopedia":"  Start Game"),1),x[4]||(x[4]=h("p",{class:"modal-body"},"",-1)),h("button",{class:"close-btn",onClick:$},"")]))],2)):Ie("",!0)],64)),o.value?(V(),Z("div",j9,[h("div",H9,[h("div",F9,[x[5]||(x[5]=h("div",{class:"settings__title"},"",-1)),h("button",{class:"settings__close",onClick:g,"aria-label":""},[h("img",{src:ye(Y)("@assets/ui/close.png"),alt:""},null,8,U9)])]),h("div",B9,[h("button",{class:"settings__item",onClick:k},[...x[6]||(x[6]=[La('<span class="settings__icon" data-v-bc37ebaf><svg width="44" height="44" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-bc37ebaf><path d="M12 3v12m0 0l-4-4m4 4l4-4" stroke="#fff" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" data-v-bc37ebaf></path><path d="M4 19h16" stroke="#fff" stroke-width="2" stroke-linecap="round" data-v-bc37ebaf></path></svg></span><span class="settings__label" data-v-bc37ebaf></span>',2)])]),h("button",{class:"settings__item",onClick:I},[...x[7]||(x[7]=[La('<span class="settings__icon" data-v-bc37ebaf><svg width="44" height="44" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-bc37ebaf><path d="M12 21V9m0 0l4 4m-4-4L8 13" stroke="#fff" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" data-v-bc37ebaf></path><path d="M4 5h16" stroke="#fff" stroke-width="2" stroke-linecap="round" data-v-bc37ebaf></path></svg></span><span class="settings__label" data-v-bc37ebaf></span>',2)])]),h("input",{ref_key:"fileInput",ref:y,type:"file",accept:".json",onChange:P,style:{display:"none"}},null,544)])])])):Ie("",!0)]))}},sd=qt(z9,[["__scopeId","data-v-bc37ebaf"]]);function V9(){const e=navigator.userAgent;return/Safari/.test(e)&&!/Chrome/.test(e)&&!/Chromium/.test(e)}function q9(){const e=document.getElementById("safari-warning"),t=document.getElementById("loading-screen");e.style.display="flex",t.style.display="none",document.getElementById("download-local").addEventListener("click",()=>{window.open("https://github.com/MGPIC-2025/Cross/releases","_blank")}),document.getElementById("continue-safari").addEventListener("click",()=>{e.style.display="none",t.style.display="flex",ph()}),document.getElementById("download-chrome").addEventListener("click",()=>{window.open("https://www.google.com/chrome/","_blank")})}function bl(e,t,n,o=""){const s=document.getElementById("progress-bar"),i=document.getElementById("progress-text"),r=document.querySelector(".loading-subtitle");s&&(s.style.width=n+"%"),i&&(e===0&&t===0?i.textContent=`${n}%`:i.textContent=`${e} / ${t} (${n}%)`),r&&o&&(r.textContent=o)}function od(){const e=document.getElementById("loading-screen");e&&(e.classList.add("fade-out"),setTimeout(()=>{e.style.display="none"},500))}async function ph(){try{f("..."),await jl(bl,["high"]),f(""),bl(0,100,100,"..."),t$(sd).mount("#app"),await new Promise(t=>setTimeout(t,200)),window.__INIT_THREE_SCENE__&&await window.__INIT_THREE_SCENE__((t,n,o)=>{bl(0,0,o,`3D... ${o}%`)}),f(""),setTimeout(()=>{od()},300),setTimeout(async()=>{try{f("..."),await jl(null,["medium"]),f("")}catch(t){f(":",t)}},1e3)}catch(e){f(":",e),t$(sd).mount("#app"),od()}}V9()?(f("Safari"),q9()):(f("Safari"),ph());
