import{T as Ec,a as li,b as lr,L as cr,c as gn,F as no,M as cs,V as It,C as rs,d as ls,S as ys,e as xc,P as Zs,D as vs,f as Vs,g as xe,I as ur,Q as cn,h as kc,O as dr,i as Ac,j as Rc,B as vn,k as $c,l as fr,N as Pc,m as Lc,n as Ic,o as ci,p as pr,R as ui,q as Oc,r as Dc,s as Nc,t as Bo,u as Gc,v as Dt,w as ks,x as $t,y as Hc,z as hr,A as Uc,E as ot,G as Fc,H as Bc,J as jc,K as zc,U as Jt,W as Dn,X as mr,Y as Vc,Z as Kc,_ as Wc,$ as qc,a0 as Xc,a1 as _r,a2 as Yc,a3 as oa,a4 as ia,a5 as aa,a6 as ra,a7 as di,a8 as Jc,a9 as Zc,aa as Ct,ab as Qc,ac as eu,ad as Yt,ae as yo,af as bo,ag as wo,ah as tu,ai as su,aj as en,ak as Qs,al as la,am as nu,an as gr,ao as oo,ap as fi,aq as io,ar as ou,as as iu,at as au,au as ca,av as ru}from"./three-BxQHwZkI.js";(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const o of document.querySelectorAll('link[rel="modulepreload"]'))n(o);new MutationObserver(o=>{for(const i of o)if(i.type==="childList")for(const a of i.addedNodes)a.tagName==="LINK"&&a.rel==="modulepreload"&&n(a)}).observe(document,{childList:!0,subtree:!0});function s(o){const i={};return o.integrity&&(i.integrity=o.integrity),o.referrerPolicy&&(i.referrerPolicy=o.referrerPolicy),o.crossOrigin==="use-credentials"?i.credentials="include":o.crossOrigin==="anonymous"?i.credentials="omit":i.credentials="same-origin",i}function n(o){if(o.ep)return;o.ep=!0;const i=s(o);fetch(o.href,i)}})();const lu="debug";function f(...t){switch(lu){case"debug":console.log(...t);break}}/**
* @vue/shared v3.5.22
* (c) 2018-present Yuxi (Evan) You and Vue contributors
* @license MIT
**/function Ri(t){const e=Object.create(null);for(const s of t.split(","))e[s]=1;return s=>s in e}const Je={},tn=[],Qt=()=>{},vr=()=>!1,So=t=>t.charCodeAt(0)===111&&t.charCodeAt(1)===110&&(t.charCodeAt(2)>122||t.charCodeAt(2)<97),$i=t=>t.startsWith("onUpdate:"),gt=Object.assign,Pi=(t,e)=>{const s=t.indexOf(e);s>-1&&t.splice(s,1)},cu=Object.prototype.hasOwnProperty,Ke=(t,e)=>cu.call(t,e),Te=Array.isArray,sn=t=>To(t)==="[object Map]",yr=t=>To(t)==="[object Set]",ke=t=>typeof t=="function",rt=t=>typeof t=="string",Ls=t=>typeof t=="symbol",et=t=>t!==null&&typeof t=="object",br=t=>(et(t)||ke(t))&&ke(t.then)&&ke(t.catch),wr=Object.prototype.toString,To=t=>wr.call(t),uu=t=>To(t).slice(8,-1),Sr=t=>To(t)==="[object Object]",Li=t=>rt(t)&&t!=="NaN"&&t[0]!=="-"&&""+parseInt(t,10)===t,yn=Ri(",key,ref,ref_for,ref_key,onVnodeBeforeMount,onVnodeMounted,onVnodeBeforeUpdate,onVnodeUpdated,onVnodeBeforeUnmount,onVnodeUnmounted"),Mo=t=>{const e=Object.create(null);return s=>e[s]||(e[s]=t(s))},du=/-\w/g,As=Mo(t=>t.replace(du,e=>e.slice(1).toUpperCase())),fu=/\B([A-Z])/g,Ws=Mo(t=>t.replace(fu,"-$1").toLowerCase()),Tr=Mo(t=>t.charAt(0).toUpperCase()+t.slice(1)),jo=Mo(t=>t?`on${Tr(t)}`:""),xs=(t,e)=>!Object.is(t,e),zo=(t,...e)=>{for(let s=0;s<t.length;s++)t[s](...e)},Mr=(t,e,s,n=!1)=>{Object.defineProperty(t,e,{configurable:!0,enumerable:!1,writable:n,value:s})},pu=t=>{const e=parseFloat(t);return isNaN(e)?t:e},hu=t=>{const e=rt(t)?Number(t):NaN;return isNaN(e)?t:e};let ua;const Co=()=>ua||(ua=typeof globalThis<"u"?globalThis:typeof self<"u"?self:typeof window<"u"?window:typeof global<"u"?global:{});function Gt(t){if(Te(t)){const e={};for(let s=0;s<t.length;s++){const n=t[s],o=rt(n)?vu(n):Gt(n);if(o)for(const i in o)e[i]=o[i]}return e}else if(rt(t)||et(t))return t}const mu=/;(?![^(]*\))/g,_u=/:([^]+)/,gu=/\/\*[^]*?\*\//g;function vu(t){const e={};return t.replace(gu,"").split(mu).forEach(s=>{if(s){const n=s.split(_u);n.length>1&&(e[n[0].trim()]=n[1].trim())}}),e}function Ye(t){let e="";if(rt(t))e=t;else if(Te(t))for(let s=0;s<t.length;s++){const n=Ye(t[s]);n&&(e+=n+" ")}else if(et(t))for(const s in t)t[s]&&(e+=s+" ");return e.trim()}const yu="itemscope,allowfullscreen,formnovalidate,ismap,nomodule,novalidate,readonly",bu=Ri(yu);function Cr(t){return!!t||t===""}const Er=t=>!!(t&&t.__v_isRef===!0),se=t=>rt(t)?t:t==null?"":Te(t)||et(t)&&(t.toString===wr||!ke(t.toString))?Er(t)?se(t.value):JSON.stringify(t,xr,2):String(t),xr=(t,e)=>Er(e)?xr(t,e.value):sn(e)?{[`Map(${e.size})`]:[...e.entries()].reduce((s,[n,o],i)=>(s[Vo(n,i)+" =>"]=o,s),{})}:yr(e)?{[`Set(${e.size})`]:[...e.values()].map(s=>Vo(s))}:Ls(e)?Vo(e):et(e)&&!Te(e)&&!Sr(e)?String(e):e,Vo=(t,e="")=>{var s;return Ls(t)?`Symbol(${(s=t.description)!=null?s:e})`:t};function wu(t){return t==null?"initial":typeof t=="string"?t===""?" ":t:String(t)}/**
* @vue/reactivity v3.5.22
* (c) 2018-present Yuxi (Evan) You and Vue contributors
* @license MIT
**/let Ot;class Su{constructor(e=!1){this.detached=e,this._active=!0,this._on=0,this.effects=[],this.cleanups=[],this._isPaused=!1,this.parent=Ot,!e&&Ot&&(this.index=(Ot.scopes||(Ot.scopes=[])).push(this)-1)}get active(){return this._active}pause(){if(this._active){this._isPaused=!0;let e,s;if(this.scopes)for(e=0,s=this.scopes.length;e<s;e++)this.scopes[e].pause();for(e=0,s=this.effects.length;e<s;e++)this.effects[e].pause()}}resume(){if(this._active&&this._isPaused){this._isPaused=!1;let e,s;if(this.scopes)for(e=0,s=this.scopes.length;e<s;e++)this.scopes[e].resume();for(e=0,s=this.effects.length;e<s;e++)this.effects[e].resume()}}run(e){if(this._active){const s=Ot;try{return Ot=this,e()}finally{Ot=s}}}on(){++this._on===1&&(this.prevScope=Ot,Ot=this)}off(){this._on>0&&--this._on===0&&(Ot=this.prevScope,this.prevScope=void 0)}stop(e){if(this._active){this._active=!1;let s,n;for(s=0,n=this.effects.length;s<n;s++)this.effects[s].stop();for(this.effects.length=0,s=0,n=this.cleanups.length;s<n;s++)this.cleanups[s]();if(this.cleanups.length=0,this.scopes){for(s=0,n=this.scopes.length;s<n;s++)this.scopes[s].stop(!0);this.scopes.length=0}if(!this.detached&&this.parent&&!e){const o=this.parent.scopes.pop();o&&o!==this&&(this.parent.scopes[this.index]=o,o.index=this.index)}this.parent=void 0}}}function Tu(){return Ot}let Qe;const Ko=new WeakSet;class kr{constructor(e){this.fn=e,this.deps=void 0,this.depsTail=void 0,this.flags=5,this.next=void 0,this.cleanup=void 0,this.scheduler=void 0,Ot&&Ot.active&&Ot.effects.push(this)}pause(){this.flags|=64}resume(){this.flags&64&&(this.flags&=-65,Ko.has(this)&&(Ko.delete(this),this.trigger()))}notify(){this.flags&2&&!(this.flags&32)||this.flags&8||Rr(this)}run(){if(!(this.flags&1))return this.fn();this.flags|=2,da(this),$r(this);const e=Qe,s=es;Qe=this,es=!0;try{return this.fn()}finally{Pr(this),Qe=e,es=s,this.flags&=-3}}stop(){if(this.flags&1){for(let e=this.deps;e;e=e.nextDep)Di(e);this.deps=this.depsTail=void 0,da(this),this.onStop&&this.onStop(),this.flags&=-2}}trigger(){this.flags&64?Ko.add(this):this.scheduler?this.scheduler():this.runIfDirty()}runIfDirty(){pi(this)&&this.run()}get dirty(){return pi(this)}}let Ar=0,bn,wn;function Rr(t,e=!1){if(t.flags|=8,e){t.next=wn,wn=t;return}t.next=bn,bn=t}function Ii(){Ar++}function Oi(){if(--Ar>0)return;if(wn){let e=wn;for(wn=void 0;e;){const s=e.next;e.next=void 0,e.flags&=-9,e=s}}let t;for(;bn;){let e=bn;for(bn=void 0;e;){const s=e.next;if(e.next=void 0,e.flags&=-9,e.flags&1)try{e.trigger()}catch(n){t||(t=n)}e=s}}if(t)throw t}function $r(t){for(let e=t.deps;e;e=e.nextDep)e.version=-1,e.prevActiveLink=e.dep.activeLink,e.dep.activeLink=e}function Pr(t){let e,s=t.depsTail,n=s;for(;n;){const o=n.prevDep;n.version===-1?(n===s&&(s=o),Di(n),Mu(n)):e=n,n.dep.activeLink=n.prevActiveLink,n.prevActiveLink=void 0,n=o}t.deps=e,t.depsTail=s}function pi(t){for(let e=t.deps;e;e=e.nextDep)if(e.dep.version!==e.version||e.dep.computed&&(Lr(e.dep.computed)||e.dep.version!==e.version))return!0;return!!t._dirty}function Lr(t){if(t.flags&4&&!(t.flags&16)||(t.flags&=-17,t.globalVersion===kn)||(t.globalVersion=kn,!t.isSSR&&t.flags&128&&(!t.deps&&!t._dirty||!pi(t))))return;t.flags|=2;const e=t.dep,s=Qe,n=es;Qe=t,es=!0;try{$r(t);const o=t.fn(t._value);(e.version===0||xs(o,t._value))&&(t.flags|=128,t._value=o,e.version++)}catch(o){throw e.version++,o}finally{Qe=s,es=n,Pr(t),t.flags&=-3}}function Di(t,e=!1){const{dep:s,prevSub:n,nextSub:o}=t;if(n&&(n.nextSub=o,t.prevSub=void 0),o&&(o.prevSub=n,t.nextSub=void 0),s.subs===t&&(s.subs=n,!n&&s.computed)){s.computed.flags&=-5;for(let i=s.computed.deps;i;i=i.nextDep)Di(i,!0)}!e&&!--s.sc&&s.map&&s.map.delete(s.key)}function Mu(t){const{prevDep:e,nextDep:s}=t;e&&(e.nextDep=s,t.prevDep=void 0),s&&(s.prevDep=e,t.nextDep=void 0)}let es=!0;const Ir=[];function bs(){Ir.push(es),es=!1}function ws(){const t=Ir.pop();es=t===void 0?!0:t}function da(t){const{cleanup:e}=t;if(t.cleanup=void 0,e){const s=Qe;Qe=void 0;try{e()}finally{Qe=s}}}let kn=0;class Cu{constructor(e,s){this.sub=e,this.dep=s,this.version=s.version,this.nextDep=this.prevDep=this.nextSub=this.prevSub=this.prevActiveLink=void 0}}class Ni{constructor(e){this.computed=e,this.version=0,this.activeLink=void 0,this.subs=void 0,this.map=void 0,this.key=void 0,this.sc=0,this.__v_skip=!0}track(e){if(!Qe||!es||Qe===this.computed)return;let s=this.activeLink;if(s===void 0||s.sub!==Qe)s=this.activeLink=new Cu(Qe,this),Qe.deps?(s.prevDep=Qe.depsTail,Qe.depsTail.nextDep=s,Qe.depsTail=s):Qe.deps=Qe.depsTail=s,Or(s);else if(s.version===-1&&(s.version=this.version,s.nextDep)){const n=s.nextDep;n.prevDep=s.prevDep,s.prevDep&&(s.prevDep.nextDep=n),s.prevDep=Qe.depsTail,s.nextDep=void 0,Qe.depsTail.nextDep=s,Qe.depsTail=s,Qe.deps===s&&(Qe.deps=n)}return s}trigger(e){this.version++,kn++,this.notify(e)}notify(e){Ii();try{for(let s=this.subs;s;s=s.prevSub)s.sub.notify()&&s.sub.dep.notify()}finally{Oi()}}}function Or(t){if(t.dep.sc++,t.sub.flags&4){const e=t.dep.computed;if(e&&!t.dep.subs){e.flags|=20;for(let n=e.deps;n;n=n.nextDep)Or(n)}const s=t.dep.subs;s!==t&&(t.prevSub=s,s&&(s.nextSub=t)),t.dep.subs=t}}const hi=new WeakMap,Ks=Symbol(""),mi=Symbol(""),An=Symbol("");function wt(t,e,s){if(es&&Qe){let n=hi.get(t);n||hi.set(t,n=new Map);let o=n.get(s);o||(n.set(s,o=new Ni),o.map=n,o.key=s),o.track()}}function _s(t,e,s,n,o,i){const a=hi.get(t);if(!a){kn++;return}const r=l=>{l&&l.trigger()};if(Ii(),e==="clear")a.forEach(r);else{const l=Te(t),c=l&&Li(s);if(l&&s==="length"){const u=Number(n);a.forEach((d,h)=>{(h==="length"||h===An||!Ls(h)&&h>=u)&&r(d)})}else switch((s!==void 0||a.has(void 0))&&r(a.get(s)),c&&r(a.get(An)),e){case"add":l?c&&r(a.get("length")):(r(a.get(Ks)),sn(t)&&r(a.get(mi)));break;case"delete":l||(r(a.get(Ks)),sn(t)&&r(a.get(mi)));break;case"set":sn(t)&&r(a.get(Ks));break}}Oi()}function Xs(t){const e=je(t);return e===t?e:(wt(e,"iterate",An),Kt(t)?e:e.map(_t))}function Eo(t){return wt(t=je(t),"iterate",An),t}const Eu={__proto__:null,[Symbol.iterator](){return Wo(this,Symbol.iterator,_t)},concat(...t){return Xs(this).concat(...t.map(e=>Te(e)?Xs(e):e))},entries(){return Wo(this,"entries",t=>(t[1]=_t(t[1]),t))},every(t,e){return fs(this,"every",t,e,void 0,arguments)},filter(t,e){return fs(this,"filter",t,e,s=>s.map(_t),arguments)},find(t,e){return fs(this,"find",t,e,_t,arguments)},findIndex(t,e){return fs(this,"findIndex",t,e,void 0,arguments)},findLast(t,e){return fs(this,"findLast",t,e,_t,arguments)},findLastIndex(t,e){return fs(this,"findLastIndex",t,e,void 0,arguments)},forEach(t,e){return fs(this,"forEach",t,e,void 0,arguments)},includes(...t){return qo(this,"includes",t)},indexOf(...t){return qo(this,"indexOf",t)},join(t){return Xs(this).join(t)},lastIndexOf(...t){return qo(this,"lastIndexOf",t)},map(t,e){return fs(this,"map",t,e,void 0,arguments)},pop(){return fn(this,"pop")},push(...t){return fn(this,"push",t)},reduce(t,...e){return fa(this,"reduce",t,e)},reduceRight(t,...e){return fa(this,"reduceRight",t,e)},shift(){return fn(this,"shift")},some(t,e){return fs(this,"some",t,e,void 0,arguments)},splice(...t){return fn(this,"splice",t)},toReversed(){return Xs(this).toReversed()},toSorted(t){return Xs(this).toSorted(t)},toSpliced(...t){return Xs(this).toSpliced(...t)},unshift(...t){return fn(this,"unshift",t)},values(){return Wo(this,"values",_t)}};function Wo(t,e,s){const n=Eo(t),o=n[e]();return n!==t&&!Kt(t)&&(o._next=o.next,o.next=()=>{const i=o._next();return i.done||(i.value=s(i.value)),i}),o}const xu=Array.prototype;function fs(t,e,s,n,o,i){const a=Eo(t),r=a!==t&&!Kt(t),l=a[e];if(l!==xu[e]){const d=l.apply(t,i);return r?_t(d):d}let c=s;a!==t&&(r?c=function(d,h){return s.call(this,_t(d),h,t)}:s.length>2&&(c=function(d,h){return s.call(this,d,h,t)}));const u=l.call(a,c,n);return r&&o?o(u):u}function fa(t,e,s,n){const o=Eo(t);let i=s;return o!==t&&(Kt(t)?s.length>3&&(i=function(a,r,l){return s.call(this,a,r,l,t)}):i=function(a,r,l){return s.call(this,a,_t(r),l,t)}),o[e](i,...n)}function qo(t,e,s){const n=je(t);wt(n,"iterate",An);const o=n[e](...s);return(o===-1||o===!1)&&Fi(s[0])?(s[0]=je(s[0]),n[e](...s)):o}function fn(t,e,s=[]){bs(),Ii();const n=je(t)[e].apply(t,s);return Oi(),ws(),n}const ku=Ri("__proto__,__v_isRef,__isVue"),Dr=new Set(Object.getOwnPropertyNames(Symbol).filter(t=>t!=="arguments"&&t!=="caller").map(t=>Symbol[t]).filter(Ls));function Au(t){Ls(t)||(t=String(t));const e=je(this);return wt(e,"has",t),e.hasOwnProperty(t)}class Nr{constructor(e=!1,s=!1){this._isReadonly=e,this._isShallow=s}get(e,s,n){if(s==="__v_skip")return e.__v_skip;const o=this._isReadonly,i=this._isShallow;if(s==="__v_isReactive")return!o;if(s==="__v_isReadonly")return o;if(s==="__v_isShallow")return i;if(s==="__v_raw")return n===(o?i?Hu:Fr:i?Ur:Hr).get(e)||Object.getPrototypeOf(e)===Object.getPrototypeOf(n)?e:void 0;const a=Te(e);if(!o){let l;if(a&&(l=Eu[s]))return l;if(s==="hasOwnProperty")return Au}const r=Reflect.get(e,s,St(e)?e:n);if((Ls(s)?Dr.has(s):ku(s))||(o||wt(e,"get",s),i))return r;if(St(r)){const l=a&&Li(s)?r:r.value;return o&&et(l)?gi(l):l}return et(r)?o?gi(r):Hi(r):r}}class Gr extends Nr{constructor(e=!1){super(!1,e)}set(e,s,n,o){let i=e[s];if(!this._isShallow){const l=Rs(i);if(!Kt(n)&&!Rs(n)&&(i=je(i),n=je(n)),!Te(e)&&St(i)&&!St(n))return l||(i.value=n),!0}const a=Te(e)&&Li(s)?Number(s)<e.length:Ke(e,s),r=Reflect.set(e,s,n,St(e)?e:o);return e===je(o)&&(a?xs(n,i)&&_s(e,"set",s,n):_s(e,"add",s,n)),r}deleteProperty(e,s){const n=Ke(e,s);e[s];const o=Reflect.deleteProperty(e,s);return o&&n&&_s(e,"delete",s,void 0),o}has(e,s){const n=Reflect.has(e,s);return(!Ls(s)||!Dr.has(s))&&wt(e,"has",s),n}ownKeys(e){return wt(e,"iterate",Te(e)?"length":Ks),Reflect.ownKeys(e)}}class Ru extends Nr{constructor(e=!1){super(!0,e)}set(e,s){return!0}deleteProperty(e,s){return!0}}const $u=new Gr,Pu=new Ru,Lu=new Gr(!0);const _i=t=>t,jn=t=>Reflect.getPrototypeOf(t);function Iu(t,e,s){return function(...n){const o=this.__v_raw,i=je(o),a=sn(i),r=t==="entries"||t===Symbol.iterator&&a,l=t==="keys"&&a,c=o[t](...n),u=s?_i:e?ao:_t;return!e&&wt(i,"iterate",l?mi:Ks),{next(){const{value:d,done:h}=c.next();return h?{value:d,done:h}:{value:r?[u(d[0]),u(d[1])]:u(d),done:h}},[Symbol.iterator](){return this}}}}function zn(t){return function(...e){return t==="delete"?!1:t==="clear"?void 0:this}}function Ou(t,e){const s={get(o){const i=this.__v_raw,a=je(i),r=je(o);t||(xs(o,r)&&wt(a,"get",o),wt(a,"get",r));const{has:l}=jn(a),c=e?_i:t?ao:_t;if(l.call(a,o))return c(i.get(o));if(l.call(a,r))return c(i.get(r));i!==a&&i.get(o)},get size(){const o=this.__v_raw;return!t&&wt(je(o),"iterate",Ks),o.size},has(o){const i=this.__v_raw,a=je(i),r=je(o);return t||(xs(o,r)&&wt(a,"has",o),wt(a,"has",r)),o===r?i.has(o):i.has(o)||i.has(r)},forEach(o,i){const a=this,r=a.__v_raw,l=je(r),c=e?_i:t?ao:_t;return!t&&wt(l,"iterate",Ks),r.forEach((u,d)=>o.call(i,c(u),c(d),a))}};return gt(s,t?{add:zn("add"),set:zn("set"),delete:zn("delete"),clear:zn("clear")}:{add(o){!e&&!Kt(o)&&!Rs(o)&&(o=je(o));const i=je(this);return jn(i).has.call(i,o)||(i.add(o),_s(i,"add",o,o)),this},set(o,i){!e&&!Kt(i)&&!Rs(i)&&(i=je(i));const a=je(this),{has:r,get:l}=jn(a);let c=r.call(a,o);c||(o=je(o),c=r.call(a,o));const u=l.call(a,o);return a.set(o,i),c?xs(i,u)&&_s(a,"set",o,i):_s(a,"add",o,i),this},delete(o){const i=je(this),{has:a,get:r}=jn(i);let l=a.call(i,o);l||(o=je(o),l=a.call(i,o)),r&&r.call(i,o);const c=i.delete(o);return l&&_s(i,"delete",o,void 0),c},clear(){const o=je(this),i=o.size!==0,a=o.clear();return i&&_s(o,"clear",void 0,void 0),a}}),["keys","values","entries",Symbol.iterator].forEach(o=>{s[o]=Iu(o,t,e)}),s}function Gi(t,e){const s=Ou(t,e);return(n,o,i)=>o==="__v_isReactive"?!t:o==="__v_isReadonly"?t:o==="__v_raw"?n:Reflect.get(Ke(s,o)&&o in n?s:n,o,i)}const Du={get:Gi(!1,!1)},Nu={get:Gi(!1,!0)},Gu={get:Gi(!0,!1)};const Hr=new WeakMap,Ur=new WeakMap,Fr=new WeakMap,Hu=new WeakMap;function Uu(t){switch(t){case"Object":case"Array":return 1;case"Map":case"Set":case"WeakMap":case"WeakSet":return 2;default:return 0}}function Fu(t){return t.__v_skip||!Object.isExtensible(t)?0:Uu(uu(t))}function Hi(t){return Rs(t)?t:Ui(t,!1,$u,Du,Hr)}function Bu(t){return Ui(t,!1,Lu,Nu,Ur)}function gi(t){return Ui(t,!0,Pu,Gu,Fr)}function Ui(t,e,s,n,o){if(!et(t)||t.__v_raw&&!(e&&t.__v_isReactive))return t;const i=Fu(t);if(i===0)return t;const a=o.get(t);if(a)return a;const r=new Proxy(t,i===2?n:s);return o.set(t,r),r}function nn(t){return Rs(t)?nn(t.__v_raw):!!(t&&t.__v_isReactive)}function Rs(t){return!!(t&&t.__v_isReadonly)}function Kt(t){return!!(t&&t.__v_isShallow)}function Fi(t){return t?!!t.__v_raw:!1}function je(t){const e=t&&t.__v_raw;return e?je(e):t}function ju(t){return!Ke(t,"__v_skip")&&Object.isExtensible(t)&&Mr(t,"__v_skip",!0),t}const _t=t=>et(t)?Hi(t):t,ao=t=>et(t)?gi(t):t;function St(t){return t?t.__v_isRef===!0:!1}function B(t){return zu(t,!1)}function zu(t,e){return St(t)?t:new Vu(t,e)}class Vu{constructor(e,s){this.dep=new Ni,this.__v_isRef=!0,this.__v_isShallow=!1,this._rawValue=s?e:je(e),this._value=s?e:_t(e),this.__v_isShallow=s}get value(){return this.dep.track(),this._value}set value(e){const s=this._rawValue,n=this.__v_isShallow||Kt(e)||Rs(e);e=n?e:je(e),xs(e,s)&&(this._rawValue=e,this._value=n?e:_t(e),this.dep.trigger())}}function ue(t){return St(t)?t.value:t}const Ku={get:(t,e,s)=>e==="__v_raw"?t:ue(Reflect.get(t,e,s)),set:(t,e,s,n)=>{const o=t[e];return St(o)&&!St(s)?(o.value=s,!0):Reflect.set(t,e,s,n)}};function Br(t){return nn(t)?t:new Proxy(t,Ku)}class Wu{constructor(e,s,n){this.fn=e,this.setter=s,this._value=void 0,this.dep=new Ni(this),this.__v_isRef=!0,this.deps=void 0,this.depsTail=void 0,this.flags=16,this.globalVersion=kn-1,this.next=void 0,this.effect=this,this.__v_isReadonly=!s,this.isSSR=n}notify(){if(this.flags|=16,!(this.flags&8)&&Qe!==this)return Rr(this,!0),!0}get value(){const e=this.dep.track();return Lr(this),e&&(e.version=this.dep.version),this._value}set value(e){this.setter&&this.setter(e)}}function qu(t,e,s=!1){let n,o;return ke(t)?n=t:(n=t.get,o=t.set),new Wu(n,o,s)}const Vn={},ro=new WeakMap;let Bs;function Xu(t,e=!1,s=Bs){if(s){let n=ro.get(s);n||ro.set(s,n=[]),n.push(t)}}function Yu(t,e,s=Je){const{immediate:n,deep:o,once:i,scheduler:a,augmentJob:r,call:l}=s,c=w=>o?w:Kt(w)||o===!1||o===0?gs(w,1):gs(w);let u,d,h,m,_=!1,E=!1;if(St(t)?(d=()=>t.value,_=Kt(t)):nn(t)?(d=()=>c(t),_=!0):Te(t)?(E=!0,_=t.some(w=>nn(w)||Kt(w)),d=()=>t.map(w=>{if(St(w))return w.value;if(nn(w))return c(w);if(ke(w))return l?l(w,2):w()})):ke(t)?e?d=l?()=>l(t,2):t:d=()=>{if(h){bs();try{h()}finally{ws()}}const w=Bs;Bs=u;try{return l?l(t,3,[m]):t(m)}finally{Bs=w}}:d=Qt,e&&o){const w=d,$=o===!0?1/0:o;d=()=>gs(w(),$)}const S=Tu(),g=()=>{u.stop(),S&&S.active&&Pi(S.effects,u)};if(i&&e){const w=e;e=(...$)=>{w(...$),g()}}let T=E?new Array(t.length).fill(Vn):Vn;const y=w=>{if(!(!(u.flags&1)||!u.dirty&&!w))if(e){const $=u.run();if(o||_||(E?$.some((z,V)=>xs(z,T[V])):xs($,T))){h&&h();const z=Bs;Bs=u;try{const V=[$,T===Vn?void 0:E&&T[0]===Vn?[]:T,m];T=$,l?l(e,3,V):e(...V)}finally{Bs=z}}}else u.run()};return r&&r(y),u=new kr(d),u.scheduler=a?()=>a(y,!1):y,m=w=>Xu(w,!1,u),h=u.onStop=()=>{const w=ro.get(u);if(w){if(l)l(w,4);else for(const $ of w)$();ro.delete(u)}},e?n?y(!0):T=u.run():a?a(y.bind(null,!0),!0):u.run(),g.pause=u.pause.bind(u),g.resume=u.resume.bind(u),g.stop=g,g}function gs(t,e=1/0,s){if(e<=0||!et(t)||t.__v_skip||(s=s||new Map,(s.get(t)||0)>=e))return t;if(s.set(t,e),e--,St(t))gs(t.value,e,s);else if(Te(t))for(let n=0;n<t.length;n++)gs(t[n],e,s);else if(yr(t)||sn(t))t.forEach(n=>{gs(n,e,s)});else if(Sr(t)){for(const n in t)gs(t[n],e,s);for(const n of Object.getOwnPropertySymbols(t))Object.prototype.propertyIsEnumerable.call(t,n)&&gs(t[n],e,s)}return t}/**
* @vue/runtime-core v3.5.22
* (c) 2018-present Yuxi (Evan) You and Vue contributors
* @license MIT
**/function Nn(t,e,s,n){try{return n?t(...n):t()}catch(o){xo(o,e,s)}}function ts(t,e,s,n){if(ke(t)){const o=Nn(t,e,s,n);return o&&br(o)&&o.catch(i=>{xo(i,e,s)}),o}if(Te(t)){const o=[];for(let i=0;i<t.length;i++)o.push(ts(t[i],e,s,n));return o}}function xo(t,e,s,n=!0){const o=e?e.vnode:null,{errorHandler:i,throwUnhandledErrorInProduction:a}=e&&e.appContext.config||Je;if(e){let r=e.parent;const l=e.proxy,c=`https://vuejs.org/error-reference/#runtime-${s}`;for(;r;){const u=r.ec;if(u){for(let d=0;d<u.length;d++)if(u[d](t,l,c)===!1)return}r=r.parent}if(i){bs(),Nn(i,null,10,[t,l,c]),ws();return}}Ju(t,s,o,n,a)}function Ju(t,e,s,n=!0,o=!1){if(o)throw t;console.error(t)}const Et=[];let os=-1;const on=[];let Cs=null,Js=0;const jr=Promise.resolve();let lo=null;function Rn(t){const e=lo||jr;return t?e.then(this?t.bind(this):t):e}function Zu(t){let e=os+1,s=Et.length;for(;e<s;){const n=e+s>>>1,o=Et[n],i=$n(o);i<t||i===t&&o.flags&2?e=n+1:s=n}return e}function Bi(t){if(!(t.flags&1)){const e=$n(t),s=Et[Et.length-1];!s||!(t.flags&2)&&e>=$n(s)?Et.push(t):Et.splice(Zu(e),0,t),t.flags|=1,zr()}}function zr(){lo||(lo=jr.then(Wr))}function Vr(t){Te(t)?on.push(...t):Cs&&t.id===-1?Cs.splice(Js+1,0,t):t.flags&1||(on.push(t),t.flags|=1),zr()}function pa(t,e,s=os+1){for(;s<Et.length;s++){const n=Et[s];if(n&&n.flags&2){if(t&&n.id!==t.uid)continue;Et.splice(s,1),s--,n.flags&4&&(n.flags&=-2),n(),n.flags&4||(n.flags&=-2)}}}function Kr(t){if(on.length){const e=[...new Set(on)].sort((s,n)=>$n(s)-$n(n));if(on.length=0,Cs){Cs.push(...e);return}for(Cs=e,Js=0;Js<Cs.length;Js++){const s=Cs[Js];s.flags&4&&(s.flags&=-2),s.flags&8||s(),s.flags&=-2}Cs=null,Js=0}}const $n=t=>t.id==null?t.flags&2?-1:1/0:t.id;function Wr(t){try{for(os=0;os<Et.length;os++){const e=Et[os];e&&!(e.flags&8)&&(e.flags&4&&(e.flags&=-2),Nn(e,e.i,e.i?15:14),e.flags&4||(e.flags&=-2))}}finally{for(;os<Et.length;os++){const e=Et[os];e&&(e.flags&=-2)}os=-1,Et.length=0,Kr(),lo=null,(Et.length||on.length)&&Wr()}}let zt=null,qr=null;function co(t){const e=zt;return zt=t,qr=t&&t.type.__scopeId||null,e}function Xr(t,e=zt,s){if(!e||t._n)return t;const n=(...o)=>{n._d&&po(-1);const i=co(e);let a;try{a=t(...o)}finally{co(i),n._d&&po(1)}return a};return n._n=!0,n._c=!0,n._d=!0,n}function Yr(t,e){if(zt===null)return t;const s=Po(zt),n=t.dirs||(t.dirs=[]);for(let o=0;o<e.length;o++){let[i,a,r,l=Je]=e[o];i&&(ke(i)&&(i={mounted:i,updated:i}),i.deep&&gs(a),n.push({dir:i,instance:s,value:a,oldValue:void 0,arg:r,modifiers:l}))}return t}function Ns(t,e,s,n){const o=t.dirs,i=e&&e.dirs;for(let a=0;a<o.length;a++){const r=o[a];i&&(r.oldValue=i[a].value);let l=r.dir[n];l&&(bs(),ts(l,s,8,[t.el,r,t,e]),ws())}}const Jr=Symbol("_vte"),Zr=t=>t.__isTeleport,Sn=t=>t&&(t.disabled||t.disabled===""),ha=t=>t&&(t.defer||t.defer===""),ma=t=>typeof SVGElement<"u"&&t instanceof SVGElement,_a=t=>typeof MathMLElement=="function"&&t instanceof MathMLElement,vi=(t,e)=>{const s=t&&t.to;return rt(s)?e?e(s):null:s},Qr={name:"Teleport",__isTeleport:!0,process(t,e,s,n,o,i,a,r,l,c){const{mc:u,pc:d,pbc:h,o:{insert:m,querySelector:_,createText:E,createComment:S}}=c,g=Sn(e.props);let{shapeFlag:T,children:y,dynamicChildren:w}=e;if(t==null){const $=e.el=E(""),z=e.anchor=E("");m($,s,n),m(z,s,n);const V=(G,ie)=>{T&16&&u(y,G,ie,o,i,a,r,l)},H=()=>{const G=e.target=vi(e.props,_),ie=tl(G,e,E,m);G&&(a!=="svg"&&ma(G)?a="svg":a!=="mathml"&&_a(G)&&(a="mathml"),o&&o.isCE&&(o.ce._teleportTargets||(o.ce._teleportTargets=new Set)).add(G),g||(V(G,ie),Jn(e,!1)))};g&&(V(s,z),Jn(e,!0)),ha(e.props)?(e.el.__isMounted=!1,Mt(()=>{H(),delete e.el.__isMounted},i)):H()}else{if(ha(e.props)&&t.el.__isMounted===!1){Mt(()=>{Qr.process(t,e,s,n,o,i,a,r,l,c)},i);return}e.el=t.el,e.targetStart=t.targetStart;const $=e.anchor=t.anchor,z=e.target=t.target,V=e.targetAnchor=t.targetAnchor,H=Sn(t.props),G=H?s:z,ie=H?$:V;if(a==="svg"||ma(z)?a="svg":(a==="mathml"||_a(z))&&(a="mathml"),w?(h(t.dynamicChildren,w,G,o,i,a,r),Ki(t,e,!0)):l||d(t,e,G,ie,o,i,a,r,!1),g)H?e.props&&t.props&&e.props.to!==t.props.to&&(e.props.to=t.props.to):Kn(e,s,$,c,1);else if((e.props&&e.props.to)!==(t.props&&t.props.to)){const O=e.target=vi(e.props,_);O&&Kn(e,O,null,c,0)}else H&&Kn(e,z,V,c,1);Jn(e,g)}},remove(t,e,s,{um:n,o:{remove:o}},i){const{shapeFlag:a,children:r,anchor:l,targetStart:c,targetAnchor:u,target:d,props:h}=t;if(d&&(o(c),o(u)),i&&o(l),a&16){const m=i||!Sn(h);for(let _=0;_<r.length;_++){const E=r[_];n(E,e,s,m,!!E.dynamicChildren)}}},move:Kn,hydrate:Qu};function Kn(t,e,s,{o:{insert:n},m:o},i=2){i===0&&n(t.targetAnchor,e,s);const{el:a,anchor:r,shapeFlag:l,children:c,props:u}=t,d=i===2;if(d&&n(a,e,s),(!d||Sn(u))&&l&16)for(let h=0;h<c.length;h++)o(c[h],e,s,2);d&&n(r,e,s)}function Qu(t,e,s,n,o,i,{o:{nextSibling:a,parentNode:r,querySelector:l,insert:c,createText:u}},d){function h(E,S,g,T){S.anchor=d(a(E),S,r(E),s,n,o,i),S.targetStart=g,S.targetAnchor=T}const m=e.target=vi(e.props,l),_=Sn(e.props);if(m){const E=m._lpa||m.firstChild;if(e.shapeFlag&16)if(_)h(t,e,E,E&&a(E));else{e.anchor=a(t);let S=E;for(;S;){if(S&&S.nodeType===8){if(S.data==="teleport start anchor")e.targetStart=S;else if(S.data==="teleport anchor"){e.targetAnchor=S,m._lpa=e.targetAnchor&&a(e.targetAnchor);break}}S=a(S)}e.targetAnchor||tl(m,e,u,c),d(E&&a(E),e,m,s,n,o,i)}Jn(e,_)}else _&&e.shapeFlag&16&&h(t,e,t,a(t));return e.anchor&&a(e.anchor)}const el=Qr;function Jn(t,e){const s=t.ctx;if(s&&s.ut){let n,o;for(e?(n=t.el,o=t.anchor):(n=t.targetStart,o=t.targetAnchor);n&&n!==o;)n.nodeType===1&&n.setAttribute("data-v-owner",s.uid),n=n.nextSibling;s.ut()}}function tl(t,e,s,n){const o=e.targetStart=s(""),i=e.targetAnchor=s("");return o[Jr]=i,t&&(n(o,t),n(i,t)),i}const ms=Symbol("_leaveCb"),Wn=Symbol("_enterCb");function ed(){const t={isMounted:!1,isLeaving:!1,isUnmounting:!1,leavingVNodes:new Map};return Pt(()=>{t.isMounted=!0}),us(()=>{t.isUnmounting=!0}),t}const Bt=[Function,Array],sl={mode:String,appear:Boolean,persisted:Boolean,onBeforeEnter:Bt,onEnter:Bt,onAfterEnter:Bt,onEnterCancelled:Bt,onBeforeLeave:Bt,onLeave:Bt,onAfterLeave:Bt,onLeaveCancelled:Bt,onBeforeAppear:Bt,onAppear:Bt,onAfterAppear:Bt,onAppearCancelled:Bt},nl=t=>{const e=t.subTree;return e.component?nl(e.component):e},td={name:"BaseTransition",props:sl,setup(t,{slots:e}){const s=qi(),n=ed();return()=>{const o=e.default&&al(e.default(),!0);if(!o||!o.length)return;const i=ol(o),a=je(t),{mode:r}=a;if(n.isLeaving)return Xo(i);const l=ga(i);if(!l)return Xo(i);let c=yi(l,a,n,s,d=>c=d);l.type!==At&&Pn(l,c);let u=s.subTree&&ga(s.subTree);if(u&&u.type!==At&&!js(u,l)&&nl(s).type!==At){let d=yi(u,a,n,s);if(Pn(u,d),r==="out-in"&&l.type!==At)return n.isLeaving=!0,d.afterLeave=()=>{n.isLeaving=!1,s.job.flags&8||s.update(),delete d.afterLeave,u=void 0},Xo(i);r==="in-out"&&l.type!==At?d.delayLeave=(h,m,_)=>{const E=il(n,u);E[String(u.key)]=u,h[ms]=()=>{m(),h[ms]=void 0,delete c.delayedLeave,u=void 0},c.delayedLeave=()=>{_(),delete c.delayedLeave,u=void 0}}:u=void 0}else u&&(u=void 0);return i}}};function ol(t){let e=t[0];if(t.length>1){for(const s of t)if(s.type!==At){e=s;break}}return e}const sd=td;function il(t,e){const{leavingVNodes:s}=t;let n=s.get(e.type);return n||(n=Object.create(null),s.set(e.type,n)),n}function yi(t,e,s,n,o){const{appear:i,mode:a,persisted:r=!1,onBeforeEnter:l,onEnter:c,onAfterEnter:u,onEnterCancelled:d,onBeforeLeave:h,onLeave:m,onAfterLeave:_,onLeaveCancelled:E,onBeforeAppear:S,onAppear:g,onAfterAppear:T,onAppearCancelled:y}=e,w=String(t.key),$=il(s,t),z=(G,ie)=>{G&&ts(G,n,9,ie)},V=(G,ie)=>{const O=ie[1];z(G,ie),Te(G)?G.every(R=>R.length<=1)&&O():G.length<=1&&O()},H={mode:a,persisted:r,beforeEnter(G){let ie=l;if(!s.isMounted)if(i)ie=S||l;else return;G[ms]&&G[ms](!0);const O=$[w];O&&js(t,O)&&O.el[ms]&&O.el[ms](),z(ie,[G])},enter(G){let ie=c,O=u,R=d;if(!s.isMounted)if(i)ie=g||c,O=T||u,R=y||d;else return;let re=!1;const ve=G[Wn]=ge=>{re||(re=!0,ge?z(R,[G]):z(O,[G]),H.delayedLeave&&H.delayedLeave(),G[Wn]=void 0)};ie?V(ie,[G,ve]):ve()},leave(G,ie){const O=String(t.key);if(G[Wn]&&G[Wn](!0),s.isUnmounting)return ie();z(h,[G]);let R=!1;const re=G[ms]=ve=>{R||(R=!0,ie(),ve?z(E,[G]):z(_,[G]),G[ms]=void 0,$[O]===t&&delete $[O])};$[O]=t,m?V(m,[G,re]):re()},clone(G){const ie=yi(G,e,s,n,o);return o&&o(ie),ie}};return H}function Xo(t){if(ko(t))return t=$s(t),t.children=null,t}function ga(t){if(!ko(t))return Zr(t.type)&&t.children?ol(t.children):t;if(t.component)return t.component.subTree;const{shapeFlag:e,children:s}=t;if(s){if(e&16)return s[0];if(e&32&&ke(s.default))return s.default()}}function Pn(t,e){t.shapeFlag&6&&t.component?(t.transition=e,Pn(t.component.subTree,e)):t.shapeFlag&128?(t.ssContent.transition=e.clone(t.ssContent),t.ssFallback.transition=e.clone(t.ssFallback)):t.transition=e}function al(t,e=!1,s){let n=[],o=0;for(let i=0;i<t.length;i++){let a=t[i];const r=s==null?a.key:String(s)+String(a.key!=null?a.key:i);a.type===Ze?(a.patchFlag&128&&o++,n=n.concat(al(a.children,e,r))):(e||a.type!==At)&&n.push(r!=null?$s(a,{key:r}):a)}if(o>1)for(let i=0;i<n.length;i++)n[i].patchFlag=-2;return n}function rl(t){t.ids=[t.ids[0]+t.ids[2]+++"-",0,0]}const uo=new WeakMap;function Tn(t,e,s,n,o=!1){if(Te(t)){t.forEach((_,E)=>Tn(_,e&&(Te(e)?e[E]:e),s,n,o));return}if(Mn(n)&&!o){n.shapeFlag&512&&n.type.__asyncResolved&&n.component.subTree.component&&Tn(t,e,s,n.component.subTree);return}const i=n.shapeFlag&4?Po(n.component):n.el,a=o?null:i,{i:r,r:l}=t,c=e&&e.r,u=r.refs===Je?r.refs={}:r.refs,d=r.setupState,h=je(d),m=d===Je?vr:_=>Ke(h,_);if(c!=null&&c!==l){if(va(e),rt(c))u[c]=null,m(c)&&(d[c]=null);else if(St(c)){c.value=null;const _=e;_.k&&(u[_.k]=null)}}if(ke(l))Nn(l,r,12,[a,u]);else{const _=rt(l),E=St(l);if(_||E){const S=()=>{if(t.f){const g=_?m(l)?d[l]:u[l]:l.value;if(o)Te(g)&&Pi(g,i);else if(Te(g))g.includes(i)||g.push(i);else if(_)u[l]=[i],m(l)&&(d[l]=u[l]);else{const T=[i];l.value=T,t.k&&(u[t.k]=T)}}else _?(u[l]=a,m(l)&&(d[l]=a)):E&&(l.value=a,t.k&&(u[t.k]=a))};if(a){const g=()=>{S(),uo.delete(t)};g.id=-1,uo.set(t,g),Mt(g,s)}else va(t),S()}}}function va(t){const e=uo.get(t);e&&(e.flags|=8,uo.delete(t))}Co().requestIdleCallback;Co().cancelIdleCallback;const Mn=t=>!!t.type.__asyncLoader,ko=t=>t.type.__isKeepAlive;function nd(t,e){ll(t,"a",e)}function od(t,e){ll(t,"da",e)}function ll(t,e,s=Rt){const n=t.__wdc||(t.__wdc=()=>{let o=s;for(;o;){if(o.isDeactivated)return;o=o.parent}return t()});if(Ao(e,n,s),s){let o=s.parent;for(;o&&o.parent;)ko(o.parent.vnode)&&id(n,e,s,o),o=o.parent}}function id(t,e,s,n){const o=Ao(e,t,n,!0);ji(()=>{Pi(n[e],o)},s)}function Ao(t,e,s=Rt,n=!1){if(s){const o=s[t]||(s[t]=[]),i=e.__weh||(e.__weh=(...a)=>{bs();const r=Gn(s),l=ts(e,s,t,a);return r(),ws(),l});return n?o.unshift(i):o.push(i),i}}const Ss=t=>(e,s=Rt)=>{(!In||t==="sp")&&Ao(t,(...n)=>e(...n),s)},ad=Ss("bm"),Pt=Ss("m"),cl=Ss("bu"),rd=Ss("u"),us=Ss("bum"),ji=Ss("um"),ld=Ss("sp"),cd=Ss("rtg"),ud=Ss("rtc");function dd(t,e=Rt){Ao("ec",t,e)}const fd=Symbol.for("v-ndc");function Wt(t,e,s,n){let o;const i=s,a=Te(t);if(a||rt(t)){const r=a&&nn(t);let l=!1,c=!1;r&&(l=!Kt(t),c=Rs(t),t=Eo(t)),o=new Array(t.length);for(let u=0,d=t.length;u<d;u++)o[u]=e(l?c?ao(_t(t[u])):_t(t[u]):t[u],u,void 0,i)}else if(typeof t=="number"){o=new Array(t);for(let r=0;r<t;r++)o[r]=e(r+1,r,void 0,i)}else if(et(t))if(t[Symbol.iterator])o=Array.from(t,(r,l)=>e(r,l,void 0,i));else{const r=Object.keys(t);o=new Array(r.length);for(let l=0,c=r.length;l<c;l++){const u=r[l];o[l]=e(t[u],u,l,i)}}else o=[];return o}const bi=t=>t?kl(t)?Po(t):bi(t.parent):null,Cn=gt(Object.create(null),{$:t=>t,$el:t=>t.vnode.el,$data:t=>t.data,$props:t=>t.props,$attrs:t=>t.attrs,$slots:t=>t.slots,$refs:t=>t.refs,$parent:t=>bi(t.parent),$root:t=>bi(t.root),$host:t=>t.ce,$emit:t=>t.emit,$options:t=>dl(t),$forceUpdate:t=>t.f||(t.f=()=>{Bi(t.update)}),$nextTick:t=>t.n||(t.n=Rn.bind(t.proxy)),$watch:t=>Id.bind(t)}),Yo=(t,e)=>t!==Je&&!t.__isScriptSetup&&Ke(t,e),pd={get({_:t},e){if(e==="__v_skip")return!0;const{ctx:s,setupState:n,data:o,props:i,accessCache:a,type:r,appContext:l}=t;let c;if(e[0]!=="$"){const m=a[e];if(m!==void 0)switch(m){case 1:return n[e];case 2:return o[e];case 4:return s[e];case 3:return i[e]}else{if(Yo(n,e))return a[e]=1,n[e];if(o!==Je&&Ke(o,e))return a[e]=2,o[e];if((c=t.propsOptions[0])&&Ke(c,e))return a[e]=3,i[e];if(s!==Je&&Ke(s,e))return a[e]=4,s[e];wi&&(a[e]=0)}}const u=Cn[e];let d,h;if(u)return e==="$attrs"&&wt(t.attrs,"get",""),u(t);if((d=r.__cssModules)&&(d=d[e]))return d;if(s!==Je&&Ke(s,e))return a[e]=4,s[e];if(h=l.config.globalProperties,Ke(h,e))return h[e]},set({_:t},e,s){const{data:n,setupState:o,ctx:i}=t;return Yo(o,e)?(o[e]=s,!0):n!==Je&&Ke(n,e)?(n[e]=s,!0):Ke(t.props,e)||e[0]==="$"&&e.slice(1)in t?!1:(i[e]=s,!0)},has({_:{data:t,setupState:e,accessCache:s,ctx:n,appContext:o,propsOptions:i,type:a}},r){let l,c;return!!(s[r]||t!==Je&&r[0]!=="$"&&Ke(t,r)||Yo(e,r)||(l=i[0])&&Ke(l,r)||Ke(n,r)||Ke(Cn,r)||Ke(o.config.globalProperties,r)||(c=a.__cssModules)&&c[r])},defineProperty(t,e,s){return s.get!=null?t._.accessCache[e]=0:Ke(s,"value")&&this.set(t,e,s.value,null),Reflect.defineProperty(t,e,s)}};function ya(t){return Te(t)?t.reduce((e,s)=>(e[s]=null,e),{}):t}let wi=!0;function hd(t){const e=dl(t),s=t.proxy,n=t.ctx;wi=!1,e.beforeCreate&&ba(e.beforeCreate,t,"bc");const{data:o,computed:i,methods:a,watch:r,provide:l,inject:c,created:u,beforeMount:d,mounted:h,beforeUpdate:m,updated:_,activated:E,deactivated:S,beforeDestroy:g,beforeUnmount:T,destroyed:y,unmounted:w,render:$,renderTracked:z,renderTriggered:V,errorCaptured:H,serverPrefetch:G,expose:ie,inheritAttrs:O,components:R,directives:re,filters:ve}=e;if(c&&md(c,n,null),a)for(const K in a){const A=a[K];ke(A)&&(n[K]=A.bind(s))}if(o){const K=o.call(s,s);et(K)&&(t.data=Hi(K))}if(wi=!0,i)for(const K in i){const A=i[K],de=ke(A)?A.bind(s,s):ke(A.get)?A.get.bind(s,s):Qt,X=!ke(A)&&ke(A.set)?A.set.bind(s):Qt,I=Ae({get:de,set:X});Object.defineProperty(n,K,{enumerable:!0,configurable:!0,get:()=>I.value,set:Q=>I.value=Q})}if(r)for(const K in r)ul(r[K],n,s,K);if(l){const K=ke(l)?l.call(s):l;Reflect.ownKeys(K).forEach(A=>{wd(A,K[A])})}u&&ba(u,t,"c");function pe(K,A){Te(A)?A.forEach(de=>K(de.bind(s))):A&&K(A.bind(s))}if(pe(ad,d),pe(Pt,h),pe(cl,m),pe(rd,_),pe(nd,E),pe(od,S),pe(dd,H),pe(ud,z),pe(cd,V),pe(us,T),pe(ji,w),pe(ld,G),Te(ie))if(ie.length){const K=t.exposed||(t.exposed={});ie.forEach(A=>{Object.defineProperty(K,A,{get:()=>s[A],set:de=>s[A]=de,enumerable:!0})})}else t.exposed||(t.exposed={});$&&t.render===Qt&&(t.render=$),O!=null&&(t.inheritAttrs=O),R&&(t.components=R),re&&(t.directives=re),G&&rl(t)}function md(t,e,s=Qt){Te(t)&&(t=Si(t));for(const n in t){const o=t[n];let i;et(o)?"default"in o?i=Zn(o.from||n,o.default,!0):i=Zn(o.from||n):i=Zn(o),St(i)?Object.defineProperty(e,n,{enumerable:!0,configurable:!0,get:()=>i.value,set:a=>i.value=a}):e[n]=i}}function ba(t,e,s){ts(Te(t)?t.map(n=>n.bind(e.proxy)):t.bind(e.proxy),e,s)}function ul(t,e,s,n){let o=n.includes(".")?Tl(s,n):()=>s[n];if(rt(t)){const i=e[t];ke(i)&&Ht(o,i)}else if(ke(t))Ht(o,t.bind(s));else if(et(t))if(Te(t))t.forEach(i=>ul(i,e,s,n));else{const i=ke(t.handler)?t.handler.bind(s):e[t.handler];ke(i)&&Ht(o,i,t)}}function dl(t){const e=t.type,{mixins:s,extends:n}=e,{mixins:o,optionsCache:i,config:{optionMergeStrategies:a}}=t.appContext,r=i.get(e);let l;return r?l=r:!o.length&&!s&&!n?l=e:(l={},o.length&&o.forEach(c=>fo(l,c,a,!0)),fo(l,e,a)),et(e)&&i.set(e,l),l}function fo(t,e,s,n=!1){const{mixins:o,extends:i}=e;i&&fo(t,i,s,!0),o&&o.forEach(a=>fo(t,a,s,!0));for(const a in e)if(!(n&&a==="expose")){const r=_d[a]||s&&s[a];t[a]=r?r(t[a],e[a]):e[a]}return t}const _d={data:wa,props:Sa,emits:Sa,methods:_n,computed:_n,beforeCreate:Tt,created:Tt,beforeMount:Tt,mounted:Tt,beforeUpdate:Tt,updated:Tt,beforeDestroy:Tt,beforeUnmount:Tt,destroyed:Tt,unmounted:Tt,activated:Tt,deactivated:Tt,errorCaptured:Tt,serverPrefetch:Tt,components:_n,directives:_n,watch:vd,provide:wa,inject:gd};function wa(t,e){return e?t?function(){return gt(ke(t)?t.call(this,this):t,ke(e)?e.call(this,this):e)}:e:t}function gd(t,e){return _n(Si(t),Si(e))}function Si(t){if(Te(t)){const e={};for(let s=0;s<t.length;s++)e[t[s]]=t[s];return e}return t}function Tt(t,e){return t?[...new Set([].concat(t,e))]:e}function _n(t,e){return t?gt(Object.create(null),t,e):e}function Sa(t,e){return t?Te(t)&&Te(e)?[...new Set([...t,...e])]:gt(Object.create(null),ya(t),ya(e??{})):e}function vd(t,e){if(!t)return e;if(!e)return t;const s=gt(Object.create(null),t);for(const n in e)s[n]=Tt(t[n],e[n]);return s}function fl(){return{app:null,config:{isNativeTag:vr,performance:!1,globalProperties:{},optionMergeStrategies:{},errorHandler:void 0,warnHandler:void 0,compilerOptions:{}},mixins:[],components:{},directives:{},provides:Object.create(null),optionsCache:new WeakMap,propsCache:new WeakMap,emitsCache:new WeakMap}}let yd=0;function bd(t,e){return function(n,o=null){ke(n)||(n=gt({},n)),o!=null&&!et(o)&&(o=null);const i=fl(),a=new WeakSet,r=[];let l=!1;const c=i.app={_uid:yd++,_component:n,_props:o,_container:null,_context:i,_instance:null,version:sf,get config(){return i.config},set config(u){},use(u,...d){return a.has(u)||(u&&ke(u.install)?(a.add(u),u.install(c,...d)):ke(u)&&(a.add(u),u(c,...d))),c},mixin(u){return i.mixins.includes(u)||i.mixins.push(u),c},component(u,d){return d?(i.components[u]=d,c):i.components[u]},directive(u,d){return d?(i.directives[u]=d,c):i.directives[u]},mount(u,d,h){if(!l){const m=c._ceVNode||it(n,o);return m.appContext=i,h===!0?h="svg":h===!1&&(h=void 0),t(m,u,h),l=!0,c._container=u,u.__vue_app__=c,Po(m.component)}},onUnmount(u){r.push(u)},unmount(){l&&(ts(r,c._instance,16),t(null,c._container),delete c._container.__vue_app__)},provide(u,d){return i.provides[u]=d,c},runWithContext(u){const d=an;an=c;try{return u()}finally{an=d}}};return c}}let an=null;function wd(t,e){if(Rt){let s=Rt.provides;const n=Rt.parent&&Rt.parent.provides;n===s&&(s=Rt.provides=Object.create(n)),s[t]=e}}function Zn(t,e,s=!1){const n=qi();if(n||an){let o=an?an._context.provides:n?n.parent==null||n.ce?n.vnode.appContext&&n.vnode.appContext.provides:n.parent.provides:void 0;if(o&&t in o)return o[t];if(arguments.length>1)return s&&ke(e)?e.call(n&&n.proxy):e}}const pl={},hl=()=>Object.create(pl),ml=t=>Object.getPrototypeOf(t)===pl;function Sd(t,e,s,n=!1){const o={},i=hl();t.propsDefaults=Object.create(null),_l(t,e,o,i);for(const a in t.propsOptions[0])a in o||(o[a]=void 0);s?t.props=n?o:Bu(o):t.type.props?t.props=o:t.props=i,t.attrs=i}function Td(t,e,s,n){const{props:o,attrs:i,vnode:{patchFlag:a}}=t,r=je(o),[l]=t.propsOptions;let c=!1;if((n||a>0)&&!(a&16)){if(a&8){const u=t.vnode.dynamicProps;for(let d=0;d<u.length;d++){let h=u[d];if(Ro(t.emitsOptions,h))continue;const m=e[h];if(l)if(Ke(i,h))m!==i[h]&&(i[h]=m,c=!0);else{const _=As(h);o[_]=Ti(l,r,_,m,t,!1)}else m!==i[h]&&(i[h]=m,c=!0)}}}else{_l(t,e,o,i)&&(c=!0);let u;for(const d in r)(!e||!Ke(e,d)&&((u=Ws(d))===d||!Ke(e,u)))&&(l?s&&(s[d]!==void 0||s[u]!==void 0)&&(o[d]=Ti(l,r,d,void 0,t,!0)):delete o[d]);if(i!==r)for(const d in i)(!e||!Ke(e,d))&&(delete i[d],c=!0)}c&&_s(t.attrs,"set","")}function _l(t,e,s,n){const[o,i]=t.propsOptions;let a=!1,r;if(e)for(let l in e){if(yn(l))continue;const c=e[l];let u;o&&Ke(o,u=As(l))?!i||!i.includes(u)?s[u]=c:(r||(r={}))[u]=c:Ro(t.emitsOptions,l)||(!(l in n)||c!==n[l])&&(n[l]=c,a=!0)}if(i){const l=je(s),c=r||Je;for(let u=0;u<i.length;u++){const d=i[u];s[d]=Ti(o,l,d,c[d],t,!Ke(c,d))}}return a}function Ti(t,e,s,n,o,i){const a=t[s];if(a!=null){const r=Ke(a,"default");if(r&&n===void 0){const l=a.default;if(a.type!==Function&&!a.skipFactory&&ke(l)){const{propsDefaults:c}=o;if(s in c)n=c[s];else{const u=Gn(o);n=c[s]=l.call(null,e),u()}}else n=l;o.ce&&o.ce._setProp(s,n)}a[0]&&(i&&!r?n=!1:a[1]&&(n===""||n===Ws(s))&&(n=!0))}return n}const Md=new WeakMap;function gl(t,e,s=!1){const n=s?Md:e.propsCache,o=n.get(t);if(o)return o;const i=t.props,a={},r=[];let l=!1;if(!ke(t)){const u=d=>{l=!0;const[h,m]=gl(d,e,!0);gt(a,h),m&&r.push(...m)};!s&&e.mixins.length&&e.mixins.forEach(u),t.extends&&u(t.extends),t.mixins&&t.mixins.forEach(u)}if(!i&&!l)return et(t)&&n.set(t,tn),tn;if(Te(i))for(let u=0;u<i.length;u++){const d=As(i[u]);Ta(d)&&(a[d]=Je)}else if(i)for(const u in i){const d=As(u);if(Ta(d)){const h=i[u],m=a[d]=Te(h)||ke(h)?{type:h}:gt({},h),_=m.type;let E=!1,S=!0;if(Te(_))for(let g=0;g<_.length;++g){const T=_[g],y=ke(T)&&T.name;if(y==="Boolean"){E=!0;break}else y==="String"&&(S=!1)}else E=ke(_)&&_.name==="Boolean";m[0]=E,m[1]=S,(E||Ke(m,"default"))&&r.push(d)}}const c=[a,r];return et(t)&&n.set(t,c),c}function Ta(t){return t[0]!=="$"&&!yn(t)}const zi=t=>t==="_"||t==="_ctx"||t==="$stable",Vi=t=>Te(t)?t.map(as):[as(t)],Cd=(t,e,s)=>{if(e._n)return e;const n=Xr((...o)=>Vi(e(...o)),s);return n._c=!1,n},vl=(t,e,s)=>{const n=t._ctx;for(const o in t){if(zi(o))continue;const i=t[o];if(ke(i))e[o]=Cd(o,i,n);else if(i!=null){const a=Vi(i);e[o]=()=>a}}},yl=(t,e)=>{const s=Vi(e);t.slots.default=()=>s},bl=(t,e,s)=>{for(const n in e)(s||!zi(n))&&(t[n]=e[n])},Ed=(t,e,s)=>{const n=t.slots=hl();if(t.vnode.shapeFlag&32){const o=e._;o?(bl(n,e,s),s&&Mr(n,"_",o,!0)):vl(e,n)}else e&&yl(t,e)},xd=(t,e,s)=>{const{vnode:n,slots:o}=t;let i=!0,a=Je;if(n.shapeFlag&32){const r=e._;r?s&&r===1?i=!1:bl(o,e,s):(i=!e.$stable,vl(e,o)),a=e}else e&&(yl(t,e),a={default:1});if(i)for(const r in o)!zi(r)&&a[r]==null&&delete o[r]},Mt=Bd;function kd(t){return Ad(t)}function Ad(t,e){const s=Co();s.__VUE__=!0;const{insert:n,remove:o,patchProp:i,createElement:a,createText:r,createComment:l,setText:c,setElementText:u,parentNode:d,nextSibling:h,setScopeId:m=Qt,insertStaticContent:_}=t,E=(b,M,P,J=null,W=null,q=null,L=void 0,ee=null,Z=!!M.dynamicChildren)=>{if(b===M)return;b&&!js(b,M)&&(J=Ie(b),Q(b,W,q,!0),b=null),M.patchFlag===-2&&(Z=!1,M.dynamicChildren=null);const{type:Y,ref:he,shapeFlag:le}=M;switch(Y){case $o:S(b,M,P,J);break;case At:g(b,M,P,J);break;case En:b==null&&T(M,P,J,L);break;case Ze:R(b,M,P,J,W,q,L,ee,Z);break;default:le&1?$(b,M,P,J,W,q,L,ee,Z):le&6?re(b,M,P,J,W,q,L,ee,Z):(le&64||le&128)&&Y.process(b,M,P,J,W,q,L,ee,Z,Ve)}he!=null&&W?Tn(he,b&&b.ref,q,M||b,!M):he==null&&b&&b.ref!=null&&Tn(b.ref,null,q,b,!0)},S=(b,M,P,J)=>{if(b==null)n(M.el=r(M.children),P,J);else{const W=M.el=b.el;M.children!==b.children&&c(W,M.children)}},g=(b,M,P,J)=>{b==null?n(M.el=l(M.children||""),P,J):M.el=b.el},T=(b,M,P,J)=>{[b.el,b.anchor]=_(b.children,M,P,J,b.el,b.anchor)},y=({el:b,anchor:M},P,J)=>{let W;for(;b&&b!==M;)W=h(b),n(b,P,J),b=W;n(M,P,J)},w=({el:b,anchor:M})=>{let P;for(;b&&b!==M;)P=h(b),o(b),b=P;o(M)},$=(b,M,P,J,W,q,L,ee,Z)=>{M.type==="svg"?L="svg":M.type==="math"&&(L="mathml"),b==null?z(M,P,J,W,q,L,ee,Z):G(b,M,W,q,L,ee,Z)},z=(b,M,P,J,W,q,L,ee)=>{let Z,Y;const{props:he,shapeFlag:le,transition:ce,dirs:be}=b;if(Z=b.el=a(b.type,q,he&&he.is,he),le&8?u(Z,b.children):le&16&&H(b.children,Z,null,J,W,Jo(b,q),L,ee),be&&Ns(b,null,J,"created"),V(Z,b,b.scopeId,L,J),he){for(const Re in he)Re!=="value"&&!yn(Re)&&i(Z,Re,null,he[Re],q,J);"value"in he&&i(Z,"value",null,he.value,q),(Y=he.onVnodeBeforeMount)&&ss(Y,J,b)}be&&Ns(b,null,J,"beforeMount");const Me=Rd(W,ce);Me&&ce.beforeEnter(Z),n(Z,M,P),((Y=he&&he.onVnodeMounted)||Me||be)&&Mt(()=>{Y&&ss(Y,J,b),Me&&ce.enter(Z),be&&Ns(b,null,J,"mounted")},W)},V=(b,M,P,J,W)=>{if(P&&m(b,P),J)for(let q=0;q<J.length;q++)m(b,J[q]);if(W){let q=W.subTree;if(M===q||Cl(q.type)&&(q.ssContent===M||q.ssFallback===M)){const L=W.vnode;V(b,L,L.scopeId,L.slotScopeIds,W.parent)}}},H=(b,M,P,J,W,q,L,ee,Z=0)=>{for(let Y=Z;Y<b.length;Y++){const he=b[Y]=ee?Es(b[Y]):as(b[Y]);E(null,he,M,P,J,W,q,L,ee)}},G=(b,M,P,J,W,q,L)=>{const ee=M.el=b.el;let{patchFlag:Z,dynamicChildren:Y,dirs:he}=M;Z|=b.patchFlag&16;const le=b.props||Je,ce=M.props||Je;let be;if(P&&Gs(P,!1),(be=ce.onVnodeBeforeUpdate)&&ss(be,P,M,b),he&&Ns(M,b,P,"beforeUpdate"),P&&Gs(P,!0),(le.innerHTML&&ce.innerHTML==null||le.textContent&&ce.textContent==null)&&u(ee,""),Y?ie(b.dynamicChildren,Y,ee,P,J,Jo(M,W),q):L||A(b,M,ee,null,P,J,Jo(M,W),q,!1),Z>0){if(Z&16)O(ee,le,ce,P,W);else if(Z&2&&le.class!==ce.class&&i(ee,"class",null,ce.class,W),Z&4&&i(ee,"style",le.style,ce.style,W),Z&8){const Me=M.dynamicProps;for(let Re=0;Re<Me.length;Re++){const Ge=Me[Re],st=le[Ge],lt=ce[Ge];(lt!==st||Ge==="value")&&i(ee,Ge,st,lt,W,P)}}Z&1&&b.children!==M.children&&u(ee,M.children)}else!L&&Y==null&&O(ee,le,ce,P,W);((be=ce.onVnodeUpdated)||he)&&Mt(()=>{be&&ss(be,P,M,b),he&&Ns(M,b,P,"updated")},J)},ie=(b,M,P,J,W,q,L)=>{for(let ee=0;ee<M.length;ee++){const Z=b[ee],Y=M[ee],he=Z.el&&(Z.type===Ze||!js(Z,Y)||Z.shapeFlag&198)?d(Z.el):P;E(Z,Y,he,null,J,W,q,L,!0)}},O=(b,M,P,J,W)=>{if(M!==P){if(M!==Je)for(const q in M)!yn(q)&&!(q in P)&&i(b,q,M[q],null,W,J);for(const q in P){if(yn(q))continue;const L=P[q],ee=M[q];L!==ee&&q!=="value"&&i(b,q,ee,L,W,J)}"value"in P&&i(b,"value",M.value,P.value,W)}},R=(b,M,P,J,W,q,L,ee,Z)=>{const Y=M.el=b?b.el:r(""),he=M.anchor=b?b.anchor:r("");let{patchFlag:le,dynamicChildren:ce,slotScopeIds:be}=M;be&&(ee=ee?ee.concat(be):be),b==null?(n(Y,P,J),n(he,P,J),H(M.children||[],P,he,W,q,L,ee,Z)):le>0&&le&64&&ce&&b.dynamicChildren?(ie(b.dynamicChildren,ce,P,W,q,L,ee),(M.key!=null||W&&M===W.subTree)&&Ki(b,M,!0)):A(b,M,P,he,W,q,L,ee,Z)},re=(b,M,P,J,W,q,L,ee,Z)=>{M.slotScopeIds=ee,b==null?M.shapeFlag&512?W.ctx.activate(M,P,J,L,Z):ve(M,P,J,W,q,L,Z):ge(b,M,Z)},ve=(b,M,P,J,W,q,L)=>{const ee=b.component=Xd(b,J,W);if(ko(b)&&(ee.ctx.renderer=Ve),Yd(ee,!1,L),ee.asyncDep){if(W&&W.registerDep(ee,pe,L),!b.el){const Z=ee.subTree=it(At);g(null,Z,M,P),b.placeholder=Z.el}}else pe(ee,b,M,P,W,q,L)},ge=(b,M,P)=>{const J=M.component=b.component;if(Ud(b,M,P))if(J.asyncDep&&!J.asyncResolved){K(J,M,P);return}else J.next=M,J.update();else M.el=b.el,J.vnode=M},pe=(b,M,P,J,W,q,L)=>{const ee=()=>{if(b.isMounted){let{next:le,bu:ce,u:be,parent:Me,vnode:Re}=b;{const Ue=wl(b);if(Ue){le&&(le.el=Re.el,K(b,le,L)),Ue.asyncDep.then(()=>{b.isUnmounted||ee()});return}}let Ge=le,st;Gs(b,!1),le?(le.el=Re.el,K(b,le,L)):le=Re,ce&&zo(ce),(st=le.props&&le.props.onVnodeBeforeUpdate)&&ss(st,Me,le,Re),Gs(b,!0);const lt=Ca(b),Oe=b.subTree;b.subTree=lt,E(Oe,lt,d(Oe.el),Ie(Oe),b,W,q),le.el=lt.el,Ge===null&&Fd(b,lt.el),be&&Mt(be,W),(st=le.props&&le.props.onVnodeUpdated)&&Mt(()=>ss(st,Me,le,Re),W)}else{let le;const{el:ce,props:be}=M,{bm:Me,m:Re,parent:Ge,root:st,type:lt}=b,Oe=Mn(M);Gs(b,!1),Me&&zo(Me),!Oe&&(le=be&&be.onVnodeBeforeMount)&&ss(le,Ge,M),Gs(b,!0);{st.ce&&st.ce._def.shadowRoot!==!1&&st.ce._injectChildStyle(lt);const Ue=b.subTree=Ca(b);E(null,Ue,P,J,b,W,q),M.el=Ue.el}if(Re&&Mt(Re,W),!Oe&&(le=be&&be.onVnodeMounted)){const Ue=M;Mt(()=>ss(le,Ge,Ue),W)}(M.shapeFlag&256||Ge&&Mn(Ge.vnode)&&Ge.vnode.shapeFlag&256)&&b.a&&Mt(b.a,W),b.isMounted=!0,M=P=J=null}};b.scope.on();const Z=b.effect=new kr(ee);b.scope.off();const Y=b.update=Z.run.bind(Z),he=b.job=Z.runIfDirty.bind(Z);he.i=b,he.id=b.uid,Z.scheduler=()=>Bi(he),Gs(b,!0),Y()},K=(b,M,P)=>{M.component=b;const J=b.vnode.props;b.vnode=M,b.next=null,Td(b,M.props,J,P),xd(b,M.children,P),bs(),pa(b),ws()},A=(b,M,P,J,W,q,L,ee,Z=!1)=>{const Y=b&&b.children,he=b?b.shapeFlag:0,le=M.children,{patchFlag:ce,shapeFlag:be}=M;if(ce>0){if(ce&128){X(Y,le,P,J,W,q,L,ee,Z);return}else if(ce&256){de(Y,le,P,J,W,q,L,ee,Z);return}}be&8?(he&16&&ze(Y,W,q),le!==Y&&u(P,le)):he&16?be&16?X(Y,le,P,J,W,q,L,ee,Z):ze(Y,W,q,!0):(he&8&&u(P,""),be&16&&H(le,P,J,W,q,L,ee,Z))},de=(b,M,P,J,W,q,L,ee,Z)=>{b=b||tn,M=M||tn;const Y=b.length,he=M.length,le=Math.min(Y,he);let ce;for(ce=0;ce<le;ce++){const be=M[ce]=Z?Es(M[ce]):as(M[ce]);E(b[ce],be,P,null,W,q,L,ee,Z)}Y>he?ze(b,W,q,!0,!1,le):H(M,P,J,W,q,L,ee,Z,le)},X=(b,M,P,J,W,q,L,ee,Z)=>{let Y=0;const he=M.length;let le=b.length-1,ce=he-1;for(;Y<=le&&Y<=ce;){const be=b[Y],Me=M[Y]=Z?Es(M[Y]):as(M[Y]);if(js(be,Me))E(be,Me,P,null,W,q,L,ee,Z);else break;Y++}for(;Y<=le&&Y<=ce;){const be=b[le],Me=M[ce]=Z?Es(M[ce]):as(M[ce]);if(js(be,Me))E(be,Me,P,null,W,q,L,ee,Z);else break;le--,ce--}if(Y>le){if(Y<=ce){const be=ce+1,Me=be<he?M[be].el:J;for(;Y<=ce;)E(null,M[Y]=Z?Es(M[Y]):as(M[Y]),P,Me,W,q,L,ee,Z),Y++}}else if(Y>ce)for(;Y<=le;)Q(b[Y],W,q,!0),Y++;else{const be=Y,Me=Y,Re=new Map;for(Y=Me;Y<=ce;Y++){const nt=M[Y]=Z?Es(M[Y]):as(M[Y]);nt.key!=null&&Re.set(nt.key,Y)}let Ge,st=0;const lt=ce-Me+1;let Oe=!1,Ue=0;const fe=new Array(lt);for(Y=0;Y<lt;Y++)fe[Y]=0;for(Y=be;Y<=le;Y++){const nt=b[Y];if(st>=lt){Q(nt,W,q,!0);continue}let vt;if(nt.key!=null)vt=Re.get(nt.key);else for(Ge=Me;Ge<=ce;Ge++)if(fe[Ge-Me]===0&&js(nt,M[Ge])){vt=Ge;break}vt===void 0?Q(nt,W,q,!0):(fe[vt-Me]=Y+1,vt>=Ue?Ue=vt:Oe=!0,E(nt,M[vt],P,null,W,q,L,ee,Z),st++)}const mt=Oe?$d(fe):tn;for(Ge=mt.length-1,Y=lt-1;Y>=0;Y--){const nt=Me+Y,vt=M[nt],Is=M[nt+1],qs=nt+1<he?Is.el||Is.placeholder:J;fe[Y]===0?E(null,vt,P,qs,W,q,L,ee,Z):Oe&&(Ge<0||Y!==mt[Ge]?I(vt,P,qs,2):Ge--)}}},I=(b,M,P,J,W=null)=>{const{el:q,type:L,transition:ee,children:Z,shapeFlag:Y}=b;if(Y&6){I(b.component.subTree,M,P,J);return}if(Y&128){b.suspense.move(M,P,J);return}if(Y&64){L.move(b,M,P,Ve);return}if(L===Ze){n(q,M,P);for(let le=0;le<Z.length;le++)I(Z[le],M,P,J);n(b.anchor,M,P);return}if(L===En){y(b,M,P);return}if(J!==2&&Y&1&&ee)if(J===0)ee.beforeEnter(q),n(q,M,P),Mt(()=>ee.enter(q),W);else{const{leave:le,delayLeave:ce,afterLeave:be}=ee,Me=()=>{b.ctx.isUnmounted?o(q):n(q,M,P)},Re=()=>{q._isLeaving&&q[ms](!0),le(q,()=>{Me(),be&&be()})};ce?ce(q,Me,Re):Re()}else n(q,M,P)},Q=(b,M,P,J=!1,W=!1)=>{const{type:q,props:L,ref:ee,children:Z,dynamicChildren:Y,shapeFlag:he,patchFlag:le,dirs:ce,cacheIndex:be}=b;if(le===-2&&(W=!1),ee!=null&&(bs(),Tn(ee,null,P,b,!0),ws()),be!=null&&(M.renderCache[be]=void 0),he&256){M.ctx.deactivate(b);return}const Me=he&1&&ce,Re=!Mn(b);let Ge;if(Re&&(Ge=L&&L.onVnodeBeforeUnmount)&&ss(Ge,M,b),he&6)Be(b.component,P,J);else{if(he&128){b.suspense.unmount(P,J);return}Me&&Ns(b,null,M,"beforeUnmount"),he&64?b.type.remove(b,M,P,Ve,J):Y&&!Y.hasOnce&&(q!==Ze||le>0&&le&64)?ze(Y,M,P,!1,!0):(q===Ze&&le&384||!W&&he&16)&&ze(Z,M,P),J&&ae(b)}(Re&&(Ge=L&&L.onVnodeUnmounted)||Me)&&Mt(()=>{Ge&&ss(Ge,M,b),Me&&Ns(b,null,M,"unmounted")},P)},ae=b=>{const{type:M,el:P,anchor:J,transition:W}=b;if(M===Ze){Pe(P,J);return}if(M===En){w(b);return}const q=()=>{o(P),W&&!W.persisted&&W.afterLeave&&W.afterLeave()};if(b.shapeFlag&1&&W&&!W.persisted){const{leave:L,delayLeave:ee}=W,Z=()=>L(P,q);ee?ee(b.el,q,Z):Z()}else q()},Pe=(b,M)=>{let P;for(;b!==M;)P=h(b),o(b),b=P;o(M)},Be=(b,M,P)=>{const{bum:J,scope:W,job:q,subTree:L,um:ee,m:Z,a:Y}=b;Ma(Z),Ma(Y),J&&zo(J),W.stop(),q&&(q.flags|=8,Q(L,b,M,P)),ee&&Mt(ee,M),Mt(()=>{b.isUnmounted=!0},M)},ze=(b,M,P,J=!1,W=!1,q=0)=>{for(let L=q;L<b.length;L++)Q(b[L],M,P,J,W)},Ie=b=>{if(b.shapeFlag&6)return Ie(b.component.subTree);if(b.shapeFlag&128)return b.suspense.next();const M=h(b.anchor||b.el),P=M&&M[Jr];return P?h(P):M};let tt=!1;const at=(b,M,P)=>{b==null?M._vnode&&Q(M._vnode,null,null,!0):E(M._vnode||null,b,M,null,null,null,P),M._vnode=b,tt||(tt=!0,pa(),Kr(),tt=!1)},Ve={p:E,um:Q,m:I,r:ae,mt:ve,mc:H,pc:A,pbc:ie,n:Ie,o:t};return{render:at,hydrate:void 0,createApp:bd(at)}}function Jo({type:t,props:e},s){return s==="svg"&&t==="foreignObject"||s==="mathml"&&t==="annotation-xml"&&e&&e.encoding&&e.encoding.includes("html")?void 0:s}function Gs({effect:t,job:e},s){s?(t.flags|=32,e.flags|=4):(t.flags&=-33,e.flags&=-5)}function Rd(t,e){return(!t||t&&!t.pendingBranch)&&e&&!e.persisted}function Ki(t,e,s=!1){const n=t.children,o=e.children;if(Te(n)&&Te(o))for(let i=0;i<n.length;i++){const a=n[i];let r=o[i];r.shapeFlag&1&&!r.dynamicChildren&&((r.patchFlag<=0||r.patchFlag===32)&&(r=o[i]=Es(o[i]),r.el=a.el),!s&&r.patchFlag!==-2&&Ki(a,r)),r.type===$o&&r.patchFlag!==-1&&(r.el=a.el),r.type===At&&!r.el&&(r.el=a.el)}}function $d(t){const e=t.slice(),s=[0];let n,o,i,a,r;const l=t.length;for(n=0;n<l;n++){const c=t[n];if(c!==0){if(o=s[s.length-1],t[o]<c){e[n]=o,s.push(n);continue}for(i=0,a=s.length-1;i<a;)r=i+a>>1,t[s[r]]<c?i=r+1:a=r;c<t[s[i]]&&(i>0&&(e[n]=s[i-1]),s[i]=n)}}for(i=s.length,a=s[i-1];i-- >0;)s[i]=a,a=e[a];return s}function wl(t){const e=t.subTree.component;if(e)return e.asyncDep&&!e.asyncResolved?e:wl(e)}function Ma(t){if(t)for(let e=0;e<t.length;e++)t[e].flags|=8}const Pd=Symbol.for("v-scx"),Ld=()=>Zn(Pd);function Ht(t,e,s){return Sl(t,e,s)}function Sl(t,e,s=Je){const{immediate:n,deep:o,flush:i,once:a}=s,r=gt({},s),l=e&&n||!e&&i!=="post";let c;if(In){if(i==="sync"){const m=Ld();c=m.__watcherHandles||(m.__watcherHandles=[])}else if(!l){const m=()=>{};return m.stop=Qt,m.resume=Qt,m.pause=Qt,m}}const u=Rt;r.call=(m,_,E)=>ts(m,u,_,E);let d=!1;i==="post"?r.scheduler=m=>{Mt(m,u&&u.suspense)}:i!=="sync"&&(d=!0,r.scheduler=(m,_)=>{_?m():Bi(m)}),r.augmentJob=m=>{e&&(m.flags|=4),d&&(m.flags|=2,u&&(m.id=u.uid,m.i=u))};const h=Yu(t,e,r);return In&&(c?c.push(h):l&&h()),h}function Id(t,e,s){const n=this.proxy,o=rt(t)?t.includes(".")?Tl(n,t):()=>n[t]:t.bind(n,n);let i;ke(e)?i=e:(i=e.handler,s=e);const a=Gn(this),r=Sl(o,i.bind(n),s);return a(),r}function Tl(t,e){const s=e.split(".");return()=>{let n=t;for(let o=0;o<s.length&&n;o++)n=n[s[o]];return n}}const Od=(t,e)=>e==="modelValue"||e==="model-value"?t.modelModifiers:t[`${e}Modifiers`]||t[`${As(e)}Modifiers`]||t[`${Ws(e)}Modifiers`];function Dd(t,e,...s){if(t.isUnmounted)return;const n=t.vnode.props||Je;let o=s;const i=e.startsWith("update:"),a=i&&Od(n,e.slice(7));a&&(a.trim&&(o=s.map(u=>rt(u)?u.trim():u)),a.number&&(o=s.map(pu)));let r,l=n[r=jo(e)]||n[r=jo(As(e))];!l&&i&&(l=n[r=jo(Ws(e))]),l&&ts(l,t,6,o);const c=n[r+"Once"];if(c){if(!t.emitted)t.emitted={};else if(t.emitted[r])return;t.emitted[r]=!0,ts(c,t,6,o)}}const Nd=new WeakMap;function Ml(t,e,s=!1){const n=s?Nd:e.emitsCache,o=n.get(t);if(o!==void 0)return o;const i=t.emits;let a={},r=!1;if(!ke(t)){const l=c=>{const u=Ml(c,e,!0);u&&(r=!0,gt(a,u))};!s&&e.mixins.length&&e.mixins.forEach(l),t.extends&&l(t.extends),t.mixins&&t.mixins.forEach(l)}return!i&&!r?(et(t)&&n.set(t,null),null):(Te(i)?i.forEach(l=>a[l]=null):gt(a,i),et(t)&&n.set(t,a),a)}function Ro(t,e){return!t||!So(e)?!1:(e=e.slice(2).replace(/Once$/,""),Ke(t,e[0].toLowerCase()+e.slice(1))||Ke(t,Ws(e))||Ke(t,e))}function Ca(t){const{type:e,vnode:s,proxy:n,withProxy:o,propsOptions:[i],slots:a,attrs:r,emit:l,render:c,renderCache:u,props:d,data:h,setupState:m,ctx:_,inheritAttrs:E}=t,S=co(t);let g,T;try{if(s.shapeFlag&4){const w=o||n,$=w;g=as(c.call($,w,u,d,m,h,_)),T=r}else{const w=e;g=as(w.length>1?w(d,{attrs:r,slots:a,emit:l}):w(d,null)),T=e.props?r:Gd(r)}}catch(w){xn.length=0,xo(w,t,1),g=it(At)}let y=g;if(T&&E!==!1){const w=Object.keys(T),{shapeFlag:$}=y;w.length&&$&7&&(i&&w.some($i)&&(T=Hd(T,i)),y=$s(y,T,!1,!0))}return s.dirs&&(y=$s(y,null,!1,!0),y.dirs=y.dirs?y.dirs.concat(s.dirs):s.dirs),s.transition&&Pn(y,s.transition),g=y,co(S),g}const Gd=t=>{let e;for(const s in t)(s==="class"||s==="style"||So(s))&&((e||(e={}))[s]=t[s]);return e},Hd=(t,e)=>{const s={};for(const n in t)(!$i(n)||!(n.slice(9)in e))&&(s[n]=t[n]);return s};function Ud(t,e,s){const{props:n,children:o,component:i}=t,{props:a,children:r,patchFlag:l}=e,c=i.emitsOptions;if(e.dirs||e.transition)return!0;if(s&&l>=0){if(l&1024)return!0;if(l&16)return n?Ea(n,a,c):!!a;if(l&8){const u=e.dynamicProps;for(let d=0;d<u.length;d++){const h=u[d];if(a[h]!==n[h]&&!Ro(c,h))return!0}}}else return(o||r)&&(!r||!r.$stable)?!0:n===a?!1:n?a?Ea(n,a,c):!0:!!a;return!1}function Ea(t,e,s){const n=Object.keys(e);if(n.length!==Object.keys(t).length)return!0;for(let o=0;o<n.length;o++){const i=n[o];if(e[i]!==t[i]&&!Ro(s,i))return!0}return!1}function Fd({vnode:t,parent:e},s){for(;e;){const n=e.subTree;if(n.suspense&&n.suspense.activeBranch===t&&(n.el=t.el),n===t)(t=e.vnode).el=s,e=e.parent;else break}}const Cl=t=>t.__isSuspense;function Bd(t,e){e&&e.pendingBranch?Te(t)?e.effects.push(...t):e.effects.push(t):Vr(t)}const Ze=Symbol.for("v-fgt"),$o=Symbol.for("v-txt"),At=Symbol.for("v-cmt"),En=Symbol.for("v-stc"),xn=[];let Ft=null;function D(t=!1){xn.push(Ft=t?null:[])}function jd(){xn.pop(),Ft=xn[xn.length-1]||null}let Ln=1;function po(t,e=!1){Ln+=t,t<0&&Ft&&e&&(Ft.hasOnce=!0)}function El(t){return t.dynamicChildren=Ln>0?Ft||tn:null,jd(),Ln>0&&Ft&&Ft.push(t),t}function j(t,e,s,n,o,i){return El(p(t,e,s,n,o,i,!0))}function xt(t,e,s,n,o){return El(it(t,e,s,n,o,!0))}function ho(t){return t?t.__v_isVNode===!0:!1}function js(t,e){return t.type===e.type&&t.key===e.key}const xl=({key:t})=>t??null,Qn=({ref:t,ref_key:e,ref_for:s})=>(typeof t=="number"&&(t=""+t),t!=null?rt(t)||St(t)||ke(t)?{i:zt,r:t,k:e,f:!!s}:t:null);function p(t,e=null,s=null,n=0,o=null,i=t===Ze?0:1,a=!1,r=!1){const l={__v_isVNode:!0,__v_skip:!0,type:t,props:e,key:e&&xl(e),ref:e&&Qn(e),scopeId:qr,slotScopeIds:null,children:s,component:null,suspense:null,ssContent:null,ssFallback:null,dirs:null,transition:null,el:null,anchor:null,target:null,targetStart:null,targetAnchor:null,staticCount:0,shapeFlag:i,patchFlag:n,dynamicProps:o,dynamicChildren:null,appContext:null,ctx:zt};return r?(Wi(l,s),i&128&&t.normalize(l)):s&&(l.shapeFlag|=rt(s)?8:16),Ln>0&&!a&&Ft&&(l.patchFlag>0||i&6)&&l.patchFlag!==32&&Ft.push(l),l}const it=zd;function zd(t,e=null,s=null,n=0,o=null,i=!1){if((!t||t===fd)&&(t=At),ho(t)){const r=$s(t,e,!0);return s&&Wi(r,s),Ln>0&&!i&&Ft&&(r.shapeFlag&6?Ft[Ft.indexOf(t)]=r:Ft.push(r)),r.patchFlag=-2,r}if(ef(t)&&(t=t.__vccOpts),e){e=Vd(e);let{class:r,style:l}=e;r&&!rt(r)&&(e.class=Ye(r)),et(l)&&(Fi(l)&&!Te(l)&&(l=gt({},l)),e.style=Gt(l))}const a=rt(t)?1:Cl(t)?128:Zr(t)?64:et(t)?4:ke(t)?2:0;return p(t,e,s,n,o,a,i,!0)}function Vd(t){return t?Fi(t)||ml(t)?gt({},t):t:null}function $s(t,e,s=!1,n=!1){const{props:o,ref:i,patchFlag:a,children:r,transition:l}=t,c=e?Kd(o||{},e):o,u={__v_isVNode:!0,__v_skip:!0,type:t.type,props:c,key:c&&xl(c),ref:e&&e.ref?s&&i?Te(i)?i.concat(Qn(e)):[i,Qn(e)]:Qn(e):i,scopeId:t.scopeId,slotScopeIds:t.slotScopeIds,children:r,target:t.target,targetStart:t.targetStart,targetAnchor:t.targetAnchor,staticCount:t.staticCount,shapeFlag:t.shapeFlag,patchFlag:e&&t.type!==Ze?a===-1?16:a|16:a,dynamicProps:t.dynamicProps,dynamicChildren:t.dynamicChildren,appContext:t.appContext,dirs:t.dirs,transition:l,component:t.component,suspense:t.suspense,ssContent:t.ssContent&&$s(t.ssContent),ssFallback:t.ssFallback&&$s(t.ssFallback),placeholder:t.placeholder,el:t.el,anchor:t.anchor,ctx:t.ctx,ce:t.ce};return l&&n&&Pn(u,l.clone(u)),u}function Ps(t=" ",e=0){return it($o,null,t,e)}function mo(t,e){const s=it(En,null,t);return s.staticCount=e,s}function ye(t="",e=!1){return e?(D(),xt(At,null,t)):it(At,null,t)}function as(t){return t==null||typeof t=="boolean"?it(At):Te(t)?it(Ze,null,t.slice()):ho(t)?Es(t):it($o,null,String(t))}function Es(t){return t.el===null&&t.patchFlag!==-1||t.memo?t:$s(t)}function Wi(t,e){let s=0;const{shapeFlag:n}=t;if(e==null)e=null;else if(Te(e))s=16;else if(typeof e=="object")if(n&65){const o=e.default;o&&(o._c&&(o._d=!1),Wi(t,o()),o._c&&(o._d=!0));return}else{s=32;const o=e._;!o&&!ml(e)?e._ctx=zt:o===3&&zt&&(zt.slots._===1?e._=1:(e._=2,t.patchFlag|=1024))}else ke(e)?(e={default:e,_ctx:zt},s=32):(e=String(e),n&64?(s=16,e=[Ps(e)]):s=8);t.children=e,t.shapeFlag|=s}function Kd(...t){const e={};for(let s=0;s<t.length;s++){const n=t[s];for(const o in n)if(o==="class")e.class!==n.class&&(e.class=Ye([e.class,n.class]));else if(o==="style")e.style=Gt([e.style,n.style]);else if(So(o)){const i=e[o],a=n[o];a&&i!==a&&!(Te(i)&&i.includes(a))&&(e[o]=i?[].concat(i,a):a)}else o!==""&&(e[o]=n[o])}return e}function ss(t,e,s,n=null){ts(t,e,7,[s,n])}const Wd=fl();let qd=0;function Xd(t,e,s){const n=t.type,o=(e?e.appContext:t.appContext)||Wd,i={uid:qd++,vnode:t,type:n,parent:e,appContext:o,root:null,next:null,subTree:null,effect:null,update:null,job:null,scope:new Su(!0),render:null,proxy:null,exposed:null,exposeProxy:null,withProxy:null,provides:e?e.provides:Object.create(o.provides),ids:e?e.ids:["",0,0],accessCache:null,renderCache:[],components:null,directives:null,propsOptions:gl(n,o),emitsOptions:Ml(n,o),emit:null,emitted:null,propsDefaults:Je,inheritAttrs:n.inheritAttrs,ctx:Je,data:Je,props:Je,attrs:Je,slots:Je,refs:Je,setupState:Je,setupContext:null,suspense:s,suspenseId:s?s.pendingId:0,asyncDep:null,asyncResolved:!1,isMounted:!1,isUnmounted:!1,isDeactivated:!1,bc:null,c:null,bm:null,m:null,bu:null,u:null,um:null,bum:null,da:null,a:null,rtg:null,rtc:null,ec:null,sp:null};return i.ctx={_:i},i.root=e?e.root:i,i.emit=Dd.bind(null,i),t.ce&&t.ce(i),i}let Rt=null;const qi=()=>Rt||zt;let _o,Mi;{const t=Co(),e=(s,n)=>{let o;return(o=t[s])||(o=t[s]=[]),o.push(n),i=>{o.length>1?o.forEach(a=>a(i)):o[0](i)}};_o=e("__VUE_INSTANCE_SETTERS__",s=>Rt=s),Mi=e("__VUE_SSR_SETTERS__",s=>In=s)}const Gn=t=>{const e=Rt;return _o(t),t.scope.on(),()=>{t.scope.off(),_o(e)}},xa=()=>{Rt&&Rt.scope.off(),_o(null)};function kl(t){return t.vnode.shapeFlag&4}let In=!1;function Yd(t,e=!1,s=!1){e&&Mi(e);const{props:n,children:o}=t.vnode,i=kl(t);Sd(t,n,i,e),Ed(t,o,s||e);const a=i?Jd(t,e):void 0;return e&&Mi(!1),a}function Jd(t,e){const s=t.type;t.accessCache=Object.create(null),t.proxy=new Proxy(t.ctx,pd);const{setup:n}=s;if(n){bs();const o=t.setupContext=n.length>1?Qd(t):null,i=Gn(t),a=Nn(n,t,0,[t.props,o]),r=br(a);if(ws(),i(),(r||t.sp)&&!Mn(t)&&rl(t),r){if(a.then(xa,xa),e)return a.then(l=>{ka(t,l)}).catch(l=>{xo(l,t,0)});t.asyncDep=a}else ka(t,a)}else Al(t)}function ka(t,e,s){ke(e)?t.type.__ssrInlineRender?t.ssrRender=e:t.render=e:et(e)&&(t.setupState=Br(e)),Al(t)}function Al(t,e,s){const n=t.type;t.render||(t.render=n.render||Qt);{const o=Gn(t);bs();try{hd(t)}finally{ws(),o()}}}const Zd={get(t,e){return wt(t,"get",""),t[e]}};function Qd(t){const e=s=>{t.exposed=s||{}};return{attrs:new Proxy(t.attrs,Zd),slots:t.slots,emit:t.emit,expose:e}}function Po(t){return t.exposed?t.exposeProxy||(t.exposeProxy=new Proxy(Br(ju(t.exposed)),{get(e,s){if(s in e)return e[s];if(s in Cn)return Cn[s](t)},has(e,s){return s in e||s in Cn}})):t.proxy}function ef(t){return ke(t)&&"__vccOpts"in t}const Ae=(t,e)=>qu(t,e,In);function tf(t,e,s){try{po(-1);const n=arguments.length;return n===2?et(e)&&!Te(e)?ho(e)?it(t,null,[e]):it(t,e):it(t,null,e):(n>3?s=Array.prototype.slice.call(arguments,2):n===3&&ho(s)&&(s=[s]),it(t,e,s))}finally{po(1)}}const sf="3.5.22";/**
* @vue/runtime-dom v3.5.22
* (c) 2018-present Yuxi (Evan) You and Vue contributors
* @license MIT
**/let Ci;const Aa=typeof window<"u"&&window.trustedTypes;if(Aa)try{Ci=Aa.createPolicy("vue",{createHTML:t=>t})}catch{}const Rl=Ci?t=>Ci.createHTML(t):t=>t,nf="http://www.w3.org/2000/svg",of="http://www.w3.org/1998/Math/MathML",hs=typeof document<"u"?document:null,Ra=hs&&hs.createElement("template"),af={insert:(t,e,s)=>{e.insertBefore(t,s||null)},remove:t=>{const e=t.parentNode;e&&e.removeChild(t)},createElement:(t,e,s,n)=>{const o=e==="svg"?hs.createElementNS(nf,t):e==="mathml"?hs.createElementNS(of,t):s?hs.createElement(t,{is:s}):hs.createElement(t);return t==="select"&&n&&n.multiple!=null&&o.setAttribute("multiple",n.multiple),o},createText:t=>hs.createTextNode(t),createComment:t=>hs.createComment(t),setText:(t,e)=>{t.nodeValue=e},setElementText:(t,e)=>{t.textContent=e},parentNode:t=>t.parentNode,nextSibling:t=>t.nextSibling,querySelector:t=>hs.querySelector(t),setScopeId(t,e){t.setAttribute(e,"")},insertStaticContent(t,e,s,n,o,i){const a=s?s.previousSibling:e.lastChild;if(o&&(o===i||o.nextSibling))for(;e.insertBefore(o.cloneNode(!0),s),!(o===i||!(o=o.nextSibling)););else{Ra.innerHTML=Rl(n==="svg"?`<svg>${t}</svg>`:n==="mathml"?`<math>${t}</math>`:t);const r=Ra.content;if(n==="svg"||n==="mathml"){const l=r.firstChild;for(;l.firstChild;)r.appendChild(l.firstChild);r.removeChild(l)}e.insertBefore(r,s)}return[a?a.nextSibling:e.firstChild,s?s.previousSibling:e.lastChild]}},Ts="transition",pn="animation",On=Symbol("_vtc"),$l={name:String,type:String,css:{type:Boolean,default:!0},duration:[String,Number,Object],enterFromClass:String,enterActiveClass:String,enterToClass:String,appearFromClass:String,appearActiveClass:String,appearToClass:String,leaveFromClass:String,leaveActiveClass:String,leaveToClass:String},rf=gt({},sl,$l),lf=t=>(t.displayName="Transition",t.props=rf,t),cf=lf((t,{slots:e})=>tf(sd,uf(t),e)),Hs=(t,e=[])=>{Te(t)?t.forEach(s=>s(...e)):t&&t(...e)},$a=t=>t?Te(t)?t.some(e=>e.length>1):t.length>1:!1;function uf(t){const e={};for(const R in t)R in $l||(e[R]=t[R]);if(t.css===!1)return e;const{name:s="v",type:n,duration:o,enterFromClass:i=`${s}-enter-from`,enterActiveClass:a=`${s}-enter-active`,enterToClass:r=`${s}-enter-to`,appearFromClass:l=i,appearActiveClass:c=a,appearToClass:u=r,leaveFromClass:d=`${s}-leave-from`,leaveActiveClass:h=`${s}-leave-active`,leaveToClass:m=`${s}-leave-to`}=t,_=df(o),E=_&&_[0],S=_&&_[1],{onBeforeEnter:g,onEnter:T,onEnterCancelled:y,onLeave:w,onLeaveCancelled:$,onBeforeAppear:z=g,onAppear:V=T,onAppearCancelled:H=y}=e,G=(R,re,ve,ge)=>{R._enterCancelled=ge,Us(R,re?u:r),Us(R,re?c:a),ve&&ve()},ie=(R,re)=>{R._isLeaving=!1,Us(R,d),Us(R,m),Us(R,h),re&&re()},O=R=>(re,ve)=>{const ge=R?V:T,pe=()=>G(re,R,ve);Hs(ge,[re,pe]),Pa(()=>{Us(re,R?l:i),ps(re,R?u:r),$a(ge)||La(re,n,E,pe)})};return gt(e,{onBeforeEnter(R){Hs(g,[R]),ps(R,i),ps(R,a)},onBeforeAppear(R){Hs(z,[R]),ps(R,l),ps(R,c)},onEnter:O(!1),onAppear:O(!0),onLeave(R,re){R._isLeaving=!0;const ve=()=>ie(R,re);ps(R,d),R._enterCancelled?(ps(R,h),Da(R)):(Da(R),ps(R,h)),Pa(()=>{R._isLeaving&&(Us(R,d),ps(R,m),$a(w)||La(R,n,S,ve))}),Hs(w,[R,ve])},onEnterCancelled(R){G(R,!1,void 0,!0),Hs(y,[R])},onAppearCancelled(R){G(R,!0,void 0,!0),Hs(H,[R])},onLeaveCancelled(R){ie(R),Hs($,[R])}})}function df(t){if(t==null)return null;if(et(t))return[Zo(t.enter),Zo(t.leave)];{const e=Zo(t);return[e,e]}}function Zo(t){return hu(t)}function ps(t,e){e.split(/\s+/).forEach(s=>s&&t.classList.add(s)),(t[On]||(t[On]=new Set)).add(e)}function Us(t,e){e.split(/\s+/).forEach(n=>n&&t.classList.remove(n));const s=t[On];s&&(s.delete(e),s.size||(t[On]=void 0))}function Pa(t){requestAnimationFrame(()=>{requestAnimationFrame(t)})}let ff=0;function La(t,e,s,n){const o=t._endId=++ff,i=()=>{o===t._endId&&n()};if(s!=null)return setTimeout(i,s);const{type:a,timeout:r,propCount:l}=pf(t,e);if(!a)return n();const c=a+"end";let u=0;const d=()=>{t.removeEventListener(c,h),i()},h=m=>{m.target===t&&++u>=l&&d()};setTimeout(()=>{u<l&&d()},r+1),t.addEventListener(c,h)}function pf(t,e){const s=window.getComputedStyle(t),n=_=>(s[_]||"").split(", "),o=n(`${Ts}Delay`),i=n(`${Ts}Duration`),a=Ia(o,i),r=n(`${pn}Delay`),l=n(`${pn}Duration`),c=Ia(r,l);let u=null,d=0,h=0;e===Ts?a>0&&(u=Ts,d=a,h=i.length):e===pn?c>0&&(u=pn,d=c,h=l.length):(d=Math.max(a,c),u=d>0?a>c?Ts:pn:null,h=u?u===Ts?i.length:l.length:0);const m=u===Ts&&/\b(?:transform|all)(?:,|$)/.test(n(`${Ts}Property`).toString());return{type:u,timeout:d,propCount:h,hasTransform:m}}function Ia(t,e){for(;t.length<e.length;)t=t.concat(t);return Math.max(...e.map((s,n)=>Oa(s)+Oa(t[n])))}function Oa(t){return t==="auto"?0:Number(t.slice(0,-1).replace(",","."))*1e3}function Da(t){return(t?t.ownerDocument:document).body.offsetHeight}function hf(t,e,s){const n=t[On];n&&(e=(e?[e,...n]:[...n]).join(" ")),e==null?t.removeAttribute("class"):s?t.setAttribute("class",e):t.className=e}const go=Symbol("_vod"),Pl=Symbol("_vsh"),Ll={name:"show",beforeMount(t,{value:e},{transition:s}){t[go]=t.style.display==="none"?"":t.style.display,s&&e?s.beforeEnter(t):hn(t,e)},mounted(t,{value:e},{transition:s}){s&&e&&s.enter(t)},updated(t,{value:e,oldValue:s},{transition:n}){!e!=!s&&(n?e?(n.beforeEnter(t),hn(t,!0),n.enter(t)):n.leave(t,()=>{hn(t,!1)}):hn(t,e))},beforeUnmount(t,{value:e}){hn(t,e)}};function hn(t,e){t.style.display=e?t[go]:"none",t[Pl]=!e}const Il=Symbol("");function qt(t){const e=qi();if(!e)return;const s=e.ut=(o=t(e.proxy))=>{Array.from(document.querySelectorAll(`[data-v-owner="${e.uid}"]`)).forEach(i=>vo(i,o))},n=()=>{const o=t(e.proxy);e.ce?vo(e.ce,o):Ei(e.subTree,o),s(o)};cl(()=>{Vr(n)}),Pt(()=>{Ht(n,Qt,{flush:"post"});const o=new MutationObserver(n);o.observe(e.subTree.el.parentNode,{childList:!0}),ji(()=>o.disconnect())})}function Ei(t,e){if(t.shapeFlag&128){const s=t.suspense;t=s.activeBranch,s.pendingBranch&&!s.isHydrating&&s.effects.push(()=>{Ei(s.activeBranch,e)})}for(;t.component;)t=t.component.subTree;if(t.shapeFlag&1&&t.el)vo(t.el,e);else if(t.type===Ze)t.children.forEach(s=>Ei(s,e));else if(t.type===En){let{el:s,anchor:n}=t;for(;s&&(vo(s,e),s!==n);)s=s.nextSibling}}function vo(t,e){if(t.nodeType===1){const s=t.style;let n="";for(const o in e){const i=wu(e[o]);s.setProperty(`--${o}`,i),n+=`--${o}: ${i};`}s[Il]=n}}const mf=/(?:^|;)\s*display\s*:/;function _f(t,e,s){const n=t.style,o=rt(s);let i=!1;if(s&&!o){if(e)if(rt(e))for(const a of e.split(";")){const r=a.slice(0,a.indexOf(":")).trim();s[r]==null&&eo(n,r,"")}else for(const a in e)s[a]==null&&eo(n,a,"");for(const a in s)a==="display"&&(i=!0),eo(n,a,s[a])}else if(o){if(e!==s){const a=n[Il];a&&(s+=";"+a),n.cssText=s,i=mf.test(s)}}else e&&t.removeAttribute("style");go in t&&(t[go]=i?n.display:"",t[Pl]&&(n.display="none"))}const Na=/\s*!important$/;function eo(t,e,s){if(Te(s))s.forEach(n=>eo(t,e,n));else if(s==null&&(s=""),e.startsWith("--"))t.setProperty(e,s);else{const n=gf(t,e);Na.test(s)?t.setProperty(Ws(n),s.replace(Na,""),"important"):t[n]=s}}const Ga=["Webkit","Moz","ms"],Qo={};function gf(t,e){const s=Qo[e];if(s)return s;let n=As(e);if(n!=="filter"&&n in t)return Qo[e]=n;n=Tr(n);for(let o=0;o<Ga.length;o++){const i=Ga[o]+n;if(i in t)return Qo[e]=i}return e}const Ha="http://www.w3.org/1999/xlink";function Ua(t,e,s,n,o,i=bu(e)){n&&e.startsWith("xlink:")?s==null?t.removeAttributeNS(Ha,e.slice(6,e.length)):t.setAttributeNS(Ha,e,s):s==null||i&&!Cr(s)?t.removeAttribute(e):t.setAttribute(e,i?"":Ls(s)?String(s):s)}function Fa(t,e,s,n,o){if(e==="innerHTML"||e==="textContent"){s!=null&&(t[e]=e==="innerHTML"?Rl(s):s);return}const i=t.tagName;if(e==="value"&&i!=="PROGRESS"&&!i.includes("-")){const r=i==="OPTION"?t.getAttribute("value")||"":t.value,l=s==null?t.type==="checkbox"?"on":"":String(s);(r!==l||!("_value"in t))&&(t.value=l),s==null&&t.removeAttribute(e),t._value=s;return}let a=!1;if(s===""||s==null){const r=typeof t[e];r==="boolean"?s=Cr(s):s==null&&r==="string"?(s="",a=!0):r==="number"&&(s=0,a=!0)}try{t[e]=s}catch{}a&&t.removeAttribute(o||e)}function vf(t,e,s,n){t.addEventListener(e,s,n)}function yf(t,e,s,n){t.removeEventListener(e,s,n)}const Ba=Symbol("_vei");function bf(t,e,s,n,o=null){const i=t[Ba]||(t[Ba]={}),a=i[e];if(n&&a)a.value=n;else{const[r,l]=wf(e);if(n){const c=i[e]=Mf(n,o);vf(t,r,c,l)}else a&&(yf(t,r,a,l),i[e]=void 0)}}const ja=/(?:Once|Passive|Capture)$/;function wf(t){let e;if(ja.test(t)){e={};let n;for(;n=t.match(ja);)t=t.slice(0,t.length-n[0].length),e[n[0].toLowerCase()]=!0}return[t[2]===":"?t.slice(3):Ws(t.slice(2)),e]}let ei=0;const Sf=Promise.resolve(),Tf=()=>ei||(Sf.then(()=>ei=0),ei=Date.now());function Mf(t,e){const s=n=>{if(!n._vts)n._vts=Date.now();else if(n._vts<=s.attached)return;ts(Cf(n,s.value),e,5,[n])};return s.value=t,s.attached=Tf(),s}function Cf(t,e){if(Te(e)){const s=t.stopImmediatePropagation;return t.stopImmediatePropagation=()=>{s.call(t),t._stopped=!0},e.map(n=>o=>!o._stopped&&n&&n(o))}else return e}const za=t=>t.charCodeAt(0)===111&&t.charCodeAt(1)===110&&t.charCodeAt(2)>96&&t.charCodeAt(2)<123,Ef=(t,e,s,n,o,i)=>{const a=o==="svg";e==="class"?hf(t,n,a):e==="style"?_f(t,s,n):So(e)?$i(e)||bf(t,e,s,n,i):(e[0]==="."?(e=e.slice(1),!0):e[0]==="^"?(e=e.slice(1),!1):xf(t,e,n,a))?(Fa(t,e,n),!t.tagName.includes("-")&&(e==="value"||e==="checked"||e==="selected")&&Ua(t,e,n,a,i,e!=="value")):t._isVueCE&&(/[A-Z]/.test(e)||!rt(n))?Fa(t,As(e),n,i,e):(e==="true-value"?t._trueValue=n:e==="false-value"&&(t._falseValue=n),Ua(t,e,n,a))};function xf(t,e,s,n){if(n)return!!(e==="innerHTML"||e==="textContent"||e in t&&za(e)&&ke(s));if(e==="spellcheck"||e==="draggable"||e==="translate"||e==="autocorrect"||e==="form"||e==="list"&&t.tagName==="INPUT"||e==="type"&&t.tagName==="TEXTAREA")return!1;if(e==="width"||e==="height"){const o=t.tagName;if(o==="IMG"||o==="VIDEO"||o==="CANVAS"||o==="SOURCE")return!1}return za(e)&&rt(s)?!1:e in t}const kf=["ctrl","shift","alt","meta"],Af={stop:t=>t.stopPropagation(),prevent:t=>t.preventDefault(),self:t=>t.target!==t.currentTarget,ctrl:t=>!t.ctrlKey,shift:t=>!t.shiftKey,alt:t=>!t.altKey,meta:t=>!t.metaKey,left:t=>"button"in t&&t.button!==0,middle:t=>"button"in t&&t.button!==1,right:t=>"button"in t&&t.button!==2,exact:(t,e)=>kf.some(s=>t[`${s}Key`]&&!e.includes(s))},kt=(t,e)=>{const s=t._withMods||(t._withMods={}),n=e.join(".");return s[n]||(s[n]=(o,...i)=>{for(let a=0;a<e.length;a++){const r=Af[e[a]];if(r&&r(o,e))return}return t(o,...i)})},Rf=gt({patchProp:Ef},af);let Va;function $f(){return Va||(Va=kd(Rf))}const Ka=(...t)=>{const e=$f().createApp(...t),{mount:s}=e;return e.mount=n=>{const o=Lf(n);if(!o)return;const i=e._component;!ke(i)&&!i.render&&!i.template&&(i.template=o.innerHTML),o.nodeType===1&&(o.textContent="");const a=s(o,!1,Pf(o));return o instanceof Element&&(o.removeAttribute("v-cloak"),o.setAttribute("data-v-app","")),a},e};function Pf(t){if(t instanceof SVGElement)return"svg";if(typeof MathMLElement=="function"&&t instanceof MathMLElement)return"mathml"}function Lf(t){return rt(t)?document.querySelector(t):t}const to={maxRetries:3,retryDelay:1e3,timeout:1e4};let ti=null;const rn={enabled:!0,maxCacheSize:50*1024*1024,cachePrefix:"mgpic_",version:"1.0.0",loadInterval:50,batchSize:3};class If{constructor(){this.cache=new Map,this.totalSize=0}isSupported(){return"caches"in window}getCacheName(){return`${rn.cachePrefix}${rn.version}`}async isCached(e){if(!this.isSupported())return!1;try{return await(await caches.open(this.getCacheName())).match(e)!==void 0}catch(s){return f(":",s.message),!1}}async cacheResource(e,s){if(!this.isSupported())return!1;try{const n=await caches.open(this.getCacheName());if(await n.match(e))return f(`: ${e}`),!0;await n.put(e,s.clone());const i=s.headers.get("content-length");return i&&(this.totalSize+=parseInt(i)),f(`: ${e}`),!0}catch(n){return f(":",n.message),!1}}async getCachedResource(e){if(!this.isSupported())return null;try{return await(await caches.open(this.getCacheName())).match(e)}catch(s){return f(":",s.message),null}}async cleanupCache(){if(this.isSupported())try{const e=await caches.keys(),s=this.getCacheName();for(const n of e)n.startsWith(rn.cachePrefix)&&n!==s&&(await caches.delete(n),f(`: ${n}`))}catch(e){f(":",e.message)}}}const Vt=new If;let qn=null;function Of(){return qn||(f("R2 URL"),qn="https://pub-6f9181bda40946ea92b5e87fe84e27d4.r2.dev",qn)}function F(t){let e=t;t.startsWith("/assets/")?e=t.slice(7):t.startsWith("@assets/")&&(e=t.slice(8));const s=Of(),n=e.startsWith("/")?e.slice(1):e;return`${s}/${n}`}async function Ol(t,e={}){if(Vt.isSupported()){const o=await Vt.getCachedResource(t);if(o)return f(` Cache Storage : ${t}`),o}const{maxRetries:s=to.maxRetries,retryDelay:n=to.retryDelay}=e;for(let o=1;o<=s;o++)try{f(` (${o}/${s}): ${t}`);const i=new AbortController,a=setTimeout(()=>i.abort(),to.timeout),r=await fetch(t,{method:"GET",mode:"cors",credentials:"omit",cache:"no-cache",signal:i.signal,...e});if(clearTimeout(a),r.ok)return Vt.isSupported()&&await Vt.cacheResource(t,r),f(`: ${t}`),r;throw new Error(`HTTP ${r.status}: ${r.statusText}`)}catch(i){if(f(` (${o}/${s}): ${t}`,i.message),o===s)throw f(`: ${t}`,i.message),i;const a=n*o;f(` ${a}ms ...`),await new Promise(r=>setTimeout(r,a))}}async function Df(t=["high","medium"]){try{if(ti){f("");const i=Wa(ti,t);return f(` ${i.length}  (: ${t.join(", ")})`),i}const e=F("asset-list.json");f(` R2 CDN : ${e}`);const s=await Ol(e);if(!s.ok)throw new Error(`: HTTP ${s.status}`);const n=await s.json();ti=n,f("");const o=Wa(n,t);return f(` ${o.length}  (: ${t.join(", ")})`),o}catch(e){return f(":",e.message),["logo.glb","frontend_resource/start_game.webp","frontend_resource/copper_warehouse.webp","frontend_resource/game_wiki.webp","frontend_resource/Tutorial.webp","frontend_resource/gacha.webp"]}}function Wa(t,e){const s=[];for(const n of e)if(t.categories&&t.categories[n]){const o=t.categories[n].resources||[];s.push(...o.map(i=>i.path))}return s}async function xi(t=null,e=["high","medium"]){f("..."),await Vt.cleanupCache();const s=await Df(e),n=rn.batchSize,o=rn.loadInterval,i=s.length;let a=0;t&&t(0,i,0);for(let r=0;r<s.length;r+=n){const l=s.slice(r,r+n);f(` ${Math.floor(r/n)+1}/${Math.ceil(s.length/n)}: ${l.length} `);const c=l.map(async(S,g)=>{const T=F(S);try{if(await Vt.isCached(T))return f(`Cache Storage: ${S}`),{success:!0,path:S,cached:!0,source:"cache"};const w=new AbortController,$=setTimeout(()=>w.abort(),to.timeout),z=await fetch(T,{method:"GET",mode:"cors",credentials:"omit",cache:"no-cache",signal:w.signal});if(clearTimeout($),z.ok){const V=z.headers.get("x-cache")||z.headers.get("cf-cache-status")||z.type==="basic"&&!z.redirected;return Vt.isSupported()&&await Vt.cacheResource(T,z),f(`: ${S}${V?" ()":""}`),{success:!0,path:S,cached:!1,fromBrowserCache:!!V}}else throw new Error(`HTTP ${z.status}: ${z.statusText}`)}catch(y){return f(`: ${S}`,y.message),{success:!1,path:S,error:y.message}}}),u=await Promise.all(c);a+=l.length;const d=Math.round(a/i*100);t&&t(a,i,d);const h=u.filter(S=>S.success).length,m=u.filter(S=>S.cached).length,_=u.filter(S=>S.fromBrowserCache).length,E=u.filter(S=>!S.success).length;f(`:  ${h}, Cache Storage ${m},  ${_},  ${E}`),r+n<s.length&&(f(` ${o}ms ...`),await new Promise(S=>setTimeout(S,o)))}f(""),t&&t(i,i,100)}async function Nf(){if(!Vt.isSupported())return{supported:!1,message:"API"};try{const e=await(await caches.open(Vt.getCacheName())).keys();return{supported:!0,cacheName:Vt.getCacheName(),resourceCount:e.length,totalSize:Vt.totalSize,maxSize:rn.maxCacheSize}}catch(t){return{supported:!0,error:t.message}}}function Lo(t,e){return F(`copper/${t.toLowerCase()}/${e}/${e}.glb`)}function Io(t){return F(`enemy/${t}/${t}.glb`)}function Dl(t){return F(`structure/${t}/${t}.glb`)}function Gf(t){return F(t)}const ut=(t,e)=>{const s=t.__vccOpts||t;for(const[n,o]of e)s[n]=o;return s},Hf={class:"hall-container"},Uf=["src"],Ff={__name:"Hall",props:{musicOn:{type:Boolean,default:!0},paused:{type:Boolean,default:!1}},emits:["startGame","openWarehouse","openTutorial","openEncyclopedia","toggle-music"],setup(t,{emit:e}){const s=e,n=t;function o(){s("startGame")}function i(){s("openWarehouse")}function a(){s("openTutorial")}function r(){s("openEncyclopedia")}const l=B(F("@assets/frontend_resource/start_game.webp")),c=B(F("@assets/frontend_resource/copper_warehouse.webp")),u=B(F("@assets/frontend_resource/game_wiki.webp")),d=B(F("@assets/frontend_resource/Tutorial.webp")),h=B(F("ui/Gemini_Generated_Image_gtrehogtrehogtre (1).png")),m=B(!1),_=B(null),E=F("@assets/frontend_resource/hall.mp3");return Pt(()=>{setTimeout(()=>{m.value=!0,f("HallUI")},100),n.musicOn&&!n.paused&&_.value&&setTimeout(()=>{if(_.value.readyState>=2)_.value.play().then(()=>{f("[Hall] ")}).catch(g=>{f("[Hall] :",g)});else{const g=()=>{_.value.play().then(()=>{f("[Hall] ")}).catch(T=>{f("[Hall] :",T)}),_.value.removeEventListener("canplay",g)};_.value.addEventListener("canplay",g,{once:!0})}},200)}),Ht(()=>n.musicOn,S=>{if(_.value)if(S&&!n.paused)if(_.value.readyState>=2)_.value.play().catch(g=>{f("[Hall] :",g)});else{const g=()=>{_.value.play().catch(T=>{f("[Hall] :",T)}),_.value.removeEventListener("canplay",g)};_.value.addEventListener("canplay",g)}else _.value.pause()}),Ht(()=>n.paused,S=>{if(_.value){if(S)_.value.pause(),f("[Hall] ");else if(n.musicOn){if(_.value.readyState>=2)_.value.play().catch(g=>{f("[Hall] :",g)});else{const g=()=>{_.value.play().catch(T=>{f("[Hall] :",T)}),_.value.removeEventListener("canplay",g)};_.value.addEventListener("canplay",g)}f("[Hall] ")}}}),us(()=>{_.value&&_.value.pause()}),(S,g)=>(D(),j("div",Hf,[p("div",{class:"hall-bg",style:Gt({backgroundImage:`url('${h.value}')`})},null,4),p("div",{class:Ye(["menu",{"menu--loaded":m.value}])},[p("button",{class:"tile tile--start",style:Gt({backgroundImage:`url('${l.value}')`}),onClick:o},[...g[0]||(g[0]=[p("div",{class:"tile__mask"},null,-1),p("div",{class:"tile__caption tile__caption--bottom"},[p("div",{class:"tile__title"},""),p("div",{class:"tile__subtitle"},"Begin Adventure")],-1)])],4),p("button",{class:"tile tile--warehouse",style:Gt({backgroundImage:`url('${c.value}')`}),onClick:i},[...g[1]||(g[1]=[p("div",{class:"tile__mask"},null,-1),p("div",{class:"tile__caption tile__caption--top"},[p("div",{class:"tile__title"},""),p("div",{class:"tile__subtitle"},"Character Collection")],-1)])],4),p("button",{class:"tile tile--wiki",style:Gt({backgroundImage:`url('${u.value}')`}),onClick:r},[...g[2]||(g[2]=[p("div",{class:"tile__mask"},null,-1),p("div",{class:"tile__caption tile__caption--bottom"},[p("div",{class:"tile__title"},""),p("div",{class:"tile__subtitle"},"Encyclopedia")],-1)])],4),p("button",{class:"tile tile--tutorial",style:Gt({backgroundImage:`url('${d.value}')`}),onClick:a},[...g[3]||(g[3]=[p("div",{class:"tile__mask"},null,-1),p("div",{class:"tile__caption tile__caption--top"},[p("div",{class:"tile__title"},""),p("div",{class:"tile__subtitle"},"Tutorial")],-1)])],4)],2),p("audio",{ref_key:"audioRef",ref:_,src:ue(E),loop:"",preload:"auto"},null,8,Uf)]))}},Bf=ut(Ff,[["__scopeId","data-v-4537fc51"]]),Zt={HeartCrystalDust:{name:"",icon:F("resource/heart_crystal_dust.webp")},RecallGear:{name:"",icon:F("resource/recall_gear.webp")},ResonantCrystal:{name:"",icon:F("resource/resonant_star_crystal/resonant_star_crystal.webp")},RefinedCopper:{name:"",icon:F("resource/refined_copper_ingot/refined_copper_ingot.webp")},SpiritalSpark:{name:"",icon:F("resource/spiritual_spark.webp")}};function Xi(t){var e;if(Array.isArray(t==null?void 0:t.item_type)&&t.item_type[0]==="Resource"){const s=t.item_type[1];return((e=Zt[s])==null?void 0:e.name)||s}else if(Array.isArray(t==null?void 0:t.item_type)&&t.item_type[0]==="Equipment")return"";return""}function bt(t){var e;return((e=Zt[t])==null?void 0:e.name)||t}function ns(t){var e;return((e=Zt[t])==null?void 0:e.icon)||""}const jf="modulepreload",zf=function(t,e){return new URL(t,e).href},qa={},Nl=function(e,s,n){let o=Promise.resolve();if(s&&s.length>0){const a=document.getElementsByTagName("link"),r=document.querySelector("meta[property=csp-nonce]"),l=(r==null?void 0:r.nonce)||(r==null?void 0:r.getAttribute("nonce"));o=Promise.allSettled(s.map(c=>{if(c=zf(c,n),c in qa)return;qa[c]=!0;const u=c.endsWith(".css"),d=u?'[rel="stylesheet"]':"";if(!!n)for(let _=a.length-1;_>=0;_--){const E=a[_];if(E.href===c&&(!u||E.rel==="stylesheet"))return}else if(document.querySelector(`link[href="${c}"]${d}`))return;const m=document.createElement("link");if(m.rel=u?"stylesheet":jf,u||(m.as="script"),m.crossOrigin="",m.href=c,l&&m.setAttribute("nonce",l),document.head.appendChild(m),u)return new Promise((_,E)=>{m.addEventListener("load",_),m.addEventListener("error",()=>E(new Error(`Unable to preload CSS for ${c}`)))})}))}function i(a){const r=new Event("vite:preloadError",{cancelable:!0});if(r.payload=a,window.dispatchEvent(r),!r.defaultPrevented)throw a}return o.then(a=>{for(const r of a||[])r.status==="rejected"&&i(r.reason);return e().catch(i)})};function Vf(t){return{all:t=t||new Map,on:function(e,s){var n=t.get(e);n?n.push(s):t.set(e,[s])},off:function(e,s){var n=t.get(e);n&&(s?n.splice(n.indexOf(s)>>>0,1):t.set(e,[]))},emit:function(e,s){var n=t.get(e);n&&n.slice().map(function(o){o(s)}),(n=t.get("*"))&&n.slice().map(function(o){o(e,s)})}}}const Yi=Vf(),Nt={UPDATE_RESOURCES:"update:resources",RESOURCES_UPDATED:"resources:updated",COPPER_ID_ADDED:"copper:id:added",START_MENU_PAUSE:"menu:pause",START_MENU_RESUME:"menu:resume",START_MENU_STARTED:"menu:started",CONTROL_MODE_CHANGED:"control:mode:changed",GAME_STARTED:"game:started",GAME_ENDED:"game:ended"},zs=(t,e)=>{Yi.emit(t,e)},Oo=(t,e)=>{Yi.on(t,e)},Ji=(t,e)=>{Yi.off(t,e)};class Kf{constructor(){this.queue=[],this.isProcessing=!1,this.handlers=new Map,this.sceneContext=null}setSceneContext(e){this.sceneContext=e}registerHandler(e,s){this.handlers.set(e,s)}enqueue(e){["handle_on_click_copper","on_game_start"].includes(e.type_msg)&&f("[MessageQueue] :",e.type_msg),this.queue.push(e),this.isProcessing||this.processNext()}async processNext(){if(this.queue.length===0){this.isProcessing=!1;return}this.isProcessing=!0;const e=50;let s=0;for(;this.queue.length>0&&s<e;){const n=this.queue.shift();s++;try{const{type_msg:o,content:i}=n,a=this.handlers.get(o);if(a){const r=JSON.parse(i),l=a(r,this.sceneContext||{});l&&typeof l.then=="function"&&await l}else f("[MessageQueue] :",o),f("[MessageQueue] :",Array.from(this.handlers.keys()))}catch(o){f("[MessageQueue] :",o),f("[MessageQueue] :",o.message),f("[MessageQueue] :",o.stack)}}this.queue.length>0?requestAnimationFrame(()=>this.processNext()):this.isProcessing=!1}}const Ce=new Kf;function Xn(t,e){return t.find(s=>s.id===e)}function Xa(t){return new Promise(e=>setTimeout(e,t))}function Gl(){f("[MessageQueue] ..."),Ce.registerHandler("handle_on_click_copper",async(i,a)=>{var u,d;const{copper:r,resources:l,has_attack_targets:c}=i;f(`[Handler] : ${((u=r.copper.copper_info)==null?void 0:u.name)||"Unknown"} (ID=${r.id})`),f(`[Handler] : HP=${r.now_health}/${r.copper.attribute.health}, =${r.can_move}, =${r.can_attack}, =${r.can_summon}, =${r.can_build}, =${c}`),f(`[Handler] : ${(d=r.copper)==null?void 0:d.copper_type}`),a.highlightSelectedCopper&&a.highlightSelectedCopper(r.id),a.onShowCopperInfo&&a.onShowCopperInfo(r,l,c)}),Ce.registerHandler("handle_on_click_enemy",async(i,a)=>{var m,_;const{enemy:r,resources:l,has_attack_targets:c}=i,u=r.owned||!1;f(`[Handler] ${u?"":""}: ${((m=r.enemy_base)==null?void 0:m.name)||"Unknown"} (ID=${r.id})`),f(`[Handler] : HP=${r.now_health}/${r.enemy_base.health}, =${r.can_move}, =${r.can_attack}, owned=${r.owned}, =${c}`);const h={id:r.id,now_health:r.now_health,can_move:u?r.can_move:!1,can_attack:u?r.can_attack:!1,can_summon:!1,position:r.position,isEnemy:!u,isOwnedEnemy:u,copper:{copper_info:{name:((_=r.enemy_base)==null?void 0:_.name)||(u?"":"")},attribute:{health:r.enemy_base.health,attack:r.enemy_base.attack,defense:r.enemy_base.defense,speed:r.enemy_base.speed}}};a.highlightSelectedCopper&&a.highlightSelectedCopper(r.id),a.onShowCopperInfo&&a.onShowCopperInfo(h,l,c)}),Ce.registerHandler("handle_on_click_structure",async(i,a)=>{var d;const{structure:r,resources:l}=i,u=r.owned||!1?"":"";f(`[Handler] ${u}: ${((d=r.structure_base)==null?void 0:d.name)||"Unknown"} (ID=${r.id})`),f(`[Handler] : HP=${r.now_health}/${r.structure_base.health}, =${r.can_move}, =${r.can_attack}, owned=${r.owned}, =${r.structure_base.has_storage}`),a.highlightSelectedCopper&&a.highlightSelectedCopper(r.id),a.onShowStructureInfo&&a.onShowStructureInfo(r,l)}),Ce.registerHandler("set_copper",async(i,a)=>{const{id:r,position:l,copper:c}=i;window.__ACTUAL_COPPER_IDS__||(window.__ACTUAL_COPPER_IDS__=[]),window.__ACTUAL_COPPER_IDS__.push(c.id),zs(Nt.COPPER_ID_ADDED,c.id),a.onSetCopper&&await a.onSetCopper(r,l,c)}),Ce.registerHandler("set_enemy",async(i,a)=>{const{id:r,position:l,enemy:c}=i;a.onSetEnemy&&a.onSetEnemy(r,l,c),c.owned&&zs(Nt.UPDATE_RESOURCES)}),Ce.registerHandler("set_material",async(i,a)=>{const{id:r,position:l,material:c}=i;a.onSetMaterial&&await a.onSetMaterial(r,l,c)}),Ce.registerHandler("set_structure",async(i,a)=>{const{id:r,position:l,structure:c}=i;a.onSetStructure&&await a.onSetStructure(r,l,c),c.owned&&zs(Nt.UPDATE_RESOURCES)}),Ce.registerHandler("remove_unit",async(i,a)=>{const{id:r}=i,l=Xn(a.models||[],r),c=l&&l.type==="enemy"&&!l.isOwned,u=c?l.position:null;if(f(`[Handler] remove_unit: ID=${r}, type=${l==null?void 0:l.type}, isOwned=${l==null?void 0:l.isOwned}, isEnemyDeath=${c}, position=${JSON.stringify(u)}`),l&&l.object){l.object.traverse(m=>{m.material&&(Array.isArray(m.material)?m.material=m.material.map(_=>_.clone()):m.material=m.material.clone())});const d=500,h=performance.now();if(await new Promise(m=>{function _(){const E=performance.now()-h,S=Math.min(E/d,1);l.object&&l.object.traverse(g=>{g.material&&(Array.isArray(g.material)?g.material.forEach(T=>{T.transparent=!0,T.opacity=1-S}):(g.material.transparent=!0,g.material.opacity=1-S))}),S<1?requestAnimationFrame(_):m()}_()}),a.scene&&a.scene.remove(l.object),l.object.traverse(m=>{m.geometry&&m.geometry.dispose(),m.material&&(Array.isArray(m.material)?m.material.forEach(_=>{_.map&&_.map.dispose(),_.lightMap&&_.lightMap.dispose(),_.bumpMap&&_.bumpMap.dispose(),_.normalMap&&_.normalMap.dispose(),_.specularMap&&_.specularMap.dispose(),_.envMap&&_.envMap.dispose(),_.alphaMap&&_.alphaMap.dispose(),_.aoMap&&_.aoMap.dispose(),_.displacementMap&&_.displacementMap.dispose(),_.emissiveMap&&_.emissiveMap.dispose(),_.metalnessMap&&_.metalnessMap.dispose(),_.roughnessMap&&_.roughnessMap.dispose(),_.dispose()}):(m.material.map&&m.material.map.dispose(),m.material.lightMap&&m.material.lightMap.dispose(),m.material.bumpMap&&m.material.bumpMap.dispose(),m.material.normalMap&&m.material.normalMap.dispose(),m.material.specularMap&&m.material.specularMap.dispose(),m.material.envMap&&m.material.envMap.dispose(),m.material.alphaMap&&m.material.alphaMap.dispose(),m.material.aoMap&&m.material.aoMap.dispose(),m.material.displacementMap&&m.material.displacementMap.dispose(),m.material.emissiveMap&&m.material.emissiveMap.dispose(),m.material.metalnessMap&&m.material.metalnessMap.dispose(),m.material.roughnessMap&&m.material.roughnessMap.dispose(),m.material.dispose()))}),a.models){const m=a.models.indexOf(l);m>-1&&a.models.splice(m,1)}a.onClearState&&a.onClearState(r),a.onRemoveHealthBar&&a.onRemoveHealthBar(r),l.type==="copper"&&a.onRemoveCopper&&a.onRemoveCopper(r)}if(c&&u){f("[Handler] ...");const d=h=>{f("[Handler] :",h),a.onShowResourceGain&&Object.keys(h).length>0&&(f("[Handler] :",u,h),a.onShowResourceGain(u,h))};Oo(Nt.RESOURCES_UPDATED,d),zs(Nt.UPDATE_RESOURCES),setTimeout(()=>{Ji(Nt.RESOURCES_UPDATED,d)},1e3)}}),Ce.registerHandler("change_direction",async(i,a)=>{const{id:r,direction:l}=i,c=Xn(a.models||[],r);if(c&&c.object){let u=0;switch(l){case"PositiveY":u=0;break;case"PositiveX":u=Math.PI/2;break;case"NegativeY":u=Math.PI;break;case"NegativeX":u=-Math.PI/2;break}let d=c.object.rotation.y;d=Math.atan2(Math.sin(d),Math.cos(d));let h=u-d;h>Math.PI?h-=2*Math.PI:h<-Math.PI&&(h+=2*Math.PI);const m=300,_=performance.now();await new Promise(E=>{function S(){const g=performance.now()-_,T=Math.min(g/m,1),y=1-Math.pow(1-T,2);c.object&&(c.object.rotation.y=d+h*y),T<1?requestAnimationFrame(S):(c.object&&(c.object.rotation.y=u),E())}S()})}}),Ce.registerHandler("move_to",async(i,a)=>{const{id:r,to:l}=i,c=Xn(a.models||[],r);if(c&&c.object&&a.gridCellSize){const[u,d]=l,h=u,m=d,_=c.object.position.y;c.position=[u,d],a.onMoveStart&&a.onMoveStart(r,c),a.animateModelMove&&await new Promise(E=>{a.animateModelMove(c,{x:h,y:_,z:m},E)}),a.onMoveComplete&&a.onMoveComplete(r)}}),Ce.registerHandler("display_can_move",(i,a)=>{const{id:r,can_move:l}=i,c=l==="true"||l===!0;a.onDisplayCanMove&&a.onDisplayCanMove(r,c)}),Ce.registerHandler("display_can_attack",(i,a)=>{const{id:r,can_attack:l}=i,c=l==="true"||l===!0;a.onDisplayCanAttack&&a.onDisplayCanAttack(r,c)}),Ce.registerHandler("display_can_summon",(i,a)=>{const{id:r,can_summon:l}=i,c=l==="true"||l===!0;f(`[Handler] display_can_summon id=${r}, can_summon=${c}`),a.onDisplayCanSummon&&a.onDisplayCanSummon(r,c)}),Ce.registerHandler("update_health",(i,a)=>{const{id:r,now_health:l,max_health:c}=i;a.onUpdateHealth&&a.onUpdateHealth(r,l,c)}),Ce.registerHandler("clear_state",(i,a)=>{const{id:r}=i;a.onClearState&&a.onClearState(r)}),Ce.registerHandler("animate_move",async(i,a)=>{const{id:r}=i,l=Xn(a.models||[],r);if(!l){f(`[Handler] animate_move:  ID=${r}`);return}if(window.disableAutoFocus){f(`[Handler] animate_move:  ID=${r}`);return}const c=a.followEnemies!==void 0?a.followEnemies:!1;if(l.type==="enemy"&&!c){f(`[Handler] animate_move:  ID=${r}  context.followEnemies = true `);return}if(a.camera&&a.focusOnModel){const u=a.focusOnModel(l.object,a.camera,a.controls);a.focusState&&(a.focusState.focusPosition=u.focusPosition,a.focusState.focusTarget=u.focusTarget,a.focusState.lerpFactor=u.lerpFactor,f(`[Handler] animate_move:  ID=${r} (${l.name})`)),await Xa(1e3)}}),Ce.registerHandler("animate_reset",async(i,a)=>{if(f("[Handler] animate_reset"),a.camera&&a.controls){const r={x:0,y:2,z:5},l={x:0,y:0,z:0};a.focusState&&(a.focusState.focusPosition=r,a.focusState.focusTarget=l,a.focusState.lerpFactor=.08),await Xa(1e3)}}),Ce.registerHandler("put_map_block",(i,a)=>{const{position:r}=i;a.onPutMapBlock&&a.onPutMapBlock(r)}),Ce.registerHandler("put_room_blocks",async(i,a)=>{const{room_position:r,size:l}=i,[c,u]=r;if(f(`[Handler]  : [${c}, ${u}], ${l}x${l}`),!a.onPutMapBlock){f("[Handler]  context.onPutMapBlock ");return}f("[Handler]  context.onPutMapBlock ...");const d=32,h=l*l;let m=0;for(let _=0;_<l;_++)for(let E=0;E<l;E++){const S=[c+_,u+E];a.onPutMapBlock(S),m++,m%d===0&&await new Promise(g=>requestAnimationFrame(g))}f(`[Handler]  : ${h}`)}),Ce.registerHandler("put_resource_marker",(i,a)=>{const{position:r}=i;a.onPutResourceMarker&&a.onPutResourceMarker(r)}),Ce.registerHandler("clear_resource_marker",(i,a)=>{const{position:r}=i;a.onClearResourceMarker&&a.onClearResourceMarker(r)});let t=0,e=0,s=0;Ce.registerHandler("set_move_block",(i,a)=>{const{position:r}=i;t++,a.onSetMoveBlock&&a.onSetMoveBlock(r)}),Ce.registerHandler("set_attack_block",(i,a)=>{const{position:r}=i;e++,a.onSetAttackBlock&&a.onSetAttackBlock(r),(e===1||e%10===0)&&f(`[Handler]  ${e} `)}),Ce.registerHandler("set_can_summon_blocks",(i,a)=>{const{position:r}=i;s++,a.onSetCanSummonBlock&&a.onSetCanSummonBlock(r),(s===1||s%10===0)&&f(`[Handler]  ${s} `)});let n=0,o=Date.now();Ce.registerHandler("clear_block",(i,a)=>{const{position:r}=i;a.onClearBlock&&a.onClearBlock(r),n++;const l=Date.now();l-o>500&&(n>1&&f(`[Handler]   ${n} `),n=0,t>0&&(f(`[Handler]  ${t} `),t=0),e>0&&(f(`[Handler]  ${e} `),e=0),s>0&&(f(`[Handler]  ${s} `),s=0)),o=l}),Ce.registerHandler("attack_complete",(i,a)=>{const{id:r}=i;a.onAttackComplete&&a.onAttackComplete(r)}),Ce.registerHandler("on_game_round_pass",(i,a)=>{}),Ce.registerHandler("craft_success",(i,a)=>{a.onCraftResult&&a.onCraftResult(!0,i.message||"")}),Ce.registerHandler("craft_failed",(i,a)=>{a.onCraftResult&&a.onCraftResult(!1,i.message||"")}),Ce.registerHandler("cannot_pick_up_item",(i,a)=>{f("[Handler] :",i.message||i)}),Ce.registerHandler("equipment_slot_full",(i,a)=>{f("[Handler] :",i.message||i)}),Ce.registerHandler("inventory_full",(i,a)=>{f("[Handler] :",i.message||i)}),Ce.registerHandler("resource_not_enough",(i,a)=>{let r="";if(i.missing&&Array.isArray(i.missing)&&i.missing.length>0){const l={HeartCrystalDust:"",RecallGear:"",SpiritalSpark:"",RefinedCopper:"",ResonantCrystal:""};r=`: ${i.missing.map(u=>{const d=l[u.type]||u.type,h=u.needed-u.current;return`${d} ( ${h})`}).join("")}`}f("[Handler] :",r),a.onResourceNotEnough&&a.onResourceNotEnough(r)}),Ce.registerHandler("summon_failed",(i,a)=>{f("[Handler] :",i.message||i),a.onSummonFailed&&a.onSummonFailed(i.message||"")}),Ce.registerHandler("summon_expired",(i,a)=>{const{id:r,message:l}=i;f(`[Handler] : ID=${r}, ${l}`)}),Ce.registerHandler("get_summon_menu",(i,a)=>{const{contents:r}=i;f("[Handler] :",r),a.onShowSummonMenu&&a.onShowSummonMenu(r)}),Ce.registerHandler("get_structure_menu",(i,a)=>{const{contents:r}=i;if(!r||r.length===0){f("[Handler]  ");return}const l=r.filter(c=>c.name!=="");f("[Handler] ",l.length,""),a.onShowStructureMenu&&a.onShowStructureMenu(l)}),Ce.registerHandler("drill_resource_generate",(i,a)=>{const{position:r,resource_type:l,amount:c}=i;f(`[Handler] : =${JSON.stringify(r)}, =${l}, =${c}`);const u={[l]:parseInt(c)};a.onShowResourceGain&&a.onShowResourceGain(r,u),zs(Nt.UPDATE_RESOURCES)}),Ce.registerHandler("game_over",(i,a)=>{f("[Handler] "),a.onGameOver&&a.onGameOver()}),Ce.registerHandler("success",(i,a)=>{f("[Handler] "),a.onGameSuccess&&a.onGameSuccess()})}const Wf=Object.freeze(Object.defineProperty({__proto__:null,messageQueue:Ce,registerAllHandlers:Gl},Symbol.toStringTag,{value:"Module"}));Gl();let Le=null,ds=null;ds=(async()=>{try{return Le=await Nl(()=>import("./main-Bp8322Dw.js"),[],import.meta.url),f("[Glue] main.js "),Le}catch(t){return f("[Glue] main.js :",t.message),null}})();async function qf(){return await ds,Le!=null&&Le.global_gacha?JSON.parse(Le.global_gacha()):{type:"error",content:""}}async function Do(){return await ds,Le!=null&&Le.global_get_resource?JSON.parse(Le.global_get_resource()):{}}async function Xf(){return await ds,Le!=null&&Le.global_craft?JSON.parse(Le.global_craft()):{type:"error",content:""}}async function so(){return await ds,Le!=null&&Le.global_get_copper_list?JSON.parse(Le.global_get_copper_list()):[]}async function Yf(t){return await ds,Le!=null&&Le.global_upgrade_copper?JSON.parse(Le.global_upgrade_copper(t)):{type:"error",content:""}}async function Hl(t){await ds,Le!=null&&Le.global_info_subscribe?(Le.global_info_subscribe(e=>{const s=JSON.parse(e);t(s),Ce.enqueue(s)}),f("[Glue] global_info_subscribe ")):f("[Glue] global_info_subscribe ")}async function Jf(t){await ds,Le!=null&&Le.global_import_save&&Le.global_import_save(t)}async function Zf(){return await ds,Le!=null&&Le.global_export_save?JSON.parse(Le.global_export_save()):{type:"error",content:""}}async function Ee(t){await ds,Le!=null&&Le.eventloop?Le.eventloop(t):f("[Glue] eventloop ")}const Qf={class:"draw-screen"},ep={class:"draw-screen__body"},tp={class:"draw-card"},sp={class:"card-face card-back"},np=["src"],op={class:"card-face card-front"},ip=["src"],ap={key:1,class:"card-icon"},rp=["src"],lp={class:"draw-cost"},cp=["src"],up=["disabled","title"],dp={key:0,class:"toast"},fp={__name:"DrawScreen",emits:["draw"],setup(t,{emit:e}){const s=e,n=B(!1),o=B(!0),i=B(!1),a=B(""),r=B(""),l=B(""),c=B({left:0,top:0,width:0,height:0}),u=B(!1),d=B(!1),h=B(!1),m=B("");function _(T){m.value=T||"",h.value=!0,setTimeout(()=>{h.value=!1},1800)}async function E(){try{const y=await Do(),w=Number((y==null?void 0:y.SpiritalSpark)??0);o.value=w>=10}catch{o.value=!1}}function S(){i.value=!1,u.value=!1,d.value=!1}function g(){if(n.value)return;if(E(),!o.value){_("");return}n.value=!0,f("[DrawScreen] runDrawSequence start");const T=document.querySelector(".draw-card");if(T){T.classList.add("is-shaking"),setTimeout(()=>T.classList.remove("is-shaking"),500);const y=T.getBoundingClientRect();c.value={left:Math.round(y.left),top:Math.round(y.top),width:Math.round(y.width),height:Math.round(y.height)}}setTimeout(async()=>{i.value=!0,u.value=!1,d.value=!0;try{const y=await qf();if(y&&y.type==="success"&&y.copper&&y.copper.copper_info){const w=y.copper.copper_info;a.value=w.name||"",r.value="",l.value=F(w.icon_url||""),f("[DrawScreen] tempImage resolved:",l.value),await Rn(),setTimeout(()=>{d.value=!1,setTimeout(()=>{u.value=!0},350)},450),s("draw",{name:w.name,image:w.icon_url||""}),E()}else y&&y.type==="error"&&(i.value=!1,u.value=!1,d.value=!1,_(y.content||""),s("draw",{error:!0}),E())}catch{i.value=!1,u.value=!1,d.value=!1,_(""),s("draw",{error:!0}),E()}finally{setTimeout(()=>{n.value=!1},800)}},600)}return(T,y)=>(D(),j("div",Qf,[p("div",ep,[p("div",tp,[i.value?(D(),j("div",{key:0,class:"draw-temp",onClick:S},[y[3]||(y[3]=p("div",{class:"dim-backdrop"},null,-1)),p("div",{class:"temp-stack",style:Gt({left:c.value.left+"px",top:c.value.top+"px",width:c.value.width+"px",height:c.value.height+"px"}),onClick:y[2]||(y[2]=kt(()=>{},["stop"]))},[p("div",{class:Ye(["card",{flipped:d.value}]),onClick:y[0]||(y[0]=kt(w=>d.value=!d.value,["stop"]))},[p("div",sp,[p("img",{src:ue(F)("frontend_resource/gacha.webp"),alt:"back"},null,8,np)]),p("div",op,[l.value?(D(),j("img",{key:0,src:l.value,alt:"copper",class:"card-front-img"},null,8,ip)):(D(),j("div",ap,se(r.value||""),1))])],2),p("div",{class:Ye(["card-name-below",{show:u.value}]),onClick:y[1]||(y[1]=kt(()=>{},["stop"]))},se(a.value),3)],4)])):ye("",!0),p("img",{class:"draw-card__img",src:ue(F)("frontend_resource/gacha.webp"),alt:"card"},null,8,rp)]),p("div",lp,[p("img",{class:"draw-cost__icon",src:ue(F)("resource/spiritual_spark.webp"),alt:"cost"},null,8,cp),y[4]||(y[4]=p("span",{class:"draw-cost__times"},"X 10",-1))]),p("button",{class:"draw-action",disabled:n.value||!o.value,title:o.value?"":"",onClick:g},"  ",8,up),h.value?(D(),j("div",dp,se(m.value),1)):ye("",!0)])]))}},pp=ut(fp,[["__scopeId","data-v-5ea8b534"]]);function Ya(t,e){if(e===Ec)return console.warn("THREE.BufferGeometryUtils.toTrianglesDrawMode(): Geometry already defined as triangles."),t;if(e===li||e===lr){let s=t.getIndex();if(s===null){const a=[],r=t.getAttribute("position");if(r!==void 0){for(let l=0;l<r.count;l++)a.push(l);t.setIndex(a),s=t.getIndex()}else return console.error("THREE.BufferGeometryUtils.toTrianglesDrawMode(): Undefined position attribute. Processing not possible."),t}const n=s.count-2,o=[];if(e===li)for(let a=1;a<=n;a++)o.push(s.getX(0)),o.push(s.getX(a)),o.push(s.getX(a+1));else for(let a=0;a<n;a++)a%2===0?(o.push(s.getX(a)),o.push(s.getX(a+1)),o.push(s.getX(a+2))):(o.push(s.getX(a+2)),o.push(s.getX(a+1)),o.push(s.getX(a)));o.length/3!==n&&console.error("THREE.BufferGeometryUtils.toTrianglesDrawMode(): Unable to generate correct amount of triangles.");const i=t.clone();return i.setIndex(o),i.clearGroups(),i}else return console.error("THREE.BufferGeometryUtils.toTrianglesDrawMode(): Unknown draw mode:",e),t}class No extends cr{constructor(e){super(e),this.dracoLoader=null,this.ktx2Loader=null,this.meshoptDecoder=null,this.pluginCallbacks=[],this.register(function(s){return new vp(s)}),this.register(function(s){return new yp(s)}),this.register(function(s){return new kp(s)}),this.register(function(s){return new Ap(s)}),this.register(function(s){return new Rp(s)}),this.register(function(s){return new wp(s)}),this.register(function(s){return new Sp(s)}),this.register(function(s){return new Tp(s)}),this.register(function(s){return new Mp(s)}),this.register(function(s){return new gp(s)}),this.register(function(s){return new Cp(s)}),this.register(function(s){return new bp(s)}),this.register(function(s){return new xp(s)}),this.register(function(s){return new Ep(s)}),this.register(function(s){return new mp(s)}),this.register(function(s){return new $p(s)}),this.register(function(s){return new Pp(s)})}load(e,s,n,o){const i=this;let a;if(this.resourcePath!=="")a=this.resourcePath;else if(this.path!==""){const c=gn.extractUrlBase(e);a=gn.resolveURL(c,this.path)}else a=gn.extractUrlBase(e);this.manager.itemStart(e);const r=function(c){o?o(c):console.error(c),i.manager.itemError(e),i.manager.itemEnd(e)},l=new no(this.manager);l.setPath(this.path),l.setResponseType("arraybuffer"),l.setRequestHeader(this.requestHeader),l.setWithCredentials(this.withCredentials),l.load(e,function(c){try{i.parse(c,a,function(u){s(u),i.manager.itemEnd(e)},r)}catch(u){r(u)}},n,r)}setDRACOLoader(e){return this.dracoLoader=e,this}setKTX2Loader(e){return this.ktx2Loader=e,this}setMeshoptDecoder(e){return this.meshoptDecoder=e,this}register(e){return this.pluginCallbacks.indexOf(e)===-1&&this.pluginCallbacks.push(e),this}unregister(e){return this.pluginCallbacks.indexOf(e)!==-1&&this.pluginCallbacks.splice(this.pluginCallbacks.indexOf(e),1),this}parse(e,s,n,o){let i;const a={},r={},l=new TextDecoder;if(typeof e=="string")i=JSON.parse(e);else if(e instanceof ArrayBuffer)if(l.decode(new Uint8Array(e,0,4))===Ul){try{a[Ne.KHR_BINARY_GLTF]=new Lp(e)}catch(d){o&&o(d);return}i=JSON.parse(a[Ne.KHR_BINARY_GLTF].content)}else i=JSON.parse(l.decode(e));else i=e;if(i.asset===void 0||i.asset.version[0]<2){o&&o(new Error("THREE.GLTFLoader: Unsupported asset. glTF versions >=2.0 are supported."));return}const c=new Kp(i,{path:s||this.resourcePath||"",crossOrigin:this.crossOrigin,requestHeader:this.requestHeader,manager:this.manager,ktx2Loader:this.ktx2Loader,meshoptDecoder:this.meshoptDecoder});c.fileLoader.setRequestHeader(this.requestHeader);for(let u=0;u<this.pluginCallbacks.length;u++){const d=this.pluginCallbacks[u](c);d.name||console.error("THREE.GLTFLoader: Invalid plugin found: missing name"),r[d.name]=d,a[d.name]=!0}if(i.extensionsUsed)for(let u=0;u<i.extensionsUsed.length;++u){const d=i.extensionsUsed[u],h=i.extensionsRequired||[];switch(d){case Ne.KHR_MATERIALS_UNLIT:a[d]=new _p;break;case Ne.KHR_DRACO_MESH_COMPRESSION:a[d]=new Ip(i,this.dracoLoader);break;case Ne.KHR_TEXTURE_TRANSFORM:a[d]=new Op;break;case Ne.KHR_MESH_QUANTIZATION:a[d]=new Dp;break;default:h.indexOf(d)>=0&&r[d]===void 0&&console.warn('THREE.GLTFLoader: Unknown extension "'+d+'".')}}c.setExtensions(a),c.setPlugins(r),c.parse(n,o)}parseAsync(e,s){const n=this;return new Promise(function(o,i){n.parse(e,s,o,i)})}}function hp(){let t={};return{get:function(e){return t[e]},add:function(e,s){t[e]=s},remove:function(e){delete t[e]},removeAll:function(){t={}}}}const Ne={KHR_BINARY_GLTF:"KHR_binary_glTF",KHR_DRACO_MESH_COMPRESSION:"KHR_draco_mesh_compression",KHR_LIGHTS_PUNCTUAL:"KHR_lights_punctual",KHR_MATERIALS_CLEARCOAT:"KHR_materials_clearcoat",KHR_MATERIALS_DISPERSION:"KHR_materials_dispersion",KHR_MATERIALS_IOR:"KHR_materials_ior",KHR_MATERIALS_SHEEN:"KHR_materials_sheen",KHR_MATERIALS_SPECULAR:"KHR_materials_specular",KHR_MATERIALS_TRANSMISSION:"KHR_materials_transmission",KHR_MATERIALS_IRIDESCENCE:"KHR_materials_iridescence",KHR_MATERIALS_ANISOTROPY:"KHR_materials_anisotropy",KHR_MATERIALS_UNLIT:"KHR_materials_unlit",KHR_MATERIALS_VOLUME:"KHR_materials_volume",KHR_TEXTURE_BASISU:"KHR_texture_basisu",KHR_TEXTURE_TRANSFORM:"KHR_texture_transform",KHR_MESH_QUANTIZATION:"KHR_mesh_quantization",KHR_MATERIALS_EMISSIVE_STRENGTH:"KHR_materials_emissive_strength",EXT_MATERIALS_BUMP:"EXT_materials_bump",EXT_TEXTURE_WEBP:"EXT_texture_webp",EXT_TEXTURE_AVIF:"EXT_texture_avif",EXT_MESHOPT_COMPRESSION:"EXT_meshopt_compression",EXT_MESH_GPU_INSTANCING:"EXT_mesh_gpu_instancing"};class mp{constructor(e){this.parser=e,this.name=Ne.KHR_LIGHTS_PUNCTUAL,this.cache={refs:{},uses:{}}}_markDefs(){const e=this.parser,s=this.parser.json.nodes||[];for(let n=0,o=s.length;n<o;n++){const i=s[n];i.extensions&&i.extensions[this.name]&&i.extensions[this.name].light!==void 0&&e._addNodeRef(this.cache,i.extensions[this.name].light)}}_loadLight(e){const s=this.parser,n="light:"+e;let o=s.cache.get(n);if(o)return o;const i=s.json,l=((i.extensions&&i.extensions[this.name]||{}).lights||[])[e];let c;const u=new rs(16777215);l.color!==void 0&&u.setRGB(l.color[0],l.color[1],l.color[2],ls);const d=l.range!==void 0?l.range:0;switch(l.type){case"directional":c=new vs(u),c.target.position.set(0,0,-1),c.add(c.target);break;case"point":c=new Zs(u),c.distance=d;break;case"spot":c=new xc(u),c.distance=d,l.spot=l.spot||{},l.spot.innerConeAngle=l.spot.innerConeAngle!==void 0?l.spot.innerConeAngle:0,l.spot.outerConeAngle=l.spot.outerConeAngle!==void 0?l.spot.outerConeAngle:Math.PI/4,c.angle=l.spot.outerConeAngle,c.penumbra=1-l.spot.innerConeAngle/l.spot.outerConeAngle,c.target.position.set(0,0,-1),c.add(c.target);break;default:throw new Error("THREE.GLTFLoader: Unexpected light type: "+l.type)}return c.position.set(0,0,0),is(c,l),l.intensity!==void 0&&(c.intensity=l.intensity),c.name=s.createUniqueName(l.name||"light_"+e),o=Promise.resolve(c),s.cache.add(n,o),o}getDependency(e,s){if(e==="light")return this._loadLight(s)}createNodeAttachment(e){const s=this,n=this.parser,i=n.json.nodes[e],r=(i.extensions&&i.extensions[this.name]||{}).light;return r===void 0?null:this._loadLight(r).then(function(l){return n._getNodeRef(s.cache,r,l)})}}class _p{constructor(){this.name=Ne.KHR_MATERIALS_UNLIT}getMaterialType(){return $t}extendParams(e,s,n){const o=[];e.color=new rs(1,1,1),e.opacity=1;const i=s.pbrMetallicRoughness;if(i){if(Array.isArray(i.baseColorFactor)){const a=i.baseColorFactor;e.color.setRGB(a[0],a[1],a[2],ls),e.opacity=a[3]}i.baseColorTexture!==void 0&&o.push(n.assignTexture(e,"map",i.baseColorTexture,ys))}return Promise.all(o)}}class gp{constructor(e){this.parser=e,this.name=Ne.KHR_MATERIALS_EMISSIVE_STRENGTH}extendMaterialParams(e,s){const o=this.parser.json.materials[e];if(!o.extensions||!o.extensions[this.name])return Promise.resolve();const i=o.extensions[this.name].emissiveStrength;return i!==void 0&&(s.emissiveIntensity=i),Promise.resolve()}}class vp{constructor(e){this.parser=e,this.name=Ne.KHR_MATERIALS_CLEARCOAT}getMaterialType(e){const n=this.parser.json.materials[e];return!n.extensions||!n.extensions[this.name]?null:cs}extendMaterialParams(e,s){const n=this.parser,o=n.json.materials[e];if(!o.extensions||!o.extensions[this.name])return Promise.resolve();const i=[],a=o.extensions[this.name];if(a.clearcoatFactor!==void 0&&(s.clearcoat=a.clearcoatFactor),a.clearcoatTexture!==void 0&&i.push(n.assignTexture(s,"clearcoatMap",a.clearcoatTexture)),a.clearcoatRoughnessFactor!==void 0&&(s.clearcoatRoughness=a.clearcoatRoughnessFactor),a.clearcoatRoughnessTexture!==void 0&&i.push(n.assignTexture(s,"clearcoatRoughnessMap",a.clearcoatRoughnessTexture)),a.clearcoatNormalTexture!==void 0&&(i.push(n.assignTexture(s,"clearcoatNormalMap",a.clearcoatNormalTexture)),a.clearcoatNormalTexture.scale!==void 0)){const r=a.clearcoatNormalTexture.scale;s.clearcoatNormalScale=new It(r,r)}return Promise.all(i)}}class yp{constructor(e){this.parser=e,this.name=Ne.KHR_MATERIALS_DISPERSION}getMaterialType(e){const n=this.parser.json.materials[e];return!n.extensions||!n.extensions[this.name]?null:cs}extendMaterialParams(e,s){const o=this.parser.json.materials[e];if(!o.extensions||!o.extensions[this.name])return Promise.resolve();const i=o.extensions[this.name];return s.dispersion=i.dispersion!==void 0?i.dispersion:0,Promise.resolve()}}class bp{constructor(e){this.parser=e,this.name=Ne.KHR_MATERIALS_IRIDESCENCE}getMaterialType(e){const n=this.parser.json.materials[e];return!n.extensions||!n.extensions[this.name]?null:cs}extendMaterialParams(e,s){const n=this.parser,o=n.json.materials[e];if(!o.extensions||!o.extensions[this.name])return Promise.resolve();const i=[],a=o.extensions[this.name];return a.iridescenceFactor!==void 0&&(s.iridescence=a.iridescenceFactor),a.iridescenceTexture!==void 0&&i.push(n.assignTexture(s,"iridescenceMap",a.iridescenceTexture)),a.iridescenceIor!==void 0&&(s.iridescenceIOR=a.iridescenceIor),s.iridescenceThicknessRange===void 0&&(s.iridescenceThicknessRange=[100,400]),a.iridescenceThicknessMinimum!==void 0&&(s.iridescenceThicknessRange[0]=a.iridescenceThicknessMinimum),a.iridescenceThicknessMaximum!==void 0&&(s.iridescenceThicknessRange[1]=a.iridescenceThicknessMaximum),a.iridescenceThicknessTexture!==void 0&&i.push(n.assignTexture(s,"iridescenceThicknessMap",a.iridescenceThicknessTexture)),Promise.all(i)}}class wp{constructor(e){this.parser=e,this.name=Ne.KHR_MATERIALS_SHEEN}getMaterialType(e){const n=this.parser.json.materials[e];return!n.extensions||!n.extensions[this.name]?null:cs}extendMaterialParams(e,s){const n=this.parser,o=n.json.materials[e];if(!o.extensions||!o.extensions[this.name])return Promise.resolve();const i=[];s.sheenColor=new rs(0,0,0),s.sheenRoughness=0,s.sheen=1;const a=o.extensions[this.name];if(a.sheenColorFactor!==void 0){const r=a.sheenColorFactor;s.sheenColor.setRGB(r[0],r[1],r[2],ls)}return a.sheenRoughnessFactor!==void 0&&(s.sheenRoughness=a.sheenRoughnessFactor),a.sheenColorTexture!==void 0&&i.push(n.assignTexture(s,"sheenColorMap",a.sheenColorTexture,ys)),a.sheenRoughnessTexture!==void 0&&i.push(n.assignTexture(s,"sheenRoughnessMap",a.sheenRoughnessTexture)),Promise.all(i)}}class Sp{constructor(e){this.parser=e,this.name=Ne.KHR_MATERIALS_TRANSMISSION}getMaterialType(e){const n=this.parser.json.materials[e];return!n.extensions||!n.extensions[this.name]?null:cs}extendMaterialParams(e,s){const n=this.parser,o=n.json.materials[e];if(!o.extensions||!o.extensions[this.name])return Promise.resolve();const i=[],a=o.extensions[this.name];return a.transmissionFactor!==void 0&&(s.transmission=a.transmissionFactor),a.transmissionTexture!==void 0&&i.push(n.assignTexture(s,"transmissionMap",a.transmissionTexture)),Promise.all(i)}}class Tp{constructor(e){this.parser=e,this.name=Ne.KHR_MATERIALS_VOLUME}getMaterialType(e){const n=this.parser.json.materials[e];return!n.extensions||!n.extensions[this.name]?null:cs}extendMaterialParams(e,s){const n=this.parser,o=n.json.materials[e];if(!o.extensions||!o.extensions[this.name])return Promise.resolve();const i=[],a=o.extensions[this.name];s.thickness=a.thicknessFactor!==void 0?a.thicknessFactor:0,a.thicknessTexture!==void 0&&i.push(n.assignTexture(s,"thicknessMap",a.thicknessTexture)),s.attenuationDistance=a.attenuationDistance||1/0;const r=a.attenuationColor||[1,1,1];return s.attenuationColor=new rs().setRGB(r[0],r[1],r[2],ls),Promise.all(i)}}class Mp{constructor(e){this.parser=e,this.name=Ne.KHR_MATERIALS_IOR}getMaterialType(e){const n=this.parser.json.materials[e];return!n.extensions||!n.extensions[this.name]?null:cs}extendMaterialParams(e,s){const o=this.parser.json.materials[e];if(!o.extensions||!o.extensions[this.name])return Promise.resolve();const i=o.extensions[this.name];return s.ior=i.ior!==void 0?i.ior:1.5,Promise.resolve()}}class Cp{constructor(e){this.parser=e,this.name=Ne.KHR_MATERIALS_SPECULAR}getMaterialType(e){const n=this.parser.json.materials[e];return!n.extensions||!n.extensions[this.name]?null:cs}extendMaterialParams(e,s){const n=this.parser,o=n.json.materials[e];if(!o.extensions||!o.extensions[this.name])return Promise.resolve();const i=[],a=o.extensions[this.name];s.specularIntensity=a.specularFactor!==void 0?a.specularFactor:1,a.specularTexture!==void 0&&i.push(n.assignTexture(s,"specularIntensityMap",a.specularTexture));const r=a.specularColorFactor||[1,1,1];return s.specularColor=new rs().setRGB(r[0],r[1],r[2],ls),a.specularColorTexture!==void 0&&i.push(n.assignTexture(s,"specularColorMap",a.specularColorTexture,ys)),Promise.all(i)}}class Ep{constructor(e){this.parser=e,this.name=Ne.EXT_MATERIALS_BUMP}getMaterialType(e){const n=this.parser.json.materials[e];return!n.extensions||!n.extensions[this.name]?null:cs}extendMaterialParams(e,s){const n=this.parser,o=n.json.materials[e];if(!o.extensions||!o.extensions[this.name])return Promise.resolve();const i=[],a=o.extensions[this.name];return s.bumpScale=a.bumpFactor!==void 0?a.bumpFactor:1,a.bumpTexture!==void 0&&i.push(n.assignTexture(s,"bumpMap",a.bumpTexture)),Promise.all(i)}}class xp{constructor(e){this.parser=e,this.name=Ne.KHR_MATERIALS_ANISOTROPY}getMaterialType(e){const n=this.parser.json.materials[e];return!n.extensions||!n.extensions[this.name]?null:cs}extendMaterialParams(e,s){const n=this.parser,o=n.json.materials[e];if(!o.extensions||!o.extensions[this.name])return Promise.resolve();const i=[],a=o.extensions[this.name];return a.anisotropyStrength!==void 0&&(s.anisotropy=a.anisotropyStrength),a.anisotropyRotation!==void 0&&(s.anisotropyRotation=a.anisotropyRotation),a.anisotropyTexture!==void 0&&i.push(n.assignTexture(s,"anisotropyMap",a.anisotropyTexture)),Promise.all(i)}}class kp{constructor(e){this.parser=e,this.name=Ne.KHR_TEXTURE_BASISU}loadTexture(e){const s=this.parser,n=s.json,o=n.textures[e];if(!o.extensions||!o.extensions[this.name])return null;const i=o.extensions[this.name],a=s.options.ktx2Loader;if(!a){if(n.extensionsRequired&&n.extensionsRequired.indexOf(this.name)>=0)throw new Error("THREE.GLTFLoader: setKTX2Loader must be called before loading KTX2 textures");return null}return s.loadTextureImage(e,i.source,a)}}class Ap{constructor(e){this.parser=e,this.name=Ne.EXT_TEXTURE_WEBP}loadTexture(e){const s=this.name,n=this.parser,o=n.json,i=o.textures[e];if(!i.extensions||!i.extensions[s])return null;const a=i.extensions[s],r=o.images[a.source];let l=n.textureLoader;if(r.uri){const c=n.options.manager.getHandler(r.uri);c!==null&&(l=c)}return n.loadTextureImage(e,a.source,l)}}class Rp{constructor(e){this.parser=e,this.name=Ne.EXT_TEXTURE_AVIF}loadTexture(e){const s=this.name,n=this.parser,o=n.json,i=o.textures[e];if(!i.extensions||!i.extensions[s])return null;const a=i.extensions[s],r=o.images[a.source];let l=n.textureLoader;if(r.uri){const c=n.options.manager.getHandler(r.uri);c!==null&&(l=c)}return n.loadTextureImage(e,a.source,l)}}class $p{constructor(e){this.name=Ne.EXT_MESHOPT_COMPRESSION,this.parser=e}loadBufferView(e){const s=this.parser.json,n=s.bufferViews[e];if(n.extensions&&n.extensions[this.name]){const o=n.extensions[this.name],i=this.parser.getDependency("buffer",o.buffer),a=this.parser.options.meshoptDecoder;if(!a||!a.supported){if(s.extensionsRequired&&s.extensionsRequired.indexOf(this.name)>=0)throw new Error("THREE.GLTFLoader: setMeshoptDecoder must be called before loading compressed files");return null}return i.then(function(r){const l=o.byteOffset||0,c=o.byteLength||0,u=o.count,d=o.byteStride,h=new Uint8Array(r,l,c);return a.decodeGltfBufferAsync?a.decodeGltfBufferAsync(u,d,h,o.mode,o.filter).then(function(m){return m.buffer}):a.ready.then(function(){const m=new ArrayBuffer(u*d);return a.decodeGltfBuffer(new Uint8Array(m),u,d,h,o.mode,o.filter),m})})}else return null}}class Pp{constructor(e){this.name=Ne.EXT_MESH_GPU_INSTANCING,this.parser=e}createNodeMesh(e){const s=this.parser.json,n=s.nodes[e];if(!n.extensions||!n.extensions[this.name]||n.mesh===void 0)return null;const o=s.meshes[n.mesh];for(const c of o.primitives)if(c.mode!==jt.TRIANGLES&&c.mode!==jt.TRIANGLE_STRIP&&c.mode!==jt.TRIANGLE_FAN&&c.mode!==void 0)return null;const a=n.extensions[this.name].attributes,r=[],l={};for(const c in a)r.push(this.parser.getDependency("accessor",a[c]).then(u=>(l[c]=u,l[c])));return r.length<1?null:(r.push(this.parser.createNodeMesh(e)),Promise.all(r).then(c=>{const u=c.pop(),d=u.isGroup?u.children:[u],h=c[0].count,m=[];for(const _ of d){const E=new Vs,S=new xe,g=new cn,T=new xe(1,1,1),y=new ur(_.geometry,_.material,h);for(let w=0;w<h;w++)l.TRANSLATION&&S.fromBufferAttribute(l.TRANSLATION,w),l.ROTATION&&g.fromBufferAttribute(l.ROTATION,w),l.SCALE&&T.fromBufferAttribute(l.SCALE,w),y.setMatrixAt(w,E.compose(S,g,T));for(const w in l)if(w==="_COLOR_0"){const $=l[w];y.instanceColor=new kc($.array,$.itemSize,$.normalized)}else w!=="TRANSLATION"&&w!=="ROTATION"&&w!=="SCALE"&&_.geometry.setAttribute(w,l[w]);dr.prototype.copy.call(y,_),this.parser.assignFinalMaterial(y),m.push(y)}return u.isGroup?(u.clear(),u.add(...m),u):m[0]}))}}const Ul="glTF",mn=12,Ja={JSON:1313821514,BIN:5130562};class Lp{constructor(e){this.name=Ne.KHR_BINARY_GLTF,this.content=null,this.body=null;const s=new DataView(e,0,mn),n=new TextDecoder;if(this.header={magic:n.decode(new Uint8Array(e.slice(0,4))),version:s.getUint32(4,!0),length:s.getUint32(8,!0)},this.header.magic!==Ul)throw new Error("THREE.GLTFLoader: Unsupported glTF-Binary header.");if(this.header.version<2)throw new Error("THREE.GLTFLoader: Legacy binary file detected.");const o=this.header.length-mn,i=new DataView(e,mn);let a=0;for(;a<o;){const r=i.getUint32(a,!0);a+=4;const l=i.getUint32(a,!0);if(a+=4,l===Ja.JSON){const c=new Uint8Array(e,mn+a,r);this.content=n.decode(c)}else if(l===Ja.BIN){const c=mn+a;this.body=e.slice(c,c+r)}a+=r}if(this.content===null)throw new Error("THREE.GLTFLoader: JSON content not found.")}}class Ip{constructor(e,s){if(!s)throw new Error("THREE.GLTFLoader: No DRACOLoader instance provided.");this.name=Ne.KHR_DRACO_MESH_COMPRESSION,this.json=e,this.dracoLoader=s,this.dracoLoader.preload()}decodePrimitive(e,s){const n=this.json,o=this.dracoLoader,i=e.extensions[this.name].bufferView,a=e.extensions[this.name].attributes,r={},l={},c={};for(const u in a){const d=ki[u]||u.toLowerCase();r[d]=a[u]}for(const u in e.attributes){const d=ki[u]||u.toLowerCase();if(a[u]!==void 0){const h=n.accessors[e.attributes[u]],m=ln[h.componentType];c[d]=m.name,l[d]=h.normalized===!0}}return s.getDependency("bufferView",i).then(function(u){return new Promise(function(d,h){o.decodeDracoFile(u,function(m){for(const _ in m.attributes){const E=m.attributes[_],S=l[_];S!==void 0&&(E.normalized=S)}d(m)},r,c,ls,h)})})}}class Op{constructor(){this.name=Ne.KHR_TEXTURE_TRANSFORM}extendTexture(e,s){return(s.texCoord===void 0||s.texCoord===e.channel)&&s.offset===void 0&&s.rotation===void 0&&s.scale===void 0||(e=e.clone(),s.texCoord!==void 0&&(e.channel=s.texCoord),s.offset!==void 0&&e.offset.fromArray(s.offset),s.rotation!==void 0&&(e.rotation=s.rotation),s.scale!==void 0&&e.repeat.fromArray(s.scale),e.needsUpdate=!0),e}}class Dp{constructor(){this.name=Ne.KHR_MESH_QUANTIZATION}}class Fl extends Zc{constructor(e,s,n,o){super(e,s,n,o)}copySampleValue_(e){const s=this.resultBuffer,n=this.sampleValues,o=this.valueSize,i=e*o*3+o;for(let a=0;a!==o;a++)s[a]=n[i+a];return s}interpolate_(e,s,n,o){const i=this.resultBuffer,a=this.sampleValues,r=this.valueSize,l=r*2,c=r*3,u=o-s,d=(n-s)/u,h=d*d,m=h*d,_=e*c,E=_-c,S=-2*m+3*h,g=m-h,T=1-S,y=g-h+d;for(let w=0;w!==r;w++){const $=a[E+w+r],z=a[E+w+l]*u,V=a[_+w+r],H=a[_+w]*u;i[w]=T*$+y*z+S*V+g*H}return i}}const Np=new cn;class Gp extends Fl{interpolate_(e,s,n,o){const i=super.interpolate_(e,s,n,o);return Np.fromArray(i).normalize().toArray(i),i}}const jt={POINTS:0,LINES:1,LINE_LOOP:2,LINE_STRIP:3,TRIANGLES:4,TRIANGLE_STRIP:5,TRIANGLE_FAN:6},ln={5120:Int8Array,5121:Uint8Array,5122:Int16Array,5123:Uint16Array,5125:Uint32Array,5126:Float32Array},Za={9728:pr,9729:ci,9984:Ic,9985:Lc,9986:Pc,9987:fr},Qa={33071:Dc,33648:Oc,10497:ui},si={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16},ki={POSITION:"position",NORMAL:"normal",TANGENT:"tangent",TEXCOORD_0:"uv",TEXCOORD_1:"uv1",TEXCOORD_2:"uv2",TEXCOORD_3:"uv3",COLOR_0:"color",WEIGHTS_0:"skinWeight",JOINTS_0:"skinIndex"},Ms={scale:"scale",translation:"position",rotation:"quaternion",weights:"morphTargetInfluences"},Hp={CUBICSPLINE:void 0,LINEAR:_r,STEP:Xc},ni={OPAQUE:"OPAQUE",MASK:"MASK",BLEND:"BLEND"};function Up(t){return t.DefaultMaterial===void 0&&(t.DefaultMaterial=new Dt({color:16777215,emissive:0,metalness:1,roughness:1,transparent:!1,depthTest:!0,side:Jc})),t.DefaultMaterial}function Fs(t,e,s){for(const n in s.extensions)t[n]===void 0&&(e.userData.gltfExtensions=e.userData.gltfExtensions||{},e.userData.gltfExtensions[n]=s.extensions[n])}function is(t,e){e.extras!==void 0&&(typeof e.extras=="object"?Object.assign(t.userData,e.extras):console.warn("THREE.GLTFLoader: Ignoring primitive type .extras, "+e.extras))}function Fp(t,e,s){let n=!1,o=!1,i=!1;for(let c=0,u=e.length;c<u;c++){const d=e[c];if(d.POSITION!==void 0&&(n=!0),d.NORMAL!==void 0&&(o=!0),d.COLOR_0!==void 0&&(i=!0),n&&o&&i)break}if(!n&&!o&&!i)return Promise.resolve(t);const a=[],r=[],l=[];for(let c=0,u=e.length;c<u;c++){const d=e[c];if(n){const h=d.POSITION!==void 0?s.getDependency("accessor",d.POSITION):t.attributes.position;a.push(h)}if(o){const h=d.NORMAL!==void 0?s.getDependency("accessor",d.NORMAL):t.attributes.normal;r.push(h)}if(i){const h=d.COLOR_0!==void 0?s.getDependency("accessor",d.COLOR_0):t.attributes.color;l.push(h)}}return Promise.all([Promise.all(a),Promise.all(r),Promise.all(l)]).then(function(c){const u=c[0],d=c[1],h=c[2];return n&&(t.morphAttributes.position=u),o&&(t.morphAttributes.normal=d),i&&(t.morphAttributes.color=h),t.morphTargetsRelative=!0,t})}function Bp(t,e){if(t.updateMorphTargets(),e.weights!==void 0)for(let s=0,n=e.weights.length;s<n;s++)t.morphTargetInfluences[s]=e.weights[s];if(e.extras&&Array.isArray(e.extras.targetNames)){const s=e.extras.targetNames;if(t.morphTargetInfluences.length===s.length){t.morphTargetDictionary={};for(let n=0,o=s.length;n<o;n++)t.morphTargetDictionary[s[n]]=n}else console.warn("THREE.GLTFLoader: Invalid extras.targetNames length. Ignoring names.")}}function jp(t){let e;const s=t.extensions&&t.extensions[Ne.KHR_DRACO_MESH_COMPRESSION];if(s?e="draco:"+s.bufferView+":"+s.indices+":"+oi(s.attributes):e=t.indices+":"+oi(t.attributes)+":"+t.mode,t.targets!==void 0)for(let n=0,o=t.targets.length;n<o;n++)e+=":"+oi(t.targets[n]);return e}function oi(t){let e="";const s=Object.keys(t).sort();for(let n=0,o=s.length;n<o;n++)e+=s[n]+":"+t[s[n]]+";";return e}function Ai(t){switch(t){case Int8Array:return 1/127;case Uint8Array:return 1/255;case Int16Array:return 1/32767;case Uint16Array:return 1/65535;default:throw new Error("THREE.GLTFLoader: Unsupported normalized accessor component type.")}}function zp(t){return t.search(/\.jpe?g($|\?)/i)>0||t.search(/^data\:image\/jpeg/)===0?"image/jpeg":t.search(/\.webp($|\?)/i)>0||t.search(/^data\:image\/webp/)===0?"image/webp":t.search(/\.ktx2($|\?)/i)>0||t.search(/^data\:image\/ktx2/)===0?"image/ktx2":"image/png"}const Vp=new Vs;class Kp{constructor(e={},s={}){this.json=e,this.extensions={},this.plugins={},this.options=s,this.cache=new hp,this.associations=new Map,this.primitiveCache={},this.nodeCache={},this.meshCache={refs:{},uses:{}},this.cameraCache={refs:{},uses:{}},this.lightCache={refs:{},uses:{}},this.sourceCache={},this.textureCache={},this.nodeNamesUsed={};let n=!1,o=-1,i=!1,a=-1;if(typeof navigator<"u"){const r=navigator.userAgent;n=/^((?!chrome|android).)*safari/i.test(r)===!0;const l=r.match(/Version\/(\d+)/);o=n&&l?parseInt(l[1],10):-1,i=r.indexOf("Firefox")>-1,a=i?r.match(/Firefox\/([0-9]+)\./)[1]:-1}typeof createImageBitmap>"u"||n&&o<17||i&&a<98?this.textureLoader=new Ac(this.options.manager):this.textureLoader=new Rc(this.options.manager),this.textureLoader.setCrossOrigin(this.options.crossOrigin),this.textureLoader.setRequestHeader(this.options.requestHeader),this.fileLoader=new no(this.options.manager),this.fileLoader.setResponseType("arraybuffer"),this.options.crossOrigin==="use-credentials"&&this.fileLoader.setWithCredentials(!0)}setExtensions(e){this.extensions=e}setPlugins(e){this.plugins=e}parse(e,s){const n=this,o=this.json,i=this.extensions;this.cache.removeAll(),this.nodeCache={},this._invokeAll(function(a){return a._markDefs&&a._markDefs()}),Promise.all(this._invokeAll(function(a){return a.beforeRoot&&a.beforeRoot()})).then(function(){return Promise.all([n.getDependencies("scene"),n.getDependencies("animation"),n.getDependencies("camera")])}).then(function(a){const r={scene:a[0][o.scene||0],scenes:a[0],animations:a[1],cameras:a[2],asset:o.asset,parser:n,userData:{}};return Fs(i,r,o),is(r,o),Promise.all(n._invokeAll(function(l){return l.afterRoot&&l.afterRoot(r)})).then(function(){for(const l of r.scenes)l.updateMatrixWorld();e(r)})}).catch(s)}_markDefs(){const e=this.json.nodes||[],s=this.json.skins||[],n=this.json.meshes||[];for(let o=0,i=s.length;o<i;o++){const a=s[o].joints;for(let r=0,l=a.length;r<l;r++)e[a[r]].isBone=!0}for(let o=0,i=e.length;o<i;o++){const a=e[o];a.mesh!==void 0&&(this._addNodeRef(this.meshCache,a.mesh),a.skin!==void 0&&(n[a.mesh].isSkinnedMesh=!0)),a.camera!==void 0&&this._addNodeRef(this.cameraCache,a.camera)}}_addNodeRef(e,s){s!==void 0&&(e.refs[s]===void 0&&(e.refs[s]=e.uses[s]=0),e.refs[s]++)}_getNodeRef(e,s,n){if(e.refs[s]<=1)return n;const o=n.clone(),i=(a,r)=>{const l=this.associations.get(a);l!=null&&this.associations.set(r,l);for(const[c,u]of a.children.entries())i(u,r.children[c])};return i(n,o),o.name+="_instance_"+e.uses[s]++,o}_invokeOne(e){const s=Object.values(this.plugins);s.push(this);for(let n=0;n<s.length;n++){const o=e(s[n]);if(o)return o}return null}_invokeAll(e){const s=Object.values(this.plugins);s.unshift(this);const n=[];for(let o=0;o<s.length;o++){const i=e(s[o]);i&&n.push(i)}return n}getDependency(e,s){const n=e+":"+s;let o=this.cache.get(n);if(!o){switch(e){case"scene":o=this.loadScene(s);break;case"node":o=this._invokeOne(function(i){return i.loadNode&&i.loadNode(s)});break;case"mesh":o=this._invokeOne(function(i){return i.loadMesh&&i.loadMesh(s)});break;case"accessor":o=this.loadAccessor(s);break;case"bufferView":o=this._invokeOne(function(i){return i.loadBufferView&&i.loadBufferView(s)});break;case"buffer":o=this.loadBuffer(s);break;case"material":o=this._invokeOne(function(i){return i.loadMaterial&&i.loadMaterial(s)});break;case"texture":o=this._invokeOne(function(i){return i.loadTexture&&i.loadTexture(s)});break;case"skin":o=this.loadSkin(s);break;case"animation":o=this._invokeOne(function(i){return i.loadAnimation&&i.loadAnimation(s)});break;case"camera":o=this.loadCamera(s);break;default:if(o=this._invokeOne(function(i){return i!=this&&i.getDependency&&i.getDependency(e,s)}),!o)throw new Error("Unknown type: "+e);break}this.cache.add(n,o)}return o}getDependencies(e){let s=this.cache.get(e);if(!s){const n=this,o=this.json[e+(e==="mesh"?"es":"s")]||[];s=Promise.all(o.map(function(i,a){return n.getDependency(e,a)})),this.cache.add(e,s)}return s}loadBuffer(e){const s=this.json.buffers[e],n=this.fileLoader;if(s.type&&s.type!=="arraybuffer")throw new Error("THREE.GLTFLoader: "+s.type+" buffer type is not supported.");if(s.uri===void 0&&e===0)return Promise.resolve(this.extensions[Ne.KHR_BINARY_GLTF].body);const o=this.options;return new Promise(function(i,a){n.load(gn.resolveURL(s.uri,o.path),i,void 0,function(){a(new Error('THREE.GLTFLoader: Failed to load buffer "'+s.uri+'".'))})})}loadBufferView(e){const s=this.json.bufferViews[e];return this.getDependency("buffer",s.buffer).then(function(n){const o=s.byteLength||0,i=s.byteOffset||0;return n.slice(i,i+o)})}loadAccessor(e){const s=this,n=this.json,o=this.json.accessors[e];if(o.bufferView===void 0&&o.sparse===void 0){const a=si[o.type],r=ln[o.componentType],l=o.normalized===!0,c=new r(o.count*a);return Promise.resolve(new vn(c,a,l))}const i=[];return o.bufferView!==void 0?i.push(this.getDependency("bufferView",o.bufferView)):i.push(null),o.sparse!==void 0&&(i.push(this.getDependency("bufferView",o.sparse.indices.bufferView)),i.push(this.getDependency("bufferView",o.sparse.values.bufferView))),Promise.all(i).then(function(a){const r=a[0],l=si[o.type],c=ln[o.componentType],u=c.BYTES_PER_ELEMENT,d=u*l,h=o.byteOffset||0,m=o.bufferView!==void 0?n.bufferViews[o.bufferView].byteStride:void 0,_=o.normalized===!0;let E,S;if(m&&m!==d){const g=Math.floor(h/m),T="InterleavedBuffer:"+o.bufferView+":"+o.componentType+":"+g+":"+o.count;let y=s.cache.get(T);y||(E=new c(r,g*m,o.count*m/u),y=new $c(E,m/u),s.cache.add(T,y)),S=new Yc(y,l,h%m/u,_)}else r===null?E=new c(o.count*l):E=new c(r,h,o.count*l),S=new vn(E,l,_);if(o.sparse!==void 0){const g=si.SCALAR,T=ln[o.sparse.indices.componentType],y=o.sparse.indices.byteOffset||0,w=o.sparse.values.byteOffset||0,$=new T(a[1],y,o.sparse.count*g),z=new c(a[2],w,o.sparse.count*l);r!==null&&(S=new vn(S.array.slice(),S.itemSize,S.normalized)),S.normalized=!1;for(let V=0,H=$.length;V<H;V++){const G=$[V];if(S.setX(G,z[V*l]),l>=2&&S.setY(G,z[V*l+1]),l>=3&&S.setZ(G,z[V*l+2]),l>=4&&S.setW(G,z[V*l+3]),l>=5)throw new Error("THREE.GLTFLoader: Unsupported itemSize in sparse BufferAttribute.")}S.normalized=_}return S})}loadTexture(e){const s=this.json,n=this.options,i=s.textures[e].source,a=s.images[i];let r=this.textureLoader;if(a.uri){const l=n.manager.getHandler(a.uri);l!==null&&(r=l)}return this.loadTextureImage(e,i,r)}loadTextureImage(e,s,n){const o=this,i=this.json,a=i.textures[e],r=i.images[s],l=(r.uri||r.bufferView)+":"+a.sampler;if(this.textureCache[l])return this.textureCache[l];const c=this.loadImageSource(s,n).then(function(u){u.flipY=!1,u.name=a.name||r.name||"",u.name===""&&typeof r.uri=="string"&&r.uri.startsWith("data:image/")===!1&&(u.name=r.uri);const h=(i.samplers||{})[a.sampler]||{};return u.magFilter=Za[h.magFilter]||ci,u.minFilter=Za[h.minFilter]||fr,u.wrapS=Qa[h.wrapS]||ui,u.wrapT=Qa[h.wrapT]||ui,u.generateMipmaps=!u.isCompressedTexture&&u.minFilter!==pr&&u.minFilter!==ci,o.associations.set(u,{textures:e}),u}).catch(function(){return null});return this.textureCache[l]=c,c}loadImageSource(e,s){const n=this,o=this.json,i=this.options;if(this.sourceCache[e]!==void 0)return this.sourceCache[e].then(d=>d.clone());const a=o.images[e],r=self.URL||self.webkitURL;let l=a.uri||"",c=!1;if(a.bufferView!==void 0)l=n.getDependency("bufferView",a.bufferView).then(function(d){c=!0;const h=new Blob([d],{type:a.mimeType});return l=r.createObjectURL(h),l});else if(a.uri===void 0)throw new Error("THREE.GLTFLoader: Image "+e+" is missing URI and bufferView");const u=Promise.resolve(l).then(function(d){return new Promise(function(h,m){let _=h;s.isImageBitmapLoader===!0&&(_=function(E){const S=new oa(E);S.needsUpdate=!0,h(S)}),s.load(gn.resolveURL(d,i.path),_,void 0,m)})}).then(function(d){return c===!0&&r.revokeObjectURL(l),is(d,a),d.userData.mimeType=a.mimeType||zp(a.uri),d}).catch(function(d){throw console.error("THREE.GLTFLoader: Couldn't load texture",l),d});return this.sourceCache[e]=u,u}assignTexture(e,s,n,o){const i=this;return this.getDependency("texture",n.index).then(function(a){if(!a)return null;if(n.texCoord!==void 0&&n.texCoord>0&&(a=a.clone(),a.channel=n.texCoord),i.extensions[Ne.KHR_TEXTURE_TRANSFORM]){const r=n.extensions!==void 0?n.extensions[Ne.KHR_TEXTURE_TRANSFORM]:void 0;if(r){const l=i.associations.get(a);a=i.extensions[Ne.KHR_TEXTURE_TRANSFORM].extendTexture(a,r),i.associations.set(a,l)}}return o!==void 0&&(a.colorSpace=o),e[s]=a,a})}assignFinalMaterial(e){const s=e.geometry;let n=e.material;const o=s.attributes.tangent===void 0,i=s.attributes.color!==void 0,a=s.attributes.normal===void 0;if(e.isPoints){const r="PointsMaterial:"+n.uuid;let l=this.cache.get(r);l||(l=new Nc,Bo.prototype.copy.call(l,n),l.color.copy(n.color),l.map=n.map,l.sizeAttenuation=!1,this.cache.add(r,l)),n=l}else if(e.isLine){const r="LineBasicMaterial:"+n.uuid;let l=this.cache.get(r);l||(l=new Gc,Bo.prototype.copy.call(l,n),l.color.copy(n.color),l.map=n.map,this.cache.add(r,l)),n=l}if(o||i||a){let r="ClonedMaterial:"+n.uuid+":";o&&(r+="derivative-tangents:"),i&&(r+="vertex-colors:"),a&&(r+="flat-shading:");let l=this.cache.get(r);l||(l=n.clone(),i&&(l.vertexColors=!0),a&&(l.flatShading=!0),o&&(l.normalScale&&(l.normalScale.y*=-1),l.clearcoatNormalScale&&(l.clearcoatNormalScale.y*=-1)),this.cache.add(r,l),this.associations.set(l,this.associations.get(n))),n=l}e.material=n}getMaterialType(){return Dt}loadMaterial(e){const s=this,n=this.json,o=this.extensions,i=n.materials[e];let a;const r={},l=i.extensions||{},c=[];if(l[Ne.KHR_MATERIALS_UNLIT]){const d=o[Ne.KHR_MATERIALS_UNLIT];a=d.getMaterialType(),c.push(d.extendParams(r,i,s))}else{const d=i.pbrMetallicRoughness||{};if(r.color=new rs(1,1,1),r.opacity=1,Array.isArray(d.baseColorFactor)){const h=d.baseColorFactor;r.color.setRGB(h[0],h[1],h[2],ls),r.opacity=h[3]}d.baseColorTexture!==void 0&&c.push(s.assignTexture(r,"map",d.baseColorTexture,ys)),r.metalness=d.metallicFactor!==void 0?d.metallicFactor:1,r.roughness=d.roughnessFactor!==void 0?d.roughnessFactor:1,d.metallicRoughnessTexture!==void 0&&(c.push(s.assignTexture(r,"metalnessMap",d.metallicRoughnessTexture)),c.push(s.assignTexture(r,"roughnessMap",d.metallicRoughnessTexture))),a=this._invokeOne(function(h){return h.getMaterialType&&h.getMaterialType(e)}),c.push(Promise.all(this._invokeAll(function(h){return h.extendMaterialParams&&h.extendMaterialParams(e,r)})))}i.doubleSided===!0&&(r.side=ks);const u=i.alphaMode||ni.OPAQUE;if(u===ni.BLEND?(r.transparent=!0,r.depthWrite=!1):(r.transparent=!1,u===ni.MASK&&(r.alphaTest=i.alphaCutoff!==void 0?i.alphaCutoff:.5)),i.normalTexture!==void 0&&a!==$t&&(c.push(s.assignTexture(r,"normalMap",i.normalTexture)),r.normalScale=new It(1,1),i.normalTexture.scale!==void 0)){const d=i.normalTexture.scale;r.normalScale.set(d,d)}if(i.occlusionTexture!==void 0&&a!==$t&&(c.push(s.assignTexture(r,"aoMap",i.occlusionTexture)),i.occlusionTexture.strength!==void 0&&(r.aoMapIntensity=i.occlusionTexture.strength)),i.emissiveFactor!==void 0&&a!==$t){const d=i.emissiveFactor;r.emissive=new rs().setRGB(d[0],d[1],d[2],ls)}return i.emissiveTexture!==void 0&&a!==$t&&c.push(s.assignTexture(r,"emissiveMap",i.emissiveTexture,ys)),Promise.all(c).then(function(){const d=new a(r);return i.name&&(d.name=i.name),is(d,i),s.associations.set(d,{materials:e}),i.extensions&&Fs(o,d,i),d})}createUniqueName(e){const s=Hc.sanitizeNodeName(e||"");return s in this.nodeNamesUsed?s+"_"+ ++this.nodeNamesUsed[s]:(this.nodeNamesUsed[s]=0,s)}loadGeometries(e){const s=this,n=this.extensions,o=this.primitiveCache;function i(r){return n[Ne.KHR_DRACO_MESH_COMPRESSION].decodePrimitive(r,s).then(function(l){return er(l,r,s)})}const a=[];for(let r=0,l=e.length;r<l;r++){const c=e[r],u=jp(c),d=o[u];if(d)a.push(d.promise);else{let h;c.extensions&&c.extensions[Ne.KHR_DRACO_MESH_COMPRESSION]?h=i(c):h=er(new hr,c,s),o[u]={primitive:c,promise:h},a.push(h)}}return Promise.all(a)}loadMesh(e){const s=this,n=this.json,o=this.extensions,i=n.meshes[e],a=i.primitives,r=[];for(let l=0,c=a.length;l<c;l++){const u=a[l].material===void 0?Up(this.cache):this.getDependency("material",a[l].material);r.push(u)}return r.push(s.loadGeometries(a)),Promise.all(r).then(function(l){const c=l.slice(0,l.length-1),u=l[l.length-1],d=[];for(let m=0,_=u.length;m<_;m++){const E=u[m],S=a[m];let g;const T=c[m];if(S.mode===jt.TRIANGLES||S.mode===jt.TRIANGLE_STRIP||S.mode===jt.TRIANGLE_FAN||S.mode===void 0)g=i.isSkinnedMesh===!0?new Uc(E,T):new ot(E,T),g.isSkinnedMesh===!0&&g.normalizeSkinWeights(),S.mode===jt.TRIANGLE_STRIP?g.geometry=Ya(g.geometry,lr):S.mode===jt.TRIANGLE_FAN&&(g.geometry=Ya(g.geometry,li));else if(S.mode===jt.LINES)g=new Fc(E,T);else if(S.mode===jt.LINE_STRIP)g=new Bc(E,T);else if(S.mode===jt.LINE_LOOP)g=new jc(E,T);else if(S.mode===jt.POINTS)g=new zc(E,T);else throw new Error("THREE.GLTFLoader: Primitive mode unsupported: "+S.mode);Object.keys(g.geometry.morphAttributes).length>0&&Bp(g,i),g.name=s.createUniqueName(i.name||"mesh_"+e),is(g,i),S.extensions&&Fs(o,g,S),s.assignFinalMaterial(g),d.push(g)}for(let m=0,_=d.length;m<_;m++)s.associations.set(d[m],{meshes:e,primitives:m});if(d.length===1)return i.extensions&&Fs(o,d[0],i),d[0];const h=new Jt;i.extensions&&Fs(o,h,i),s.associations.set(h,{meshes:e});for(let m=0,_=d.length;m<_;m++)h.add(d[m]);return h})}loadCamera(e){let s;const n=this.json.cameras[e],o=n[n.type];if(!o){console.warn("THREE.GLTFLoader: Missing camera parameters.");return}return n.type==="perspective"?s=new Dn(mr.radToDeg(o.yfov),o.aspectRatio||1,o.znear||1,o.zfar||2e6):n.type==="orthographic"&&(s=new Vc(-o.xmag,o.xmag,o.ymag,-o.ymag,o.znear,o.zfar)),n.name&&(s.name=this.createUniqueName(n.name)),is(s,n),Promise.resolve(s)}loadSkin(e){const s=this.json.skins[e],n=[];for(let o=0,i=s.joints.length;o<i;o++)n.push(this._loadNodeShallow(s.joints[o]));return s.inverseBindMatrices!==void 0?n.push(this.getDependency("accessor",s.inverseBindMatrices)):n.push(null),Promise.all(n).then(function(o){const i=o.pop(),a=o,r=[],l=[];for(let c=0,u=a.length;c<u;c++){const d=a[c];if(d){r.push(d);const h=new Vs;i!==null&&h.fromArray(i.array,c*16),l.push(h)}else console.warn('THREE.GLTFLoader: Joint "%s" could not be found.',s.joints[c])}return new Kc(r,l)})}loadAnimation(e){const s=this.json,n=this,o=s.animations[e],i=o.name?o.name:"animation_"+e,a=[],r=[],l=[],c=[],u=[];for(let d=0,h=o.channels.length;d<h;d++){const m=o.channels[d],_=o.samplers[m.sampler],E=m.target,S=E.node,g=o.parameters!==void 0?o.parameters[_.input]:_.input,T=o.parameters!==void 0?o.parameters[_.output]:_.output;E.node!==void 0&&(a.push(this.getDependency("node",S)),r.push(this.getDependency("accessor",g)),l.push(this.getDependency("accessor",T)),c.push(_),u.push(E))}return Promise.all([Promise.all(a),Promise.all(r),Promise.all(l),Promise.all(c),Promise.all(u)]).then(function(d){const h=d[0],m=d[1],_=d[2],E=d[3],S=d[4],g=[];for(let y=0,w=h.length;y<w;y++){const $=h[y],z=m[y],V=_[y],H=E[y],G=S[y];if($===void 0)continue;$.updateMatrix&&$.updateMatrix();const ie=n._createAnimationTracks($,z,V,H,G);if(ie)for(let O=0;O<ie.length;O++)g.push(ie[O])}const T=new Wc(i,void 0,g);return is(T,o),T})}createNodeMesh(e){const s=this.json,n=this,o=s.nodes[e];return o.mesh===void 0?null:n.getDependency("mesh",o.mesh).then(function(i){const a=n._getNodeRef(n.meshCache,o.mesh,i);return o.weights!==void 0&&a.traverse(function(r){if(r.isMesh)for(let l=0,c=o.weights.length;l<c;l++)r.morphTargetInfluences[l]=o.weights[l]}),a})}loadNode(e){const s=this.json,n=this,o=s.nodes[e],i=n._loadNodeShallow(e),a=[],r=o.children||[];for(let c=0,u=r.length;c<u;c++)a.push(n.getDependency("node",r[c]));const l=o.skin===void 0?Promise.resolve(null):n.getDependency("skin",o.skin);return Promise.all([i,Promise.all(a),l]).then(function(c){const u=c[0],d=c[1],h=c[2];h!==null&&u.traverse(function(m){m.isSkinnedMesh&&m.bind(h,Vp)});for(let m=0,_=d.length;m<_;m++)u.add(d[m]);return u})}_loadNodeShallow(e){const s=this.json,n=this.extensions,o=this;if(this.nodeCache[e]!==void 0)return this.nodeCache[e];const i=s.nodes[e],a=i.name?o.createUniqueName(i.name):"",r=[],l=o._invokeOne(function(c){return c.createNodeMesh&&c.createNodeMesh(e)});return l&&r.push(l),i.camera!==void 0&&r.push(o.getDependency("camera",i.camera).then(function(c){return o._getNodeRef(o.cameraCache,i.camera,c)})),o._invokeAll(function(c){return c.createNodeAttachment&&c.createNodeAttachment(e)}).forEach(function(c){r.push(c)}),this.nodeCache[e]=Promise.all(r).then(function(c){let u;if(i.isBone===!0?u=new qc:c.length>1?u=new Jt:c.length===1?u=c[0]:u=new dr,u!==c[0])for(let d=0,h=c.length;d<h;d++)u.add(c[d]);if(i.name&&(u.userData.name=i.name,u.name=a),is(u,i),i.extensions&&Fs(n,u,i),i.matrix!==void 0){const d=new Vs;d.fromArray(i.matrix),u.applyMatrix4(d)}else i.translation!==void 0&&u.position.fromArray(i.translation),i.rotation!==void 0&&u.quaternion.fromArray(i.rotation),i.scale!==void 0&&u.scale.fromArray(i.scale);if(!o.associations.has(u))o.associations.set(u,{});else if(i.mesh!==void 0&&o.meshCache.refs[i.mesh]>1){const d=o.associations.get(u);o.associations.set(u,{...d})}return o.associations.get(u).nodes=e,u}),this.nodeCache[e]}loadScene(e){const s=this.extensions,n=this.json.scenes[e],o=this,i=new Jt;n.name&&(i.name=o.createUniqueName(n.name)),is(i,n),n.extensions&&Fs(s,i,n);const a=n.nodes||[],r=[];for(let l=0,c=a.length;l<c;l++)r.push(o.getDependency("node",a[l]));return Promise.all(r).then(function(l){for(let u=0,d=l.length;u<d;u++)i.add(l[u]);const c=u=>{const d=new Map;for(const[h,m]of o.associations)(h instanceof Bo||h instanceof oa)&&d.set(h,m);return u.traverse(h=>{const m=o.associations.get(h);m!=null&&d.set(h,m)}),d};return o.associations=c(i),i})}_createAnimationTracks(e,s,n,o,i){const a=[],r=e.name?e.name:e.uuid,l=[];Ms[i.path]===Ms.weights?e.traverse(function(h){h.morphTargetInfluences&&l.push(h.name?h.name:h.uuid)}):l.push(r);let c;switch(Ms[i.path]){case Ms.weights:c=aa;break;case Ms.rotation:c=ra;break;case Ms.translation:case Ms.scale:c=ia;break;default:switch(n.itemSize){case 1:c=aa;break;case 2:case 3:default:c=ia;break}break}const u=o.interpolation!==void 0?Hp[o.interpolation]:_r,d=this._getArrayFromAccessor(n);for(let h=0,m=l.length;h<m;h++){const _=new c(l[h]+"."+Ms[i.path],s.array,d,u);o.interpolation==="CUBICSPLINE"&&this._createCubicSplineTrackInterpolant(_),a.push(_)}return a}_getArrayFromAccessor(e){let s=e.array;if(e.normalized){const n=Ai(s.constructor),o=new Float32Array(s.length);for(let i=0,a=s.length;i<a;i++)o[i]=s[i]*n;s=o}return s}_createCubicSplineTrackInterpolant(e){e.createInterpolant=function(n){const o=this instanceof ra?Gp:Fl;return new o(this.times,this.values,this.getValueSize()/3,n)},e.createInterpolant.isInterpolantFactoryMethodGLTFCubicSpline=!0}}function Wp(t,e,s){const n=e.attributes,o=new Ct;if(n.POSITION!==void 0){const r=s.json.accessors[n.POSITION],l=r.min,c=r.max;if(l!==void 0&&c!==void 0){if(o.set(new xe(l[0],l[1],l[2]),new xe(c[0],c[1],c[2])),r.normalized){const u=Ai(ln[r.componentType]);o.min.multiplyScalar(u),o.max.multiplyScalar(u)}}else{console.warn("THREE.GLTFLoader: Missing min/max properties for accessor POSITION.");return}}else return;const i=e.targets;if(i!==void 0){const r=new xe,l=new xe;for(let c=0,u=i.length;c<u;c++){const d=i[c];if(d.POSITION!==void 0){const h=s.json.accessors[d.POSITION],m=h.min,_=h.max;if(m!==void 0&&_!==void 0){if(l.setX(Math.max(Math.abs(m[0]),Math.abs(_[0]))),l.setY(Math.max(Math.abs(m[1]),Math.abs(_[1]))),l.setZ(Math.max(Math.abs(m[2]),Math.abs(_[2]))),h.normalized){const E=Ai(ln[h.componentType]);l.multiplyScalar(E)}r.max(l)}else console.warn("THREE.GLTFLoader: Missing min/max properties for accessor POSITION.")}}o.expandByVector(r)}t.boundingBox=o;const a=new Qc;o.getCenter(a.center),a.radius=o.min.distanceTo(o.max)/2,t.boundingSphere=a}function er(t,e,s){const n=e.attributes,o=[];function i(a,r){return s.getDependency("accessor",a).then(function(l){t.setAttribute(r,l)})}for(const a in n){const r=ki[a]||a.toLowerCase();r in t.attributes||o.push(i(n[a],r))}if(e.indices!==void 0&&!t.index){const a=s.getDependency("accessor",e.indices).then(function(r){t.setIndex(r)});o.push(a)}return di.workingColorSpace!==ls&&"COLOR_0"in n&&console.warn(`THREE.GLTFLoader: Converting vertex colors from "srgb-linear" to "${di.workingColorSpace}" not supported.`),is(t,e),Wp(t,e,s),Promise.all(o).then(function(){return e.targets!==void 0?Fp(t,e.targets,s):t})}const ii=new WeakMap;class Go extends cr{constructor(e){super(e),this.decoderPath="",this.decoderConfig={},this.decoderBinary=null,this.decoderPending=null,this.workerLimit=4,this.workerPool=[],this.workerNextTaskID=1,this.workerSourceURL="",this.defaultAttributeIDs={position:"POSITION",normal:"NORMAL",color:"COLOR",uv:"TEX_COORD"},this.defaultAttributeTypes={position:"Float32Array",normal:"Float32Array",color:"Float32Array",uv:"Float32Array"}}setDecoderPath(e){return this.decoderPath=e,this}setDecoderConfig(e){return this.decoderConfig=e,this}setWorkerLimit(e){return this.workerLimit=e,this}load(e,s,n,o){const i=new no(this.manager);i.setPath(this.path),i.setResponseType("arraybuffer"),i.setRequestHeader(this.requestHeader),i.setWithCredentials(this.withCredentials),i.load(e,a=>{this.parse(a,s,o)},n,o)}parse(e,s,n=()=>{}){this.decodeDracoFile(e,s,null,null,ys,n).catch(n)}decodeDracoFile(e,s,n,o,i=ls,a=()=>{}){const r={attributeIDs:n||this.defaultAttributeIDs,attributeTypes:o||this.defaultAttributeTypes,useUniqueIDs:!!n,vertexColorSpace:i};return this.decodeGeometry(e,r).then(s).catch(a)}decodeGeometry(e,s){const n=JSON.stringify(s);if(ii.has(e)){const l=ii.get(e);if(l.key===n)return l.promise;if(e.byteLength===0)throw new Error("THREE.DRACOLoader: Unable to re-decode a buffer with different settings. Buffer has already been transferred.")}let o;const i=this.workerNextTaskID++,a=e.byteLength,r=this._getWorker(i,a).then(l=>(o=l,new Promise((c,u)=>{o._callbacks[i]={resolve:c,reject:u},o.postMessage({type:"decode",id:i,taskConfig:s,buffer:e},[e])}))).then(l=>this._createGeometry(l.geometry));return r.catch(()=>!0).then(()=>{o&&i&&this._releaseTask(o,i)}),ii.set(e,{key:n,promise:r}),r}_createGeometry(e){const s=new hr;e.index&&s.setIndex(new vn(e.index.array,1));for(let n=0;n<e.attributes.length;n++){const o=e.attributes[n],i=o.name,a=o.array,r=o.itemSize,l=new vn(a,r);i==="color"&&(this._assignVertexColorSpace(l,o.vertexColorSpace),l.normalized=!(a instanceof Float32Array)),s.setAttribute(i,l)}return s}_assignVertexColorSpace(e,s){if(s!==ys)return;const n=new rs;for(let o=0,i=e.count;o<i;o++)n.fromBufferAttribute(e,o),di.colorSpaceToWorking(n,ys),e.setXYZ(o,n.r,n.g,n.b)}_loadLibrary(e,s){const n=new no(this.manager);return n.setPath(this.decoderPath),n.setResponseType(s),n.setWithCredentials(this.withCredentials),new Promise((o,i)=>{n.load(e,o,void 0,i)})}preload(){return this._initDecoder(),this}_initDecoder(){if(this.decoderPending)return this.decoderPending;const e=typeof WebAssembly!="object"||this.decoderConfig.type==="js",s=[];return e?s.push(this._loadLibrary("draco_decoder.js","text")):(s.push(this._loadLibrary("draco_wasm_wrapper.js","text")),s.push(this._loadLibrary("draco_decoder.wasm","arraybuffer"))),this.decoderPending=Promise.all(s).then(n=>{const o=n[0];e||(this.decoderConfig.wasmBinary=n[1]);const i=qp.toString(),a=["/* draco decoder */",o,"","/* worker */",i.substring(i.indexOf("{")+1,i.lastIndexOf("}"))].join(`
`);this.workerSourceURL=URL.createObjectURL(new Blob([a]))}),this.decoderPending}_getWorker(e,s){return this._initDecoder().then(()=>{if(this.workerPool.length<this.workerLimit){const o=new Worker(this.workerSourceURL);o._callbacks={},o._taskCosts={},o._taskLoad=0,o.postMessage({type:"init",decoderConfig:this.decoderConfig}),o.onmessage=function(i){const a=i.data;switch(a.type){case"decode":o._callbacks[a.id].resolve(a);break;case"error":o._callbacks[a.id].reject(a);break;default:console.error('THREE.DRACOLoader: Unexpected message, "'+a.type+'"')}},this.workerPool.push(o)}else this.workerPool.sort(function(o,i){return o._taskLoad>i._taskLoad?-1:1});const n=this.workerPool[this.workerPool.length-1];return n._taskCosts[e]=s,n._taskLoad+=s,n})}_releaseTask(e,s){e._taskLoad-=e._taskCosts[s],delete e._callbacks[s],delete e._taskCosts[s]}debug(){console.log("Task load: ",this.workerPool.map(e=>e._taskLoad))}dispose(){for(let e=0;e<this.workerPool.length;++e)this.workerPool[e].terminate();return this.workerPool.length=0,this.workerSourceURL!==""&&URL.revokeObjectURL(this.workerSourceURL),this}}function qp(){let t,e;onmessage=function(a){const r=a.data;switch(r.type){case"init":t=r.decoderConfig,e=new Promise(function(u){t.onModuleLoaded=function(d){u({draco:d})},DracoDecoderModule(t)});break;case"decode":const l=r.buffer,c=r.taskConfig;e.then(u=>{const d=u.draco,h=new d.Decoder;try{const m=s(d,h,new Int8Array(l),c),_=m.attributes.map(E=>E.array.buffer);m.index&&_.push(m.index.array.buffer),self.postMessage({type:"decode",id:r.id,geometry:m},_)}catch(m){console.error(m),self.postMessage({type:"error",id:r.id,error:m.message})}finally{d.destroy(h)}});break}};function s(a,r,l,c){const u=c.attributeIDs,d=c.attributeTypes;let h,m;const _=r.GetEncodedGeometryType(l);if(_===a.TRIANGULAR_MESH)h=new a.Mesh,m=r.DecodeArrayToMesh(l,l.byteLength,h);else if(_===a.POINT_CLOUD)h=new a.PointCloud,m=r.DecodeArrayToPointCloud(l,l.byteLength,h);else throw new Error("THREE.DRACOLoader: Unexpected geometry type.");if(!m.ok()||h.ptr===0)throw new Error("THREE.DRACOLoader: Decoding failed: "+m.error_msg());const E={index:null,attributes:[]};for(const S in u){const g=self[d[S]];let T,y;if(c.useUniqueIDs)y=u[S],T=r.GetAttributeByUniqueId(h,y);else{if(y=r.GetAttributeId(h,a[u[S]]),y===-1)continue;T=r.GetAttribute(h,y)}const w=o(a,r,h,S,g,T);S==="color"&&(w.vertexColorSpace=c.vertexColorSpace),E.attributes.push(w)}return _===a.TRIANGULAR_MESH&&(E.index=n(a,r,h)),a.destroy(h),E}function n(a,r,l){const u=l.num_faces()*3,d=u*4,h=a._malloc(d);r.GetTrianglesUInt32Array(l,d,h);const m=new Uint32Array(a.HEAPF32.buffer,h,u).slice();return a._free(h),{array:m,itemSize:1}}function o(a,r,l,c,u,d){const h=d.num_components(),_=l.num_points()*h,E=_*u.BYTES_PER_ELEMENT,S=i(a,u),g=a._malloc(E);r.GetAttributeDataArrayForAllPoints(l,d,S,E,g);const T=new u(a.HEAPF32.buffer,g,_).slice();return a._free(g),{name:c,array:T,itemSize:h}}function i(a,r){switch(r){case Float32Array:return a.DT_FLOAT32;case Int8Array:return a.DT_INT8;case Int16Array:return a.DT_INT16;case Int32Array:return a.DT_INT32;case Uint8Array:return a.DT_UINT8;case Uint16Array:return a.DT_UINT16;case Uint32Array:return a.DT_UINT32}}}class Xp{constructor(){this.gltfCache=new Map,this.modelPool=new Map,this.instancedMeshes=new Map,this.gltfLoader=null,this.dracoLoader=null,this.maxCacheSize=50,this.maxInstancesPerModel=1e3,this.preloadStatus=new Map,this.preloadQueue=[],this.initLoaders()}initLoaders(){this.gltfLoader||(this.gltfLoader=new No,this.gltfLoader.setCrossOrigin("anonymous"),this.dracoLoader=new Go,this.dracoLoader.setDecoderPath("https://www.gstatic.com/draco/versioned/decoders/1.5.6/"),this.dracoLoader.setCrossOrigin("anonymous"),this.gltfLoader.setDRACOLoader(this.dracoLoader),f("[ModelCache] GLTFDraco"))}async loadModel(e,s=!0){if(s&&this.modelPool.has(e)){const i=this.modelPool.get(e);return f(`[ModelCache] : ${e}`),i.clone(!0)}let n;if(this.gltfCache.has(e))f(`[ModelCache] GLTF: ${e}`),n=this.gltfCache.get(e);else try{const a=await(await Ol(e)).arrayBuffer();f(`[ModelCache] GLTF: ${e}`),n=await new Promise((r,l)=>{this.gltfLoader.parse(a,"",c=>r(c),c=>l(c))}),this.cacheGLTF(e,n)}catch(i){throw f(`[ModelCache] : ${e}`,i),i}const o=n.scene.clone(!0);return s&&this.addToModelPool(e,o),o}async createInstancedMesh(e,s=100){if(this.instancedMeshes.has(e))return f(`[ModelCache] : ${e}`),this.instancedMeshes.get(e);const n=await this.loadModel(e,!0),o=[];if(n.traverse(l=>{l.isMesh&&o.push(l)}),o.length===0)throw new Error(`[ModelCache] : ${e}`);const i=o[0],a=new ur(i.geometry,i.material,s),r=new Vs;for(let l=0;l<s;l++)r.setPosition(0,-1e3,0),a.setMatrixAt(l,r);return a.instanceMatrix.needsUpdate=!0,this.instancedMeshes.set(e,a),f(`[ModelCache] : ${e}, : ${s}`),a}updateInstancedMeshInstance(e,s,n,o,i){const a=this.instancedMeshes.get(e);if(!a){f(`[ModelCache] : ${e}`);return}if(s>=a.count){f(`[ModelCache] : ${s}/${a.count}`);return}const r=new Vs;r.compose(n,new cn().setFromEuler(o),i),a.setMatrixAt(s,r),a.instanceMatrix.needsUpdate=!0}hideInstancedMeshInstance(e,s){const n=this.instancedMeshes.get(e);if(!n)return;const o=new Vs;o.setPosition(0,-1e3,0),n.setMatrixAt(s,o),n.instanceMatrix.needsUpdate=!0}cacheGLTF(e,s){if(this.gltfCache.size>=this.maxCacheSize){const n=this.gltfCache.keys().next().value;this.gltfCache.delete(n),f(`[ModelCache] GLTF: ${n}`)}this.gltfCache.set(e,s),f(`[ModelCache] GLTF: ${e}`)}addToModelPool(e,s){if(this.modelPool.size>=this.maxCacheSize){const n=this.modelPool.keys().next().value,o=this.modelPool.get(n);this.disposeModel(o),this.modelPool.delete(n),f(`[ModelCache] : ${n}`)}this.modelPool.set(e,s),f(`[ModelCache] : ${e}`)}async preloadModels(e,s=null){f(`[ModelCache]  ${e.length} `);const n=e.length;let o=0;const i=e.filter(r=>{const l=this.preloadStatus.get(r);return!l||l==="failed"});f(`[ModelCache]  ${i.length} `);const a=3;for(let r=0;r<i.length;r+=a){const c=i.slice(r,r+a).map(async u=>{try{this.preloadStatus.set(u,"loading"),await this.loadModel(u,!0),this.preloadStatus.set(u,"loaded"),o++,s&&s(o,n,Math.round(o/n*100)),f(`[ModelCache] : ${u} (${o}/${n})`)}catch(d){f(`[ModelCache] : ${u}`,d),this.preloadStatus.set(u,"failed"),o++,s&&s(o,n,Math.round(o/n*100))}});await Promise.all(c),r+a<i.length&&await new Promise(u=>setTimeout(u,100))}f(`[ModelCache] : ${o}/${n} `)}isPreloaded(e){return this.preloadStatus.get(e)==="loaded"}getPreloadStatus(){const e={total:this.preloadStatus.size,loaded:0,loading:0,failed:0};for(const s of this.preloadStatus.values())e[s]++;return e}disposeModel(e){e&&e.traverse(s=>{s.isMesh&&(s.geometry&&s.geometry.dispose(),s.material&&(Array.isArray(s.material)?s.material.forEach(n=>{n.map&&n.map.dispose(),n.dispose&&n.dispose()}):(s.material.map&&s.material.map.dispose(),s.material.dispose&&s.material.dispose())))})}clearCache(){f("[ModelCache] ..."),this.modelPool.forEach(e=>{this.disposeModel(e)}),this.modelPool.clear(),this.instancedMeshes.forEach(e=>{this.disposeModel(e)}),this.instancedMeshes.clear(),this.gltfCache.clear(),this.preloadStatus.clear(),f("[ModelCache] ")}getCacheStatus(){return{gltfCacheSize:this.gltfCache.size,modelPoolSize:this.modelPool.size,instancedMeshesSize:this.instancedMeshes.size,preloadStatus:this.getPreloadStatus(),maxCacheSize:this.maxCacheSize,maxInstancesPerModel:this.maxInstancesPerModel,gltfLoaderInitialized:!!this.gltfLoader,dracoLoaderInitialized:!!this.dracoLoader}}updateConfig(e){e.maxCacheSize!==void 0&&(this.maxCacheSize=Math.max(10,e.maxCacheSize)),e.maxInstancesPerModel!==void 0&&(this.maxInstancesPerModel=Math.max(10,e.maxInstancesPerModel)),f("[ModelCache] :",this.getCacheStatus())}}const Ut=new Xp,Yp={class:"model-wrapper"},Jp={key:0,class:"model-loading"},Zp={__name:"PuppetModelView",props:{puppet:{type:Object,default:null}},setup(t){const e=t,s=B(null),n=B(!1);let o=null,i=null,a=null,r=0,l=null,c=null,u=new tu,d=null,h=null,m=0,_=!1;window.__GLTF_MEMORY_CACHE__||(window.__GLTF_MEMORY_CACHE__=new Map,f("[PuppetModelView] Initialized global GLTF memory cache"));function E(){if(_)return;const y=s.value;if(!y){f("[PuppetModelView] Container not ready for Three.js initialization");return}f("[PuppetModelView] Initializing Three.js..."),i=new yo,a=new Dn(45,1,.1,1e3),a.position.set(0,1,3),o=new bo({antialias:!0,alpha:!0}),o.setPixelRatio(window.devicePixelRatio||1),o.outputColorSpace=ys,h=new Go,h.setDecoderPath("https://www.gstatic.com/draco/versioned/decoders/1.5.6/"),h.setCrossOrigin("anonymous"),f("[PuppetModelView] Draco loader initialized:",!!h),y.innerHTML="",y.appendChild(o.domElement);const w=new wo(16777215,1.2),$=new vs(16777215,1.5);$.position.set(3,5,2);const z=new vs(16777215,.8);z.position.set(-2,3,4);const V=new Zs(16777215,1,10);V.position.set(0,2,3),i.add(w,$,z,V);const H=()=>{if(!y||!o)return;let ie=y.clientWidth,O=y.clientHeight;if(!ie||!O){const R=y.getBoundingClientRect();if(ie=R.width||200,O=R.height||200,!R.width||!R.height){requestAnimationFrame(H);return}}o.setSize(ie,O,!0),a.aspect=ie/Math.max(1,O),a.updateProjectionMatrix()};H(),d=new ResizeObserver(H),d.observe(y),requestAnimationFrame(()=>{H(),requestAnimationFrame(()=>{H(),requestAnimationFrame(H)})});const G=()=>{if(!o||!i||!a)return;r=requestAnimationFrame(G);const ie=u.getDelta();c&&c.update(ie),l&&(l.rotation.y+=ie*.6),o.render(i,a)};G(),_=!0,f("[PuppetModelView] Three.js initialized successfully, container size:",y.clientWidth,"x",y.clientHeight)}function S(){c&&(c.stopAllAction(),c=null),l&&(i.remove(l),l.traverse(y=>{y.isMesh&&(y.geometry&&y.geometry.dispose(),Array.isArray(y.material)?y.material.forEach(w=>{w.map&&w.map.dispose(),w&&w.dispose&&w.dispose()}):y.material&&(y.material.map&&y.material.map.dispose(),y.material.dispose&&y.material.dispose()))}),l=null)}function g(y){const w=new Ct().setFromObject(y),$=new xe,z=new xe;w.getSize($),w.getCenter(z),y.position.sub(z),y.position.add(new xe(0,0,0)),y.scale.multiplyScalar(.8);const H=o==null?void 0:o.domElement,G=H?H.clientWidth||H.width:200,ie=H?H.clientHeight||H.height:200,O=Math.max(1e-6,G/Math.max(1,ie)),R=a.fov*(Math.PI/180),re=2*Math.atan(Math.tan(R/2)*O),ve=1.05,ge=$.y/2/Math.tan(R/2),pe=$.x/2/Math.tan(re/2),K=ve*Math.max(ge,pe,.1);a.position.set(0,0,K),a.lookAt(0,0,0)}async function T(y){var z;if(!y)return;f("[PuppetModelView] Loading puppet:",y.name),n.value=!0,E(),S();const w=++m;f("[PuppetModelView] ");let $=y.modelUrl||"";if(f("[PuppetModelView] Original modelUrl:",$),f("[PuppetModelView] Puppet image:",y.image),f("[PuppetModelView] Puppet name:",y.name),f("[PuppetModelView] Puppet data:",y),!$||$.trim()===""){f("[PuppetModelView] No model URL found");return}f("[PuppetModelView] Final Model URL:",$);try{f("[PuppetModelView] Starting to load:",$),f("[PuppetModelView] Cache status:",Ut.getCacheStatus());const V=await Ut.loadModel($);if(f("[PuppetModelView] Model loaded from cache manager:",V),w!==m){f("[PuppetModelView] Ignoring outdated load result for:",y.name),gltf&&gltf.scene&&gltf.scene.traverse(H=>{H.isMesh&&(H.geometry&&H.geometry.dispose(),Array.isArray(H.material)?H.material.forEach(G=>{G.map&&G.map.dispose(),G.dispose&&G.dispose()}):H.material&&(H.material.map&&H.material.map.dispose(),H.material.dispose&&H.material.dispose()))});return}if(f("[PuppetModelView] Applying model for:",y.name),!i){f("[PuppetModelView] Scene not ready, initializing..."),E();let H=0;for(;!i&&H<40;)await new Promise(G=>setTimeout(G,50)),H++;if(!i){f("[PuppetModelView] Scene initialization timeout");return}}if(l=V,!l){f("[PuppetModelView] No model instance received");return}i.add(l),g(l),f("[PuppetModelView] Model loaded successfully:",y.name,"Scene children:",i.children.length),n.value=!1}catch(V){if(f("[PuppetModelView] Load failed:",V),f("[PuppetModelView] Failed URL:",$),f("[PuppetModelView] Puppet data:",y),typeof(V==null?void 0:V.message)=="string"&&V.message.includes("DRACOLoader")){f("[PuppetModelView] Retrying without Draco decoder...");try{const H=new No;H.setCrossOrigin("anonymous");const G=await H.loadAsync($);if(w===m&&(l=G.scene||((z=G.scenes)==null?void 0:z[0]),l)){i.add(l),G.animations&&G.animations.length&&(c=new eu(l),c.clipAction(G.animations[0]).play()),g(l),f("[PuppetModelView] Model loaded successfully without Draco:",y.name);return}}catch(H){f("[PuppetModelView] Fallback load also failed:",H)}}if(w===m){const H=new Yt(1,1,1),G=new Dt({color:8947967});l=new ot(H,G),i.add(l),g(l)}n.value=!1}}return Ht(()=>e.puppet,async y=>{await Rn(),T(y)},{immediate:!1}),Pt(()=>{f("[PuppetModelView] Component mounted"),Rn(()=>{s.value&&(E(),e.puppet&&setTimeout(()=>{T(e.puppet)},0))})}),us(()=>{if(f("[PuppetModelView] Cleaning up..."),cancelAnimationFrame(r),S(),d&&s.value)try{d.unobserve(s.value)}catch{}const y=i,w=o;o=null,i=null,a=null,_=!1,m=0;const $=()=>{if(f("[PuppetModelView] Starting deferred cleanup..."),y&&y.traverse(z=>{if(z.isMesh)try{if(z.geometry&&z.geometry.dispose(),Array.isArray(z.material))z.material.forEach(V=>{try{V.map&&V.map.dispose(),V.dispose&&V.dispose()}catch{}});else if(z.material)try{z.material.map&&z.material.map.dispose(),z.material.dispose&&z.material.dispose()}catch{}}catch{}}),w)try{w.dispose(),w.forceContextLoss&&w.forceContextLoss()}catch{}f("[PuppetModelView] Deferred cleanup completed")};typeof window<"u"&&window.requestIdleCallback?window.requestIdleCallback($,{timeout:1e3}):setTimeout($,100),f("[PuppetModelView] Quick cleanup completed, heavy cleanup deferred")}),(y,w)=>(D(),j("div",Yp,[p("div",{ref_key:"mountEl",ref:s,class:"model-canvas"},null,512),n.value?(D(),j("div",Jp,[...w[0]||(w[0]=[p("div",{class:"loading-spinner"},null,-1)])])):ye("",!0)]))}},Qp=ut(Zp,[["__scopeId","data-v-0e860b93"]]),eh={class:"warehouse"},th={class:"warehouse__resources"},sh={class:"resource-icon"},nh=["src","alt"],oh={class:"resource-value"},ih={class:"resource-tooltip"},ah={key:0,class:"warehouse__main"},rh={class:"warehouse__sidebar"},lh={class:"puppet-list"},ch=["onClick","onMouseenter"],uh={class:"puppet-card__quantity"},dh={class:"puppet-card__image"},fh=["src","alt"],ph={class:"puppet-card__info"},hh={class:"puppet-card__name"},mh={class:"puppet-card__level"},_h={class:"puppet-detail__header"},gh={class:"puppet-detail__name"},vh={class:"puppet-detail__content"},yh={class:"puppet-detail__row"},bh={class:"puppet-detail__model"},wh={class:"puppet-detail__description"},Sh={class:"puppet-detail__row"},Th={class:"puppet-detail__stats"},Mh={class:"stats-section"},Ch={class:"stat-item"},Eh={class:"stat-value"},xh={class:"stat-item"},kh={class:"stat-value"},Ah={class:"stat-item"},Rh={class:"stat-value"},$h={class:"stat-item"},Ph={class:"stat-value"},Lh={class:"stat-item"},Ih={class:"stat-value"},Oh={class:"stat-item"},Dh={class:"stat-value"},Nh={class:"stat-item"},Gh={class:"stat-value"},Hh={class:"equipment-section"},Uh={class:"equipment-slots"},Fh=["src","alt"],Bh=["src"],jh=["src"],zh={key:3,class:"equipment-icon"},Vh={key:0,class:"skill-section"},Kh={class:"skill-info"},Wh={class:"skill-text"},qh={class:"skill-name"},Xh={class:"skill-cooldown"},Yh={class:"skill-effect"},Jh={class:"skill-icon"},Zh=["src","alt"],Qh={key:1},em={class:"puppet-detail__upgrade"},tm={class:"upgrade-cost"},sm=["src"],nm={class:"cost-amount"},om=["disabled"],im=["src"],am={class:"warehouse__placeholder",key:"placeholder"},rm=["src"],lm={__name:"Warehouse",props:{musicOn:{type:Boolean,default:!0}},setup(t,{expose:e}){qt(K=>({v9925b07e:ve,bf2e7e24:re,bf31385e:ie,bf304fa0:O,bf2f66e2:R}));const s=t,n=["SpiritalSpark","RecallGear","ResonantCrystal","RefinedCopper","HeartCrystalDust"];function o(K){return n.map(A=>({icon:Zt[A].icon,name:Zt[A].name,value:Number((K==null?void 0:K[A])??0)}))}const i={IronWall:"",Arcanist:"",CraftsMan:"",Mechanic:"",Resonator:""};function a(K){const A=Number(K??1);return A===1?5:A===2?10:A===3?20:A===4?30:0}function r(K){return(K||[]).map((A,de)=>{var J,W,q,L,ee,Z;const X=(A==null?void 0:A.copper_info)||{},I=(X==null?void 0:X.skill)||{},Q=(A==null?void 0:A.equipment_slot)||{},ae=(Q==null?void 0:Q.slot1)||null,Pe=(Q==null?void 0:Q.slot2)||null,Be=(A==null?void 0:A.attribute)||{},ze=((J=ae==null?void 0:ae.equipment_base)==null?void 0:J.attribute)||{},Ie=((W=Pe==null?void 0:Pe.equipment_base)==null?void 0:W.attribute)||{},tt=Number(ze.attack||0)+Number(Ie.attack||0),at=Number(ze.defense||0)+Number(Ie.defense||0),Ve=Number(ze.dodge||0)+Number(Ie.dodge||0),ht=A==null?void 0:A.copper_type,b=(A==null?void 0:A.level)??1,M=(X==null?void 0:X.model_url)||"",P=M?F(M):"";return{id:Number((A==null?void 0:A.id)??de+1),name:(X==null?void 0:X.name)??"",level:b,suffix:(A==null?void 0:A.suffix)??0,image:F((X==null?void 0:X.icon_url)||""),modelUrl:P,quantity:1,description:(X==null?void 0:X.description)||"",stats:{level:`${b}/5`,health:Number(Be.health||0),live_left:Number((A==null?void 0:A.live_left)??0),attack:{base:Number(Be.attack||0),bonus:tt},defense:{base:Number(Be.defense||0),bonus:at},dodge:{base:Number(Be.dodge||0),bonus:Ve},class:i[ht]||""},equipment:[ae?{name:((q=ae.equipment_base)==null?void 0:q.name)||"",icon:F(((L=ae.equipment_base)==null?void 0:L.resource_url)||""),equipped:!0,locked:!1}:{name:"",icon:"",equipped:!1,locked:!1},Q!=null&&Q.is_slot2_locked?{name:"",icon:"",equipped:!1,locked:!0}:Pe?{name:((ee=Pe.equipment_base)==null?void 0:ee.name)||"",icon:F(((Z=Pe.equipment_base)==null?void 0:Z.resource_url)||""),equipped:!0,locked:!1}:{name:"",icon:"",equipped:!1,locked:!1}],skill:{name:(I==null?void 0:I.name)||"",cooldown:(I==null?void 0:I.cool_down)!=null?`${I.cool_down}`:"",effect:(I==null?void 0:I.description)||"",icon:F((I==null?void 0:I.resource_url)||"")},upgradeCost:a(b)}})}function l(K,A,de=[]){if(!K||typeof K!="object")return null;if(Object.prototype.hasOwnProperty.call(K,A))return[...de,A];if(Array.isArray(K)){for(let X=0;X<K.length;X++){const I=l(K[X],A,[...de,X]);if(I)return I}return null}for(const X of Object.keys(K)){const I=l(K[X],A,[...de,X]);if(I)return I}return null}function c(K,A){return A.reduce((de,X)=>de!=null?de[X]:void 0,K)}const u=B([]);async function d(){try{const K=await Do();K&&(u.value=o(K))}catch(K){console.error("[Warehouse] :",K),u.value=o({})}}Pt(()=>{d(),Oo(Nt.UPDATE_RESOURCES,d)});function h(K){let A=K;if(typeof K=="string")try{A=JSON.parse(K)}catch{}A&&A.type_msg&&(A.type_msg==="upgrade_cost_error"?alert(A.content||""):f("[GlobalInfo]",A))}Pt(()=>{try{Hl(h)}catch{}s.musicOn&&ge.value&&setTimeout(()=>{if(ge.value.readyState>=2)ge.value.play().then(()=>{f("[Warehouse] ")}).catch(A=>{f("[Warehouse] :",A)});else{const A=()=>{ge.value.play().then(()=>{f("[Warehouse] ")}).catch(de=>{f("[Warehouse] :",de)}),ge.value.removeEventListener("canplay",A)};ge.value.addEventListener("canplay",A,{once:!0})}},200)}),Ht(()=>s.musicOn,K=>{if(ge.value)if(K)if(ge.value.readyState>=2)ge.value.play().catch(A=>{f("[Warehouse] :",A)});else{const A=()=>{ge.value.play().catch(de=>{f("[Warehouse] :",de)}),ge.value.removeEventListener("canplay",A)};ge.value.addEventListener("canplay",A)}else ge.value.pause()}),us(()=>{ge.value&&ge.value.pause(),Ji(Nt.UPDATE_RESOURCES,d)});const m=B([]);Pt(async()=>{try{const K=await so();let A=K&&Array.isArray(K.coppers)?K.coppers:[];if(!Array.isArray(A)){const de=l(K,"coppers");if(f("[Warehouse] copper key path:",de),de){const X=c(K,de);f("[Warehouse] copper found by path:",X),Array.isArray(X)&&(A=X)}!Array.isArray(A)&&K&&K.entries&&f("[Warehouse] copper entries sample:",K.entries)}Array.isArray(A)||f("[Warehouse] copper list not array"),m.value=r(A),Array.isArray(m.value)&&m.value.length>0&&(_.value=m.value[0]),!_.value&&Array.isArray(m.value)&&m.value.length>0&&(_.value=m.value[0])}catch{m.value=[]}});const _=B(null),E=B([]),S=B(null),g=B(null),T=B(null);function y(K,A){K&&(E.value[A]=K)}async function w(K,A){_.value=K,await Rn();const de=E.value[A];if(de&&typeof de.scrollIntoView=="function"&&de.scrollIntoView({block:"nearest",inline:"nearest",behavior:"smooth"}),S.value=A,g.value)try{g.value.scrollTo({top:0,behavior:"smooth"})}catch{g.value.scrollTop=0}setTimeout(()=>{S.value===A&&(S.value=null)},320)}const $=B(!1);function z(){$.value=!0}function V(){return $.value?($.value=!1,!0):!1}e({handleBack:V});async function H(K){try{await d();const A=await so(),de=Array.isArray(A==null?void 0:A.coppers)?A.coppers:[];m.value=r(de)}catch{}}async function G(){if(!_.value)return;if(Number(_.value.level||0)>=5){alert("");return}const K=_.value.id,A=await Yf(K);if(!A||A.type!=="success"){alert(A&&A.content?A.content:"");return}try{await d();const de=await so(),X=Array.isArray(de==null?void 0:de.coppers)?de.coppers:[];m.value=r(X);const I=m.value.find(Q=>Q.id===K);I&&(_.value=I)}catch{}}const ie=`url('${F("@assets/ui/panel2.png")}')`,O=`url('${F("@assets/ui/panel3.png")}')`,R=`url('${F("@assets/ui/panel4.png")}')`,re=`url('${F("@assets/ui/panel5.png")}')`,ve=`url('${F("@assets/frontend_resource/Gemini_Generated_Image_e03q5oe03q5oe03q.png")}')`,ge=B(null),pe=F("assets/warehouse.mp3");return(K,A)=>(D(),j("div",eh,[p("div",th,[(D(!0),j(Ze,null,Wt(u.value,de=>(D(),j("div",{class:"resource-item",key:de.name},[p("div",sh,[p("img",{src:de.icon,alt:de.name},null,8,nh)]),p("div",oh,se(de.value),1),p("div",ih,se(de.name),1)]))),128))]),$.value?ye("",!0):(D(),j("div",ah,[p("div",rh,[A[2]||(A[2]=p("div",{class:"warehouse__title"},"",-1)),p("div",lh,[(D(!0),j(Ze,null,Wt(m.value,(de,X)=>{var I;return D(),j("div",{class:Ye(["puppet-card",{"puppet-card--selected":((I=_.value)==null?void 0:I.id)===de.id,"puppet-card--pulse":S.value===X,"puppet-card--hover":T.value===X}]),key:de.id,ref_for:!0,ref:Q=>y(Q,X),onClick:Q=>w(de,X),onMouseenter:Q=>T.value=X,onMouseleave:A[0]||(A[0]=Q=>T.value=null)},[p("div",uh,se(de.level),1),p("div",dh,[p("img",{src:de.image,alt:de.name},null,8,fh)]),p("div",ph,[p("div",hh,se(de.name)+se(de.suffix),1),p("div",mh,se(de.level)+"",1)])],42,ch)}),128)),p("div",{class:"puppet-card puppet-card--add",onClick:z},[...A[1]||(A[1]=[p("div",{class:"puppet-card__add-icon"},"+",-1),p("div",{class:"puppet-card__add-text"},"",-1)])])])]),p("div",{class:"warehouse__detail",ref_key:"detailWrap",ref:g},[it(cf,{name:"fade-slide",mode:"out-in"},{default:Xr(()=>{var de,X,I,Q;return[_.value?(D(),j("div",{class:"puppet-detail",key:((de=_.value)==null?void 0:de.id)||"none"},[p("div",_h,[p("h2",gh,se(_.value.name),1)]),p("div",vh,[p("div",yh,[p("div",bh,[it(Qp,{puppet:_.value},null,8,["puppet"])]),p("div",wh,se(_.value.description),1)]),p("div",Sh,[p("div",Th,[p("div",Mh,[p("div",Ch,[A[3]||(A[3]=p("span",{class:"stat-label"},":",-1)),p("span",Eh,se(_.value.stats.health),1)]),p("div",xh,[A[4]||(A[4]=p("span",{class:"stat-label"},":",-1)),p("span",kh,se(_.value.stats.level),1)]),p("div",Ah,[A[5]||(A[5]=p("span",{class:"stat-label"},":",-1)),p("span",Rh,se(_.value.stats.live_left),1)]),p("div",$h,[A[6]||(A[6]=p("span",{class:"stat-label"},":",-1)),p("span",Ph,se(_.value.stats.attack.base),1)]),p("div",Lh,[A[7]||(A[7]=p("span",{class:"stat-label"},":",-1)),p("span",Ih,se(_.value.stats.defense.base),1)]),p("div",Oh,[A[8]||(A[8]=p("span",{class:"stat-label"},":",-1)),p("span",Dh,se(_.value.stats.dodge.base)+"% ",1)]),p("div",Nh,[A[9]||(A[9]=p("span",{class:"stat-label"},":",-1)),p("span",Gh,se(_.value.stats.class),1)])])]),p("div",Hh,[A[10]||(A[10]=p("h4",{class:"section-title"},"",-1)),p("div",Uh,[(D(!0),j(Ze,null,Wt(_.value.equipment,(ae,Pe)=>(D(),j("div",{key:Pe,class:Ye(["equipment-slot",{"equipment-slot--empty":!ae.equipped&&!ae.locked,"equipment-slot--locked":ae.locked}])},[ae.equipped&&ae.icon&&(ae.icon.startsWith("/")||ae.icon.startsWith("http"))?(D(),j("img",{key:0,src:ae.icon,alt:ae.name,class:"equipment-icon"},null,8,Fh)):ae.locked?(D(),j("img",{key:1,src:ue(F)("@assets/ui/lock.png"),alt:"",class:"equipment-icon"},null,8,Bh)):ae.icon===""?(D(),j("img",{key:2,src:ue(F)("@assets/ui/jia.png"),alt:"",class:"equipment-icon"},null,8,jh)):(D(),j("span",zh,se(ae.icon),1))],2))),128))])])]),((I=(X=_.value)==null?void 0:X.stats)==null?void 0:I.class)!==""?(D(),j("div",Vh,[A[11]||(A[11]=p("h4",{class:"section-title"},"",-1)),p("div",Kh,[p("div",Wh,[p("div",qh,se(_.value.skill.name),1),p("div",Xh," : "+se(_.value.skill.cooldown),1),p("div",Yh,se(_.value.skill.effect),1)]),p("div",Jh,[_.value.skill.icon&&(_.value.skill.icon.startsWith("/")||_.value.skill.icon.startsWith("http"))?(D(),j("img",{key:0,src:_.value.skill.icon,alt:_.value.skill.name,class:"skill-icon-img"},null,8,Zh)):(D(),j("span",Qh,se(_.value.skill.icon),1))])])])):ye("",!0)]),p("div",em,[p("div",tm,[_.value.level<5?(D(),j("img",{key:0,src:ue(Zt).SpiritalSpark.icon,alt:"",class:"cost-icon-img"},null,8,sm)):ye("",!0),p("span",nm,se(_.value.level>=5?"":"X "+_.value.upgradeCost),1)]),p("button",{class:"upgrade-btn",onClick:G,disabled:((Q=_.value)==null?void 0:Q.level)>=5},[p("img",{src:ue(F)("@assets/ui/upgrade.png"),class:"upgrade-icon",alt:""},null,8,im)],8,om)])])):(D(),j("div",am,[...A[12]||(A[12]=[p("p",null,"",-1)])]))]}),_:1})],512)])),$.value?(D(),xt(pp,{key:1,onDraw:H})):ye("",!0),p("audio",{ref_key:"audioRef",ref:ge,src:ue(pe),loop:"",preload:"auto"},null,8,rm)]))}},cm=ut(lm,[["__scopeId","data-v-228931f6"]]),um={class:"panel",style:{left:"24px",right:"auto"}},dm=["title"],fm={key:0,width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg"},pm={key:1,width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg"},hm={class:"sr-only"},mm={__name:"TopLeftPanel",props:{musicOn:{type:Boolean,default:!0}},emits:["back","open-settings","toggle-music"],setup(t,{emit:e}){return(s,n)=>(D(),j("div",um,[p("button",{class:"btn",onClick:n[0]||(n[0]=o=>s.$emit("back")),title:""},[...n[3]||(n[3]=[p("svg",{width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg"},[p("path",{d:"M15 18L9 12L15 6",stroke:"#ffffff","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"})],-1),p("span",{class:"sr-only"},"",-1)])]),p("button",{class:"btn",onClick:n[1]||(n[1]=o=>s.$emit("toggle-music")),title:t.musicOn?"":""},[t.musicOn?(D(),j("svg",fm,[...n[4]||(n[4]=[p("path",{d:"M9 18V5L21 3V16",stroke:"#ffffff","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"},null,-1),p("circle",{cx:"6",cy:"18",r:"3",stroke:"#ffffff","stroke-width":"2"},null,-1),p("circle",{cx:"18",cy:"16",r:"3",stroke:"#ffffff","stroke-width":"2"},null,-1)])])):(D(),j("svg",pm,[...n[5]||(n[5]=[p("path",{d:"M9 18V5L21 3V16",stroke:"#ffffff","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"},null,-1),p("circle",{cx:"6",cy:"18",r:"3",stroke:"#ffffff","stroke-width":"2"},null,-1),p("circle",{cx:"18",cy:"16",r:"3",stroke:"#ffffff","stroke-width":"2"},null,-1),p("line",{x1:"2",y1:"2",x2:"22",y2:"22",stroke:"#ffffff","stroke-width":"2","stroke-linecap":"round"},null,-1)])])),p("span",hm,se(t.musicOn?"":""),1)],8,dm),p("button",{class:"btn",onClick:n[2]||(n[2]=o=>s.$emit("open-settings")),title:""},[...n[6]||(n[6]=[p("svg",{width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg"},[p("path",{d:"M12 15.5C13.933 15.5 15.5 13.933 15.5 12C15.5 10.067 13.933 8.5 12 8.5C10.067 8.5 8.5 10.067 8.5 12C8.5 13.933 10.067 15.5 12 15.5Z",stroke:"#ffffff","stroke-width":"2"}),p("path",{d:"M19.4 15A7.964 7.964 0 0 0 20 12C20 11.49 19.95 10.99 19.86 10.5L22 8.5L20 5.5L17.34 6.07C16.78 5.58 16.14 5.18 15.44 4.9L15 2H9L8.56 4.9C7.86 5.18 7.22 5.58 6.66 6.07L4 5.5L2 8.5L4.14 10.5C4.05 10.99 4 11.49 4 12C4 12.51 4.05 13.01 4.14 13.5L2 15.5L4 18.5L6.66 17.93C7.22 18.42 7.86 18.82 8.56 19.1L9 22H15L15.44 19.1C16.14 18.82 16.78 18.42 17.34 17.93L20 18.5L22 15.5L19.86 13.5C19.95 13.01 20 12.51 20 12",stroke:"#ffffff","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"})],-1),p("span",{class:"sr-only"},"",-1)])])]))}},tr=ut(mm,[["__scopeId","data-v-8380a348"]]),_m=["automatic_loading_gun","charging_coil","heart_source_mineral_drill","mirro_light_refraction_tower","repair_workshop","resonance_alarm_bell","rivet_barrier","steam_mining_car","storm_anvil"];function gm(){const t=[],e=[{type:"arcanist",name:"bubble"},{type:"craftsman",name:"coil"},{type:"iron_wall",name:"bell"},{type:"mechanic",name:"gyro"},{type:"resonator",name:"clawster"}];for(const n of e){const o=Lo(n.type,n.name);t.push(o)}const s=["goblin","guard","demon"];for(const n of s){const o=Io(n);t.push(o)}return f(`[ModelPreloadConfig]  ${t.length} URL`),t}function vm(){const t=[],e=[{type:"arcanist",name:"glimmer"},{type:"arcanist",name:"spark"},{type:"craftsman",name:"artifex"},{type:"craftsman",name:"wrench"},{type:"iron_wall",name:"chief"},{type:"iron_wall",name:"rocky"},{type:"mechanic",name:"karin"},{type:"mechanic",name:"tricky"},{type:"resonator",name:"diggs"},{type:"resonator",name:"hive"}];for(const n of e){const o=Lo(n.type,n.name);t.push(o)}const s=["assassin","boxer","cruiser","devourer","glutton"];for(const n of s){const o=Io(n);t.push(o)}return f(`[ModelPreloadConfig]  ${t.length} URL`),t}function ym(){const t=[],e=[{type:"arcanist",name:"syrup"},{type:"arcanist",name:"turner"},{type:"craftsman",name:"drillbit"},{type:"craftsman",name:"quickhand"},{type:"iron_wall",name:"tumble"},{type:"iron_wall",name:"wesley"},{type:"mechanic",name:"pendulum"},{type:"mechanic",name:"yoyo"},{type:"resonator",name:"melody"},{type:"resonator",name:"murmur"}];for(const n of e){const o=Lo(n.type,n.name);t.push(o)}const s=["horn","mirror","scout","shatra","variant"];for(const n of s){const o=Io(n);t.push(o)}for(const n of _m){const o=Dl(n);t.push(o)}return f(`[ModelPreloadConfig]  ${t.length} URL`),t}function bm(t=["high","medium"]){const e=[];for(const n of t)switch(n){case"high":e.push(...gm());break;case"medium":e.push(...vm());break;case"low":e.push(...ym());break}const s=[...new Set(e)];return f(`[ModelPreloadConfig]  ${t.join(", ")}  ${s.length} URL`),s}class wm{constructor(){this.isPreloading=!1,this.preloadProgress=0,this.preloadCallbacks=[]}async startPreload(e=["high","medium"],s=null){if(this.isPreloading){f("[ModelPreloadManager] ");return}this.isPreloading=!0,this.preloadProgress=0;try{const n=bm(e);f(`[ModelPreloadManager]  ${n.length}  (: ${e.join(", ")})`),s&&this.preloadCallbacks.push(s),await Ut.preloadModels(n,(o,i,a)=>{this.preloadProgress=a,this.notifyProgress(o,i,a)}),f("[ModelPreloadManager] ")}catch(n){f("[ModelPreloadManager] :",n)}finally{this.isPreloading=!1,this.preloadCallbacks=[]}}notifyProgress(e,s,n){this.preloadCallbacks.forEach(o=>{try{o(e,s,n)}catch(i){f("[ModelPreloadManager] :",i)}})}getStatus(){return{isPreloading:this.isPreloading,progress:this.preloadProgress,cacheStatus:Ut.getCacheStatus()}}isModelPreloaded(e){return Ut.isPreloaded(e)}async preloadModel(e){try{await Ut.loadModel(e,!0),f(`[ModelPreloadManager] : ${e}`)}catch(s){f(`[ModelPreloadManager] : ${e}`,s)}}async preloadModels(e){const s=e.map(n=>this.preloadModel(n));await Promise.all(s),f(`[ModelPreloadManager] : ${e.length} `)}}const sr=new wm,Bl="mgpic_game_settings",nr={controlMode:"mobile",mouseSensitivity:.002};function jl(){try{const t=localStorage.getItem(Bl);if(t){const e=JSON.parse(t);return{...nr,...e}}}catch(t){console.error("[GameSettings] :",t)}return{...nr}}function Sm(t){try{return localStorage.setItem(Bl,JSON.stringify(t)),!0}catch(e){return console.error("[GameSettings] :",e),!1}}function Tm(t,e){const s=jl();return s[t]=e,Sm(s)}const Mm={class:"startmenu"},Cm={key:0,class:"settings-local"},Em={class:"settings-local__card"},xm={class:"settings-local__content"},km={class:"settings-local__row"},Am={class:"setting-options"},Rm={__name:"StartMenu",props:{visible:{type:Boolean,default:!0}},emits:["started"],setup(t,{emit:e}){qt(O=>({v21ff84e0:E}));const s=t,n=B(null);let o=null,i=null,a=null,r=null,l=null,c=1.2;const u=B(!1),d=B(!1),h=B(!1),m=B("touchpad"),_=B(F("ui/Gemini_Generated_Image_gtrehogtrehogtre (1).png")),E=`url('${F("@assets/ui/panel4.png")}')`,S=e;Ht(()=>s.visible,O=>{O&&o&&l?w():O||y()});function g(){if(r=requestAnimationFrame(g),l){const O=Date.now()*.001;l.position.y=Math.sin(O*.8)*.1,l.rotation.y=Math.sin(O*.6)*.1;const R=c+Math.sin(O*1.2)*.04;l.scale.setScalar(R)}a&&a.render(o,i)}function T(){!a||!i||(i.aspect=window.innerWidth/window.innerHeight,i.updateProjectionMatrix(),a.setSize(window.innerWidth,window.innerHeight))}function y(){r&&(cancelAnimationFrame(r),r=null),a&&a.setAnimationLoop(null)}function w(){r||g()}function $(){try{y()}catch{}try{window.removeEventListener("resize",T)}catch{}try{o&&(o.traverse(O=>{if(O.isMesh){O.geometry&&O.geometry.dispose&&O.geometry.dispose();const R=O.material;Array.isArray(R)?R.forEach(re=>re&&re.dispose&&re.dispose()):R&&R.dispose&&R.dispose()}}),o.clear())}catch{}try{if(a){a.clear(!0,!0,!0),a.dispose();const O=a.getContext&&a.getContext(),R=O&&O.getExtension&&O.getExtension("WEBGL_lose_context");R&&R.loseContext&&R.loseContext()}}catch{}o=null,i=null,a=null,l=null}async function z(O=null){try{window.getAssetUrl=F,window.precacheAllResources=xi,window.getCacheStatus=Nf}catch{}if(!o||!a){f("[StartMenu] Scene or renderer not initialized in onMounted");return}if(O&&O(0,100,20),!o.children.some(ve=>ve.isLight)){const ve=new wo(4210752,.4);o.add(ve);const ge=new vs(16777215,12.5);ge.position.set(-5,-2,1),o.add(ge)}O&&O(0,100,50);const re=F("logo.glb");try{O&&O(0,100,60),f("[StartMenu] Logo...");const ve=await Ut.loadModel(re,!0);O&&O(0,100,80),ve.position.set(0,0,0),o.add(ve);const pe=new Ct().setFromObject(ve).getCenter(new xe);ve.position.set(-pe.x,-pe.y,-pe.z-.3);try{ve.scale.setScalar(c)}catch{}l=ve,O&&O(0,100,80),f("[StartMenu] Logo ...");try{await sr.startPreload(["high","medium"],(K,A,de)=>{const X=80+de*.15;O&&O(0,100,Math.round(X)),f(`[StartMenu] : ${K}/${A} (${de}%)`)}),f("[StartMenu] ")}catch(K){f("[StartMenu] :",K)}O&&O(0,100,100),u.value=!0,f("[StartMenu] "),d.value=!0}catch(ve){f("[StartMenu] 3D",ve);const ge=new Yt(1,1,1),pe=new $t({color:16096779}),K=new ot(ge,pe);o.add(K),l=K,f("[StartMenu] ...");try{await sr.startPreload(["high","medium"],(A,de,X)=>{const I=80+X*.15;O&&O(0,100,Math.round(I)),f(`[StartMenu] : ${A}/${de} (${X}%)`)}),f("[StartMenu] ")}catch(A){f("[StartMenu] :",A)}O&&O(0,100,100),u.value=!0,f("[StartMenu] "),d.value=!0}window.__START_MENU_PAUSE__=()=>y(),window.__START_MENU_RESUME__=()=>w()}function V(){S("started"),y()}function H(){const O=jl();m.value=O.controlMode,h.value=!0}function G(){h.value=!1}function ie(O){m.value=O,Tm("controlMode",O),window.updateControlMode&&window.updateControlMode(O),f(`[StartMenu] : ${O}`)}return Pt(()=>{d.value=!1,u.value=!1,f("[StartMenu] ..."),!o&&n.value?(o=new yo,o.background=null,i=new Dn(50,window.innerWidth/window.innerHeight,.1,1e3),i.position.set(-3.655,.2,-.006),i.rotation.set(-1.618275,-1.538307,-1.6183,"XYZ"),a=new bo({antialias:!0,alpha:!0,canvas:n.value}),a.setSize(window.innerWidth,window.innerHeight),a.setPixelRatio(window.devicePixelRatio),a.setClearColor(0,0),window.addEventListener("resize",T),g(),f("[StartMenu] ")):o&&!l?f("[StartMenu] "):l&&(f("[StartMenu] Logo"),d.value=!0,u.value=!0),window.__INIT_THREE_SCENE__=async O=>{if(o&&l){f("[StartMenu] Logo"),d.value=!0,u.value=!0;return}f("[StartMenu] 3D..."),await z(O)}}),us(()=>{$()}),(O,R)=>(D(),j("div",Mm,[p("div",{class:"startmenu__bg",style:Gt({backgroundImage:`url('${_.value}')`})},null,4),p("canvas",{ref_key:"canvasRef",ref:n,class:"startmenu__canvas"},null,512),Yr(p("div",{class:Ye(["startmenu-ui",{"fade-in":d.value}])},[p("button",{id:"start-btn",class:"startmenu-btn","aria-label":"",onClick:V},"  "),p("button",{id:"settings-btn",class:"startmenu-btn","aria-label":"",onClick:H},"  ")],2),[[Ll,d.value]]),h.value?(D(),j("div",Cm,[p("div",Em,[p("div",{class:"settings-local__header"},[R[2]||(R[2]=p("div",{class:"settings-local__title"},"",-1)),p("button",{class:"settings-local__close",onClick:G,"aria-label":""},"  ")]),p("div",xm,[p("div",km,[R[5]||(R[5]=p("div",{class:"setting-label"},"",-1)),p("div",Am,[p("button",{class:Ye(["option-btn",{active:m.value==="touchpad"}]),onClick:R[0]||(R[0]=re=>ie("touchpad"))},[...R[3]||(R[3]=[p("span",{class:"option-title"},"",-1),p("span",{class:"option-desc"},"",-1)])],2),p("button",{class:Ye(["option-btn",{active:m.value==="mouse"}]),onClick:R[1]||(R[1]=re=>ie("mouse"))},[...R[4]||(R[4]=[p("span",{class:"option-title"},"",-1),p("span",{class:"option-desc"},"",-1)])],2)])])])])])):ye("",!0)]))}},$m=ut(Rm,[["__scopeId","data-v-2b74aa33"]]),or={type:"change"},Zi={type:"start"},zl={type:"end"},Yn=new nu,ir=new gr,Pm=Math.cos(70*mr.DEG2RAD),pt=new xe,Lt=2*Math.PI,Xe={NONE:-1,ROTATE:0,DOLLY:1,PAN:2,TOUCH_ROTATE:3,TOUCH_PAN:4,TOUCH_DOLLY_PAN:5,TOUCH_DOLLY_ROTATE:6},ai=1e-6;class Lm extends su{constructor(e,s=null){super(e,s),this.state=Xe.NONE,this.target=new xe,this.cursor=new xe,this.minDistance=0,this.maxDistance=1/0,this.minZoom=0,this.maxZoom=1/0,this.minTargetRadius=0,this.maxTargetRadius=1/0,this.minPolarAngle=0,this.maxPolarAngle=Math.PI,this.minAzimuthAngle=-1/0,this.maxAzimuthAngle=1/0,this.enableDamping=!1,this.dampingFactor=.05,this.enableZoom=!0,this.zoomSpeed=1,this.enableRotate=!0,this.rotateSpeed=1,this.keyRotateSpeed=1,this.enablePan=!0,this.panSpeed=1,this.screenSpacePanning=!0,this.keyPanSpeed=7,this.zoomToCursor=!1,this.autoRotate=!1,this.autoRotateSpeed=2,this.keys={LEFT:"ArrowLeft",UP:"ArrowUp",RIGHT:"ArrowRight",BOTTOM:"ArrowDown"},this.mouseButtons={LEFT:en.ROTATE,MIDDLE:en.DOLLY,RIGHT:en.PAN},this.touches={ONE:Qs.ROTATE,TWO:Qs.DOLLY_PAN},this.target0=this.target.clone(),this.position0=this.object.position.clone(),this.zoom0=this.object.zoom,this._domElementKeyEvents=null,this._lastPosition=new xe,this._lastQuaternion=new cn,this._lastTargetPosition=new xe,this._quat=new cn().setFromUnitVectors(e.up,new xe(0,1,0)),this._quatInverse=this._quat.clone().invert(),this._spherical=new la,this._sphericalDelta=new la,this._scale=1,this._panOffset=new xe,this._rotateStart=new It,this._rotateEnd=new It,this._rotateDelta=new It,this._panStart=new It,this._panEnd=new It,this._panDelta=new It,this._dollyStart=new It,this._dollyEnd=new It,this._dollyDelta=new It,this._dollyDirection=new xe,this._mouse=new It,this._performCursorZoom=!1,this._pointers=[],this._pointerPositions={},this._controlActive=!1,this._onPointerMove=Om.bind(this),this._onPointerDown=Im.bind(this),this._onPointerUp=Dm.bind(this),this._onContextMenu=jm.bind(this),this._onMouseWheel=Hm.bind(this),this._onKeyDown=Um.bind(this),this._onTouchStart=Fm.bind(this),this._onTouchMove=Bm.bind(this),this._onMouseDown=Nm.bind(this),this._onMouseMove=Gm.bind(this),this._interceptControlDown=zm.bind(this),this._interceptControlUp=Vm.bind(this),this.domElement!==null&&this.connect(this.domElement),this.update()}connect(e){super.connect(e),this.domElement.addEventListener("pointerdown",this._onPointerDown),this.domElement.addEventListener("pointercancel",this._onPointerUp),this.domElement.addEventListener("contextmenu",this._onContextMenu),this.domElement.addEventListener("wheel",this._onMouseWheel,{passive:!1}),this.domElement.getRootNode().addEventListener("keydown",this._interceptControlDown,{passive:!0,capture:!0}),this.domElement.style.touchAction="none"}disconnect(){this.domElement.removeEventListener("pointerdown",this._onPointerDown),this.domElement.removeEventListener("pointermove",this._onPointerMove),this.domElement.removeEventListener("pointerup",this._onPointerUp),this.domElement.removeEventListener("pointercancel",this._onPointerUp),this.domElement.removeEventListener("wheel",this._onMouseWheel),this.domElement.removeEventListener("contextmenu",this._onContextMenu),this.stopListenToKeyEvents(),this.domElement.getRootNode().removeEventListener("keydown",this._interceptControlDown,{capture:!0}),this.domElement.style.touchAction="auto"}dispose(){this.disconnect()}getPolarAngle(){return this._spherical.phi}getAzimuthalAngle(){return this._spherical.theta}getDistance(){return this.object.position.distanceTo(this.target)}listenToKeyEvents(e){e.addEventListener("keydown",this._onKeyDown),this._domElementKeyEvents=e}stopListenToKeyEvents(){this._domElementKeyEvents!==null&&(this._domElementKeyEvents.removeEventListener("keydown",this._onKeyDown),this._domElementKeyEvents=null)}saveState(){this.target0.copy(this.target),this.position0.copy(this.object.position),this.zoom0=this.object.zoom}reset(){this.target.copy(this.target0),this.object.position.copy(this.position0),this.object.zoom=this.zoom0,this.object.updateProjectionMatrix(),this.dispatchEvent(or),this.update(),this.state=Xe.NONE}update(e=null){const s=this.object.position;pt.copy(s).sub(this.target),pt.applyQuaternion(this._quat),this._spherical.setFromVector3(pt),this.autoRotate&&this.state===Xe.NONE&&this._rotateLeft(this._getAutoRotationAngle(e)),this.enableDamping?(this._spherical.theta+=this._sphericalDelta.theta*this.dampingFactor,this._spherical.phi+=this._sphericalDelta.phi*this.dampingFactor):(this._spherical.theta+=this._sphericalDelta.theta,this._spherical.phi+=this._sphericalDelta.phi);let n=this.minAzimuthAngle,o=this.maxAzimuthAngle;isFinite(n)&&isFinite(o)&&(n<-Math.PI?n+=Lt:n>Math.PI&&(n-=Lt),o<-Math.PI?o+=Lt:o>Math.PI&&(o-=Lt),n<=o?this._spherical.theta=Math.max(n,Math.min(o,this._spherical.theta)):this._spherical.theta=this._spherical.theta>(n+o)/2?Math.max(n,this._spherical.theta):Math.min(o,this._spherical.theta)),this._spherical.phi=Math.max(this.minPolarAngle,Math.min(this.maxPolarAngle,this._spherical.phi)),this._spherical.makeSafe(),this.enableDamping===!0?this.target.addScaledVector(this._panOffset,this.dampingFactor):this.target.add(this._panOffset),this.target.sub(this.cursor),this.target.clampLength(this.minTargetRadius,this.maxTargetRadius),this.target.add(this.cursor);let i=!1;if(this.zoomToCursor&&this._performCursorZoom||this.object.isOrthographicCamera)this._spherical.radius=this._clampDistance(this._spherical.radius);else{const a=this._spherical.radius;this._spherical.radius=this._clampDistance(this._spherical.radius*this._scale),i=a!=this._spherical.radius}if(pt.setFromSpherical(this._spherical),pt.applyQuaternion(this._quatInverse),s.copy(this.target).add(pt),this.object.lookAt(this.target),this.enableDamping===!0?(this._sphericalDelta.theta*=1-this.dampingFactor,this._sphericalDelta.phi*=1-this.dampingFactor,this._panOffset.multiplyScalar(1-this.dampingFactor)):(this._sphericalDelta.set(0,0,0),this._panOffset.set(0,0,0)),this.zoomToCursor&&this._performCursorZoom){let a=null;if(this.object.isPerspectiveCamera){const r=pt.length();a=this._clampDistance(r*this._scale);const l=r-a;this.object.position.addScaledVector(this._dollyDirection,l),this.object.updateMatrixWorld(),i=!!l}else if(this.object.isOrthographicCamera){const r=new xe(this._mouse.x,this._mouse.y,0);r.unproject(this.object);const l=this.object.zoom;this.object.zoom=Math.max(this.minZoom,Math.min(this.maxZoom,this.object.zoom/this._scale)),this.object.updateProjectionMatrix(),i=l!==this.object.zoom;const c=new xe(this._mouse.x,this._mouse.y,0);c.unproject(this.object),this.object.position.sub(c).add(r),this.object.updateMatrixWorld(),a=pt.length()}else console.warn("WARNING: OrbitControls.js encountered an unknown camera type - zoom to cursor disabled."),this.zoomToCursor=!1;a!==null&&(this.screenSpacePanning?this.target.set(0,0,-1).transformDirection(this.object.matrix).multiplyScalar(a).add(this.object.position):(Yn.origin.copy(this.object.position),Yn.direction.set(0,0,-1).transformDirection(this.object.matrix),Math.abs(this.object.up.dot(Yn.direction))<Pm?this.object.lookAt(this.target):(ir.setFromNormalAndCoplanarPoint(this.object.up,this.target),Yn.intersectPlane(ir,this.target))))}else if(this.object.isOrthographicCamera){const a=this.object.zoom;this.object.zoom=Math.max(this.minZoom,Math.min(this.maxZoom,this.object.zoom/this._scale)),a!==this.object.zoom&&(this.object.updateProjectionMatrix(),i=!0)}return this._scale=1,this._performCursorZoom=!1,i||this._lastPosition.distanceToSquared(this.object.position)>ai||8*(1-this._lastQuaternion.dot(this.object.quaternion))>ai||this._lastTargetPosition.distanceToSquared(this.target)>ai?(this.dispatchEvent(or),this._lastPosition.copy(this.object.position),this._lastQuaternion.copy(this.object.quaternion),this._lastTargetPosition.copy(this.target),!0):!1}_getAutoRotationAngle(e){return e!==null?Lt/60*this.autoRotateSpeed*e:Lt/60/60*this.autoRotateSpeed}_getZoomScale(e){const s=Math.abs(e*.01);return Math.pow(.95,this.zoomSpeed*s)}_rotateLeft(e){this._sphericalDelta.theta-=e}_rotateUp(e){this._sphericalDelta.phi-=e}_panLeft(e,s){pt.setFromMatrixColumn(s,0),pt.multiplyScalar(-e),this._panOffset.add(pt)}_panUp(e,s){this.screenSpacePanning===!0?pt.setFromMatrixColumn(s,1):(pt.setFromMatrixColumn(s,0),pt.crossVectors(this.object.up,pt)),pt.multiplyScalar(e),this._panOffset.add(pt)}_pan(e,s){const n=this.domElement;if(this.object.isPerspectiveCamera){const o=this.object.position;pt.copy(o).sub(this.target);let i=pt.length();i*=Math.tan(this.object.fov/2*Math.PI/180),this._panLeft(2*e*i/n.clientHeight,this.object.matrix),this._panUp(2*s*i/n.clientHeight,this.object.matrix)}else this.object.isOrthographicCamera?(this._panLeft(e*(this.object.right-this.object.left)/this.object.zoom/n.clientWidth,this.object.matrix),this._panUp(s*(this.object.top-this.object.bottom)/this.object.zoom/n.clientHeight,this.object.matrix)):(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - pan disabled."),this.enablePan=!1)}_dollyOut(e){this.object.isPerspectiveCamera||this.object.isOrthographicCamera?this._scale/=e:(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - dolly/zoom disabled."),this.enableZoom=!1)}_dollyIn(e){this.object.isPerspectiveCamera||this.object.isOrthographicCamera?this._scale*=e:(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - dolly/zoom disabled."),this.enableZoom=!1)}_updateZoomParameters(e,s){if(!this.zoomToCursor)return;this._performCursorZoom=!0;const n=this.domElement.getBoundingClientRect(),o=e-n.left,i=s-n.top,a=n.width,r=n.height;this._mouse.x=o/a*2-1,this._mouse.y=-(i/r)*2+1,this._dollyDirection.set(this._mouse.x,this._mouse.y,1).unproject(this.object).sub(this.object.position).normalize()}_clampDistance(e){return Math.max(this.minDistance,Math.min(this.maxDistance,e))}_handleMouseDownRotate(e){this._rotateStart.set(e.clientX,e.clientY)}_handleMouseDownDolly(e){this._updateZoomParameters(e.clientX,e.clientX),this._dollyStart.set(e.clientX,e.clientY)}_handleMouseDownPan(e){this._panStart.set(e.clientX,e.clientY)}_handleMouseMoveRotate(e){this._rotateEnd.set(e.clientX,e.clientY),this._rotateDelta.subVectors(this._rotateEnd,this._rotateStart).multiplyScalar(this.rotateSpeed);const s=this.domElement;this._rotateLeft(Lt*this._rotateDelta.x/s.clientHeight),this._rotateUp(Lt*this._rotateDelta.y/s.clientHeight),this._rotateStart.copy(this._rotateEnd),this.update()}_handleMouseMoveDolly(e){this._dollyEnd.set(e.clientX,e.clientY),this._dollyDelta.subVectors(this._dollyEnd,this._dollyStart),this._dollyDelta.y>0?this._dollyOut(this._getZoomScale(this._dollyDelta.y)):this._dollyDelta.y<0&&this._dollyIn(this._getZoomScale(this._dollyDelta.y)),this._dollyStart.copy(this._dollyEnd),this.update()}_handleMouseMovePan(e){this._panEnd.set(e.clientX,e.clientY),this._panDelta.subVectors(this._panEnd,this._panStart).multiplyScalar(this.panSpeed),this._pan(this._panDelta.x,this._panDelta.y),this._panStart.copy(this._panEnd),this.update()}_handleMouseWheel(e){this._updateZoomParameters(e.clientX,e.clientY),e.deltaY<0?this._dollyIn(this._getZoomScale(e.deltaY)):e.deltaY>0&&this._dollyOut(this._getZoomScale(e.deltaY)),this.update()}_handleKeyDown(e){let s=!1;switch(e.code){case this.keys.UP:e.ctrlKey||e.metaKey||e.shiftKey?this.enableRotate&&this._rotateUp(Lt*this.keyRotateSpeed/this.domElement.clientHeight):this.enablePan&&this._pan(0,this.keyPanSpeed),s=!0;break;case this.keys.BOTTOM:e.ctrlKey||e.metaKey||e.shiftKey?this.enableRotate&&this._rotateUp(-Lt*this.keyRotateSpeed/this.domElement.clientHeight):this.enablePan&&this._pan(0,-this.keyPanSpeed),s=!0;break;case this.keys.LEFT:e.ctrlKey||e.metaKey||e.shiftKey?this.enableRotate&&this._rotateLeft(Lt*this.keyRotateSpeed/this.domElement.clientHeight):this.enablePan&&this._pan(this.keyPanSpeed,0),s=!0;break;case this.keys.RIGHT:e.ctrlKey||e.metaKey||e.shiftKey?this.enableRotate&&this._rotateLeft(-Lt*this.keyRotateSpeed/this.domElement.clientHeight):this.enablePan&&this._pan(-this.keyPanSpeed,0),s=!0;break}s&&(e.preventDefault(),this.update())}_handleTouchStartRotate(e){if(this._pointers.length===1)this._rotateStart.set(e.pageX,e.pageY);else{const s=this._getSecondPointerPosition(e),n=.5*(e.pageX+s.x),o=.5*(e.pageY+s.y);this._rotateStart.set(n,o)}}_handleTouchStartPan(e){if(this._pointers.length===1)this._panStart.set(e.pageX,e.pageY);else{const s=this._getSecondPointerPosition(e),n=.5*(e.pageX+s.x),o=.5*(e.pageY+s.y);this._panStart.set(n,o)}}_handleTouchStartDolly(e){const s=this._getSecondPointerPosition(e),n=e.pageX-s.x,o=e.pageY-s.y,i=Math.sqrt(n*n+o*o);this._dollyStart.set(0,i)}_handleTouchStartDollyPan(e){this.enableZoom&&this._handleTouchStartDolly(e),this.enablePan&&this._handleTouchStartPan(e)}_handleTouchStartDollyRotate(e){this.enableZoom&&this._handleTouchStartDolly(e),this.enableRotate&&this._handleTouchStartRotate(e)}_handleTouchMoveRotate(e){if(this._pointers.length==1)this._rotateEnd.set(e.pageX,e.pageY);else{const n=this._getSecondPointerPosition(e),o=.5*(e.pageX+n.x),i=.5*(e.pageY+n.y);this._rotateEnd.set(o,i)}this._rotateDelta.subVectors(this._rotateEnd,this._rotateStart).multiplyScalar(this.rotateSpeed);const s=this.domElement;this._rotateLeft(Lt*this._rotateDelta.x/s.clientHeight),this._rotateUp(Lt*this._rotateDelta.y/s.clientHeight),this._rotateStart.copy(this._rotateEnd)}_handleTouchMovePan(e){if(this._pointers.length===1)this._panEnd.set(e.pageX,e.pageY);else{const s=this._getSecondPointerPosition(e),n=.5*(e.pageX+s.x),o=.5*(e.pageY+s.y);this._panEnd.set(n,o)}this._panDelta.subVectors(this._panEnd,this._panStart).multiplyScalar(this.panSpeed),this._pan(this._panDelta.x,this._panDelta.y),this._panStart.copy(this._panEnd)}_handleTouchMoveDolly(e){const s=this._getSecondPointerPosition(e),n=e.pageX-s.x,o=e.pageY-s.y,i=Math.sqrt(n*n+o*o);this._dollyEnd.set(0,i),this._dollyDelta.set(0,Math.pow(this._dollyEnd.y/this._dollyStart.y,this.zoomSpeed)),this._dollyOut(this._dollyDelta.y),this._dollyStart.copy(this._dollyEnd);const a=(e.pageX+s.x)*.5,r=(e.pageY+s.y)*.5;this._updateZoomParameters(a,r)}_handleTouchMoveDollyPan(e){this.enableZoom&&this._handleTouchMoveDolly(e),this.enablePan&&this._handleTouchMovePan(e)}_handleTouchMoveDollyRotate(e){this.enableZoom&&this._handleTouchMoveDolly(e),this.enableRotate&&this._handleTouchMoveRotate(e)}_addPointer(e){this._pointers.push(e.pointerId)}_removePointer(e){delete this._pointerPositions[e.pointerId];for(let s=0;s<this._pointers.length;s++)if(this._pointers[s]==e.pointerId){this._pointers.splice(s,1);return}}_isTrackingPointer(e){for(let s=0;s<this._pointers.length;s++)if(this._pointers[s]==e.pointerId)return!0;return!1}_trackPointer(e){let s=this._pointerPositions[e.pointerId];s===void 0&&(s=new It,this._pointerPositions[e.pointerId]=s),s.set(e.pageX,e.pageY)}_getSecondPointerPosition(e){const s=e.pointerId===this._pointers[0]?this._pointers[1]:this._pointers[0];return this._pointerPositions[s]}_customWheelEvent(e){const s=e.deltaMode,n={clientX:e.clientX,clientY:e.clientY,deltaY:e.deltaY};switch(s){case 1:n.deltaY*=16;break;case 2:n.deltaY*=100;break}return e.ctrlKey&&!this._controlActive&&(n.deltaY*=10),n}}function Im(t){this.enabled!==!1&&(this._pointers.length===0&&(this.domElement.setPointerCapture(t.pointerId),this.domElement.addEventListener("pointermove",this._onPointerMove),this.domElement.addEventListener("pointerup",this._onPointerUp)),!this._isTrackingPointer(t)&&(this._addPointer(t),t.pointerType==="touch"?this._onTouchStart(t):this._onMouseDown(t)))}function Om(t){this.enabled!==!1&&(t.pointerType==="touch"?this._onTouchMove(t):this._onMouseMove(t))}function Dm(t){switch(this._removePointer(t),this._pointers.length){case 0:this.domElement.releasePointerCapture(t.pointerId),this.domElement.removeEventListener("pointermove",this._onPointerMove),this.domElement.removeEventListener("pointerup",this._onPointerUp),this.dispatchEvent(zl),this.state=Xe.NONE;break;case 1:const e=this._pointers[0],s=this._pointerPositions[e];this._onTouchStart({pointerId:e,pageX:s.x,pageY:s.y});break}}function Nm(t){let e;switch(t.button){case 0:e=this.mouseButtons.LEFT;break;case 1:e=this.mouseButtons.MIDDLE;break;case 2:e=this.mouseButtons.RIGHT;break;default:e=-1}switch(e){case en.DOLLY:if(this.enableZoom===!1)return;this._handleMouseDownDolly(t),this.state=Xe.DOLLY;break;case en.ROTATE:if(t.ctrlKey||t.metaKey||t.shiftKey){if(this.enablePan===!1)return;this._handleMouseDownPan(t),this.state=Xe.PAN}else{if(this.enableRotate===!1)return;this._handleMouseDownRotate(t),this.state=Xe.ROTATE}break;case en.PAN:if(t.ctrlKey||t.metaKey||t.shiftKey){if(this.enableRotate===!1)return;this._handleMouseDownRotate(t),this.state=Xe.ROTATE}else{if(this.enablePan===!1)return;this._handleMouseDownPan(t),this.state=Xe.PAN}break;default:this.state=Xe.NONE}this.state!==Xe.NONE&&this.dispatchEvent(Zi)}function Gm(t){switch(this.state){case Xe.ROTATE:if(this.enableRotate===!1)return;this._handleMouseMoveRotate(t);break;case Xe.DOLLY:if(this.enableZoom===!1)return;this._handleMouseMoveDolly(t);break;case Xe.PAN:if(this.enablePan===!1)return;this._handleMouseMovePan(t);break}}function Hm(t){this.enabled===!1||this.enableZoom===!1||this.state!==Xe.NONE||(t.preventDefault(),this.dispatchEvent(Zi),this._handleMouseWheel(this._customWheelEvent(t)),this.dispatchEvent(zl))}function Um(t){this.enabled!==!1&&this._handleKeyDown(t)}function Fm(t){switch(this._trackPointer(t),this._pointers.length){case 1:switch(this.touches.ONE){case Qs.ROTATE:if(this.enableRotate===!1)return;this._handleTouchStartRotate(t),this.state=Xe.TOUCH_ROTATE;break;case Qs.PAN:if(this.enablePan===!1)return;this._handleTouchStartPan(t),this.state=Xe.TOUCH_PAN;break;default:this.state=Xe.NONE}break;case 2:switch(this.touches.TWO){case Qs.DOLLY_PAN:if(this.enableZoom===!1&&this.enablePan===!1)return;this._handleTouchStartDollyPan(t),this.state=Xe.TOUCH_DOLLY_PAN;break;case Qs.DOLLY_ROTATE:if(this.enableZoom===!1&&this.enableRotate===!1)return;this._handleTouchStartDollyRotate(t),this.state=Xe.TOUCH_DOLLY_ROTATE;break;default:this.state=Xe.NONE}break;default:this.state=Xe.NONE}this.state!==Xe.NONE&&this.dispatchEvent(Zi)}function Bm(t){switch(this._trackPointer(t),this.state){case Xe.TOUCH_ROTATE:if(this.enableRotate===!1)return;this._handleTouchMoveRotate(t),this.update();break;case Xe.TOUCH_PAN:if(this.enablePan===!1)return;this._handleTouchMovePan(t),this.update();break;case Xe.TOUCH_DOLLY_PAN:if(this.enableZoom===!1&&this.enablePan===!1)return;this._handleTouchMoveDollyPan(t),this.update();break;case Xe.TOUCH_DOLLY_ROTATE:if(this.enableZoom===!1&&this.enableRotate===!1)return;this._handleTouchMoveDollyRotate(t),this.update();break;default:this.state=Xe.NONE}}function jm(t){this.enabled!==!1&&t.preventDefault()}function zm(t){t.key==="Control"&&(this._controlActive=!0,this.domElement.getRootNode().addEventListener("keyup",this._interceptControlUp,{passive:!0,capture:!0}))}function Vm(t){t.key==="Control"&&(this._controlActive=!1,this.domElement.getRootNode().removeEventListener("keyup",this._interceptControlUp,{passive:!0,capture:!0}))}const Km={class:"startgame-modal"},Wm={class:"card"},qm={class:"card__header"},Xm=["src"],Ym={class:"card__body"},Jm={class:"card__content"},Zm={key:0,class:"loading"},Qm={key:1,class:"error"},e_={key:2,class:"list"},t_=["onClick"],s_={class:"item__img"},n_=["src","alt"],o_={class:"item__meta"},i_={class:"item__name"},a_={class:"item__level"},r_={class:"preview"},l_={class:"preview__info"},c_={key:0,class:"preview__empty"},u_={key:1,class:"preview__names"},d_={class:"preview__name-number"},f_={class:"preview__name-text"},p_={class:"card__footer"},h_=["disabled"],m_=["src"],__={__name:"StartGame",props:{musicOn:{type:Boolean,default:!0},paused:{type:Boolean,default:!1}},emits:["confirm","close"],setup(t,{emit:e}){qt(I=>({aa824e20:re,aa807ca4:ge,aa7b0830:de,a5e82c30:X,aa7dc26a:pe,aa7bf0ee:A,aa816562:ve,aa7cd9ac:K}));const s=e,n=t,o=B(!0),i=B(""),a=B([]),r=B(new Set),l=B(null),c=B(null),u=F("@assets/frontend_resource/startgame.mp3");let d,h,m,_,E;const S=new Map,g=Ae(()=>r.value.size===3),T=Ae(()=>a.value.filter(I=>r.value.has(I.id)));function y(){if(!l.value)return;d=new yo,d.background=new rs(1710618),h=new Dn(45,l.value.clientWidth/l.value.clientHeight,.1,100),h.position.set(0,3,8),m=new bo({antialias:!0}),m.setSize(l.value.clientWidth,l.value.clientHeight),m.setPixelRatio(window.devicePixelRatio),l.value.appendChild(m.domElement),_=new Lm(h,m.domElement),_.enableDamping=!0,_.dampingFactor=.05,_.target.set(0,1,0);const I=new wo(16777215,.5);d.add(I);const Q=new vs(16777215,1);Q.position.set(0,5,10),d.add(Q);const ae=new vs(11193599,.4);ae.position.set(-5,3,5),d.add(ae);const Pe=new vs(16764074,.4);Pe.position.set(5,3,5),d.add(Pe);const Be=new vs(16777215,.3);Be.position.set(0,5,-5),d.add(Be);const ze=new oo(20,20),Ie=new Dt({color:2763306,side:ks}),tt=new ot(ze,Ie);tt.rotation.x=-Math.PI/2,tt.position.y=0,d.add(tt),E=new No;const at=new Go;at.setDecoderPath("https://www.gstatic.com/draco/versioned/decoders/1.5.6/"),E.setDRACOLoader(at),w(),window.addEventListener("resize",$)}function w(){requestAnimationFrame(w),_&&_.update(),m&&d&&h&&m.render(d,h)}function $(){!l.value||!h||!m||(h.aspect=l.value.clientWidth/l.value.clientHeight,h.updateProjectionMatrix(),m.setSize(l.value.clientWidth,l.value.clientHeight))}function z(I){const Q=r.value;if(Q.has(I))Q.delete(I);else{if(Q.size>=3)return;Q.add(I)}r.value=new Set(Q)}async function V(I,Q){if(!d||!E)return;let ae=I.modelUrl;f(`[StartGame] model_url: ${I.name}, URL: ${ae}`);try{const Pe=await Ut.loadModel(ae,!0);f(`[StartGame] : ${I.name}`);const ze=new Ct().setFromObject(Pe).getSize(new xe),Ie=new Jt;Ie.add(Pe);const tt=2.5,at=-(T.value.length-1)*tt/2;Ie.position.set(at+Q*tt,0,0),Ie.scale.set(1,1,1),Ie.rotation.y=-Math.PI/2;const Ve=new Ct().setFromObject(Ie);Ie.position.y=-Ve.min.y,d.add(Ie),S.set(I.id,Ie),f(`[StartGame] : ${I.name}`)}catch(Pe){f(`[StartGame] : ${I.name}`,Pe),H(I,Q)}}function H(I,Q){if(!d)return;const ae=new Yt(.8,.8,.8),Pe=new Dt({color:4491519}),Be=new ot(ae,Pe),ze=2.5,Ie=-(T.value.length-1)*ze/2;Be.position.set(Ie+Q*ze,.8,0),Be.rotation.y=-Math.PI/2,d.add(Be),S.set(I.id,Be)}function G(){d&&(S.forEach(I=>{d.remove(I),I.geometry&&I.geometry.dispose(),I.material&&(Array.isArray(I.material)?I.material.forEach(Q=>Q.dispose()):I.material.dispose())}),S.clear(),T.value.forEach((I,Q)=>{V(I,Q)}))}async function ie(){o.value=!0,i.value="";try{const I=await so(),Q=Array.isArray(I==null?void 0:I.coppers)?I.coppers:[];a.value=(Q||[]).map((ae,Pe)=>{var ze,Ie,tt,at,Ve,ht;const Be=(ze=ae==null?void 0:ae.copper_info)==null?void 0:ze.model_url;return f(`[StartGame] Copper ${((Ie=ae==null?void 0:ae.copper_info)==null?void 0:Ie.name)||Pe+1}: model_url=${Be}`),{id:Number((ae==null?void 0:ae.id)??Pe+1),name:((tt=ae==null?void 0:ae.copper_info)==null?void 0:tt.name)||`#${Pe+1}`,icon:F(((at=ae==null?void 0:ae.copper_info)==null?void 0:at.icon_url)||""),level:Number((ae==null?void 0:ae.level)??1),copperType:(ae==null?void 0:ae.copper_type)||"Arcanist",modelName:((ht=(Ve=ae==null?void 0:ae.copper_info)==null?void 0:Ve.name)==null?void 0:ht.toLowerCase())||"",modelUrl:Be?F(Be):""}})}catch(I){f("[StartGame] ",I),i.value=""}finally{o.value=!1}}async function O(){if(r.value.size!==3)return;const I=Array.from(r.value).map(Q=>String(Q));window.__ACTUAL_COPPER_IDS__=I,f("[StartGame] ID:",I),s("confirm",{ids:I})}function R(){s("close")}Ht(T,()=>{G()},{deep:!0}),Pt(()=>{ie(),setTimeout(()=>{y()},100),n.musicOn&&!n.paused&&c.value&&setTimeout(()=>{if(c.value.readyState>=2)c.value.play().then(()=>{f("[StartGame] ")}).catch(Q=>{f("[StartGame] :",Q)});else{const Q=()=>{c.value.play().then(()=>{f("[StartGame] ")}).catch(ae=>{f("[StartGame] :",ae)}),c.value.removeEventListener("canplay",Q)};c.value.addEventListener("canplay",Q,{once:!0})}},200)}),Ht(()=>n.musicOn,I=>{if(c.value)if(I&&!n.paused)if(c.value.readyState>=2)c.value.play().catch(Q=>{f("[StartGame] :",Q)});else{const Q=()=>{c.value.play().catch(ae=>{f("[StartGame] :",ae)}),c.value.removeEventListener("canplay",Q)};c.value.addEventListener("canplay",Q)}else c.value.pause()}),Ht(()=>n.paused,I=>{if(c.value){if(I)c.value.pause(),f("[StartGame] ");else if(n.musicOn){if(c.value.readyState>=2)c.value.play().catch(Q=>{f("[StartGame] :",Q)});else{const Q=()=>{c.value.play().catch(ae=>{f("[StartGame] :",ae)}),c.value.removeEventListener("canplay",Q)};c.value.addEventListener("canplay",Q)}f("[StartGame] ")}}}),us(()=>{window.removeEventListener("resize",$),c.value&&c.value.pause(),S.forEach(I=>{d&&d.remove(I)}),S.clear(),m&&m.dispose(),_&&_.dispose()});const re=`url('${F("@assets/ui/panel1.png")}')`,ve=`url('${F("@assets/ui/panel2.png")}')`,ge=`url('${F("@assets/ui/panel3.png")}')`,pe=`url('${F("@assets/ui/panel6.png")}')`,K=`url('${F("@assets/ui/panel7.png")}')`,A=`url('${F("@assets/ui/panel8.png")}')`,de=`url('${F("@assets/ui/panel9.png")}')`,X=`url('${F("@assets/ui/panel10.png")}')`;return(I,Q)=>(D(),j("div",Km,[p("div",Wm,[p("div",qm,[Q[0]||(Q[0]=p("div",{class:"card__title"},"",-1)),p("button",{class:"card__close",onClick:R,"aria-label":""},[p("img",{src:ue(F)("@assets/ui/close.png"),alt:""},null,8,Xm)])]),p("div",Ym,[p("div",Jm,[o.value?(D(),j("div",Zm,"...")):i.value?(D(),j("div",Qm,se(i.value),1)):(D(),j("div",e_,[(D(!0),j(Ze,null,Wt(a.value,ae=>(D(),j("div",{key:ae.id,class:Ye(["item",{"item--selected":r.value.has(ae.id)}]),onClick:Pe=>z(ae.id)},[p("div",s_,[p("img",{src:ae.icon,alt:ae.name},null,8,n_)]),p("div",o_,[p("div",i_,se(ae.name),1),p("div",a_,"Lv. "+se(ae.level),1)])],10,t_))),128))])),Q[1]||(Q[1]=p("div",{class:"hint"},"3",-1))]),p("div",r_,[Q[2]||(Q[2]=p("div",{class:"preview__title"},"",-1)),p("div",{ref_key:"previewContainer",ref:l,class:"preview__scene"},null,512),p("div",l_,[T.value.length===0?(D(),j("div",c_,"  ")):(D(),j("div",u_,[(D(!0),j(Ze,null,Wt(T.value,(ae,Pe)=>(D(),j("div",{key:ae.id,class:"preview__name"},[p("span",d_,se(Pe+1),1),p("span",f_,se(ae.name),1)]))),128))]))])])]),p("div",p_,[p("button",{class:"btn btn--primary",disabled:!g.value,onClick:O},"  ",8,h_),p("button",{class:"btn",onClick:R},"")])]),p("audio",{ref_key:"audioRef",ref:c,src:ue(u),loop:"",preload:"auto"},null,8,m_)]))}},g_=ut(__,[["__scopeId","data-v-5e159611"]]),v_={:"spark",:"syrup",:"bubble",:"glimmer",:"turner",:"wrench",:"artifex",:"coil",:"drillbit",:"quickhand",:"rocky",:"wesley",:"bell",:"tumble",:"chief",:"gyro",:"tricky",:"pendulum",:"yoyo",:"karin",:"murmur",:"melody",:"clawster",:"diggs",:"hive"},y_={IronWall:"iron_wall",Arcanist:"arcanist",Mechanic:"mechanic",Resonator:"resonator",CraftsMan:"craftsman"};function b_(t){return v_[t]||t.toLowerCase()}function w_(t){return y_[t]||t.toLowerCase()}const S_={:"rivet_barrier",:"gear_arrow_tower",:"heart_source_mineral_drill",:"steam_mining_car",:"charging_coil",:"repair_workshop",:"mirro_light_refraction_tower",:"resonance_alarm_bell",:"storm_anvil",:"automatic_loading_gun"};function T_(t){return S_[t]||t.toLowerCase().replace(/\s+/g,"_")}function M_(t,e){const s=new Map;function n(c,u,d){if(s.has(c)){const $=s.get(c);$.maxHp=d,o(c,u,d);return}const h=1,m=.1,_=new oo(h,m),E=new $t({color:4456448,side:ks,depthTest:!1,depthWrite:!1,transparent:!1,toneMapped:!1}),S=new ot(_,E),g=new oo(h,m),T=new $t({color:i(u,d),side:ks,depthTest:!1,depthWrite:!1,transparent:!1,toneMapped:!1}),y=new ot(g,T);y.position.z=.001;const w=new Jt;w.add(S),w.add(y),w.renderOrder=999,S.renderOrder=999,y.renderOrder=1e3,t.add(w),s.set(c,{bar:y,background:S,container:w,maxHp:d}),o(c,u,d)}function o(c,u,d){const h=s.get(c);if(!h)return;const{bar:m}=h,_=Math.max(0,Math.min(1,u/d));m.scale.x=_,m.position.x=-(1-_)*.5,m.material.color.setHex(i(u,d))}function i(c,u){const d=c/u;return d>.6?65280:d>.3?16776960:16711680}function a(c){const u=s.get(c);if(!u)return;const{bar:d,background:h,container:m}=u;d.geometry.dispose(),d.material.dispose(),h.geometry.dispose(),h.material.dispose(),t.remove(m),s.delete(c)}function r(c){s.forEach((u,d)=>{const h=c.find(m=>m.id===d);if(h&&h.object){const{container:m}=u,_=h.object.position.clone();_.y+=1.5,m.position.copy(_),m.lookAt(e.position)}})}function l(){s.forEach((c,u)=>{a(u)}),s.clear()}return{healthBars:s,createOrUpdateHealthBar:n,updateHealthBarValue:o,removeHealthBar:a,updateHealthBarsPosition:r,dispose:l}}function C_(t){const e={move:[],attack:[],summon:[]},s={move:{color:4521796,opacity:.6},attack:{color:16729156,opacity:.6},summon:{color:16776960,opacity:.6}};function n(c,u="move"){const[d,h]=c,m=s[u]||s.move,_=new oo(.9,.9),E=new $t({color:m.color,side:ks,transparent:!0,opacity:m.opacity}),S=new ot(_,E);return S.rotation.x=-Math.PI/2,S.position.set(d,.08,h),S.userData={position:c,type:u},t.add(S),e[u].push(S),S}function o(c){const[u,d]=c;let h=!1;return Object.keys(e).forEach(m=>{const _=e[m].findIndex(E=>{const S=E.userData.position;return S[0]===u&&S[1]===d});if(_!==-1){const E=e[m][_];t.remove(E),E.geometry.dispose(),E.material.dispose(),e[m].splice(_,1),h=!0}}),h}function i(c){e[c]&&(e[c].forEach(u=>{t.remove(u),u.geometry.dispose(),u.material.dispose()}),e[c]=[])}function a(){Object.keys(e).forEach(c=>{i(c)})}function r(c,u){var m;const[d,h]=c;return(m=e[u])==null?void 0:m.some(_=>{const E=_.userData.position;return E[0]===d&&E[1]===h})}function l(){a()}return{indicators:e,createIndicator:n,clearIndicatorAt:o,clearIndicators:i,clearAllIndicators:a,hasIndicatorAt:r,dispose:l}}function E_(){const t={geometries:[],materials:[],meshes:[],maxSize:10},e={geometries:[],materials:[],meshes:[],maxSize:10};function s(r){let l;if(t.meshes.length>0)l=t.meshes.pop(),l.geometry.dispose(),l.geometry=new io(.05,.05,r,8),l.material.opacity=.9;else{const c=new io(.05,.05,r,8),u=new $t({color:16729156,transparent:!0,opacity:.9,emissive:16729156,emissiveIntensity:.5});l=new ot(c,u)}return l}function n(r){t.meshes.length<t.maxSize?t.meshes.push(r):(r.geometry.dispose(),r.material.dispose())}function o(){let r;if(e.meshes.length>0)r=e.meshes.pop(),r.scale.set(1,1,1),r.material.opacity=.8;else{const l=new fi(.2,.4,32),c=new $t({color:16711680,side:ks,transparent:!0,opacity:.8,emissive:16711680,emissiveIntensity:.5});r=new ot(l,c),r.rotation.x=-Math.PI/2}return r}function i(r){e.meshes.length<e.maxSize?e.meshes.push(r):(r.geometry.dispose(),r.material.dispose())}function a(){t.meshes.forEach(r=>{r.geometry.dispose(),r.material.dispose()}),t.meshes=[],t.geometries=[],t.materials=[],e.meshes.forEach(r=>{r.geometry.dispose(),r.material.dispose()}),e.meshes=[],e.geometries=[],e.materials=[]}return{getAttackRay:s,recycleAttackRay:n,getExplosionRing:o,recycleExplosionRing:i,dispose:a}}function x_(t){const e=E_();function s(i,a){const r=new xe(i[0],.5,i[1]),l=new xe(a[0],.5,a[1]),c=r.distanceTo(l),u=e.getAttackRay(c),d=new xe().addVectors(r,l).multiplyScalar(.5);u.position.copy(d);const h=new xe().subVectors(l,r).normalize(),m=new cn;m.setFromUnitVectors(new xe(0,1,0),h),u.quaternion.copy(m),t.add(u);let _=.9;const E=()=>{_-=.05,u.material.opacity=_,_<=0?(t.remove(u),e.recycleAttackRay(u)):requestAnimationFrame(E)};setTimeout(E,300);const S=e.getExplosionRing();S.position.set(a[0],.1,a[1]),t.add(S);let g=1,T=.8;const y=()=>{g+=.1,T-=.08,S.scale.set(g,g,1),S.material.opacity=T,T<=0?(t.remove(S),e.recycleExplosionRing(S)):requestAnimationFrame(y)};y()}function n(i,a){const r=Object.entries(a).filter(([w,$])=>$>0).map(([w,$])=>{const z=bt(w);return`+${$} ${z}`});if(r.length===0)return;const l=r.join(`
`),c=document.createElement("canvas"),u=c.getContext("2d");c.width=512,c.height=256,u.fillStyle="rgba(0, 0, 0, 0)",u.fillRect(0,0,c.width,c.height),u.font="bold 48px Arial",u.fillStyle="#ffff00",u.strokeStyle="#000000",u.lineWidth=4,u.textAlign="center",u.textBaseline="middle";const d=l.split(`
`),h=60,m=c.height/2-(d.length-1)*h/2;d.forEach((w,$)=>{const z=m+$*h;u.strokeText(w,c.width/2,z),u.fillText(w,c.width/2,z)});const _=new ou(c),E=new iu({map:_,transparent:!0,opacity:1}),S=new au(E);S.scale.set(2,1,1),S.position.set(i[0],1.5,i[1]),t.add(S);let g=1.5,T=1;const y=()=>{g+=.02,T-=.01,S.position.y=g,S.material.opacity=T,T<=0?(t.remove(S),S.material.map.dispose(),S.material.dispose()):requestAnimationFrame(y)};y()}function o(){e.dispose()}return{createAttackEffect:s,createResourceGainEffect:n,dispose:o}}const k_={key:0,class:"diamond-name"},A_={class:"diamond-row diamond-row--top"},R_=["title","aria-disabled"],$_={class:"diamond border-orange-red"},P_={class:"diamond-content"},L_={class:"diamond-text"},I_={class:"diamond-value"},O_={class:"diamond-row diamond-row--bottom"},D_={class:"diamond border-orange-red"},N_={class:"diamond-content"},G_={class:"diamond-text"},H_={class:"diamond-value"},U_={class:"diamond border-green"},F_={class:"diamond-content"},B_={class:"diamond-text"},j_={class:"diamond-value"},z_={class:"diamond border-blue"},V_={class:"diamond-content"},K_={class:"diamond-text"},W_={class:"diamond-value"},q_={__name:"DiamondPanel",props:{copperInfo:{type:Object,required:!0},inventoryItems:{type:Array,default:()=>[]},inventoryCapacity:{type:Number,default:5}},emits:["inventory-click"],setup(t,{emit:e}){qt(g=>({v2b14f7a8:h,v6dc22a41:s,v740cabaa:n,v4ea1daaa:o}));const s=`url('${F("ui/border-blue.png")}')`,n=`url('${F("ui/border-green.png")}')`,o=`url('${F("ui/border-orange-red.png")}')`,i=t,a=e,r=Ae(()=>{var g;return(((g=i.copperInfo)==null?void 0:g.name)||"").trim()}),l=Ae(()=>{var g,T;return((g=i.copperInfo)==null?void 0:g.isOwnedEnemy)===!0||((T=i.copperInfo)==null?void 0:T.isEnemy)===!0}),c=Ae(()=>l.value&&r.value!==""),u=Ae(()=>{var T;const g=(T=i.copperInfo)==null?void 0:T.position;return!Array.isArray(g)||g.length<2?"--":`${g[0]},${g[1]}`}),d=Ae(()=>l.value===!0),h=`url('${F("@assets/ui/panel4.png")}')`,m=B({SpiritalSpark:0,RecallGear:0,ResonantCrystal:0,RefinedCopper:0,HeartCrystalDust:0});async function _(){try{const g=await Do();g&&Object.keys(m.value).forEach(T=>{m.value[T]=g[T]||0})}catch(g){console.error("[DiamondPanel] :",g)}}Ae(()=>Object.values(m.value).filter(g=>g>0).length);function E(){d.value||a("inventory-click")}const S=B(null);return Pt(async()=>{if(_(),Oo(Nt.UPDATE_RESOURCES,_),!S.value)return;function g(y){return new Promise((w,$)=>{const z=new Image;z.onload=()=>w(z),z.onerror=()=>$(),z.src=y})}function T(y,w){S.value&&S.value.style.setProperty(y,String(w))}try{const[y,w,$]=await Promise.all([g(F("ui/border-blue.png")),g(F("ui/border-green.png")),g(F("ui/border-orange-red.png"))]),z=Math.max(3,Math.round(y.naturalHeight/4)),V=Math.max(3,Math.round(w.naturalHeight/4)),H=Math.max(3,Math.round($.naturalHeight/4));T("--border-blue-slice",z),T("--border-green-slice",V),T("--border-orange-red-slice",H)}catch{T("--border-blue-slice","8"),T("--border-green-slice","8"),T("--border-orange-red-slice","8")}}),(g,T)=>(D(),j("div",{ref_key:"diamondPanelRef",ref:S,class:"diamond-panel"},[c.value?(D(),j("div",k_,se(r.value),1)):ye("",!0),p("div",A_,[p("div",{class:Ye(["diamond","border-blue",{"diamond--disabled":d.value}]),onClick:E,title:d.value?"":"","aria-disabled":d.value?"true":"false"},[...T[0]||(T[0]=[p("div",{class:"diamond-content"},[p("div",{class:"diamond-text"},[p("div",{class:"diamond-label"},"")])],-1)])],10,R_),p("div",$_,[p("div",P_,[p("div",L_,[T[1]||(T[1]=p("div",{class:"diamond-label"},"",-1)),p("div",I_,se(u.value),1)])])])]),p("div",O_,[p("div",D_,[p("div",N_,[p("div",G_,[T[2]||(T[2]=p("div",{class:"diamond-label"},"",-1)),p("div",H_,se(t.copperInfo.attack),1)])])]),p("div",U_,[p("div",F_,[p("div",B_,[T[3]||(T[3]=p("div",{class:"diamond-label"},"",-1)),p("div",j_,se(t.copperInfo.defense),1)])])]),p("div",z_,[p("div",V_,[p("div",K_,[T[4]||(T[4]=p("div",{class:"diamond-label"},"",-1)),p("div",W_,se(t.copperInfo.speed),1)])])])])],512))}},X_=ut(q_,[["__scopeId","data-v-94197fa6"]]),Y_={class:"minecraft-inventory"},J_={class:"inventory-layout"},Z_={class:"inventory-section"},Q_={class:"equipment-header-mc"},eg={class:"copper-name"},tg={class:"inventory-grid"},sg={class:"slot-icon"},ng=["src","alt"],og=["src"],ig=["src"],ag={key:3,class:"equipment-icon"},rg={class:"slot-tooltip"},lg={class:"tooltip-name"},cg={__name:"InventoryModal",props:{visible:{type:Boolean,default:!1},copperName:{type:String,default:""},equipment:{type:Array,default:()=>[]}},emits:["close"],setup(t,{emit:e}){const s=t,n=Ae(()=>s.equipment||[]),o=e;function i(){o("close")}return(a,r)=>t.visible?(D(),j("div",{key:0,class:"inventory-modal",onClick:kt(i,["self"])},[p("div",Y_,[p("div",J_,[p("div",Z_,[p("div",Q_,[p("h4",null,[p("span",eg,se(t.copperName),1),r[0]||(r[0]=Ps("  ",-1))])]),p("div",tg,[(D(),j(Ze,null,Wt(2,(l,c)=>{var u,d,h,m,_,E,S,g,T,y;return p("div",{key:c,class:Ye(["inv-slot",{"has-item":c<n.value.length&&((u=n.value[c])==null?void 0:u.equipped),"slot-locked":(d=n.value[c])==null?void 0:d.locked}])},[c<n.value.length?(D(),j(Ze,{key:0},[p("div",sg,[(h=n.value[c])!=null&&h.equipped&&((m=n.value[c])!=null&&m.icon)&&n.value[c].icon!==""&&(n.value[c].icon.startsWith("/")||n.value[c].icon.startsWith("http")||n.value[c].icon.includes("."))?(D(),j("img",{key:0,src:n.value[c].icon,alt:((_=n.value[c])==null?void 0:_.name)||"",class:"equipment-icon"},null,8,ng)):(E=n.value[c])!=null&&E.locked?(D(),j("img",{key:1,src:ue(F)("@assets/ui/lock.png"),alt:"",class:"equipment-icon"},null,8,og)):((S=n.value[c])==null?void 0:S.icon)===""?(D(),j("img",{key:2,src:ue(F)("@assets/ui/jia.png"),alt:"",class:"equipment-icon"},null,8,ig)):(D(),j("span",ag,se(((g=n.value[c])==null?void 0:g.icon)||""),1))]),p("div",rg,[p("div",lg,se(((T=n.value[c])==null?void 0:T.name)||((y=n.value[c])!=null&&y.locked?"":"")),1)])],64)):ye("",!0)],2)}),64))])])])])])):ye("",!0)}},ug=ut(cg,[["__scopeId","data-v-87970a7f"]]),dg={class:"health-bar","aria-label":"Health Bar"},fg={class:"health-bar__border"},pg={class:"health-bar__border-left"},hg=["src"],mg={class:"health-bar__border-right"},_g=["src"],gg={class:"health-bar__text"},vg={__name:"HealthBar",props:{hp:{type:Number,default:0},maxHp:{type:Number,default:100}},setup(t){qt(l=>({v3bf30af6:o,v3ceb41be:i}));const e=t,s=F("ui/blood-border-left.png"),n=F("ui/blood-border-right.png"),o=`url('${F("ui/blood-border-middle.png")}')`,i=`url('${F("ui/blood-bar.png")}')`,a=Ae(()=>{if(!e.maxHp||e.maxHp===0)return 0;const c=Math.max(0,Math.min(e.hp,e.maxHp))/e.maxHp*100;return Math.max(0,Math.min(100,c))}),r=Ae(()=>{const l=Math.max(0,Math.min(e.hp,e.maxHp)),c=e.maxHp||100;return`${Math.round(l)}/${Math.round(c)}`});return(l,c)=>(D(),j("div",dg,[p("div",fg,[p("div",pg,[p("img",{src:ue(s),alt:""},null,8,hg)]),c[0]||(c[0]=p("div",{class:"health-bar__border-middle"},null,-1)),p("div",mg,[p("img",{src:ue(n),alt:""},null,8,_g)]),p("div",{class:"health-bar__fill",style:Gt({width:`calc(${a.value}% + 20px)`})},null,4),p("div",gg,se(r.value),1)])]))}},yg=ut(vg,[["__scopeId","data-v-7b5f9ec2"]]),bg={class:"tri-panel"},wg={class:"diamond","aria-label":""},Sg=["src"],Tg=["src"],Mg=["title"],Cg=["src"],Eg=["src"],xg=["title"],kg=["src"],Ag=["src","alt"],Rg={__name:"TriPanel",props:{copperType:{type:String,default:""},canMove:{type:Boolean,default:!0},canAttack:{type:Boolean,default:!0},canSummon:{type:Boolean,default:!1}},emits:["move","wait","attack","summon","build"],setup(t,{emit:e}){const s=t,n=e,o=Ae(()=>s.copperType==="CraftsMan"?"build":s.copperType==="Resonator"?"summon":"attack"),i=Ae(()=>o.value==="build"?s.canSummon?"":"":o.value==="summon"?s.canSummon?"":"":s.canAttack?"":""),a=Ae(()=>o.value==="build"||o.value==="summon"?!s.canSummon:!s.canAttack),r=F("ui/your-image.png"),l=F("ui/boot.png"),c=F("ui/mushroom.png"),u=F("ui/sword.png"),d=F("@assets/ui/summon.png"),h=F("@assets/ui/build.png");function m(){s.canMove&&n("move")}function _(){n("wait")}function E(){if(o.value==="build"){if(!s.canSummon)return;n("build")}else if(o.value==="summon"){if(!s.canSummon)return;n("summon")}else{if(!s.canAttack)return;n("attack")}}return(S,g)=>(D(),j("div",bg,[p("div",wg,[p("div",{class:"hex top",title:"",onClick:_},[p("img",{class:"hex-bg",src:ue(r),alt:""},null,8,Sg),p("img",{class:"hex-icon",src:ue(l),alt:""},null,8,Tg)]),p("div",{class:Ye(["hex left",{"is-locked":t.canMove===!1}]),title:t.canMove?"":"",onClick:m},[p("img",{class:"hex-bg",src:ue(r),alt:""},null,8,Cg),p("img",{class:"hex-icon",src:ue(c),alt:""},null,8,Eg)],10,Mg),p("div",{class:Ye(["hex right",{"is-locked":a.value}]),title:i.value,onClick:E},[p("img",{class:"hex-bg",src:ue(r),alt:""},null,8,kg),p("img",{class:"hex-icon",src:o.value==="build"?ue(h):o.value==="summon"?ue(d):ue(u),alt:o.value==="build"?"":o.value==="summon"?"":""},null,8,Ag)],10,xg)])]))}},$g=ut(Rg,[["__scopeId","data-v-38a09e87"]]),Pg={class:"modal-header"},Lg=["src"],Ig={class:"modal-info"},Og={class:"info-text"},Dg={class:"copper-name"},Ng={class:"modal-body"},Gg={class:"structure-list"},Hg=["onClick"],Ug={class:"structure-header"},Fg={class:"structure-name-row"},Bg={class:"structure-name"},jg={class:"structure-type"},zg={class:"structure-stats"},Vg={class:"stat"},Kg={class:"stat-value"},Wg={class:"stat"},qg={class:"stat-value"},Xg={class:"stat"},Yg={class:"stat-value"},Jg={class:"stat"},Zg={class:"stat-value"},Qg={class:"structure-cost"},ev={class:"cost-value"},tv={class:"structure-desc"},sv={key:0,class:"selected-badge"},nv={class:"modal-footer"},ov=["disabled"],iv={__name:"BuildModal",props:{visible:{type:Boolean,default:!1},copperName:{type:String,default:""},structureList:{type:Array,default:()=>[]},position:{type:Array,default:null}},emits:["close","build"],setup(t,{emit:e}){qt(S=>({b71f15e0:d,v26ebd2fa:_,v26e918c0:m,v26ea017e:h,b71e2d22:E}));const s=t,n=e,o=B(null),i=Ae(()=>[...s.structureList].sort((S,g)=>{const T=y=>{var $;const w=(($=y.cost)==null?void 0:$.cost)||y.cost;return!Array.isArray(w)||w.length===0?0:Array.isArray(w[0])?w[0][1]:w[0].count};return T(S)-T(g)}));function a(S){o.value=S}function r(){if(!o.value){f("[BuildModal] ");return}f("[BuildModal] :",o.value.name),n("build",o.value.name),l()}function l(){o.value=null,n("close")}function c(S){return{:"",:"",:"",:""}[S]||""}function u(S){if(!S)return"";const g=S.cost||S;return!Array.isArray(g)||g.length===0?"":g.map(T=>{var y;if(Array.isArray(T)){const w=T[0],$=T[1];return`${((y=Zt[w])==null?void 0:y.name)||w} x${$}`}return`${Xi(T)} x${T.count}`}).join(", ")}const d=`url('${F("@assets/ui/panel11.png")}')`,h=`url('${F("@assets/ui/panel7.png")}')`,m=`url('${F("@assets/ui/panel8.png")}')`,_=`url('${F("@assets/ui/panel5.png")}')`,E=`url('${F("@assets/ui/panel12.png")}')`;return(S,g)=>(D(),xt(el,{to:"body"},[t.visible?(D(),j("div",{key:0,class:"modal-overlay",onClick:kt(l,["self"])},[p("div",{class:"build-modal",onClick:g[0]||(g[0]=kt(()=>{},["stop"]))},[p("div",Pg,[g[1]||(g[1]=p("h2",{class:"modal-title"}," ",-1)),p("button",{class:"close-btn",onClick:l,title:""},[p("img",{src:ue(F)("@assets/ui/close.png"),alt:""},null,8,Lg)])]),p("div",Ig,[p("p",Og,[p("span",Dg,se(t.copperName),1),g[2]||(g[2]=Ps("  ",-1))]),g[3]||(g[3]=p("p",{class:"tip-text"},"   ",-1))]),p("div",Ng,[p("div",Gg,[(D(!0),j(Ze,null,Wt(i.value,T=>{var y,w,$;return D(),j("div",{key:T.name,class:Ye(["structure-card",{selected:((y=o.value)==null?void 0:y.name)===T.name}]),onClick:z=>a(T)},[p("div",Ug,[p("div",Fg,[p("span",Bg,se(T.name),1)]),p("span",jg,se(c(T.name)),1)]),p("div",zg,[p("div",Vg,[g[4]||(g[4]=p("span",{class:"stat-label"},"",-1)),p("span",Kg,se(T.health),1)]),p("div",Wg,[g[5]||(g[5]=p("span",{class:"stat-label"},"",-1)),p("span",qg,se(((w=T.attribute)==null?void 0:w.attack)||""),1)]),p("div",Xg,[g[6]||(g[6]=p("span",{class:"stat-label"},"",-1)),p("span",Yg,se(T.has_storage?"":""),1)]),p("div",Jg,[g[7]||(g[7]=p("span",{class:"stat-label"},"",-1)),p("span",Zg,se(T.attack_range||""),1)])]),p("div",Qg,[g[8]||(g[8]=p("span",{class:"cost-label"}," ",-1)),p("span",ev,se(u(T.cost)),1)]),p("div",tv,se(T.description),1),(($=o.value)==null?void 0:$.name)===T.name?(D(),j("div",sv,"  ")):ye("",!0)],10,Hg)}),128))])]),p("div",nv,[p("button",{class:"btn btn-cancel",onClick:l},""),p("button",{class:"btn btn-confirm",disabled:!o.value,onClick:r},"  ",8,ov)])])])):ye("",!0)]))}},av=ut(iv,[["__scopeId","data-v-96b14c10"]]),rv={key:0,class:"copper-panel-parent"},lv={key:0,class:"minimized-content"},cv=["src"],uv={class:"minimized-info"},dv={class:"minimized-name"},fv={class:"minimized-action"},pv=["src"],hv={class:"panel-content"},mv={key:0,class:"resources"},_v={class:"resources-list"},gv=["onClick"],vv={class:"resource-name"},yv={class:"resource-count"},bv={key:2,class:"enemy-info-tip"},wv={__name:"ActionPanel",props:{copper:{type:Object,default:null},resources:{type:Array,default:()=>[]},hasAttackTargets:{type:Boolean,default:!0},onSelectCopper:{type:Function,default:null}},emits:["close","action","selectCopper"],setup(t,{expose:e,emit:s}){qt(X=>({a4d8c7e2:i.value,e0fd0632:a.value,v58bba3fc:r.value,v1ac48a75:l.value,v27e0a61e:u.value,v0e219880:c.value}));const n=t,o=s,i=Ae(()=>`url('${F("ui/sword.png")}')`),a=Ae(()=>`url('${F("ui/red.png")}')`),r=Ae(()=>`url('${F("ui/boot.png")}')`),l=Ae(()=>`url('${F("ui/green.png")}')`),c=Ae(()=>`url('${F("@assets/ui/build.png")}')`),u=Ae(()=>`url('${F("@assets/ui/summon.png")}')`),d=F("@assets/ui/close.png"),h=B("full"),m=B(null),_=B(!1),E=B(!1),S=B([]),g=Ae(()=>{var I,Q,ae,Pe,Be,ze,Ie,tt,at,Ve,ht,b,M,P,J,W,q,L,ee,Z,Y,he,le,ce,be,Me,Re,Ge,st,lt,Oe,Ue,fe,mt,nt;if(!n.copper)return null;const X=((Q=(I=n.copper.copper)==null?void 0:I.copper_info)==null?void 0:Q.name)||((Pe=(ae=n.copper.enemy)==null?void 0:ae.enemy_base)==null?void 0:Pe.name)||((Be=n.copper.enemy_base)==null?void 0:Be.name)||n.copper.name||` #${n.copper.id}`;return{id:n.copper.id,name:X,level:((ze=n.copper.copper)==null?void 0:ze.level)??((Ie=n.copper.enemy)==null?void 0:Ie.level)??((tt=n.copper.enemy_base)==null?void 0:tt.level)??1,hp:n.copper.now_health,maxHp:((Ve=(at=n.copper.copper)==null?void 0:at.attribute)==null?void 0:Ve.health)??((b=(ht=n.copper.enemy)==null?void 0:ht.enemy_base)==null?void 0:b.health)??((M=n.copper.enemy_base)==null?void 0:M.health)??100,attack:((J=(P=n.copper.copper)==null?void 0:P.attribute)==null?void 0:J.attack)??((q=(W=n.copper.enemy)==null?void 0:W.enemy_base)==null?void 0:q.attack)??((L=n.copper.enemy_base)==null?void 0:L.attack)??0,defense:((Z=(ee=n.copper.copper)==null?void 0:ee.attribute)==null?void 0:Z.defense)??((he=(Y=n.copper.enemy)==null?void 0:Y.enemy_base)==null?void 0:he.defense)??((le=n.copper.enemy_base)==null?void 0:le.defense)??0,speed:((be=(ce=n.copper.copper)==null?void 0:ce.attribute)==null?void 0:be.speed)??((Re=(Me=n.copper.enemy)==null?void 0:Me.enemy_base)==null?void 0:Re.speed)??((Ge=n.copper.enemy_base)==null?void 0:Ge.speed)??0,canMove:n.copper.can_move,canAttack:n.copper.can_attack,canSummon:n.copper.can_summon,position:Array.isArray(n.copper.position)&&n.copper.position.length>=2?n.copper.position:Array.isArray((st=n.copper.enemy)==null?void 0:st.position)&&n.copper.enemy.position.length>=2?n.copper.enemy.position:Array.isArray((lt=n.copper.enemy_base)==null?void 0:lt.position)&&n.copper.enemy_base.position.length>=2?n.copper.enemy_base.position:[0,0],inventoryCapacity:((Oe=n.copper.inventory)==null?void 0:Oe.capacity)||0,copperType:((Ue=n.copper.copper)==null?void 0:Ue.copper_type)||((mt=(fe=n.copper.enemy)==null?void 0:fe.enemy_base)==null?void 0:mt.enemy_type)||((nt=n.copper.enemy_base)==null?void 0:nt.enemy_type)||"",isOwnedEnemy:n.copper.isOwnedEnemy===!0,isEnemy:n.copper.isEnemy===!0}}),T=Ae(()=>{var ae,Pe,Be,ze,Ie;if(!n.copper)return[];const X=((ae=n.copper.copper)==null?void 0:ae.equipment_slot)||{},I=(X==null?void 0:X.slot1)||null,Q=(X==null?void 0:X.slot2)||null;return[I?{name:((Pe=I.equipment_base)==null?void 0:Pe.name)||"",icon:F(((Be=I.equipment_base)==null?void 0:Be.resource_url)||""),equipped:!0,locked:!1}:{name:"",icon:"",equipped:!1,locked:!1},X!=null&&X.is_slot2_locked?{name:"",icon:"",equipped:!1,locked:!0}:Q?{name:((ze=Q.equipment_base)==null?void 0:ze.name)||"",icon:F(((Ie=Q.equipment_base)==null?void 0:Ie.resource_url)||""),equipped:!0,locked:!1}:{name:"",icon:"",equipped:!1,locked:!1}]});Ht(()=>{var X;return(X=n.copper)==null?void 0:X.id},(X,I)=>{X!==I&&(h.value="full",m.value=null,_.value=!1,E.value=!1)});async function y(){if(!g.value.canMove)return;f("[ActionPanel] ");const X=n.copper.isOwnedEnemy===!0,I=X?"on_enemy_move_start":"on_move_start";f(`[ActionPanel] : ${X?"":""}, : ${I}`);const Q=JSON.stringify({type:I,content:{id:String(g.value.id)}});await Ee(Q),h.value="minimized",m.value="moving",o("action",{type:"moveStart",copperId:g.value.id})}async function w(){if(f("[ActionPanel] ",{canAttack:g.value.canAttack,copperId:g.value.id,name:g.value.name}),!g.value.canAttack){f("[ActionPanel] : ");return}f("[ActionPanel] ");const X=n.copper.isOwnedEnemy===!0,I=X?"on_enemy_attack_start":"on_attack_start";f(`[ActionPanel] : ${X?"":""}, : ${I}`);const Q=JSON.stringify({type:I,content:{id:String(g.value.id)}});await Ee(Q),h.value="minimized",m.value="attacking",o("action",{type:"attackStart",copperId:g.value.id})}async function $(){if(f("[ActionPanel] ",{canSummon:g.value.canSummon,copperId:g.value.id,name:g.value.name}),!g.value.canSummon){f("[ActionPanel] : ");return}f("[ActionPanel] ");const X=JSON.stringify({type:"on_summon_start",content:{id:String(g.value.id)}});await Ee(X),h.value="minimized",m.value="summoning",o("action",{type:"summonStart",copperId:g.value.id})}async function z(){if(f("[ActionPanel] ",{copperId:g.value.id,name:g.value.name}),!g.value.canSummon){f("[ActionPanel] : /");return}o("action",{type:"buildRequest",copperId:g.value.id})}function V(X){f("[ActionPanel] ",(X==null?void 0:X.length)||0,""),S.value=X||[],E.value=!0}async function H(X){f("[ActionPanel] :",X),E.value=!1;const I=JSON.stringify({type:"on_structure_build_start",content:{id:String(g.value.id),name:X}});await Ee(I),h.value="minimized",m.value="building",o("action",{type:"buildStart",copperId:g.value.id,structureName:X})}function G(){f("[ActionPanel] "),_.value=!0}async function ie(X){f(`[ActionPanel] : index=${X}`);const I=JSON.stringify({type:"on_copper_pick_up",content:{id:String(g.value.id),index:String(X)}});await Ee(I),await re()}async function O(){f("[ActionPanel] ");const X=JSON.stringify({type:"on_copper_craft",content:{id:String(g.value.id)}});await Ee(X),await re()}async function R(){await O()}async function re(){const I=n.copper.isOwnedEnemy===!0?"on_click_enemy":"on_click_copper",Q=JSON.stringify({type:I,content:{id:String(g.value.id)}});await Ee(Q)}function ve(){f("[ActionPanel] "),o("action",{type:"wait",copperId:g.value.id})}function ge(){h.value="full",m.value=null,_.value=!1,o("close")}function pe(){_.value=!1}function K(){h.value="full",m.value=null,o("action",{type:"cancel",copperId:g.value.id})}function A(){K(),ge()}async function de(X){n.onSelectCopper?await n.onSelectCopper(X):o("selectCopper",X)}return e({cancelAction:K,handleSelectCopper:de,showBuildMenu:V}),(X,I)=>{var Q,ae,Pe,Be,ze,Ie,tt,at;return D(),j(Ze,null,[t.copper?(D(),j("div",rv,[it(X_,{"copper-info":g.value,"inventory-items":[],"inventory-capacity":5,onInventoryClick:G},null,8,["copper-info"]),it(yg,{hp:((Q=g.value)==null?void 0:Q.hp)||0,"max-hp":((ae=g.value)==null?void 0:ae.maxHp)||100},null,8,["hp","max-hp"]),h.value==="minimized"||t.resources&&t.resources.length>0&&h.value==="full"?(D(),j("div",{key:0,class:Ye(["copper-panel",{"copper-panel--minimized":h.value==="minimized","copper-panel--min-attack":h.value==="minimized"&&m.value==="attacking","copper-panel--min-move":h.value==="minimized"&&m.value==="moving","copper-panel--min-summon":h.value==="minimized"&&m.value==="summoning","copper-panel--min-build":h.value==="minimized"&&m.value==="building"}]),onClick:I[0]||(I[0]=kt(()=>{},["stop"]))},[h.value==="minimized"?(D(),j("div",lv,[p("button",{class:"minimized-close",type:"button",onClick:A,title:""},[p("img",{src:ue(d),alt:""},null,8,cv)]),p("div",uv,[p("span",dv,se(g.value.name),1),p("span",fv,se(m.value==="moving"?"...":m.value==="attacking"?"...":m.value==="summoning"?"...":m.value==="building"?"...":""),1)])])):(D(),j(Ze,{key:1},[p("button",{class:"close-btn",onClick:ge,title:""},[p("img",{src:ue(d),alt:""},null,8,pv)]),p("div",hv,[t.resources&&t.resources.length>0?(D(),j("div",mv,[I[3]||(I[3]=p("div",{class:"resources-header"}," ",-1)),p("div",_v,[(D(!0),j(Ze,null,Wt(t.resources,(Ve,ht)=>(D(),j("div",{key:ht,class:"resource-item",onClick:b=>ie(ht),title:""},[p("span",vv,se(ue(Xi)(Ve)),1),p("span",yv,"x"+se(Ve.count||1),1),I[2]||(I[2]=p("span",{class:"resource-pickup"},"",-1))],8,gv))),128))])])):ye("",!0)])],64))],2)):ye("",!0),n.copper.isEnemy?ye("",!0):(D(),xt($g,{key:1,"copper-type":(Pe=g.value)==null?void 0:Pe.copperType,"can-move":((Be=g.value)==null?void 0:Be.canMove)!==!1,"can-attack":((ze=g.value)==null?void 0:ze.canAttack)!==!1,"can-summon":((Ie=g.value)==null?void 0:Ie.canSummon)!==!1,onMove:y,onWait:ve,onAttack:w,onSummon:$,onBuild:z},null,8,["copper-type","can-move","can-attack","can-summon"])),n.copper.isEnemy?(D(),j("div",bv,[...I[4]||(I[4]=[p("span",null," ",-1)])])):ye("",!0)])):ye("",!0),it(ug,{visible:_.value,"copper-name":((tt=g.value)==null?void 0:tt.name)||"",equipment:T.value,onClose:pe,onCraft:R},null,8,["visible","copper-name","equipment"]),it(av,{visible:E.value,"copper-name":((at=g.value)==null?void 0:at.name)||"","structure-list":S.value,onClose:I[1]||(I[1]=Ve=>E.value=!1),onBuild:H},null,8,["visible","copper-name","structure-list"])],64)}}},Sv=ut(wv,[["__scopeId","data-v-3fc53dbe"]]),Tv={class:"panel"},Mv={class:"panel-inner"},Cv={class:"section section-header"},Ev=["aria-label"],xv={class:"section section-body"},kv={class:"current-doll",role:"status","aria-live":"polite"},Av={key:0},Rv={class:"section section-choices",role:"group","aria-label":"Character Queue"},$v=["aria-pressed","data-copper-id","title","onClick"],Pv=["alt","src","data-default-src","data-selected-src"],Lv={class:"actions"},Iv=["disabled"],Ov=["disabled"],Dv={__name:"TurnSystem",props:{currentCopperId:{type:Number,default:null},copperList:{type:Array,default:()=>[]},roundNumber:{type:Number,default:1},isEnemyMoving:{type:Boolean,default:!1}},emits:["nextCopper","endRound","selectCopper"],setup(t,{emit:e}){qt(T=>({v47a453cf:r,v1e3f2614:c,c03019fe:l,v4742a9d0:u,v0776a3a9:d,v9cd100b8:h,baf36480:m}));const s=t,n=e,o=B(null),i=F("ui/choice.png"),a=F("ui/choice-active.png"),r=`url('${F("ui/ribbon-left.png")}')`,l=`url('${F("ui/ribbon-middle.png")}')`,c=`url('${F("ui/ribbon-right.png")}')`,u=`url('${F("ui/panel.png")}')`,d=`url('${F("ui/round1.png")}')`,h=`url('${F("ui/currentcupper.png")}')`,m=`url('${F("ui/btn.png")}')`,_=Ae(()=>{if(!s.currentCopperId)return null;const T=s.copperList.find(y=>y.id===s.currentCopperId);return T?{id:T.id,name:T.name||` #${T.id}`,level:T.level??0,isSummon:T.type==="summon"}:null});function E(){n("nextCopper")}async function S(){const T=JSON.stringify({type:"on_game_round_pass"});await Ee(T),n("endRound")}function g(T){n("selectCopper",T)}return Pt(async()=>{if(!o.value)return;function T(w){return new Promise(($,z)=>{const V=new Image;V.onload=()=>$(V),V.onerror=H=>{f(":",w,H),z(H)},V.src=w})}function y(w,$){o.value&&(o.value.style.setProperty(w,String($)),f(` CSS  ${w} = ${$}`))}try{const[w,$,z]=await Promise.all([T(F("ui/panel.png")),T(F("ui/btn.png")),T(F("ui/currentcupper.png"))]),V=Math.max(4,Math.round(w.naturalHeight/4)),H=Math.max(3,Math.round($.naturalHeight/3)),G=Math.max(3,Math.round(z.naturalHeight/4));f(":",{panelSlice:V,btnSlice:H,currentSlice:G,currentImgSize:`${z.naturalWidth}x${z.naturalHeight}`}),y("--panel-slice",V),y("--btn-slice",H),y("--current-slice",G),setTimeout(()=>{const ie=getComputedStyle(o.value);f("CSS :",{"--current-slice":ie.getPropertyValue("--current-slice"),"--panel-slice":ie.getPropertyValue("--panel-slice"),"--btn-slice":ie.getPropertyValue("--btn-slice")})},100)}catch(w){f(":",w),y("--panel-slice","8"),y("--btn-slice","11"),y("--current-slice","8")}}),(T,y)=>(D(),j("div",{ref_key:"turnSystemRef",ref:o,class:"turn-system"},[y[0]||(y[0]=p("div",{class:"ribbon","aria-hidden":"true"},[p("div",{class:"ribbon-cap left"}),p("div",{class:"ribbon-fill"},"CONTROL"),p("div",{class:"ribbon-cap right"})],-1)),p("div",Tv,[p("div",Mv,[p("section",Cv,[p("div",{class:"round-header",role:"img","aria-label":`Round ${t.roundNumber}`}," Round "+se(t.roundNumber),9,Ev)]),p("section",xv,[p("div",kv,[p("span",null,se(_.value?`${_.value.name||` #${t.currentCopperId}`}`:""),1),_.value&&!_.value.isSummon?(D(),j("span",Av," Lv."+se(_.value.level??0)+" ",1)):ye("",!0)])]),p("section",Rv,[(D(!0),j(Ze,null,Wt(t.copperList,w=>(D(),j("button",{key:w.id,class:"choice",type:"button","aria-pressed":String(w.id===t.currentCopperId),"data-copper-id":w.id,title:w.name||` #${w.id}`,onClick:$=>g(w.id)},[p("img",{alt:w.name||`Character ${w.id}`,src:w.id===t.currentCopperId?ue(a):ue(i),"data-default-src":ue(i),"data-selected-src":ue(a)},null,8,Pv)],8,$v))),128))])])]),p("div",Lv,[p("button",{class:"btn btn-primary",onClick:E,disabled:!t.currentCopperId||t.isEnemyMoving},"  ",8,Iv),p("button",{class:"btn btn-secondary",onClick:S,disabled:t.isEnemyMoving},"  ",8,Ov)])],512))}},Nv=ut(Dv,[["__scopeId","data-v-a62c4b3a"]]),Gv={class:"modal-info"},Hv={class:"info-text"},Uv={class:"copper-name"},Fv={class:"cost-text"},Bv=["src"],jv={class:"modal-body"},zv={class:"enemy-list"},Vv=["onClick"],Kv={class:"enemy-header"},Wv={class:"enemy-name-row"},qv={class:"enemy-name"},Xv={class:"enemy-level"},Yv={class:"enemy-type"},Jv={class:"enemy-stats"},Zv={class:"stat"},Qv={class:"stat-value"},ey={class:"stat"},ty={class:"stat-value"},sy={class:"stat"},ny={class:"stat-value"},oy={class:"stat"},iy={class:"stat-value"},ay={class:"stat"},ry={class:"stat-value"},ly={class:"enemy-desc"},cy={key:0,class:"selected-badge"},uy={class:"modal-footer"},dy=["disabled"],fy={__name:"SummonModal",props:{visible:{type:Boolean,default:!1},copperName:{type:String,default:""},enemyList:{type:Array,default:()=>[]},position:{type:Array,default:null}},emits:["close","summon"],setup(t,{emit:e}){qt(d=>({v30033463:s}));const s=`url('${F("@assets/ui/panel6.png")}')`,n=t,o=e,i=B(null),a=Ae(()=>[...n.enemyList].sort((d,h)=>d.level-h.level));function r(d){i.value=d}function l(){if(!i.value){f("[SummonModal] ");return}f("[SummonModal] :",i.value.name),o("summon",i.value.name),c()}function c(){i.value=null,o("close")}function u(d){return{goblin:"",cruiser:"",scout:"",boxer:"",horn:"",assassin:"",devourer:"",mirror:"",guard:"",demon:"",variant:"",shatra:"BOSS",glutton:"BOSS"}[d]||d}return(d,h)=>(D(),xt(el,{to:"body"},[t.visible?(D(),j("div",{key:0,class:"modal-overlay",onClick:kt(c,["self"])},[p("div",{class:"summon-modal",onClick:h[0]||(h[0]=kt(()=>{},["stop"]))},[p("div",{class:"modal-header"},[h[1]||(h[1]=p("h2",{class:"modal-title"}," ",-1)),p("button",{class:"close-btn",onClick:c,title:""},"")]),p("div",Gv,[p("p",Hv,[p("span",Uv,se(t.copperName),1),h[2]||(h[2]=Ps("  ",-1))]),p("p",Fv,[p("img",{class:"cost-icon",src:ue(F)("resource/spiritual_spark.webp"),alt:""},null,8,Bv),h[3]||(h[3]=Ps(" ",-1)),h[4]||(h[4]=p("strong",null,"1 ",-1))])]),p("div",jv,[p("div",zv,[(D(!0),j(Ze,null,Wt(a.value,m=>{var _,E;return D(),j("div",{key:m.name,class:Ye(["enemy-card",{selected:((_=i.value)==null?void 0:_.name)===m.name}]),onClick:S=>r(m)},[p("div",Kv,[p("div",Wv,[p("span",qv,se(m.name),1),p("span",Xv,"Lv."+se(m.level),1)]),p("span",Yv,se(u(m.enemy_type)),1)]),p("div",Jv,[p("div",Zv,[h[5]||(h[5]=p("span",{class:"stat-label"},"",-1)),p("span",Qv,se(m.health),1)]),p("div",ey,[h[6]||(h[6]=p("span",{class:"stat-label"},"",-1)),p("span",ty,se(m.attack),1)]),p("div",sy,[h[7]||(h[7]=p("span",{class:"stat-label"},"",-1)),p("span",ny,se(m.defense),1)]),p("div",oy,[h[8]||(h[8]=p("span",{class:"stat-label"},"",-1)),p("span",iy,se(m.attack_range),1)]),p("div",ay,[h[9]||(h[9]=p("span",{class:"stat-label"},"",-1)),p("span",ry,se(m.move_range),1)])]),p("div",ly,se(m.description),1),((E=i.value)==null?void 0:E.name)===m.name?(D(),j("div",cy,"   ")):ye("",!0)],10,Vv)}),128))])]),p("div",uy,[p("button",{class:"btn btn-cancel",onClick:c},""),p("button",{class:"btn btn-confirm",disabled:!i.value,onClick:l},"  ",8,dy)])])])):ye("",!0)]))}},py=ut(fy,[["__scopeId","data-v-4a0a4142"]]),hy={key:0,class:"minimized-content"},my={class:"minimized-info"},_y={class:"minimized-name"},gy={class:"minimized-action"},vy={key:1},yy={class:"structure-panel__header"},by={class:"structure-panel__title"},wy={class:"structure-panel__body"},Sy={class:"structure-panel__health"},Ty={class:"structure-panel__health-bar"},My={class:"structure-panel__health-text"},Cy={key:0,class:"structure-panel__storage"},Ey={class:"structure-panel__storage-content"},xy={key:0,class:"structure-panel__storage-item"},ky={class:"structure-panel__storage-name"},Ay={class:"structure-panel__storage-count"},Ry={key:1,class:"structure-panel__storage-empty"},$y={key:1,class:"structure-panel__ground-resources"},Py={class:"structure-panel__ground-list"},Ly={class:"structure-panel__resource-name"},Iy={class:"structure-panel__resource-count"},Oy={key:2,class:"structure-panel__actions"},Dy={__name:"StructurePanel",props:{structure:{type:Object,required:!0},resources:{type:Array,default:()=>[]},actionMode:{type:String,default:null}},emits:["close","action","cancel"],setup(t,{emit:e}){qt(w=>({v31b4b180:_}));const s=t,n=e,o=Ae(()=>{var w;return((w=s.structure.structure_base)==null?void 0:w.name)||""}),i=Ae(()=>s.structure.owned||!1),a=Ae(()=>{var w;return((w=s.structure.structure_base)==null?void 0:w.has_storage)||!1}),r=Ae(()=>s.structure.storage||null),l=Ae(()=>s.structure.can_move||!1),c=Ae(()=>s.structure.can_attack||!1),u=Ae(()=>s.structure.now_health||0),d=Ae(()=>{var w;return((w=s.structure.structure_base)==null?void 0:w.health)||100}),h=Ae(()=>d.value===0?0:Math.max(0,Math.min(100,u.value/d.value*100))),m=Ae(()=>{const w=h.value;return w>60?"#4ade80":w>30?"#facc15":"#ef4444"});F("@assets/ui/panel.png");const _=`url('${F("@assets/ui/panel11.png")}')`,E=Ae(()=>s.actionMode!==null),S=Ae(()=>s.actionMode==="move"?"...":s.actionMode==="attack"?"...":s.actionMode==="extract"?"...":s.actionMode==="transfer"?"...":"");function g(w){f(`[StructurePanel] : ${w}`),n("action",{type:w})}function T(){f("[StructurePanel] "),n("cancel")}function y(){n("close")}return(w,$)=>(D(),j("div",{class:Ye(["structure-panel",{"structure-panel--minimized":E.value}])},[E.value?(D(),j("div",hy,[p("div",my,[p("span",_y,se(o.value),1),p("span",gy,se(S.value),1)]),p("div",{class:"minimized-actions"},[p("button",{class:"mini-btn mini-btn--cancel",onClick:T,title:""},"  ")])])):(D(),j("div",vy,[p("div",yy,[p("div",by,[Ps(se(o.value)+" ",1),p("span",{class:Ye(["structure-panel__badge",{"structure-panel__badge--owned":i.value}])},se(i.value?"":""),3)]),p("button",{class:"structure-panel__close",onClick:y,"aria-label":""},"  ")]),p("div",wy,[p("div",Sy,[$[4]||($[4]=p("div",{class:"structure-panel__health-label"},"",-1)),p("div",Ty,[p("div",{class:"structure-panel__health-fill",style:Gt({width:h.value+"%",backgroundColor:m.value})},null,4)]),p("div",My,se(Math.ceil(u.value))+" / "+se(Math.ceil(d.value)),1)]),a.value?(D(),j("div",Cy,[$[5]||($[5]=p("div",{class:"structure-panel__storage-label"},"",-1)),p("div",Ey,[r.value?(D(),j("div",xy,[p("span",ky,se(ue(Xi)(r.value)),1),p("span",Ay,"x"+se(r.value.count||0),1)])):(D(),j("div",Ry,""))])])):ye("",!0),t.resources&&t.resources.length>0?(D(),j("div",$y,[$[6]||($[6]=p("div",{class:"structure-panel__ground-label"},"",-1)),p("div",Py,[(D(!0),j(Ze,null,Wt(t.resources,(z,V)=>(D(),j("div",{key:V,class:"structure-panel__ground-item"},[p("span",Ly,se(z.name||""),1),p("span",Iy,"x"+se(z.count||0),1)]))),128))])])):ye("",!0),i.value?(D(),j("div",Oy,[l.value?(D(),j("button",{key:0,class:"structure-panel__action-btn structure-panel__action-btn--move",onClick:$[0]||($[0]=z=>g("move"))},"  ")):ye("",!0),c.value?(D(),j("button",{key:1,class:"structure-panel__action-btn structure-panel__action-btn--attack",onClick:$[1]||($[1]=z=>g("attack"))},"  ")):ye("",!0),a.value&&r.value?(D(),j("button",{key:2,class:"structure-panel__action-btn structure-panel__action-btn--transfer",onClick:$[2]||($[2]=z=>g("transfer"))},"  ")):ye("",!0),a.value?(D(),j("button",{key:3,class:"structure-panel__action-btn structure-panel__action-btn--extract",onClick:$[3]||($[3]=z=>g("extract"))},"  ")):ye("",!0)])):ye("",!0)])]))],2))}},Ny=ut(Dy,[["__scopeId","data-v-c3c198e2"]]),Gy={class:"resource-panel"},Hy={class:"resource-list"},Uy={class:"resource-layout"},Fy={class:"row row-top"},By=["title"],jy=["src","alt"],zy={class:"resource-count"},Vy={class:"resource-tooltip"},Ky=["title"],Wy=["src","alt"],qy={class:"resource-count"},Xy={class:"resource-tooltip"},Yy={class:"row row-middle"},Jy=["title"],Zy=["src","alt"],Qy={class:"resource-count"},eb={class:"resource-tooltip"},tb={class:"row row-bottom"},sb=["title"],nb=["src","alt"],ob={class:"resource-count"},ib={class:"resource-tooltip"},ab=["title"],rb=["src","alt"],lb={class:"resource-count"},cb={class:"resource-tooltip"},ub={class:"crafting-section"},db={class:"crafting-grid"},fb=["src"],pb={class:"craft-count"},hb={class:"craft-arrow-group"},mb=["src","alt"],_b={class:"craft-result"},gb={class:"recipe-display"},vb=["src"],yb={class:"craft-count"},bb={__name:"ResourcePanel",setup(t,{expose:e}){qt(d=>({v6e6b9dca:n}));const n=`url('${F("@assets/ui/panel5.png")}')`,o=B({SpiritalSpark:0,RecallGear:0,ResonantCrystal:0,RefinedCopper:0,HeartCrystalDust:0}),i=["HeartCrystalDust","RecallGear","ResonantCrystal","RefinedCopper"],a=B(!1),r=B({visible:!1,success:!0,text:""});function l(d,h=!0,m=1500){r.value={visible:!0,success:h,text:d},window.clearTimeout(l._timer),l._timer=window.setTimeout(()=>{r.value.visible=!1},m)}async function c(){if(!a.value){a.value=!0;try{const d=await Xf();zs(Nt.UPDATE_RESOURCES),(d==null?void 0:d.type)==="error"?(console.warn("[ResourcePanel] :",(d==null?void 0:d.content)||d),l("",!1)):(console.log("[ResourcePanel] :",d),l("",!0))}catch(d){console.error("[ResourcePanel] :",d),l("",!1)}finally{a.value=!1}}}async function u(){try{const d=await Do();if(d){const h={},m={};return Object.keys(o.value).forEach(_=>{const E=o.value[_],S=d[_]||0;m[_]=S;const g=S-E;g>0&&(h[_]=g)}),o.value=m,zs(Nt.RESOURCES_UPDATED,h),h}}catch(d){console.error("[ResourcePanel] :",d)}return{}}return Pt(()=>{u(),Oo(Nt.UPDATE_RESOURCES,u)}),us(()=>{Ji(Nt.UPDATE_RESOURCES,u)}),e({updateResources:u}),(d,h)=>{var m;return D(),j("div",Gy,[h[0]||(h[0]=p("div",{class:"resource-header"},[p("span",{class:"header-text"},"")],-1)),p("div",Hy,[p("div",Uy,[p("div",Fy,[p("div",{class:"resource-slot small",title:ue(bt)("RecallGear")},[ue(ns)("RecallGear")?(D(),j("img",{key:0,src:ue(ns)("RecallGear"),alt:ue(bt)("RecallGear"),class:"resource-icon"},null,8,jy)):ye("",!0),p("div",zy,se(o.value.RecallGear||0),1),p("div",Vy,se(ue(bt)("RecallGear")),1)],8,By),p("div",{class:"resource-slot small",title:ue(bt)("HeartCrystalDust")},[ue(ns)("HeartCrystalDust")?(D(),j("img",{key:0,src:ue(ns)("HeartCrystalDust"),alt:ue(bt)("HeartCrystalDust"),class:"resource-icon"},null,8,Wy)):ye("",!0),p("div",qy,se(o.value.HeartCrystalDust||0),1),p("div",Xy,se(ue(bt)("HeartCrystalDust")),1)],8,Ky)]),p("div",Yy,[p("div",{class:"resource-slot large",title:ue(bt)("SpiritalSpark")},[ue(ns)("SpiritalSpark")?(D(),j("img",{key:0,src:ue(ns)("SpiritalSpark"),alt:ue(bt)("SpiritalSpark"),class:"resource-icon"},null,8,Zy)):ye("",!0),p("div",Qy,se(o.value.SpiritalSpark||0),1),p("div",eb,se(ue(bt)("SpiritalSpark")),1)],8,Jy)]),p("div",tb,[p("div",{class:"resource-slot small",title:ue(bt)("ResonantCrystal")},[ue(ns)("ResonantCrystal")?(D(),j("img",{key:0,src:ue(ns)("ResonantCrystal"),alt:ue(bt)("ResonantCrystal"),class:"resource-icon"},null,8,nb)):ye("",!0),p("div",ob,se(o.value.ResonantCrystal||0),1),p("div",ib,se(ue(bt)("ResonantCrystal")),1)],8,sb),p("div",{class:"resource-slot small",title:ue(bt)("RefinedCopper")},[ue(ns)("RefinedCopper")?(D(),j("img",{key:0,src:ue(ns)("RefinedCopper"),alt:ue(bt)("RefinedCopper"),class:"resource-icon"},null,8,rb)):ye("",!0),p("div",lb,se(o.value.RefinedCopper||0),1),p("div",cb,se(ue(bt)("RefinedCopper")),1)],8,ab)])])]),p("div",ub,[p("div",db,[(D(),j(Ze,null,Wt(i,(_,E)=>{var S;return p("div",{class:"craft-slot",key:E},[(S=ue(Zt)[_])!=null&&S.icon?(D(),j("img",{key:0,src:ue(Zt)[_].icon,class:"craft-icon"},null,8,fb)):ye("",!0),p("div",pb,se(o.value[_]||0),1)])}),64))]),p("div",hb,[p("img",{class:Ye(["craft-arrow-img",{disabled:a.value}]),src:ue(F)("@assets/ui/upgrade.png"),alt:a.value?"":"",onClick:c},null,10,mb),r.value.visible?(D(),j("div",{key:0,class:Ye(["craft-toast",{success:r.value.success,error:!r.value.success}])},se(r.value.text),3)):ye("",!0)]),p("div",_b,[p("div",gb,[(m=ue(Zt).SpiritalSpark)!=null&&m.icon?(D(),j("img",{key:0,src:ue(Zt).SpiritalSpark.icon,class:"recipe-icon"},null,8,vb)):ye("",!0),p("div",yb,se(o.value.SpiritalSpark||0),1)])])])])}}},wb=ut(bb,[["__scopeId","data-v-f3ce41a7"]]),Sb={key:0,class:"virtual-controls"},Tb={class:"joystick-container joystick-left"},Mb={class:"joystick-container joystick-right"},Cb={class:"vertical-buttons"},Ys=50,Eb={__name:"VirtualControls",props:{visible:{type:Boolean,default:!0}},emits:["move","rotate","verticalMove"],setup(t,{emit:e}){const s=e,n=B(!1),o=B({x:0,y:0}),i=B({x:0,y:0}),a=B(null),r=B(!1),l=B({x:0,y:0}),c=B({x:0,y:0}),u=B(null),d=B(!1),h=B(!1);function m(O){O.preventDefault();const R=O.touches[0];if(!R)return;a.value=R.identifier;const re=O.target.getBoundingClientRect(),ve=re.left+re.width/2,ge=re.top+re.height/2;o.value={x:ve,y:ge},n.value=!0,S(R.clientX,R.clientY)}function _(O){if(!n.value)return;const R=Array.from(O.touches).find(re=>re.identifier===a.value);R&&S(R.clientX,R.clientY)}function E(O){Array.from(O.changedTouches).find(re=>re.identifier===a.value)&&(n.value=!1,i.value={x:0,y:0},a.value=null,s("move",{x:0,y:0}))}function S(O,R){const re=O-o.value.x,ve=R-o.value.y,ge=Math.sqrt(re*re+ve*ve),pe=Math.min(ge,Ys);if(ge>0){const K=re/ge*pe,A=ve/ge*pe;i.value={x:K,y:A},s("move",{x:K/Ys,y:A/Ys})}}function g(O){O.preventDefault();const R=O.touches[0];if(!R)return;u.value=R.identifier;const re=O.target.getBoundingClientRect(),ve=re.left+re.width/2,ge=re.top+re.height/2;l.value={x:ve,y:ge},r.value=!0,w(R.clientX,R.clientY)}function T(O){if(!r.value)return;const R=Array.from(O.touches).find(re=>re.identifier===u.value);R&&w(R.clientX,R.clientY)}function y(O){Array.from(O.changedTouches).find(re=>re.identifier===u.value)&&(r.value=!1,c.value={x:0,y:0},u.value=null,s("rotate",{x:0,y:0}))}function w(O,R){const re=O-l.value.x,ve=R-l.value.y,ge=Math.sqrt(re*re+ve*ve),pe=Math.min(ge,Ys);if(ge>0){const K=re/ge*pe,A=ve/ge*pe;c.value={x:K,y:A},s("rotate",{x:K/Ys,y:A/Ys})}}function $(){d.value=!0,s("verticalMove",{up:!0,down:!1})}function z(){d.value=!1,s("verticalMove",{up:!1,down:h.value})}function V(){h.value=!0,s("verticalMove",{up:!1,down:!0})}function H(){h.value=!1,s("verticalMove",{up:d.value,down:!1})}const G=Ae(()=>({transform:`translate(${i.value.x}px, ${i.value.y}px)`})),ie=Ae(()=>({transform:`translate(${c.value.x}px, ${c.value.y}px)`}));return(O,R)=>t.visible?(D(),j("div",Sb,[p("div",Tb,[R[0]||(R[0]=p("div",{class:"joystick-label"},"",-1)),p("div",{class:"joystick-base",onTouchstart:m,onTouchmove:_,onTouchend:E,onTouchcancel:E},[p("div",{class:Ye(["joystick-stick",{active:n.value}]),style:Gt(G.value)},null,6)],32)]),p("div",Mb,[R[1]||(R[1]=p("div",{class:"joystick-label"},"",-1)),p("div",{class:"joystick-base",onTouchstart:g,onTouchmove:T,onTouchend:y,onTouchcancel:y},[p("div",{class:Ye(["joystick-stick",{active:r.value}]),style:Gt(ie.value)},null,6)],32)]),p("div",Cb,[p("button",{class:Ye(["vertical-button up-button",{pressed:d.value}]),onTouchstart:kt($,["prevent"]),onTouchend:kt(z,["prevent"]),onTouchcancel:kt(z,["prevent"])},"  ",34),p("button",{class:Ye(["vertical-button down-button",{pressed:h.value}]),onTouchstart:kt(V,["prevent"]),onTouchend:kt(H,["prevent"]),onTouchcancel:kt(H,["prevent"])},"  ",34)])])):ye("",!0)}},xb=ut(Eb,[["__scopeId","data-v-50616a1e"]]),kb={class:"game-scene"},Ab={key:7,class:"info-panel"},Rb={key:8,class:"game-over-overlay"},$b={key:9,class:"game-over-overlay"},Pb={key:10,class:"credits-overlay"},Lb={key:11,class:"game-over-overlay"},Ib=["src"],Ob=["src"],Db=["src"],Nb=["src"],Gb=["src"],Hb=["src"],Ub=["src"],Fb=.2,Bb="url('/assets/panel7.png')",jb="url('/assets/panel8.png')",zb={__name:"GameScene",props:{isGameMode:{type:Boolean,default:!1},musicOn:{type:Boolean,default:!0}},emits:["back"],setup(t,{emit:e}){qt(x=>({v240fdcb5:Bb,v24105114:jb}));const s=t,n=B(null),o=e,i=B(null),a=F("@assets/frontend_resource/gamescene.mp3"),r=B(null),l=B(null),c=B(null),u=B(null),d=B(null),h=B(null),m=F("@assets/frontend_resource/move.mp3"),_=F("@assets/frontend_resource/move_enemy.mp3"),E=F("@assets/frontend_resource/attack.mp3"),S=F("@assets/frontend_resource/attack_enemy.mp3"),g=F("@assets/frontend_resource/me_hurt.mp3"),T=F("@assets/frontend_resource/enemy_hurt.mp3");let y,w,$,z,V=[],H={focusPosition:null,focusTarget:null,lerpFactor:.08},G=null,ie=new It,O=null,R=null,re=null,ve=null;const ge=new Map,pe={w:!1,a:!1,s:!1,d:!1,shift:!1,space:!1},K=B("mobile"),A=B(.002),de=B({x:0,y:0}),X=B({x:0,y:0}),I=B({up:!1,down:!1});window.updateControlMode=x=>{K.value=x,f(`[GameScene] : ${x}`)},window.updateMouseSensitivity=x=>{A.value=x};function Q(x){de.value=x}function ae(x){X.value=x}function Pe(x){I.value=x}function Be(x){const k=x.key.toLowerCase();k==="w"||k==="a"||k==="s"||k==="d"?pe[k]=!0:k==="shift"?pe.shift=!0:k===" "?(pe.space=!0,x.preventDefault()):k==="escape"&&document.pointerLockElement&&document.exitPointerLock()}function ze(x){const k=x.key.toLowerCase();k==="w"||k==="a"||k==="s"||k==="d"?pe[k]=!1:k==="shift"?pe.shift=!1:k===" "&&(pe.space=!1)}let Ie=!1,tt=0,at=0,Ve=0,ht=0,b=!1;function M(x){x.button===0&&(K.value==="mouse"&&n.value&&n.value.requestPointerLock(),Ie=!0,tt=x.clientX,at=x.clientY)}function P(){Ie=!1}function J(x){if(K.value==="touchpad"){if(!Ie)return;const k=x.clientX-tt,U=x.clientY-at;ht-=k*A.value,Ve-=U*A.value,tt=x.clientX,at=x.clientY}else if(K.value==="mouse"&&b){const k=x.movementX||0,U=x.movementY||0;ht-=k*A.value,Ve-=U*A.value}Ve=Math.max(-Math.PI/2,Math.min(Math.PI/2,Ve)),w.rotation.order="YXZ",w.rotation.y=ht,w.rotation.x=Ve}function W(){b=document.pointerLockElement===n.value,f(b?"[GameScene] ":"[GameScene] ")}function q(){f("[GameScene] ")}const L=B(null),ee=B([]),Z=B(null),Y=B(!1),he=B([]),le=B([]),ce=B(null),be=B(null),Me=B(!1),Re=B(null),Ge=B([]),st=B(null),lt=B(1),Oe=B([]),Ue=B(-1),fe=B(null),mt=B(!1),nt=B(new Set),vt=B(!1),Is=new Map,qs=B(!1),Ho=B(!1),Hn=B(!1),Un=B(!1),Kl=Ae(()=>{if(Oe.value.length===0||Ue.value<0||Ue.value>=Oe.value.length)return null;const x=Oe.value[Ue.value];return x?x.id:null});Pt(async()=>{var k;f("[GameScene] "),Wl(),f("[GameScene] "),Zl(),f("[GameScene] ");const{messageQueue:x}=await Nl(async()=>{const{messageQueue:U}=await Promise.resolve().then(()=>Wf);return{messageQueue:U}},void 0,import.meta.url);if((k=x.sceneContext)!=null&&k.setTestMode&&x.sceneContext.setTestMode("eventloop"),window.__ACTUAL_COPPER_IDS__){const U=window.__ACTUAL_COPPER_IDS__;f("[GameScene] ID:",U);const te=JSON.stringify({type:"on_game_start",content:{ids:U}});Ee(te).catch(me=>{f("[GameScene] ",me)}),delete window.__ACTUAL_COPPER_IDS__}else f("[GameScene] ID");window.addEventListener("keydown",Be),window.addEventListener("keyup",ze),window.addEventListener("mousedown",M),window.addEventListener("mouseup",P),window.addEventListener("mousemove",J),document.addEventListener("pointerlockchange",W),document.addEventListener("pointerlockerror",q),ea(),s.musicOn&&i.value&&setTimeout(()=>{if(i.value.readyState>=2)i.value.play().then(()=>{f("[GameScene] ")}).catch(te=>{f("[GameScene] :",te)});else{const te=()=>{i.value.play().then(()=>{f("[GameScene] ")}).catch(me=>{f("[GameScene] :",me)}),i.value.removeEventListener("canplay",te)};i.value.addEventListener("canplay",te,{once:!0})}},200)}),Ht(()=>s.musicOn,x=>{if(i.value)if(x)if(i.value.readyState>=2)i.value.play().catch(k=>{f("[GameScene] :",k)});else{const k=()=>{i.value.play().catch(U=>{f("[GameScene] :",U)}),i.value.removeEventListener("canplay",k)};i.value.addEventListener("canplay",k)}else i.value.pause()}),us(()=>{window.removeEventListener("resize",Qi),window.removeEventListener("click",ta),window.removeEventListener("keydown",Be),window.removeEventListener("keyup",ze),window.removeEventListener("mousedown",M),window.removeEventListener("mouseup",P),window.removeEventListener("mousemove",J),document.removeEventListener("pointerlockchange",W),document.removeEventListener("pointerlockerror",q),document.pointerLockElement&&document.exitPointerLock(),i.value&&i.value.pause(),R&&R.dispose(),re&&re.dispose(),ve&&ve.dispose(),$&&$.dispose()});function Wl(){y=new yo,y.background=new rs(2236962),w=new Dn(60,window.innerWidth/window.innerHeight,.1,2e3),w.position.set(0,5,10),G=new ca,$=new bo({antialias:!0}),$.setSize(window.innerWidth,window.innerHeight),$.setPixelRatio(window.devicePixelRatio),n.value.appendChild($.domElement),z=null;const x=new wo(16777215,.8);y.add(x);const k=new vs(16777215,1);k.position.set(5,10,5),y.add(k),O=new No;const U=new Go;U.setDecoderPath("https://www.gstatic.com/draco/versioned/decoders/1.5.6/"),O.setDRACOLoader(U),s.isGameMode&&window.addEventListener("click",ta),ql(),R=M_(y,w),re=C_(y),ve=x_(y),f("[GameScene] "),f('[GameScene] - /(ID=1,2)""'),f("[GameScene] - EventLoop"),window.addEventListener("resize",Qi)}function ql(){const x=new Yt(.8,.8,.8),k=new Dt({color:4491519}),U=new ot(x,k);U.position.set(.5,.4,.5),y.add(U),V.push({id:1,object:U,name:"1",type:"test"});const te=new Yt(.8,.8,.8),me=new Dt({color:16729156}),v=new ot(te,me);v.position.set(4.5,.4,4.5),y.add(v),V.push({id:2,object:v,name:"2",type:"test"}),f("[GameScene] :",V.map(C=>`ID=${C.id}`))}async function Xl(x,k,U,te=1){const me=Lo(x,k);try{const v=await Ut.loadModel(me,!0);f(`[GameScene] : ${k}`);const C=v.clone(!0);C.traverse(we=>{we.material&&(Array.isArray(we.material)?we.material=we.material.map(Se=>Se.clone()):we.material=we.material.clone())});const ne=new Ct().setFromObject(C).getSize(new xe),oe=new Jt;oe.add(C),oe.position.set(U[0],0,U[1]),oe.scale.set(te,te,te),oe.rotation.y=0;const _e=new Ct().setFromObject(oe);return oe.position.y=-_e.min.y,f(`[GameScene] : ${k}, URL: ${me}`),oe}catch(v){return f(`[GameScene] : ${k}`,v),null}}async function Yl(x,k,U=1,te="model"){try{const me=await Ut.loadModel(x,!0);f(`[GameScene] : ${te}, url=${x}`);const v=me.clone(!0);v.traverse(oe=>{oe.material&&(Array.isArray(oe.material)?oe.material=oe.material.map(_e=>_e.clone()):oe.material=oe.material.clone())});const N=new Ct().setFromObject(v).getSize(new xe),ne=new Jt;return ne.add(v),ne.position.set(k[0],0,k[1]),ne.scale.set(U,U,U),ne}catch(me){return f(`[GameScene] : ${te}, url=${x}, error=${me}`),null}}async function Jl(x,k,U=1){const te=Io(x);try{const me=await Ut.loadModel(te,!0);f(`[GameScene] : ${x}`);const v=me.clone(!0);v.traverse(we=>{we.material&&(Array.isArray(we.material)?we.material=we.material.map(Se=>Se.clone()):we.material=we.material.clone())});const N=new Ct().setFromObject(v).getSize(new xe),ne=new Jt;ne.add(v),ne.position.set(k[0],0,k[1]),ne.scale.set(U,U,U),ne.rotation.y=0;const oe=new Ct().setFromObject(ne);ne.position.y=-oe.min.y;const _e=new Zs(16729156,2.5,12);return _e.position.set(0,N.y*U*.8,0),ne.add(_e),f(`[GameScene] : ${x}, URL: ${te}`),ne}catch(me){return f(`[GameScene] : ${x}`,me),null}}let Fn=null;function Zl(){const x=new Map,k=new Map,U=new Map;function te(v,C,N){const ne=V.find(Se=>Se.id===v);if(!ne||!ne.object)return;let oe,_e;C==="move"?(oe=65280,_e=.8):C==="attack"?(oe=16711680,_e=1):C==="summon"?(oe=16776960,_e=1.2):(oe=16777215,_e=1),x.has(v)||x.set(v,{});const we=x.get(v);if(we[C]&&(y.remove(we[C]),we[C].geometry.dispose(),we[C].material.dispose(),delete we[C]),N){const Se=new fi(_e-.1,_e,32),$e=new $t({color:oe,side:ks,transparent:!0,opacity:.6}),qe=new ot(Se,$e);qe.rotation.x=-Math.PI/2,qe.position.set(ne.object.position.x,.1,ne.object.position.z),y.add(qe),we[C]=qe}}const me=v=>{if(V.forEach(C=>{C.object&&(C.object.scale.set(1,1,1),C.object.traverse(N=>{var ne;N.material&&((ne=N.material.emissive)==null||ne.setHex(0),N.material.emissiveIntensity!==void 0&&(N.material.emissiveIntensity=0))}))}),v!==null){const C=V.find(N=>N.id===v);if(C){C.object.scale.set(1.1,1.1,1.1),C.object.traverse(ne=>{ne.material&&ne.material.emissive&&(ne.material.emissive.setHex(16755200),ne.material.emissiveIntensity=.5)});const N=C.type==="summon"?"":C.type==="copper"?"":"";f(`[GameScene] ${N}: ${C.name} (ID=${v})`)}}};Fn=(v,C)=>{const N=V.find(ct=>ct.id===v);if(!N)return;const ne=new Map;N.object.traverse(ct=>{ct.material&&ct.material.emissive&&(ne.set(ct,{color:ct.material.emissive.getHex(),intensity:ct.material.emissiveIntensity||0}),ct.material.emissive.setHex(16711680),ct.material.emissiveIntensity=.8)}),setTimeout(()=>{ne.forEach((ct,Xt)=>{Xt.material&&Xt.material.emissive&&(Xt.material.emissive.setHex(ct.color),Xt.material.emissiveIntensity=ct.intensity)})},500);const oe=new xe(N.object.position.x,.5,N.object.position.z),_e=new xe(C[0],.5,C[1]),we=new xe().subVectors(_e,oe),Se=we.length(),$e=new xe().addVectors(oe,_e).multiplyScalar(.5),qe=new io(.05,.05,Se,8),He=new $t({color:16729156,transparent:!0,opacity:.9,emissive:16729156,emissiveIntensity:.5}),De=new ot(qe,He);De.position.copy($e),De.quaternion.setFromUnitVectors(new xe(0,1,0),we.normalize()),y.add(De);const Fe=new fi(.2,.4,32),We=new $t({color:16711680,side:ks,transparent:!0,opacity:.8,emissive:16711680,emissiveIntensity:.5}),yt=new ot(Fe,We);yt.rotation.x=-Math.PI/2,yt.position.copy(_e),y.add(yt);const Ds=performance.now(),dt=300;function ft(){const Xt=(performance.now()-Ds)/dt;if(Xt<1){const dn=1-Xt;He&&(He.opacity=dn),We&&(We.opacity=dn),yt.scale.set(1+Xt*2,1+Xt*2,1),requestAnimationFrame(ft)}else y.remove(De),y.remove(yt),qe.dispose(),He.dispose(),Fe.dispose(),We.dispose()}ft(),f(`[GameScene] : ID=${v}, =${oe.x.toFixed(1)},${oe.z.toFixed(1)}  [${C[0]},${C[1]}]`)},Ce.setSceneContext({scene:y,camera:w,controls:z,models:V,gridCellSize:1,focusState:H,focusOnModel:Ql,onShowCopperInfo:(v,C,N)=>{var oe,_e,we,Se,$e,qe,He,De,Fe,We,yt;f(`[GameScene] onShowCopperInfo : type=${(oe=v.copper)==null?void 0:oe.copper_type}, can_build=${v.can_build}, can_summon=${v.can_summon}`),((_e=v.copper)==null?void 0:_e.copper_type)==="CraftsMan"&&v.id!==void 0&&Is.set(v.id,v.can_build===!0);const ne=((Se=(we=v.copper)==null?void 0:we.copper_info)==null?void 0:Se.name)||v.name||((qe=($e=v.enemy)==null?void 0:$e.enemy_base)==null?void 0:qe.name)||((De=(He=v.enemy)==null?void 0:He.enemy_base)==null?void 0:De.enemy_type)||((Fe=v.enemy_base)==null?void 0:Fe.name)||((We=v.enemy_base)==null?void 0:We.enemy_type)||` #${v.id}`;((yt=v.copper)==null?void 0:yt.copper_type)==="CraftsMan"?(f(`[GameScene]  can_build=${v.can_build}  can_summon`),L.value={...v,name:ne,can_summon:v.can_build===!0}):L.value={...v,name:ne},ee.value=C||[],Y.value=N||!1,f(`[GameScene] : ID=${L.value.id}, has_attack_targets=${Y.value}, can_summon=${L.value.can_summon}`)},onShowStructureInfo:(v,C)=>{var N;ce.value=v,be.value={structure:v,resources:C},f(`[GameScene] : ID=${v.id}, =${(N=v.structure_base)==null?void 0:N.name}, =${v.now_health}/${v.structure_base.health}`)},highlightSelectedCopper:me,createAttackEffect:Fn,onMoveStart:(v,C)=>{s.isGameMode&&mt.value&&(C==null?void 0:C.type)==="enemy"&&!(C!=null&&C.isOwned)&&(f(`[GameScene]  ${v} `),nt.value.add(v))},onMoveComplete:v=>{if(!s.isGameMode)return;const C=V.find(_e=>_e.id===v);if((C==null?void 0:C.type)==="structure"){f("[GameScene] "),fe.value=null,vt.value=!1,setTimeout(async()=>{await un(v)},300);return}if((C==null?void 0:C.type)==="enemy"&&!(C!=null&&C.isOwned)){mt.value&&nt.value.has(v)?(f(`[GameScene]  ${v} `),nt.value.delete(v),nt.value.size===0&&(f("[GameScene] "),mt.value=!1)):f(`[GameScene]  ${v} `);return}const ne=Oe.value.some(_e=>_e.id===v),oe=(C==null?void 0:C.type)==="summon"||(C==null?void 0:C.isOwned);!ne&&!oe||(vt.value=!1,f("[GameScene] "),fe.value=null,Z.value&&Z.value.cancelAction(),setTimeout(async()=>{(C==null?void 0:C.type)==="summon"?await Bn(v,!1):await Os(v),setTimeout(()=>{if(ee.value&&ee.value.length>0){f("[GameScene] ");return}na()},100)},300))},onCraftResult:(v,C)=>{f(`[GameScene] : ${v?"":""} - ${C}`),alert(C)},onResourceNotEnough:v=>{f(`[GameScene] : ${v}`),alert(` ${v}`),fe.value=null,st.value=null,Me.value=!1,Re.value=null},onSummonFailed:v=>{f(`[GameScene] : ${v}`),alert(` ${v}`),fe.value=null,Me.value=!1,Re.value=null},onShowSummonMenu:v=>{f("[GameScene] :",v),Ge.value=v||[]},onShowStructureMenu:v=>{var C;f("[GameScene] ",(v==null?void 0:v.length)||0,""),(C=Z.value)!=null&&C.showBuildMenu?Z.value.showBuildMenu(v||[]):f("[GameScene]  copperActionPanelRef.value.showBuildMenu ")},onRemoveCopper:v=>{const C=Oe.value.findIndex(N=>N.id===v);C>-1&&(f(`[GameScene] : ID=${v}`),Oe.value.splice(C,1),L.value&&L.value.id===v&&Uo(),Oe.value.length===0||Ue.value===C?Ue.value=-1:Ue.value>C?Ue.value-=1:Ue.value>=Oe.value.length&&(Ue.value=Oe.value.length-1))},onShowResourceGain:(v,C)=>{f("[GameScene] :",v,C),ve&&Object.keys(C).length>0&&ve.createResourceGainEffect(v,C)},onGameOver:()=>{f("[GameScene] "),qs.value=!0},onGameSuccess:()=>{f("[GameScene] "),Ho.value=!0},onAttackComplete:v=>{if(!s.isGameMode)return;const C=V.find(ne=>ne.id===v);if((C==null?void 0:C.type)==="structure"){f("[GameScene] "),fe.value=null,setTimeout(async()=>{await un(v)},300);return}if(!Oe.value.some(ne=>ne.id===v)){f("[GameScene] ");return}f("[GameScene] "),fe.value=null,Z.value&&Z.value.cancelAction(),setTimeout(async()=>{(C==null?void 0:C.type)==="summon"?await Bn(v,!1):await Os(v),setTimeout(()=>{if(ee.value&&ee.value.length>0){f("[GameScene] ");return}na()},100)},300)},onSetMoveBlock:v=>{re&&re.createIndicator(v,"move"),f(`[GameScene] : =${v}`)},onSetAttackBlock:v=>{if(fe.value==="transferring"){he.value.push(v);const C=V.find(N=>{if(N.type==="copper"&&N.object){const ne=N.object.position;return Math.abs(ne.x-v[0])<.1&&Math.abs(ne.z-v[1])<.1}return!1});if(C){const N=Oe.value.find(oe=>oe.id===C.id);le.value.find(oe=>oe.id===C.id)||(le.value.push({id:C.id,name:C.name||(N?N.name:` #${C.id}`)||` #${C.id}`,position:v}),f(`[GameScene] : ${C.name||C.id} (ID=${C.id}), =${le.value.length}`))}else f(`[GameScene]  ${v} `)}else re&&re.createIndicator(v,"attack"),Y.value=!0,f(`[GameScene] : ${v}`)},onSetCanSummonBlock:v=>{re&&re.createIndicator(v,"summon"),f(`[GameScene] : =${v}`)},onClearBlock:v=>{re&&re.clearIndicatorAt(v)},onSetCopper:async(v,C,N)=>{var He,De,Fe,We,yt,Ds;if(f(`[GameScene] : id=${N.id}, pos=${C}`),V.find(dt=>dt.id===N.id)){f(`[GameScene] ID=${N.id}`);return}if(((He=N.copper)==null?void 0:He.copper_type)==="CraftsMan"&&(Is.set(N.id,N.can_build===!0),f(`[GameScene]  can_build : id=${N.id}, can_build=${N.can_build}`)),s.isGameMode){const dt={id:N.id,name:((De=N.copper.copper_info)==null?void 0:De.name)||` #${N.id}`,level:Number(((Fe=N.copper)==null?void 0:Fe.level)??0),turnDone:!1};Oe.value.find(ft=>ft.id===N.id)||(Oe.value.push(dt),f(`[GameScene] : ${dt.name}`))}const oe=N.copper.copper_type||"Arcanist",_e=((We=N.copper.copper_info)==null?void 0:We.name)||"default",we=(yt=N.copper.copper_info)==null?void 0:yt.model_url;let Se=1;switch(oe){case"IronWall":Se=1.2;break;case"Arcanist":Se=1;break;case"Mechanic":Se=1.1;break;case"Resonator":Se=1;break;case"CraftsMan":Se=1;break;default:Se=1}let $e;if(we&&we.includes("/enemy/")){const dt=F(we);if(f(`[GameScene] URL: ${we} -> ${dt}`),$e=await Yl(dt,C,Se,_e),$e){const ct=new Ct().setFromObject($e).getSize(new xe),Xt=new Ct().setFromObject($e);$e.position.y=-Xt.min.y;const dn=new Zs(4474111,2.5,12);dn.position.set(0,ct.y*Se*.8,0),$e.add(dn)}}else{const dt=b_(_e),ft=w_(oe);f(`[GameScene] : =${_e}, =${dt}, type=${oe}, typeFolder=${ft}`),$e=await Xl(ft,dt,C,Se)}if(!$e){f(`[GameScene] : ${_e}`);const dt=new Yt(.8,.8,.8);let ft=4491519;switch(oe){case"IronWall":ft=8947848;break;case"Arcanist":ft=16729224;break;case"Mechanic":ft=4521864;break;case"Resonator":ft=16755268;break;case"CraftsMan":ft=4474111;break}const ct=new Dt({color:ft});$e=new ot(dt,ct),$e.position.set(C[0],.4,C[1])}$e.userData.modelId=N.id,y.add($e);const qe={id:N.id,object:$e,name:((Ds=N.copper.copper_info)==null?void 0:Ds.name)||`Copper_${N.id}`,type:"copper"};V.push(qe),f(`[GameScene] : ${qe.name} (ID=${N.id})`)},onSetEnemy:async(v,C,N)=>{var De,Fe,We,yt,Ds;const ne=N.id,oe=N.owned||!1;if(f(`[GameScene] : id=${ne}, pos=${C}, owned=${oe}`),V.find(dt=>dt.id===ne)){f(`[GameScene] ID=${ne}`);return}const Se=(((De=N.enemy_base)==null?void 0:De.enemy_type)||"").toLowerCase()||"goblin";let $e=1;switch(Se){case"demon":case"glutton":case"devourer":$e=1.5;break;case"guard":case"horn":$e=1.2;break;default:$e=1}const qe={id:ne,object:null,name:((Fe=N.enemy_base)==null?void 0:Fe.enemy_type)||`Enemy_${ne}`,type:oe?"summon":"enemy",position:C,isOwned:oe,isLoading:!0};V.push(qe);let He=await Jl(Se,C,$e);if(!He){f(`[GameScene] : ${Se}`);const dt=new Yt(.8,.8,.8),ft=new Dt({color:oe?4474111:16711680});He=new ot(dt,ft),He.position.set(C[0],.4,C[1])}if(oe&&He){const ft=new Ct().setFromObject(He).getSize(new xe),ct=new Zs(4474111,2.5,12);ct.position.set(0,ft.y*$e*.8,0),He.add(ct),f(`[GameScene] : ${Se}`)}He.userData.modelId=ne,y.add(He),qe.object=He,qe.isLoading=!1,N.now_health!==void 0&&((We=N.enemy_base)==null?void 0:We.health)!==void 0&&R&&(R.createOrUpdateHealthBar(ne,N.now_health,N.enemy_base.health),f(`[GameScene] : ${Se} (${N.now_health}/${N.enemy_base.health})`)),oe&&(Oe.value.push({id:ne,name:((yt=N.enemy_base)==null?void 0:yt.name)||Se,type:"summon",enemy:N}),f(`[GameScene] : ${Se} (ID=${ne})`)),f(`[GameScene] : ${((Ds=N.enemy_base)==null?void 0:Ds.enemy_type)||ne}, owned=${oe}`)},onSetMaterial:async(v,C,N)=>{var $e,qe,He;if(f(`[GameScene] : id=${v}, pos=${C}, name=${($e=N.material_base)==null?void 0:$e.name}`),V.find(De=>De.id===v)){f(`[GameScene] ID=${v}`);return}const oe=((qe=N.material_base)==null?void 0:qe.name)||"",_e=(He=N.material_base)==null?void 0:He.model_url;if(!_e){f("[GameScene] model_url");const De=new Yt(.5,.5,.5),Fe=new Dt({color:16755200,metalness:.3,roughness:.7}),We=new ot(De,Fe);We.position.set(C[0],.25,C[1]),We.userData.modelId=v,y.add(We),V.push({id:v,object:We,name:oe||`Material_${v}`,type:"material"});return}const we=Gf(_e);let Se=null;try{const De=await Ut.loadModel(we,!0),Fe=new Jt;Fe.add(De),Fe.position.set(C[0],0,C[1]),Fe.scale.set(1,1,1),Fe.rotation.y=0;const We=new Ct().setFromObject(Fe);Fe.position.y=-We.min.y,Se=Fe,f(`[GameScene] : ${oe}, URL: ${we}`)}catch(De){f(`[GameScene] : ${oe}`,De);const Fe=new Yt(.5,.5,.5),We=new Dt({color:16755200,metalness:.3,roughness:.7});Se=new ot(Fe,We),Se.position.set(C[0],.25,C[1])}Se.userData.modelId=v,y.add(Se),V.push({id:v,object:Se,name:oe||`Material_${v}`,type:"material"}),f(`[GameScene] : ${oe}`)},onSetStructure:async(v,C,N)=>{var $e,qe;if(f(`[GameScene] : id=${v}, pos=${C}`),V.find(He=>He.id===v)){f(`[GameScene] ID=${v}`);return}const oe=(($e=N.structure_base)==null?void 0:$e.name)||"",_e=T_(oe),we=Dl(_e);let Se=null;try{const He=await Ut.loadModel(we,!0),De=new Jt;De.add(He),De.position.set(C[0],0,C[1]),De.scale.set(1,1,1),De.rotation.y=0;const Fe=new Ct().setFromObject(De);De.position.y=-Fe.min.y,Se=De,f(`[GameScene] : ${oe}, URL: ${we}`)}catch(He){f(`[GameScene] : ${oe}`,He);const De=new Yt(.9,1.2,.9),Fe=new Dt({color:6710886,metalness:.5,roughness:.6});Se=new ot(De,Fe),Se.position.set(C[0],.6,C[1])}Se.userData.modelId=v,y.add(Se),V.push({id:v,object:Se,name:oe||`Structure_${v}`,type:"structure"}),f(`[GameScene] : ${oe}`),N.now_health!==void 0&&((qe=N.structure_base)!=null&&qe.health)&&R&&(R.createOrUpdateHealthBar(v,N.now_health,N.structure_base.health),f(`[GameScene] : ${oe} (${N.now_health}/${N.structure_base.health})`))},onPutResourceMarker:v=>{const C=`${v[0]},${v[1]}`;if(U.has(C)){const Fe=U.get(C);y.remove(Fe),Fe.traverse(We=>{We.geometry&&We.geometry.dispose(),We.material&&(Array.isArray(We.material)?We.material.forEach(yt=>yt.dispose()):We.material.dispose())}),U.delete(C)}const N=new Jt,ne=new io(.15,.2,.25,8),oe=new Dt({color:16766720,emissive:16755200,emissiveIntensity:.6,metalness:.7,roughness:.3}),_e=new ot(ne,oe);_e.position.y=.125,N.add(_e);const we=new ru(.08,8,8),Se=new Dt({color:16776960,emissive:16776960,emissiveIntensity:1}),$e=new ot(we,Se);$e.position.y=.3,N.add($e);const qe=v[0],He=v[1];N.position.set(qe,.15,He);const De=new Zs(16766720,1.5,3);De.position.set(0,.3,0),N.add(De),y.add(N),U.set(C,N)},onClearResourceMarker:v=>{const C=`${v[0]},${v[1]}`;if(U.has(C)){const N=U.get(C);y.remove(N),N.traverse(ne=>{ne.geometry&&ne.geometry.dispose(),ne.material&&(Array.isArray(ne.material)?ne.material.forEach(oe=>oe.dispose()):ne.material.dispose())}),U.delete(C)}},onDisplayCanMove:(v,C)=>{f(`[GameScene] : id=${v}, show=${C}`),te(v,"move",C),L.value&&L.value.id===v&&(L.value={...L.value,can_move:C},f(`[GameScene] selectedCopper.can_move=${C}`))},onDisplayCanAttack:(v,C)=>{f(`[GameScene] : id=${v}, show=${C}`),te(v,"attack",C),L.value&&L.value.id===v&&(L.value={...L.value,can_attack:C},f(`[GameScene] selectedCopper.can_attack=${C}`))},onDisplayCanSummon:(v,C)=>{var _e;let N=C,ne=!1,oe=!1;L.value&&L.value.id===v?(ne=((_e=L.value.copper)==null?void 0:_e.copper_type)==="CraftsMan",oe=L.value.can_build===!0):Is.has(v)&&(ne=!0,oe=Is.get(v)),ne&&(N=oe,f(`[GameScene] : id=${v}, can_build=${N}`)),f(`[GameScene] /: id=${v}, show=${N}`),te(v,"summon",N),L.value&&L.value.id===v&&(L.value={...L.value,can_summon:N},f(`[GameScene] selectedCopper.can_summon=${N}`))},onClearState:v=>{if(f(`[GameScene] : id=${v}`),x.has(v)){const C=x.get(v);C.move&&(y.remove(C.move),C.move.geometry.dispose(),C.move.material.dispose(),delete C.move),C.attack&&(y.remove(C.attack),C.attack.geometry.dispose(),C.attack.material.dispose(),delete C.attack),C.summon&&(y.remove(C.summon),C.summon.geometry.dispose(),C.summon.material.dispose(),delete C.summon),x.delete(v)}},onUpdateHealth:(v,C,N)=>{f(`[GameScene] : id=${v}, hp=${C}/${N}`);const ne=ge.get(v);if(ne!==void 0&&C<ne&&C>0){const oe=V.find(_e=>_e.id===v);if(oe){const _e=oe.type==="copper",we=_e?d.value:h.value;we&&(we.currentTime=0,we.play().catch(Se=>{f(`[GameScene]  (${_e?"":""}):`,Se)}),f(`[GameScene] : ${_e?"":""} (ID=${v})`))}}ge.set(v,C),R&&R.createOrUpdateHealthBar(v,C,N)},onRemoveHealthBar:v=>{f(`[GameScene] : id=${v}`),R&&R.removeHealthBar(v),ge.delete(v)},onPutMapBlock:v=>{const C=`${v[0]},${v[1]}`;if(k.has(C)){const _e=k.get(C);y.remove(_e),_e.geometry.dispose(),_e.material.dispose()}const N=new Yt(.9,.05,.9),ne=new $t({color:8421504}),oe=new ot(N,ne);oe.position.set(v[0],.025,v[1]),y.add(oe),k.set(C,oe)},animateModelMove:(v,C,N)=>{if(!v||!v.object)return;const ne=v.type==="enemy",oe=ne?l.value:r.value;oe&&(oe.currentTime=0,oe.play().catch(He=>{f(`[GameScene]  (${ne?"":""}):`,He)})),v.isMoving=!0;const _e=v.object.position.clone(),we=new xe(C.x,C.y,C.z),Se=500,$e=performance.now();function qe(){if(!v||!v.object){N&&N();return}const He=performance.now()-$e,De=Math.min(He/Se,1),Fe=1-Math.pow(1-De,2);v.object.position.lerpVectors(_e,we,Fe),De<1?requestAnimationFrame(qe):(v.object.position.copy(we),v.isMoving=!1,N&&N())}qe()},setTestMode:v=>{f(`[GameScene] ${v==="backend"?"":"EventLoop"}`),V.forEach(C=>{C.type==="test"?C.object.visible=v==="backend":(C.type==="copper"||C.type==="enemy")&&(C.object.visible=v==="eventloop")}),f(`[GameScene] ${v==="backend"?"":""}${v==="eventloop"?"":""}EventLoop`)}}),f("[GameScene] ")}function Ql(x,k,U){const te=new xe;x.getWorldPosition(te);const me=window.cameraFocusDistance||8,v=window.cameraFocusHeight||6,C=0,N=me;return{focusPosition:new xe(te.x+C,te.y+v,te.z+N).clone(),focusTarget:te.clone(),lerpFactor:.1}}function Qi(){w.aspect=window.innerWidth/window.innerHeight,w.updateProjectionMatrix(),$.setSize(window.innerWidth,window.innerHeight)}function ea(){requestAnimationFrame(ea);const x=pe.w||pe.a||pe.s||pe.d||pe.shift||pe.space,k=K.value==="mobile"&&(Math.abs(de.value.x)>.01||Math.abs(de.value.y)>.01||I.value.up||I.value.down);if(x||k){const U=new xe;pe.w&&(U.z-=1),pe.s&&(U.z+=1),pe.a&&(U.x-=1),pe.d&&(U.x+=1),K.value==="mobile"&&(U.x+=de.value.x,U.z+=de.value.y),pe.shift&&(U.y-=1),pe.space&&(U.y+=1),K.value==="mobile"&&(I.value.up&&(U.y+=1),I.value.down&&(U.y-=1)),U.applyQuaternion(w.quaternion),pe.shift||pe.space||K.value==="mobile"&&(I.value.up||I.value.down)?U.y=pe.shift||K.value==="mobile"&&I.value.down?-1:1:U.y=0,w.position.add(U.multiplyScalar(Fb))}K.value==="mobile"&&(Math.abs(X.value.x)>.01||Math.abs(X.value.y)>.01)&&(ht-=X.value.x*.05,Ve-=X.value.y*.05,Ve=Math.max(-Math.PI/2,Math.min(Math.PI/2,Ve)),w.rotation.order="YXZ",w.rotation.y=ht,w.rotation.x=Ve),H.focusPosition&&H.focusTarget&&(w.position.lerp(H.focusPosition,H.lerpFactor),w.lookAt(H.focusTarget),ht=w.rotation.y,Ve=w.rotation.x,w.position.distanceTo(H.focusPosition)<.5&&(f("[GameScene] "),H.focusPosition=null,H.focusTarget=null)),R&&R.updateHealthBarsPosition(V),$.render(y,w)}function ta(x){if(x.target.tagName!=="CANVAS")return;if(ie.x=x.clientX/window.innerWidth*2-1,ie.y=-(x.clientY/window.innerHeight)*2+1,G.setFromCamera(ie,w),fe.value==="moving"||fe.value==="attacking"||fe.value==="summoning"||fe.value==="building"||fe.value==="transferring"||fe.value==="structureMoving"||fe.value==="structureAttacking"||fe.value==="structureExtract"||fe.value==="structureTransfer"){ec(ie);return}const k=V.filter(te=>(te.type==="copper"||te.type==="summon"||te.type==="enemy"||te.type==="structure")&&te.object).map(te=>te.object),U=G.intersectObjects(k,!0);if(U.length>0){let te=U[0].object;for(;te.parent&&!te.userData.modelId;)te=te.parent;const me=te.userData.modelId;if(me!==void 0){const v=V.find(ne=>ne.id===me),N={copper:"",summon:"",enemy:"",structure:""}[v==null?void 0:v.type]||"";f(`[GameScene] ${N}ID:`,me),(v==null?void 0:v.type)==="summon"||(v==null?void 0:v.type)==="enemy"?Bn(me,(v==null?void 0:v.type)==="enemy"):(v==null?void 0:v.type)==="structure"?un(me):Os(me)}}else L.value=null,ce.value=null}async function ec(x){const k=new gr(new xe(0,1,0),0),U=new ca;if(U.setFromCamera(x,w),fe.value==="moving"&&vt.value){f("[GameScene] ");return}const te=new xe;if(U.ray.intersectPlane(k,te),te){const me=Math.round(te.x),v=Math.round(te.z);f(`[GameScene] : (${me}, ${v})`);const C={moving:"move",attacking:"attack",summoning:"summon",building:"summon",structureMoving:"move",structureAttacking:"attack",structureExtract:"attack",structureTransfer:"attack"}[fe.value];if(!re||!re.hasIndicatorAt([me,v],C)){f(`[GameScene]  (${me}, ${v}) `);return}fe.value==="moving"?await tc(me,v):fe.value==="attacking"?await sc(me,v):fe.value==="summoning"?await nc(me,v):fe.value==="building"?await oc(me,v):fe.value==="structureMoving"?await pc(me,v):fe.value==="structureAttacking"?await hc(me,v):fe.value==="structureExtract"?await mc(me,v):fe.value==="structureTransfer"&&await _c(me,v)}}async function tc(x,k){if(!L.value)return;if(vt.value){f("[GameScene] ");return}const U=L.value.isOwnedEnemy===!0,te=U?"on_enemy_move_apply":"on_move_apply";f(`[GameScene] : (${x}, ${k}), =${U?"":""}, =${te}`);const me=JSON.stringify({type:te,content:{id:String(L.value.id),position:{x:String(x),y:String(k)}}});vt.value=!0,await Ee(me)}async function sc(x,k){if(!L.value)return;const U=L.value.isOwnedEnemy===!0,te=U?"on_enemy_attack_apply":"on_attack_apply";f(`[GameScene] : (${x}, ${k}), =${U?"":""}, =${te}`);const me=L.value.id,v=V.find(N=>N.id===me);if(v){const N=v.type==="enemy",ne=N?u.value:c.value;ne&&(ne.currentTime=0,ne.play().catch(oe=>{f(`[GameScene]  (${N?"":""}):`,oe)})),Fn&&Fn(me,[x,k])}const C=JSON.stringify({type:te,content:{id:String(L.value.id),position:{x:String(x),y:String(k)}}});await Ee(C)}async function nc(x,k){if(!L.value)return;f(`[GameScene] : (${x}, ${k})`),Re.value=[x,k];const U=JSON.stringify({type:"on_get_summon_menu"});await Ee(U),await new Promise(te=>setTimeout(te,100)),Me.value=!0}async function oc(x,k){if(!L.value||!st.value)return;f(`[GameScene]  ${st.value} : (${x}, ${k})`);const U=L.value.id,te=JSON.stringify({type:"on_structure_build_apply",content:{id:String(U),position:{x:String(x),y:String(k)},name:st.value}});await Ee(te),fe.value=null,st.value=null,Z.value&&Z.value.cancelAction(),await new Promise(me=>setTimeout(me,100)),f("[GameScene] "),await Os(U)}async function ic(x){if(!L.value||!Re.value)return;const[k,U]=Re.value;f(`[GameScene]  ${x} : (${k}, ${U})`);try{const te=JSON.stringify({type:"on_summon_apply",content:{id:String(L.value.id),position:{x:String(k),y:String(U)},name:x}});await Ee(te)}catch(te){f("[GameScene] :",te)}finally{Me.value=!1,fe.value=null,Re.value=null,Z.value&&Z.value.cancelAction();try{const te=JSON.stringify({type:"on_summon_end"});await Ee(te)}catch(te){f("[GameScene] :",te)}}}function ac(){Me.value=!1,Re.value=null,fe.value=null;const x=JSON.stringify({type:"on_summon_end"});Ee(x).catch(k=>{f("[GameScene] ",k)})}function sa(){if(f("[GameScene] "),fe.value==="structureMoving"){const x=JSON.stringify({type:"on_structure_move_end"});Ee(x).catch(k=>{f("[GameScene] ",k)})}else if(fe.value==="structureAttacking"){const x=JSON.stringify({type:"on_structure_attack_end"});Ee(x).catch(k=>{f("[GameScene] ",k)})}else if(fe.value==="structureExtract"){const x=JSON.stringify({type:"on_structure_extract_end"});Ee(x).catch(k=>{f("[GameScene] ",k)})}else if(fe.value==="structureTransfer"){const x=JSON.stringify({type:"on_structure_transfer_end"});Ee(x).catch(k=>{f("[GameScene] ",k)})}fe.value=null}function rc(){sa(),ce.value=null,be.value=null,f("[GameScene] ")}async function lc(x){if(!ce.value)return;const k=ce.value.id;switch(f(`[GameScene] : ${x.type}, ID=${k}`),x.type){case"move":await cc(k);break;case"attack":await uc(k);break;case"transfer":await fc(k);break;case"extract":await dc(k);break;default:f("[GameScene] :",x.type)}}async function cc(x){f(`[GameScene]  ${x} `);const k=JSON.stringify({type:"on_structure_move_start",content:{id:String(x)}});await Ee(k),fe.value="structureMoving"}async function uc(x){f(`[GameScene]  ${x} `);const k=JSON.stringify({type:"on_structure_attack_start",content:{id:String(x)}});await Ee(k),fe.value="structureAttacking"}async function dc(x){f(`[GameScene]  ${x} `);const k=JSON.stringify({type:"on_structure_extract_start",content:{id:String(x)}});await Ee(k),fe.value="structureExtract"}async function fc(x){f(`[GameScene]  ${x} `);const k=JSON.stringify({type:"on_structure_transfer_start",content:{id:String(x)}});await Ee(k),fe.value="structureTransfer"}async function pc(x,k){if(!ce.value)return;f(`[GameScene]  ${ce.value.id}  (${x}, ${k})`);const U=JSON.stringify({type:"on_structure_move_apply",content:{id:String(ce.value.id),position:{x:String(x),y:String(k)}}});await Ee(U),fe.value=null}async function hc(x,k){if(!ce.value)return;f(`[GameScene]  ${ce.value.id}  (${x}, ${k})`);const U=JSON.stringify({type:"on_structure_attack_apply",content:{id:String(ce.value.id),position:{x:String(x),y:String(k)}}});await Ee(U),fe.value=null}async function mc(x,k){if(!ce.value)return;f(`[GameScene]  ${ce.value.id}  (${x}, ${k}) `);const U=ce.value.id,te=JSON.stringify({type:"on_structure_extract_apply",content:{id:String(U),position:{x:String(x),y:String(k)}}});await Ee(te),f("[GameScene] ");const me=JSON.stringify({type:"on_structure_extract_end"});await Ee(me),await new Promise(v=>setTimeout(v,100)),f("[GameScene] "),fe.value=null,setTimeout(async()=>{f("[GameScene] "),await un(U)},300)}async function _c(x,k){if(!ce.value)return;f(`[GameScene]  ${ce.value.id}  (${x}, ${k}) `);const U=ce.value.id,te=JSON.stringify({type:"on_structure_transfer_apply",content:{id:String(U),position:{x:String(x),y:String(k)}}});await Ee(te),f("[GameScene] ");const me=JSON.stringify({type:"on_structure_transfer_end"});await Ee(me),await new Promise(v=>setTimeout(v,100)),f("[GameScene] "),fe.value=null,setTimeout(async()=>{f("[GameScene] "),await un(U)},300)}async function Os(x){const k=Oe.value.findIndex(te=>te.id===x);k!==-1&&(Ue.value=k),ce.value=null;const U=JSON.stringify({type:"on_click_copper",content:{id:String(x)}});await Ee(U)}async function un(x){f(`[GameScene] : ID=${x}`),L.value=null;const k=JSON.stringify({type:"on_click_structure",content:{id:String(x)}});await Ee(k)}async function Bn(x,k=!1){if(k)Ue.value=-1,Uo();else{const te=Oe.value.findIndex(me=>me.id===x);te!==-1&&(Ue.value=te)}ce.value=null;const U=JSON.stringify({type:"on_click_enemy",content:{id:String(x)}});await Ee(U)}function Uo(){L.value=null,ee.value=[],fe.value=null}async function gc(x){if(f("[GameScene] :",x),x.type==="moveStart")fe.value="moving";else if(x.type==="attackStart")fe.value="attacking";else if(x.type==="summonStart")fe.value="summoning";else if(x.type==="buildRequest"){f("[GameScene] ");const k=JSON.stringify({type:"on_get_structure_menu"});await Ee(k)}else if(x.type==="buildStart")fe.value="building",st.value=x.structureName||null;else if(x.type==="transferring"||x.type==="transferStart")fe.value="transferring",he.value=[],le.value=[];else if(x.type==="transferComplete")fe.value=null,he.value=[],le.value=[];else if(x.type==="cancel"){const k=fe.value;if(k==="moving"){const U=JSON.stringify({type:"on_move_end"});Ee(U).catch(te=>{f("[GameScene] ",te)})}else if(k==="attacking"){const U=JSON.stringify({type:"on_attack_end"});Ee(U).catch(te=>{f("[GameScene] ",te)})}else if(k==="transferring"){const U=JSON.stringify({type:"on_transfer_end"});Ee(U).catch(te=>{f("[GameScene] ",te)}),he.value=[],le.value=[]}else if(k==="summoning"){const U=JSON.stringify({type:"on_summon_end"});Ee(U).catch(te=>{f("[GameScene] ",te)}),Me.value=!1}else if(k==="building"){const U=JSON.stringify({type:"on_structure_build_end"});Ee(U).catch(te=>{f("[GameScene] ",te)}),st.value=null,Re.value=null}fe.value=null}else x.type==="wait"&&(f("[GameScene] "),Fo())}function na(){if(Oe.value.length!==0){if(L.value){const x=L.value.can_move,k=L.value.can_attack,U=L.value.can_summon;if(f(`[GameScene] : ID=${L.value.id}, can_move=${x}, can_attack=${k}, can_summon=${U}, hasAttackTargets=${Y.value}`),x||k&&Y.value||U){f("[GameScene] ");return}}f("[GameScene] "),Fo()}}async function Fo(){var U,te,me;if(Oe.value.length===0)return;L.value=null,fe.value=null,Ue.value;let x=0;const k=Oe.value.length;for(;x<k;){Ue.value=(Ue.value+1)%Oe.value.length;const v=Oe.value[Ue.value];f(`[GameScene] : ${v.name||v.id} ( ${x+1}/${k})`),await new Promise(_e=>{setTimeout(async()=>{const we=V.find($e=>$e.id===v.id);(we==null?void 0:we.type)==="summon"?await Bn(v.id,!1):await Os(v.id),_e()},300)}),await new Promise(_e=>setTimeout(_e,200));const C=((U=L.value)==null?void 0:U.can_move)||!1,N=((te=L.value)==null?void 0:te.can_attack)||!1,ne=((me=L.value)==null?void 0:me.can_summon)||!1,oe=C||N&&Y.value||ne;if(f(`[GameScene]  ${v.name}: can_move=${C}, can_attack=${N}, can_summon=${ne}, hasTargets=${Y.value}, valid=${oe}`),L.value&&oe){f(`[GameScene] : ${v.name||v.id}`);return}x++}f("[GameScene] "),L.value=null,s.isGameMode&&f('[GameScene] ""')}function vc(){lt.value++,Ue.value=-1,L.value=null,fe.value=null,Oe.value.forEach(k=>k.turnDone=!1),f(`[GameScene]  ${lt.value}`);const x=V.filter(k=>k.type==="enemy"&&!k.isOwned);if(f(`[GameScene]  ${x.length} `),x.length===0)f("[GameScene] "),mt.value=!1;else{mt.value=!0,nt.value.clear(),f("[GameScene] ");let k=setTimeout(()=>{mt.value&&nt.value.size>0&&(f("[GameScene] "),mt.value=!1,nt.value.clear())},3e3),U=setInterval(()=>{mt.value||(clearTimeout(k),clearInterval(U))},100);setTimeout(()=>{mt.value&&nt.value.size===0&&(f("[GameScene] "),mt.value=!1,clearTimeout(k),clearInterval(U))},1e3)}}async function yc(){f("[GameScene] "),qs.value=!1;const x=JSON.stringify({type:"on_game_over"});await Ee(x).catch(k=>{f("[GameScene]  on_game_over ",k)}),o("back")}async function bc(){f("[GameScene] game over"),Ho.value=!1;const x=JSON.stringify({type:"on_game_over"});await Ee(x).catch(k=>{f("[GameScene]  on_game_over ",k)}),wc()}function wc(){f("[GameScene] "),Hn.value=!0,setTimeout(()=>{f("[GameScene] "),Hn.value=!1,o("back")},5e3)}function Sc(){f("[GameScene] "),Hn.value=!1,o("back")}function Tc(){f("[GameScene] "),Un.value=!0}function Mc(){f("[GameScene] "),Un.value=!1}async function Cc(){f("[GameScene]  game_over "),Un.value=!1;const x=JSON.stringify({type:"on_game_over"});await Ee(x).catch(k=>{f("[GameScene]  on_game_over ",k)}),o("back")}return(x,k)=>{var U,te,me,v;return D(),j("div",kb,[p("div",{ref_key:"container",ref:n,class:"scene-container"},null,512),t.isGameMode?(D(),xt(Nv,{key:0,currentCopperId:Kl.value,copperList:Oe.value,roundNumber:lt.value,isEnemyMoving:mt.value,onNextCopper:Fo,onEndRound:vc,onSelectCopper:Os},null,8,["currentCopperId","copperList","roundNumber","isEnemyMoving"])):ye("",!0),t.isGameMode?(D(),j("button",{key:1,class:"withdraw-button",onClick:Tc},"  ")):ye("",!0),t.isGameMode?(D(),xt(wb,{key:2})):ye("",!0),t.isGameMode?(D(),xt(xb,{key:3,visible:!0,onMove:Q,onRotate:ae,onVerticalMove:Pe})):ye("",!0),t.isGameMode&&L.value?(D(),xt(Sv,{key:4,ref_key:"copperActionPanelRef",ref:Z,copper:L.value,resources:ee.value,hasAttackTargets:Y.value,transferTargets:le.value,onSelectCopper:Os,onClose:Uo,onAction:gc},null,8,["copper","resources","hasAttackTargets","transferTargets"])):ye("",!0),t.isGameMode?(D(),xt(py,{key:5,visible:Me.value,"copper-name":((me=(te=(U=L.value)==null?void 0:U.copper)==null?void 0:te.copper_info)==null?void 0:me.name)||"","enemy-list":Ge.value,position:Re.value,onClose:ac,onSummon:ic},null,8,["visible","copper-name","enemy-list","position"])):ye("",!0),t.isGameMode&&ce.value?(D(),xt(Ny,{key:6,structure:ce.value,resources:((v=be.value)==null?void 0:v.resources)||[],"action-mode":fe.value==="structureMoving"?"move":fe.value==="structureAttacking"?"attack":fe.value==="structureExtract"?"extract":fe.value==="structureTransfer"?"transfer":null,onClose:rc,onAction:lc,onCancel:sa},null,8,["structure","resources","action-mode"])):ye("",!0),t.isGameMode?ye("",!0):(D(),j("div",Ab,[...k[0]||(k[0]=[mo('<h3 data-v-62ebde6b>3D</h3><p style="color:#ffd700;font-weight:600;" data-v-62ebde6b> </p><div style="margin:8px 0;padding:8px;background:rgba(255, 255, 255, 0.1);border-radius:6px;" data-v-62ebde6b><p style="font-weight:600;" data-v-62ebde6b> </p><p style="font-size:12px;" data-v-62ebde6b>  = ID:1</p><p style="font-size:12px;" data-v-62ebde6b>  = ID:2</p></div><div style="margin:8px 0;padding:8px;background:rgba(255, 255, 255, 0.1);border-radius:6px;" data-v-62ebde6b><p style="font-weight:600;" data-v-62ebde6b> EventLoop</p><p style="font-size:12px;" data-v-62ebde6b>1.   EventLoop</p><p style="font-size:12px;" data-v-62ebde6b>2. &quot; &quot;</p><p style="font-size:12px;" data-v-62ebde6b>3. 3</p><p style="font-size:11px;" data-v-62ebde6b>  =IronWall  =Arcanist  =CraftsMan </p></div>',4)])])),qs.value?(D(),j("div",Rb,[p("div",{class:"game-over-dialog"},[k[1]||(k[1]=p("h2",{class:"game-over-title"},"",-1)),k[2]||(k[2]=p("p",{class:"game-over-message"},"",-1)),p("button",{class:"game-over-button",onClick:yc},"  ")])])):ye("",!0),Ho.value?(D(),j("div",$b,[p("div",{class:"game-over-dialog success-dialog"},[k[3]||(k[3]=p("h2",{class:"success-title"},"  ",-1)),k[4]||(k[4]=p("p",{class:"game-over-message"},"",-1)),p("button",{class:"game-over-button success-button",onClick:bc},"  ")])])):ye("",!0),Hn.value?(D(),j("div",Pb,[p("div",{class:"credits-container"},[k[5]||(k[5]=mo('<h1 class="credits-title" data-v-62ebde6b></h1><div class="credits-content" data-v-62ebde6b><div class="credits-section" data-v-62ebde6b><h2 data-v-62ebde6b></h2><p data-v-62ebde6b>MGPIC Team</p></div><div class="credits-section" data-v-62ebde6b><h2 data-v-62ebde6b></h2><p data-v-62ebde6b>Backend Developer</p><p data-v-62ebde6b>Frontend Developer</p></div><div class="credits-section" data-v-62ebde6b><h2 data-v-62ebde6b></h2><p data-v-62ebde6b>3D Artist</p><p data-v-62ebde6b>UI Designer</p></div><div class="credits-section" data-v-62ebde6b><h2 data-v-62ebde6b></h2><p data-v-62ebde6b>Sound Designer</p></div><div class="credits-section" data-v-62ebde6b><h2 data-v-62ebde6b></h2><p data-v-62ebde6b></p></div></div>',2)),p("button",{class:"skip-credits-button",onClick:Sc},"")])])):ye("",!0),Un.value?(D(),j("div",Lb,[p("div",{class:"game-over-dialog"},[k[6]||(k[6]=p("h2",{class:"withdraw-title"},"",-1)),k[7]||(k[7]=p("p",{class:"game-over-message"},[Ps(""),p("br"),Ps("")],-1)),p("div",{class:"dialog-buttons"},[p("button",{class:"dialog-button cancel-button",onClick:Mc},"  "),p("button",{class:"dialog-button confirm-button",onClick:Cc},"  ")])])])):ye("",!0),p("audio",{ref_key:"audioRef",ref:i,src:ue(a),loop:"",preload:"auto"},null,8,Ib),p("audio",{ref_key:"moveSoundRef",ref:r,src:ue(m),preload:"auto"},null,8,Ob),p("audio",{ref_key:"moveEnemySoundRef",ref:l,src:ue(_),preload:"auto"},null,8,Db),p("audio",{ref_key:"attackSoundRef",ref:c,src:ue(E),preload:"auto"},null,8,Nb),p("audio",{ref_key:"attackEnemySoundRef",ref:u,src:ue(S),preload:"auto"},null,8,Gb),p("audio",{ref_key:"meHurtSoundRef",ref:d,src:ue(g),preload:"auto"},null,8,Hb),p("audio",{ref_key:"enemyHurtSoundRef",ref:h,src:ue(T),preload:"auto"},null,8,Ub)])}}},Vb=ut(zb,[["__scopeId","data-v-62ebde6b"]]),Kb={class:"stage"},Wb={key:0,style:{position:"relative",width:"100%",height:"100%"}},qb={key:2,class:"modal"},Xb={class:"modal-title"},Yb={key:2,class:"overlay",style:{"z-index":"30000","align-items":"flex-start","justify-content":"flex-start",background:"rgba(0, 0, 0, 0.25)"}},Jb={class:"settings"},Zb={class:"settings__header"},Qb=["src"],e0={class:"settings__content"},t0={__name:"App",setup(t){const e=B(!1),s=B(null),n=B(!1),o=B(null),i=B([]);B(0);const a=B(!0),r=B(!1),l=B(!1);let c=null;function u(H){s.value!==H&&(i.value.push(s.value),s.value=H),window.__START_MENU_PAUSE__&&window.__START_MENU_PAUSE__(),e.value=!0}function d(){a.value=!1,c&&clearTimeout(c),c=setTimeout(()=>{a.value||(f("[App] StartMenu"),l.value=!0)},5*60*1e3)}function h(){s.value=null,i.value=[],window.__START_MENU_RESUME__&&window.__START_MENU_RESUME__(),e.value=!1}function m(H){f("[App] ID:",H.ids),h(),r.value=!0,f("[App] ")}function _(){r.value=!1}function E(){n.value=!0,e.value=!0}function S(){n.value=!1,s.value||(window.__START_MENU_RESUME__&&window.__START_MENU_RESUME__(),e.value=!1)}function g(){if(n.value){S();return}if(s.value){if(s.value==="warehouse"&&o.value&&o.value.handleBack&&o.value.handleBack())return;const H=i.value.pop()??null;s.value=H,H||(e.value=!1);return}if(!a.value){c&&(clearTimeout(c),c=null),l.value&&(l.value=!1,f("[App] StartMenu")),a.value=!0,setTimeout(()=>{window.__INIT_THREE_SCENE__?window.__INIT_THREE_SCENE__().then(()=>{window.__START_MENU_RESUME__&&window.__START_MENU_RESUME__()}).catch(()=>{window.__START_MENU_RESUME__&&window.__START_MENU_RESUME__()}):window.__START_MENU_RESUME__&&window.__START_MENU_RESUME__()},100),e.value=!1;return}}const T=B(!0),y=B(null);function w(){T.value=!T.value,f("[App] :",T.value?"":"")}async function $(){try{f("[App] ...");const H=await Zf();if(H.type==="error"){f("[App] :",H.content),alert(": "+H.content);return}f("[App] ...");const G=new Blob([JSON.stringify(H,null,2)],{type:"application/json"}),ie=document.createElement("a");ie.href=URL.createObjectURL(G);const O=new Date().toISOString().replace(/[:.]/g,"-").slice(0,-5);ie.download=`mgpic-save-${O}.json`,ie.click(),URL.revokeObjectURL(ie.href),f("[App] ")}catch(H){f("[App] :",H),alert("")}}function z(){try{y.value&&y.value.click()}catch{}}async function V(H){try{const G=H.target&&H.target.files&&H.target.files[0];if(!G)return;f("[App] ...");const ie=new FileReader;ie.onload=async()=>{try{const O=String(ie.result||"{}"),R=JSON.parse(O);f("[App] ..."),await Jf(O),f("[App] "),alert("")}catch(O){f("[App] :",O),alert(": "+O.message)}H.target.value=""},ie.onerror=()=>{f("[App] "),alert(""),H.target.value=""},ie.readAsText(G)}catch(G){f("[App] :",G),alert("")}}return Pt(()=>{Hl(H=>{})}),us(()=>{c&&(clearTimeout(c),c=null)}),(H,G)=>(D(),j("div",Kb,[r.value?(D(),xt(Vb,{key:0,isGameMode:!0,"music-on":T.value,onBack:_},null,8,["music-on"])):ye("",!0),r.value?ye("",!0):(D(),j(Ze,{key:1},[l.value?ye("",!0):Yr((D(),xt($m,{key:0,visible:a.value,onStarted:d},null,8,["visible"])),[[Ll,a.value]]),a.value?ye("",!0):(D(),xt(tr,{key:1,"music-on":T.value,onBack:g,onOpenSettings:E,onToggleMusic:w},null,8,["music-on"])),it(Bf,{"music-on":T.value,paused:s.value==="start"||s.value==="warehouse"||r.value,onStartGame:G[0]||(G[0]=ie=>u("start")),onOpenWarehouse:G[1]||(G[1]=ie=>u("warehouse")),onOpenTutorial:G[2]||(G[2]=ie=>u("tutorial")),onOpenEncyclopedia:G[3]||(G[3]=ie=>u("encyclopedia")),onToggleMusic:w},null,8,["music-on","paused"]),s.value?(D(),j("div",{key:2,class:Ye(["overlay",{"overlay--warehouse":s.value==="warehouse"}])},[s.value==="warehouse"?(D(),j("div",Wb,[it(tr,{"music-on":T.value,onBack:g,onOpenSettings:E,onToggleMusic:w},null,8,["music-on"]),it(cm,{ref_key:"warehouseRef",ref:o,"music-on":T.value},null,8,["music-on"])])):s.value==="start"?(D(),xt(g_,{key:1,"music-on":T.value,paused:r.value,onClose:h,onConfirm:m},null,8,["music-on","paused"])):(D(),j("div",qb,[p("h2",Xb,se(s.value==="warehouse"?"  Copper Warehouse":s.value==="tutorial"?"  Tutorial":s.value==="encyclopedia"?"  Game Encyclopedia":"  Start Game"),1),G[4]||(G[4]=p("p",{class:"modal-body"},"",-1)),p("button",{class:"close-btn",onClick:h},"")]))],2)):ye("",!0)],64)),n.value?(D(),j("div",Yb,[p("div",Jb,[p("div",Zb,[G[5]||(G[5]=p("div",{class:"settings__title"},"",-1)),p("button",{class:"settings__close",onClick:S,"aria-label":""},[p("img",{src:ue(F)("@assets/ui/close.png"),alt:""},null,8,Qb)])]),p("div",e0,[p("button",{class:"settings__item",onClick:$},[...G[6]||(G[6]=[mo('<span class="settings__icon" data-v-b00c8af0><svg width="44" height="44" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-b00c8af0><path d="M12 3v12m0 0l-4-4m4 4l4-4" stroke="#fff" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" data-v-b00c8af0></path><path d="M4 19h16" stroke="#fff" stroke-width="2" stroke-linecap="round" data-v-b00c8af0></path></svg></span><span class="settings__label" data-v-b00c8af0></span>',2)])]),p("button",{class:"settings__item",onClick:z},[...G[7]||(G[7]=[mo('<span class="settings__icon" data-v-b00c8af0><svg width="44" height="44" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-b00c8af0><path d="M12 21V9m0 0l4 4m-4-4L8 13" stroke="#fff" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" data-v-b00c8af0></path><path d="M4 5h16" stroke="#fff" stroke-width="2" stroke-linecap="round" data-v-b00c8af0></path></svg></span><span class="settings__label" data-v-b00c8af0></span>',2)])]),p("input",{ref_key:"fileInput",ref:y,type:"file",accept:".json",onChange:V,style:{display:"none"}},null,544)])])])):ye("",!0)]))}},ar=ut(t0,[["__scopeId","data-v-b00c8af0"]]);function s0(){const t=navigator.userAgent;return/Safari/.test(t)&&!/Chrome/.test(t)&&!/Chromium/.test(t)}function n0(){const t=document.getElementById("safari-warning"),e=document.getElementById("loading-screen");t.style.display="flex",e.style.display="none",document.getElementById("continue-safari").addEventListener("click",()=>{t.style.display="none",e.style.display="flex",Vl()}),document.getElementById("download-chrome").addEventListener("click",()=>{window.open("https://www.google.com/chrome/","_blank")})}function ri(t,e,s,n=""){const o=document.getElementById("progress-bar"),i=document.getElementById("progress-text"),a=document.querySelector(".loading-subtitle");o&&(o.style.width=s+"%"),i&&(t===0&&e===0?i.textContent=`${s}%`:i.textContent=`${t} / ${e} (${s}%)`),a&&n&&(a.textContent=n)}function rr(){const t=document.getElementById("loading-screen");t&&(t.classList.add("fade-out"),setTimeout(()=>{t.style.display="none"},500))}async function Vl(){try{f("..."),await xi(ri,["high"]),f(""),ri(0,100,100,"..."),Ka(ar).mount("#app"),await new Promise(e=>setTimeout(e,200)),window.__INIT_THREE_SCENE__&&await window.__INIT_THREE_SCENE__((e,s,n)=>{ri(0,0,n,`3D... ${n}%`)}),f(""),setTimeout(()=>{rr()},300),setTimeout(async()=>{try{f("..."),await xi(null,["medium"]),f("")}catch(e){f(":",e)}},1e3)}catch(t){f(":",t),Ka(ar).mount("#app"),rr()}}s0()?(f("Safari"),n0()):(f("Safari"),Vl());
