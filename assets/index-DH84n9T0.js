import{T as Dc,a as ha,b as gr,L as _r,c as wn,F as co,M as hs,V as kt,C as os,d as ps,S as Tt,e as Nc,P as tn,D as fs,f as qs,g as ke,I as vr,Q as fn,h as Gc,O as yr,i as pn,j as Hc,B as Sn,k as Uc,l as br,N as Fc,m as Bc,n as jc,o as ma,p as wr,R as Ms,q as zc,r as Vc,s as Wc,t as qo,u as Kc,v as gt,w as Ft,x as _t,y as qc,z as Sr,A as Xc,E as st,G as Yc,H as Jc,J as Zc,K as Qc,U as es,W as Fn,X as Mr,Y as eu,Z as tu,_ as su,$ as nu,a0 as ou,a1 as Tr,a2 as au,a3 as ui,a4 as di,a5 as fi,a6 as pi,a7 as ga,a8 as iu,a9 as ru,aa as Rt,ab as lu,ac as cu,ad as us,ae as To,af as xo,ag as Co,ah as uu,ai as du,aj as nn,ak as sn,al as hi,am as fu,an as xr,ao as Pn,ap as _a,aq as uo,ar as pu,as as hu,at as mu,au as gu,av as mi,aw as va,ax as _u,ay as gi}from"./three-DALeLLf3.js";(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const o of document.querySelectorAll('link[rel="modulepreload"]'))n(o);new MutationObserver(o=>{for(const a of o)if(a.type==="childList")for(const i of a.addedNodes)i.tagName==="LINK"&&i.rel==="modulepreload"&&n(i)}).observe(document,{childList:!0,subtree:!0});function s(o){const a={};return o.integrity&&(a.integrity=o.integrity),o.referrerPolicy&&(a.referrerPolicy=o.referrerPolicy),o.crossOrigin==="use-credentials"?a.credentials="include":o.crossOrigin==="anonymous"?a.credentials="omit":a.credentials="same-origin",a}function n(o){if(o.ep)return;o.ep=!0;const a=s(o);fetch(o.href,a)}})();const vu="release";function f(...t){switch(vu){case"debug":console.log(...t);break}}/**
* @vue/shared v3.5.22
* (c) 2018-present Yuxi (Evan) You and Vue contributors
* @license MIT
**/function Da(t){const e=Object.create(null);for(const s of t.split(","))e[s]=1;return s=>s in e}const Ye={},on=[],ss=()=>{},Cr=()=>!1,Eo=t=>t.charCodeAt(0)===111&&t.charCodeAt(1)===110&&(t.charCodeAt(2)>122||t.charCodeAt(2)<97),Na=t=>t.startsWith("onUpdate:"),bt=Object.assign,Ga=(t,e)=>{const s=t.indexOf(e);s>-1&&t.splice(s,1)},yu=Object.prototype.hasOwnProperty,ze=(t,e)=>yu.call(t,e),Te=Array.isArray,an=t=>ko(t)==="[object Map]",Er=t=>ko(t)==="[object Set]",Ae=t=>typeof t=="function",rt=t=>typeof t=="string",Ns=t=>typeof t=="symbol",Qe=t=>t!==null&&typeof t=="object",kr=t=>(Qe(t)||Ae(t))&&Ae(t.then)&&Ae(t.catch),Ar=Object.prototype.toString,ko=t=>Ar.call(t),bu=t=>ko(t).slice(8,-1),Rr=t=>ko(t)==="[object Object]",Ha=t=>rt(t)&&t!=="NaN"&&t[0]!=="-"&&""+parseInt(t,10)===t,Mn=Da(",key,ref,ref_for,ref_key,onVnodeBeforeMount,onVnodeMounted,onVnodeBeforeUpdate,onVnodeUpdated,onVnodeBeforeUnmount,onVnodeUnmounted"),Ao=t=>{const e=Object.create(null);return s=>e[s]||(e[s]=t(s))},wu=/-\w/g,Ls=Ao(t=>t.replace(wu,e=>e.slice(1).toUpperCase())),Su=/\B([A-Z])/g,Ys=Ao(t=>t.replace(Su,"-$1").toLowerCase()),$r=Ao(t=>t.charAt(0).toUpperCase()+t.slice(1)),Xo=Ao(t=>t?`on${$r(t)}`:""),Ps=(t,e)=>!Object.is(t,e),Yo=(t,...e)=>{for(let s=0;s<t.length;s++)t[s](...e)},Pr=(t,e,s,n=!1)=>{Object.defineProperty(t,e,{configurable:!0,enumerable:!1,writable:n,value:s})},Mu=t=>{const e=parseFloat(t);return isNaN(e)?t:e},Tu=t=>{const e=rt(t)?Number(t):NaN;return isNaN(e)?t:e};let _i;const Ro=()=>_i||(_i=typeof globalThis<"u"?globalThis:typeof self<"u"?self:typeof window<"u"?window:typeof global<"u"?global:{});function Ut(t){if(Te(t)){const e={};for(let s=0;s<t.length;s++){const n=t[s],o=rt(n)?ku(n):Ut(n);if(o)for(const a in o)e[a]=o[a]}return e}else if(rt(t)||Qe(t))return t}const xu=/;(?![^(]*\))/g,Cu=/:([^]+)/,Eu=/\/\*[^]*?\*\//g;function ku(t){const e={};return t.replace(Eu,"").split(xu).forEach(s=>{if(s){const n=s.split(Cu);n.length>1&&(e[n[0].trim()]=n[1].trim())}}),e}function qe(t){let e="";if(rt(t))e=t;else if(Te(t))for(let s=0;s<t.length;s++){const n=qe(t[s]);n&&(e+=n+" ")}else if(Qe(t))for(const s in t)t[s]&&(e+=s+" ");return e.trim()}const Au="itemscope,allowfullscreen,formnovalidate,ismap,nomodule,novalidate,readonly",Ru=Da(Au);function Lr(t){return!!t||t===""}const Ir=t=>!!(t&&t.__v_isRef===!0),se=t=>rt(t)?t:t==null?"":Te(t)||Qe(t)&&(t.toString===Ar||!Ae(t.toString))?Ir(t)?se(t.value):JSON.stringify(t,Or,2):String(t),Or=(t,e)=>Ir(e)?Or(t,e.value):an(e)?{[`Map(${e.size})`]:[...e.entries()].reduce((s,[n,o],a)=>(s[Jo(n,a)+" =>"]=o,s),{})}:Er(e)?{[`Set(${e.size})`]:[...e.values()].map(s=>Jo(s))}:Ns(e)?Jo(e):Qe(e)&&!Te(e)&&!Rr(e)?String(e):e,Jo=(t,e="")=>{var s;return Ns(t)?`Symbol(${(s=t.description)!=null?s:e})`:t};function $u(t){return t==null?"initial":typeof t=="string"?t===""?" ":t:String(t)}/**
* @vue/reactivity v3.5.22
* (c) 2018-present Yuxi (Evan) You and Vue contributors
* @license MIT
**/let Gt;class Pu{constructor(e=!1){this.detached=e,this._active=!0,this._on=0,this.effects=[],this.cleanups=[],this._isPaused=!1,this.parent=Gt,!e&&Gt&&(this.index=(Gt.scopes||(Gt.scopes=[])).push(this)-1)}get active(){return this._active}pause(){if(this._active){this._isPaused=!0;let e,s;if(this.scopes)for(e=0,s=this.scopes.length;e<s;e++)this.scopes[e].pause();for(e=0,s=this.effects.length;e<s;e++)this.effects[e].pause()}}resume(){if(this._active&&this._isPaused){this._isPaused=!1;let e,s;if(this.scopes)for(e=0,s=this.scopes.length;e<s;e++)this.scopes[e].resume();for(e=0,s=this.effects.length;e<s;e++)this.effects[e].resume()}}run(e){if(this._active){const s=Gt;try{return Gt=this,e()}finally{Gt=s}}}on(){++this._on===1&&(this.prevScope=Gt,Gt=this)}off(){this._on>0&&--this._on===0&&(Gt=this.prevScope,this.prevScope=void 0)}stop(e){if(this._active){this._active=!1;let s,n;for(s=0,n=this.effects.length;s<n;s++)this.effects[s].stop();for(this.effects.length=0,s=0,n=this.cleanups.length;s<n;s++)this.cleanups[s]();if(this.cleanups.length=0,this.scopes){for(s=0,n=this.scopes.length;s<n;s++)this.scopes[s].stop(!0);this.scopes.length=0}if(!this.detached&&this.parent&&!e){const o=this.parent.scopes.pop();o&&o!==this&&(this.parent.scopes[this.index]=o,o.index=this.index)}this.parent=void 0}}}function Lu(){return Gt}let Ze;const Zo=new WeakSet;class Dr{constructor(e){this.fn=e,this.deps=void 0,this.depsTail=void 0,this.flags=5,this.next=void 0,this.cleanup=void 0,this.scheduler=void 0,Gt&&Gt.active&&Gt.effects.push(this)}pause(){this.flags|=64}resume(){this.flags&64&&(this.flags&=-65,Zo.has(this)&&(Zo.delete(this),this.trigger()))}notify(){this.flags&2&&!(this.flags&32)||this.flags&8||Gr(this)}run(){if(!(this.flags&1))return this.fn();this.flags|=2,vi(this),Hr(this);const e=Ze,s=ns;Ze=this,ns=!0;try{return this.fn()}finally{Ur(this),Ze=e,ns=s,this.flags&=-3}}stop(){if(this.flags&1){for(let e=this.deps;e;e=e.nextDep)Ba(e);this.deps=this.depsTail=void 0,vi(this),this.onStop&&this.onStop(),this.flags&=-2}}trigger(){this.flags&64?Zo.add(this):this.scheduler?this.scheduler():this.runIfDirty()}runIfDirty(){ya(this)&&this.run()}get dirty(){return ya(this)}}let Nr=0,Tn,xn;function Gr(t,e=!1){if(t.flags|=8,e){t.next=xn,xn=t;return}t.next=Tn,Tn=t}function Ua(){Nr++}function Fa(){if(--Nr>0)return;if(xn){let e=xn;for(xn=void 0;e;){const s=e.next;e.next=void 0,e.flags&=-9,e=s}}let t;for(;Tn;){let e=Tn;for(Tn=void 0;e;){const s=e.next;if(e.next=void 0,e.flags&=-9,e.flags&1)try{e.trigger()}catch(n){t||(t=n)}e=s}}if(t)throw t}function Hr(t){for(let e=t.deps;e;e=e.nextDep)e.version=-1,e.prevActiveLink=e.dep.activeLink,e.dep.activeLink=e}function Ur(t){let e,s=t.depsTail,n=s;for(;n;){const o=n.prevDep;n.version===-1?(n===s&&(s=o),Ba(n),Iu(n)):e=n,n.dep.activeLink=n.prevActiveLink,n.prevActiveLink=void 0,n=o}t.deps=e,t.depsTail=s}function ya(t){for(let e=t.deps;e;e=e.nextDep)if(e.dep.version!==e.version||e.dep.computed&&(Fr(e.dep.computed)||e.dep.version!==e.version))return!0;return!!t._dirty}function Fr(t){if(t.flags&4&&!(t.flags&16)||(t.flags&=-17,t.globalVersion===Ln)||(t.globalVersion=Ln,!t.isSSR&&t.flags&128&&(!t.deps&&!t._dirty||!ya(t))))return;t.flags|=2;const e=t.dep,s=Ze,n=ns;Ze=t,ns=!0;try{Hr(t);const o=t.fn(t._value);(e.version===0||Ps(o,t._value))&&(t.flags|=128,t._value=o,e.version++)}catch(o){throw e.version++,o}finally{Ze=s,ns=n,Ur(t),t.flags&=-3}}function Ba(t,e=!1){const{dep:s,prevSub:n,nextSub:o}=t;if(n&&(n.nextSub=o,t.prevSub=void 0),o&&(o.prevSub=n,t.nextSub=void 0),s.subs===t&&(s.subs=n,!n&&s.computed)){s.computed.flags&=-5;for(let a=s.computed.deps;a;a=a.nextDep)Ba(a,!0)}!e&&!--s.sc&&s.map&&s.map.delete(s.key)}function Iu(t){const{prevDep:e,nextDep:s}=t;e&&(e.nextDep=s,t.prevDep=void 0),s&&(s.prevDep=e,t.nextDep=void 0)}let ns=!0;const Br=[];function Ts(){Br.push(ns),ns=!1}function xs(){const t=Br.pop();ns=t===void 0?!0:t}function vi(t){const{cleanup:e}=t;if(t.cleanup=void 0,e){const s=Ze;Ze=void 0;try{e()}finally{Ze=s}}}let Ln=0;class Ou{constructor(e,s){this.sub=e,this.dep=s,this.version=s.version,this.nextDep=this.prevDep=this.nextSub=this.prevSub=this.prevActiveLink=void 0}}class ja{constructor(e){this.computed=e,this.version=0,this.activeLink=void 0,this.subs=void 0,this.map=void 0,this.key=void 0,this.sc=0,this.__v_skip=!0}track(e){if(!Ze||!ns||Ze===this.computed)return;let s=this.activeLink;if(s===void 0||s.sub!==Ze)s=this.activeLink=new Ou(Ze,this),Ze.deps?(s.prevDep=Ze.depsTail,Ze.depsTail.nextDep=s,Ze.depsTail=s):Ze.deps=Ze.depsTail=s,jr(s);else if(s.version===-1&&(s.version=this.version,s.nextDep)){const n=s.nextDep;n.prevDep=s.prevDep,s.prevDep&&(s.prevDep.nextDep=n),s.prevDep=Ze.depsTail,s.nextDep=void 0,Ze.depsTail.nextDep=s,Ze.depsTail=s,Ze.deps===s&&(Ze.deps=n)}return s}trigger(e){this.version++,Ln++,this.notify(e)}notify(e){Ua();try{for(let s=this.subs;s;s=s.prevSub)s.sub.notify()&&s.sub.dep.notify()}finally{Fa()}}}function jr(t){if(t.dep.sc++,t.sub.flags&4){const e=t.dep.computed;if(e&&!t.dep.subs){e.flags|=20;for(let n=e.deps;n;n=n.nextDep)jr(n)}const s=t.dep.subs;s!==t&&(t.prevSub=s,s&&(s.nextSub=t)),t.dep.subs=t}}const ba=new WeakMap,Xs=Symbol(""),wa=Symbol(""),In=Symbol("");function Mt(t,e,s){if(ns&&Ze){let n=ba.get(t);n||ba.set(t,n=new Map);let o=n.get(s);o||(n.set(s,o=new ja),o.map=n,o.key=s),o.track()}}function ws(t,e,s,n,o,a){const i=ba.get(t);if(!i){Ln++;return}const r=l=>{l&&l.trigger()};if(Ua(),e==="clear")i.forEach(r);else{const l=Te(t),c=l&&Ha(s);if(l&&s==="length"){const u=Number(n);i.forEach((d,h)=>{(h==="length"||h===In||!Ns(h)&&h>=u)&&r(d)})}else switch((s!==void 0||i.has(void 0))&&r(i.get(s)),c&&r(i.get(In)),e){case"add":l?c&&r(i.get("length")):(r(i.get(Xs)),an(t)&&r(i.get(wa)));break;case"delete":l||(r(i.get(Xs)),an(t)&&r(i.get(wa)));break;case"set":an(t)&&r(i.get(Xs));break}}Fa()}function Js(t){const e=Be(t);return e===t?e:(Mt(e,"iterate",In),Xt(t)?e:e.map(yt))}function $o(t){return Mt(t=Be(t),"iterate",In),t}const Du={__proto__:null,[Symbol.iterator](){return Qo(this,Symbol.iterator,yt)},concat(...t){return Js(this).concat(...t.map(e=>Te(e)?Js(e):e))},entries(){return Qo(this,"entries",t=>(t[1]=yt(t[1]),t))},every(t,e){return _s(this,"every",t,e,void 0,arguments)},filter(t,e){return _s(this,"filter",t,e,s=>s.map(yt),arguments)},find(t,e){return _s(this,"find",t,e,yt,arguments)},findIndex(t,e){return _s(this,"findIndex",t,e,void 0,arguments)},findLast(t,e){return _s(this,"findLast",t,e,yt,arguments)},findLastIndex(t,e){return _s(this,"findLastIndex",t,e,void 0,arguments)},forEach(t,e){return _s(this,"forEach",t,e,void 0,arguments)},includes(...t){return ea(this,"includes",t)},indexOf(...t){return ea(this,"indexOf",t)},join(t){return Js(this).join(t)},lastIndexOf(...t){return ea(this,"lastIndexOf",t)},map(t,e){return _s(this,"map",t,e,void 0,arguments)},pop(){return gn(this,"pop")},push(...t){return gn(this,"push",t)},reduce(t,...e){return yi(this,"reduce",t,e)},reduceRight(t,...e){return yi(this,"reduceRight",t,e)},shift(){return gn(this,"shift")},some(t,e){return _s(this,"some",t,e,void 0,arguments)},splice(...t){return gn(this,"splice",t)},toReversed(){return Js(this).toReversed()},toSorted(t){return Js(this).toSorted(t)},toSpliced(...t){return Js(this).toSpliced(...t)},unshift(...t){return gn(this,"unshift",t)},values(){return Qo(this,"values",yt)}};function Qo(t,e,s){const n=$o(t),o=n[e]();return n!==t&&!Xt(t)&&(o._next=o.next,o.next=()=>{const a=o._next();return a.done||(a.value=s(a.value)),a}),o}const Nu=Array.prototype;function _s(t,e,s,n,o,a){const i=$o(t),r=i!==t&&!Xt(t),l=i[e];if(l!==Nu[e]){const d=l.apply(t,a);return r?yt(d):d}let c=s;i!==t&&(r?c=function(d,h){return s.call(this,yt(d),h,t)}:s.length>2&&(c=function(d,h){return s.call(this,d,h,t)}));const u=l.call(i,c,n);return r&&o?o(u):u}function yi(t,e,s,n){const o=$o(t);let a=s;return o!==t&&(Xt(t)?s.length>3&&(a=function(i,r,l){return s.call(this,i,r,l,t)}):a=function(i,r,l){return s.call(this,i,yt(r),l,t)}),o[e](a,...n)}function ea(t,e,s){const n=Be(t);Mt(n,"iterate",In);const o=n[e](...s);return(o===-1||o===!1)&&Ka(s[0])?(s[0]=Be(s[0]),n[e](...s)):o}function gn(t,e,s=[]){Ts(),Ua();const n=Be(t)[e].apply(t,s);return Fa(),xs(),n}const Gu=Da("__proto__,__v_isRef,__isVue"),zr=new Set(Object.getOwnPropertyNames(Symbol).filter(t=>t!=="arguments"&&t!=="caller").map(t=>Symbol[t]).filter(Ns));function Hu(t){Ns(t)||(t=String(t));const e=Be(this);return Mt(e,"has",t),e.hasOwnProperty(t)}class Vr{constructor(e=!1,s=!1){this._isReadonly=e,this._isShallow=s}get(e,s,n){if(s==="__v_skip")return e.__v_skip;const o=this._isReadonly,a=this._isShallow;if(s==="__v_isReactive")return!o;if(s==="__v_isReadonly")return o;if(s==="__v_isShallow")return a;if(s==="__v_raw")return n===(o?a?Xu:Xr:a?qr:Kr).get(e)||Object.getPrototypeOf(e)===Object.getPrototypeOf(n)?e:void 0;const i=Te(e);if(!o){let l;if(i&&(l=Du[s]))return l;if(s==="hasOwnProperty")return Hu}const r=Reflect.get(e,s,xt(e)?e:n);if((Ns(s)?zr.has(s):Gu(s))||(o||Mt(e,"get",s),a))return r;if(xt(r)){const l=i&&Ha(s)?r:r.value;return o&&Qe(l)?Ma(l):l}return Qe(r)?o?Ma(r):Va(r):r}}class Wr extends Vr{constructor(e=!1){super(!1,e)}set(e,s,n,o){let a=e[s];if(!this._isShallow){const l=Is(a);if(!Xt(n)&&!Is(n)&&(a=Be(a),n=Be(n)),!Te(e)&&xt(a)&&!xt(n))return l||(a.value=n),!0}const i=Te(e)&&Ha(s)?Number(s)<e.length:ze(e,s),r=Reflect.set(e,s,n,xt(e)?e:o);return e===Be(o)&&(i?Ps(n,a)&&ws(e,"set",s,n):ws(e,"add",s,n)),r}deleteProperty(e,s){const n=ze(e,s);e[s];const o=Reflect.deleteProperty(e,s);return o&&n&&ws(e,"delete",s,void 0),o}has(e,s){const n=Reflect.has(e,s);return(!Ns(s)||!zr.has(s))&&Mt(e,"has",s),n}ownKeys(e){return Mt(e,"iterate",Te(e)?"length":Xs),Reflect.ownKeys(e)}}class Uu extends Vr{constructor(e=!1){super(!0,e)}set(e,s){return!0}deleteProperty(e,s){return!0}}const Fu=new Wr,Bu=new Uu,ju=new Wr(!0);const Sa=t=>t,Xn=t=>Reflect.getPrototypeOf(t);function zu(t,e,s){return function(...n){const o=this.__v_raw,a=Be(o),i=an(a),r=t==="entries"||t===Symbol.iterator&&i,l=t==="keys"&&i,c=o[t](...n),u=s?Sa:e?fo:yt;return!e&&Mt(a,"iterate",l?wa:Xs),{next(){const{value:d,done:h}=c.next();return h?{value:d,done:h}:{value:r?[u(d[0]),u(d[1])]:u(d),done:h}},[Symbol.iterator](){return this}}}}function Yn(t){return function(...e){return t==="delete"?!1:t==="clear"?void 0:this}}function Vu(t,e){const s={get(o){const a=this.__v_raw,i=Be(a),r=Be(o);t||(Ps(o,r)&&Mt(i,"get",o),Mt(i,"get",r));const{has:l}=Xn(i),c=e?Sa:t?fo:yt;if(l.call(i,o))return c(a.get(o));if(l.call(i,r))return c(a.get(r));a!==i&&a.get(o)},get size(){const o=this.__v_raw;return!t&&Mt(Be(o),"iterate",Xs),o.size},has(o){const a=this.__v_raw,i=Be(a),r=Be(o);return t||(Ps(o,r)&&Mt(i,"has",o),Mt(i,"has",r)),o===r?a.has(o):a.has(o)||a.has(r)},forEach(o,a){const i=this,r=i.__v_raw,l=Be(r),c=e?Sa:t?fo:yt;return!t&&Mt(l,"iterate",Xs),r.forEach((u,d)=>o.call(a,c(u),c(d),i))}};return bt(s,t?{add:Yn("add"),set:Yn("set"),delete:Yn("delete"),clear:Yn("clear")}:{add(o){!e&&!Xt(o)&&!Is(o)&&(o=Be(o));const a=Be(this);return Xn(a).has.call(a,o)||(a.add(o),ws(a,"add",o,o)),this},set(o,a){!e&&!Xt(a)&&!Is(a)&&(a=Be(a));const i=Be(this),{has:r,get:l}=Xn(i);let c=r.call(i,o);c||(o=Be(o),c=r.call(i,o));const u=l.call(i,o);return i.set(o,a),c?Ps(a,u)&&ws(i,"set",o,a):ws(i,"add",o,a),this},delete(o){const a=Be(this),{has:i,get:r}=Xn(a);let l=i.call(a,o);l||(o=Be(o),l=i.call(a,o)),r&&r.call(a,o);const c=a.delete(o);return l&&ws(a,"delete",o,void 0),c},clear(){const o=Be(this),a=o.size!==0,i=o.clear();return a&&ws(o,"clear",void 0,void 0),i}}),["keys","values","entries",Symbol.iterator].forEach(o=>{s[o]=zu(o,t,e)}),s}function za(t,e){const s=Vu(t,e);return(n,o,a)=>o==="__v_isReactive"?!t:o==="__v_isReadonly"?t:o==="__v_raw"?n:Reflect.get(ze(s,o)&&o in n?s:n,o,a)}const Wu={get:za(!1,!1)},Ku={get:za(!1,!0)},qu={get:za(!0,!1)};const Kr=new WeakMap,qr=new WeakMap,Xr=new WeakMap,Xu=new WeakMap;function Yu(t){switch(t){case"Object":case"Array":return 1;case"Map":case"Set":case"WeakMap":case"WeakSet":return 2;default:return 0}}function Ju(t){return t.__v_skip||!Object.isExtensible(t)?0:Yu(bu(t))}function Va(t){return Is(t)?t:Wa(t,!1,Fu,Wu,Kr)}function Zu(t){return Wa(t,!1,ju,Ku,qr)}function Ma(t){return Wa(t,!0,Bu,qu,Xr)}function Wa(t,e,s,n,o){if(!Qe(t)||t.__v_raw&&!(e&&t.__v_isReactive))return t;const a=Ju(t);if(a===0)return t;const i=o.get(t);if(i)return i;const r=new Proxy(t,a===2?n:s);return o.set(t,r),r}function rn(t){return Is(t)?rn(t.__v_raw):!!(t&&t.__v_isReactive)}function Is(t){return!!(t&&t.__v_isReadonly)}function Xt(t){return!!(t&&t.__v_isShallow)}function Ka(t){return t?!!t.__v_raw:!1}function Be(t){const e=t&&t.__v_raw;return e?Be(e):t}function Qu(t){return!ze(t,"__v_skip")&&Object.isExtensible(t)&&Pr(t,"__v_skip",!0),t}const yt=t=>Qe(t)?Va(t):t,fo=t=>Qe(t)?Ma(t):t;function xt(t){return t?t.__v_isRef===!0:!1}function H(t){return ed(t,!1)}function ed(t,e){return xt(t)?t:new td(t,e)}class td{constructor(e,s){this.dep=new ja,this.__v_isRef=!0,this.__v_isShallow=!1,this._rawValue=s?e:Be(e),this._value=s?e:yt(e),this.__v_isShallow=s}get value(){return this.dep.track(),this._value}set value(e){const s=this._rawValue,n=this.__v_isShallow||Xt(e)||Is(e);e=n?e:Be(e),Ps(e,s)&&(this._rawValue=e,this._value=n?e:yt(e),this.dep.trigger())}}function de(t){return xt(t)?t.value:t}const sd={get:(t,e,s)=>e==="__v_raw"?t:de(Reflect.get(t,e,s)),set:(t,e,s,n)=>{const o=t[e];return xt(o)&&!xt(s)?(o.value=s,!0):Reflect.set(t,e,s,n)}};function Yr(t){return rn(t)?t:new Proxy(t,sd)}class nd{constructor(e,s,n){this.fn=e,this.setter=s,this._value=void 0,this.dep=new ja(this),this.__v_isRef=!0,this.deps=void 0,this.depsTail=void 0,this.flags=16,this.globalVersion=Ln-1,this.next=void 0,this.effect=this,this.__v_isReadonly=!s,this.isSSR=n}notify(){if(this.flags|=16,!(this.flags&8)&&Ze!==this)return Gr(this,!0),!0}get value(){const e=this.dep.track();return Fr(this),e&&(e.version=this.dep.version),this._value}set value(e){this.setter&&this.setter(e)}}function od(t,e,s=!1){let n,o;return Ae(t)?n=t:(n=t.get,o=t.set),new nd(n,o,s)}const Jn={},po=new WeakMap;let Vs;function ad(t,e=!1,s=Vs){if(s){let n=po.get(s);n||po.set(s,n=[]),n.push(t)}}function id(t,e,s=Ye){const{immediate:n,deep:o,once:a,scheduler:i,augmentJob:r,call:l}=s,c=w=>o?w:Xt(w)||o===!1||o===0?Ss(w,1):Ss(w);let u,d,h,m,g=!1,x=!1;if(xt(t)?(d=()=>t.value,g=Xt(t)):rn(t)?(d=()=>c(t),g=!0):Te(t)?(x=!0,g=t.some(w=>rn(w)||Xt(w)),d=()=>t.map(w=>{if(xt(w))return w.value;if(rn(w))return c(w);if(Ae(w))return l?l(w,2):w()})):Ae(t)?e?d=l?()=>l(t,2):t:d=()=>{if(h){Ts();try{h()}finally{xs()}}const w=Vs;Vs=u;try{return l?l(t,3,[m]):t(m)}finally{Vs=w}}:d=ss,e&&o){const w=d,I=o===!0?1/0:o;d=()=>Ss(w(),I)}const S=Lu(),_=()=>{u.stop(),S&&S.active&&Ga(S.effects,u)};if(a&&e){const w=e;e=(...I)=>{w(...I),_()}}let M=x?new Array(t.length).fill(Jn):Jn;const b=w=>{if(!(!(u.flags&1)||!u.dirty&&!w))if(e){const I=u.run();if(o||g||(x?I.some((F,z)=>Ps(F,M[z])):Ps(I,M))){h&&h();const F=Vs;Vs=u;try{const z=[I,M===Jn?void 0:x&&M[0]===Jn?[]:M,m];M=I,l?l(e,3,z):e(...z)}finally{Vs=F}}}else u.run()};return r&&r(b),u=new Dr(d),u.scheduler=i?()=>i(b,!1):b,m=w=>ad(w,!1,u),h=u.onStop=()=>{const w=po.get(u);if(w){if(l)l(w,4);else for(const I of w)I();po.delete(u)}},e?n?b(!0):M=u.run():i?i(b.bind(null,!0),!0):u.run(),_.pause=u.pause.bind(u),_.resume=u.resume.bind(u),_.stop=_,_}function Ss(t,e=1/0,s){if(e<=0||!Qe(t)||t.__v_skip||(s=s||new Map,(s.get(t)||0)>=e))return t;if(s.set(t,e),e--,xt(t))Ss(t.value,e,s);else if(Te(t))for(let n=0;n<t.length;n++)Ss(t[n],e,s);else if(Er(t)||an(t))t.forEach(n=>{Ss(n,e,s)});else if(Rr(t)){for(const n in t)Ss(t[n],e,s);for(const n of Object.getOwnPropertySymbols(t))Object.prototype.propertyIsEnumerable.call(t,n)&&Ss(t[n],e,s)}return t}/**
* @vue/runtime-core v3.5.22
* (c) 2018-present Yuxi (Evan) You and Vue contributors
* @license MIT
**/function Bn(t,e,s,n){try{return n?t(...n):t()}catch(o){Po(o,e,s)}}function as(t,e,s,n){if(Ae(t)){const o=Bn(t,e,s,n);return o&&kr(o)&&o.catch(a=>{Po(a,e,s)}),o}if(Te(t)){const o=[];for(let a=0;a<t.length;a++)o.push(as(t[a],e,s,n));return o}}function Po(t,e,s,n=!0){const o=e?e.vnode:null,{errorHandler:a,throwUnhandledErrorInProduction:i}=e&&e.appContext.config||Ye;if(e){let r=e.parent;const l=e.proxy,c=`https://vuejs.org/error-reference/#runtime-${s}`;for(;r;){const u=r.ec;if(u){for(let d=0;d<u.length;d++)if(u[d](t,l,c)===!1)return}r=r.parent}if(a){Ts(),Bn(a,null,10,[t,l,c]),xs();return}}rd(t,s,o,n,i)}function rd(t,e,s,n=!0,o=!1){if(o)throw t;console.error(t)}const $t=[];let ls=-1;const ln=[];let Rs=null,en=0;const Jr=Promise.resolve();let ho=null;function On(t){const e=ho||Jr;return t?e.then(this?t.bind(this):t):e}function ld(t){let e=ls+1,s=$t.length;for(;e<s;){const n=e+s>>>1,o=$t[n],a=Dn(o);a<t||a===t&&o.flags&2?e=n+1:s=n}return e}function qa(t){if(!(t.flags&1)){const e=Dn(t),s=$t[$t.length-1];!s||!(t.flags&2)&&e>=Dn(s)?$t.push(t):$t.splice(ld(e),0,t),t.flags|=1,Zr()}}function Zr(){ho||(ho=Jr.then(tl))}function Qr(t){Te(t)?ln.push(...t):Rs&&t.id===-1?Rs.splice(en+1,0,t):t.flags&1||(ln.push(t),t.flags|=1),Zr()}function bi(t,e,s=ls+1){for(;s<$t.length;s++){const n=$t[s];if(n&&n.flags&2){if(t&&n.id!==t.uid)continue;$t.splice(s,1),s--,n.flags&4&&(n.flags&=-2),n(),n.flags&4||(n.flags&=-2)}}}function el(t){if(ln.length){const e=[...new Set(ln)].sort((s,n)=>Dn(s)-Dn(n));if(ln.length=0,Rs){Rs.push(...e);return}for(Rs=e,en=0;en<Rs.length;en++){const s=Rs[en];s.flags&4&&(s.flags&=-2),s.flags&8||s(),s.flags&=-2}Rs=null,en=0}}const Dn=t=>t.id==null?t.flags&2?-1:1/0:t.id;function tl(t){try{for(ls=0;ls<$t.length;ls++){const e=$t[ls];e&&!(e.flags&8)&&(e.flags&4&&(e.flags&=-2),Bn(e,e.i,e.i?15:14),e.flags&4||(e.flags&=-2))}}finally{for(;ls<$t.length;ls++){const e=$t[ls];e&&(e.flags&=-2)}ls=-1,$t.length=0,el(),ho=null,($t.length||ln.length)&&tl()}}let Kt=null,sl=null;function mo(t){const e=Kt;return Kt=t,sl=t&&t.type.__scopeId||null,e}function nl(t,e=Kt,s){if(!e||t._n)return t;const n=(...o)=>{n._d&&vo(-1);const a=mo(e);let i;try{i=t(...o)}finally{mo(a),n._d&&vo(1)}return i};return n._n=!0,n._c=!0,n._d=!0,n}function ol(t,e){if(Kt===null)return t;const s=No(Kt),n=t.dirs||(t.dirs=[]);for(let o=0;o<e.length;o++){let[a,i,r,l=Ye]=e[o];a&&(Ae(a)&&(a={mounted:a,updated:a}),a.deep&&Ss(i),n.push({dir:a,instance:s,value:i,oldValue:void 0,arg:r,modifiers:l}))}return t}function Us(t,e,s,n){const o=t.dirs,a=e&&e.dirs;for(let i=0;i<o.length;i++){const r=o[i];a&&(r.oldValue=a[i].value);let l=r.dir[n];l&&(Ts(),as(l,s,8,[t.el,r,t,e]),xs())}}const al=Symbol("_vte"),il=t=>t.__isTeleport,Cn=t=>t&&(t.disabled||t.disabled===""),wi=t=>t&&(t.defer||t.defer===""),Si=t=>typeof SVGElement<"u"&&t instanceof SVGElement,Mi=t=>typeof MathMLElement=="function"&&t instanceof MathMLElement,Ta=(t,e)=>{const s=t&&t.to;return rt(s)?e?e(s):null:s},rl={name:"Teleport",__isTeleport:!0,process(t,e,s,n,o,a,i,r,l,c){const{mc:u,pc:d,pbc:h,o:{insert:m,querySelector:g,createText:x,createComment:S}}=c,_=Cn(e.props);let{shapeFlag:M,children:b,dynamicChildren:w}=e;if(t==null){const I=e.el=x(""),F=e.anchor=x("");m(I,s,n),m(F,s,n);const z=(N,ie)=>{M&16&&u(b,N,ie,o,a,i,r,l)},B=()=>{const N=e.target=Ta(e.props,g),ie=cl(N,e,x,m);N&&(i!=="svg"&&Si(N)?i="svg":i!=="mathml"&&Mi(N)&&(i="mathml"),o&&o.isCE&&(o.ce._teleportTargets||(o.ce._teleportTargets=new Set)).add(N),_||(z(N,ie),no(e,!1)))};_&&(z(s,F),no(e,!0)),wi(e.props)?(e.el.__isMounted=!1,At(()=>{B(),delete e.el.__isMounted},a)):B()}else{if(wi(e.props)&&t.el.__isMounted===!1){At(()=>{rl.process(t,e,s,n,o,a,i,r,l,c)},a);return}e.el=t.el,e.targetStart=t.targetStart;const I=e.anchor=t.anchor,F=e.target=t.target,z=e.targetAnchor=t.targetAnchor,B=Cn(t.props),N=B?s:F,ie=B?I:z;if(i==="svg"||Si(F)?i="svg":(i==="mathml"||Mi(F))&&(i="mathml"),w?(h(t.dynamicChildren,w,N,o,a,i,r),Za(t,e,!0)):l||d(t,e,N,ie,o,a,i,r,!1),_)B?e.props&&t.props&&e.props.to!==t.props.to&&(e.props.to=t.props.to):Zn(e,s,I,c,1);else if((e.props&&e.props.to)!==(t.props&&t.props.to)){const le=e.target=Ta(e.props,g);le&&Zn(e,le,null,c,0)}else B&&Zn(e,F,z,c,1);no(e,_)}},remove(t,e,s,{um:n,o:{remove:o}},a){const{shapeFlag:i,children:r,anchor:l,targetStart:c,targetAnchor:u,target:d,props:h}=t;if(d&&(o(c),o(u)),a&&o(l),i&16){const m=a||!Cn(h);for(let g=0;g<r.length;g++){const x=r[g];n(x,e,s,m,!!x.dynamicChildren)}}},move:Zn,hydrate:cd};function Zn(t,e,s,{o:{insert:n},m:o},a=2){a===0&&n(t.targetAnchor,e,s);const{el:i,anchor:r,shapeFlag:l,children:c,props:u}=t,d=a===2;if(d&&n(i,e,s),(!d||Cn(u))&&l&16)for(let h=0;h<c.length;h++)o(c[h],e,s,2);d&&n(r,e,s)}function cd(t,e,s,n,o,a,{o:{nextSibling:i,parentNode:r,querySelector:l,insert:c,createText:u}},d){function h(x,S,_,M){S.anchor=d(i(x),S,r(x),s,n,o,a),S.targetStart=_,S.targetAnchor=M}const m=e.target=Ta(e.props,l),g=Cn(e.props);if(m){const x=m._lpa||m.firstChild;if(e.shapeFlag&16)if(g)h(t,e,x,x&&i(x));else{e.anchor=i(t);let S=x;for(;S;){if(S&&S.nodeType===8){if(S.data==="teleport start anchor")e.targetStart=S;else if(S.data==="teleport anchor"){e.targetAnchor=S,m._lpa=e.targetAnchor&&i(e.targetAnchor);break}}S=i(S)}e.targetAnchor||cl(m,e,u,c),d(x&&i(x),e,m,s,n,o,a)}no(e,g)}else g&&e.shapeFlag&16&&h(t,e,t,i(t));return e.anchor&&i(e.anchor)}const ll=rl;function no(t,e){const s=t.ctx;if(s&&s.ut){let n,o;for(e?(n=t.el,o=t.anchor):(n=t.targetStart,o=t.targetAnchor);n&&n!==o;)n.nodeType===1&&n.setAttribute("data-v-owner",s.uid),n=n.nextSibling;s.ut()}}function cl(t,e,s,n){const o=e.targetStart=s(""),a=e.targetAnchor=s("");return o[al]=a,t&&(n(o,t),n(a,t)),a}const bs=Symbol("_leaveCb"),Qn=Symbol("_enterCb");function ud(){const t={isMounted:!1,isLeaving:!1,isUnmounting:!1,leavingVNodes:new Map};return Dt(()=>{t.isMounted=!0}),ms(()=>{t.isUnmounting=!0}),t}const Vt=[Function,Array],ul={mode:String,appear:Boolean,persisted:Boolean,onBeforeEnter:Vt,onEnter:Vt,onAfterEnter:Vt,onEnterCancelled:Vt,onBeforeLeave:Vt,onLeave:Vt,onAfterLeave:Vt,onLeaveCancelled:Vt,onBeforeAppear:Vt,onAppear:Vt,onAfterAppear:Vt,onAppearCancelled:Vt},dl=t=>{const e=t.subTree;return e.component?dl(e.component):e},dd={name:"BaseTransition",props:ul,setup(t,{slots:e}){const s=ei(),n=ud();return()=>{const o=e.default&&hl(e.default(),!0);if(!o||!o.length)return;const a=fl(o),i=Be(t),{mode:r}=i;if(n.isLeaving)return ta(a);const l=Ti(a);if(!l)return ta(a);let c=xa(l,i,n,s,d=>c=d);l.type!==It&&Nn(l,c);let u=s.subTree&&Ti(s.subTree);if(u&&u.type!==It&&!Ws(u,l)&&dl(s).type!==It){let d=xa(u,i,n,s);if(Nn(u,d),r==="out-in"&&l.type!==It)return n.isLeaving=!0,d.afterLeave=()=>{n.isLeaving=!1,s.job.flags&8||s.update(),delete d.afterLeave,u=void 0},ta(a);r==="in-out"&&l.type!==It?d.delayLeave=(h,m,g)=>{const x=pl(n,u);x[String(u.key)]=u,h[bs]=()=>{m(),h[bs]=void 0,delete c.delayedLeave,u=void 0},c.delayedLeave=()=>{g(),delete c.delayedLeave,u=void 0}}:u=void 0}else u&&(u=void 0);return a}}};function fl(t){let e=t[0];if(t.length>1){for(const s of t)if(s.type!==It){e=s;break}}return e}const fd=dd;function pl(t,e){const{leavingVNodes:s}=t;let n=s.get(e.type);return n||(n=Object.create(null),s.set(e.type,n)),n}function xa(t,e,s,n,o){const{appear:a,mode:i,persisted:r=!1,onBeforeEnter:l,onEnter:c,onAfterEnter:u,onEnterCancelled:d,onBeforeLeave:h,onLeave:m,onAfterLeave:g,onLeaveCancelled:x,onBeforeAppear:S,onAppear:_,onAfterAppear:M,onAppearCancelled:b}=e,w=String(t.key),I=pl(s,t),F=(N,ie)=>{N&&as(N,n,9,ie)},z=(N,ie)=>{const le=ie[1];F(N,ie),Te(N)?N.every(E=>E.length<=1)&&le():N.length<=1&&le()},B={mode:i,persisted:r,beforeEnter(N){let ie=l;if(!s.isMounted)if(a)ie=S||l;else return;N[bs]&&N[bs](!0);const le=I[w];le&&Ws(t,le)&&le.el[bs]&&le.el[bs](),F(ie,[N])},enter(N){let ie=c,le=u,E=d;if(!s.isMounted)if(a)ie=_||c,le=M||u,E=b||d;else return;let q=!1;const Me=N[Qn]=fe=>{q||(q=!0,fe?F(E,[N]):F(le,[N]),B.delayedLeave&&B.delayedLeave(),N[Qn]=void 0)};ie?z(ie,[N,Me]):Me()},leave(N,ie){const le=String(t.key);if(N[Qn]&&N[Qn](!0),s.isUnmounting)return ie();F(h,[N]);let E=!1;const q=N[bs]=Me=>{E||(E=!0,ie(),Me?F(x,[N]):F(g,[N]),N[bs]=void 0,I[le]===t&&delete I[le])};I[le]=t,m?z(m,[N,q]):q()},clone(N){const ie=xa(N,e,s,n,o);return o&&o(ie),ie}};return B}function ta(t){if(Lo(t))return t=Os(t),t.children=null,t}function Ti(t){if(!Lo(t))return il(t.type)&&t.children?fl(t.children):t;if(t.component)return t.component.subTree;const{shapeFlag:e,children:s}=t;if(s){if(e&16)return s[0];if(e&32&&Ae(s.default))return s.default()}}function Nn(t,e){t.shapeFlag&6&&t.component?(t.transition=e,Nn(t.component.subTree,e)):t.shapeFlag&128?(t.ssContent.transition=e.clone(t.ssContent),t.ssFallback.transition=e.clone(t.ssFallback)):t.transition=e}function hl(t,e=!1,s){let n=[],o=0;for(let a=0;a<t.length;a++){let i=t[a];const r=s==null?i.key:String(s)+String(i.key!=null?i.key:a);i.type===Je?(i.patchFlag&128&&o++,n=n.concat(hl(i.children,e,r))):(e||i.type!==It)&&n.push(r!=null?Os(i,{key:r}):i)}if(o>1)for(let a=0;a<n.length;a++)n[a].patchFlag=-2;return n}function ml(t){t.ids=[t.ids[0]+t.ids[2]+++"-",0,0]}const go=new WeakMap;function En(t,e,s,n,o=!1){if(Te(t)){t.forEach((g,x)=>En(g,e&&(Te(e)?e[x]:e),s,n,o));return}if(kn(n)&&!o){n.shapeFlag&512&&n.type.__asyncResolved&&n.component.subTree.component&&En(t,e,s,n.component.subTree);return}const a=n.shapeFlag&4?No(n.component):n.el,i=o?null:a,{i:r,r:l}=t,c=e&&e.r,u=r.refs===Ye?r.refs={}:r.refs,d=r.setupState,h=Be(d),m=d===Ye?Cr:g=>ze(h,g);if(c!=null&&c!==l){if(xi(e),rt(c))u[c]=null,m(c)&&(d[c]=null);else if(xt(c)){c.value=null;const g=e;g.k&&(u[g.k]=null)}}if(Ae(l))Bn(l,r,12,[i,u]);else{const g=rt(l),x=xt(l);if(g||x){const S=()=>{if(t.f){const _=g?m(l)?d[l]:u[l]:l.value;if(o)Te(_)&&Ga(_,a);else if(Te(_))_.includes(a)||_.push(a);else if(g)u[l]=[a],m(l)&&(d[l]=u[l]);else{const M=[a];l.value=M,t.k&&(u[t.k]=M)}}else g?(u[l]=i,m(l)&&(d[l]=i)):x&&(l.value=i,t.k&&(u[t.k]=i))};if(i){const _=()=>{S(),go.delete(t)};_.id=-1,go.set(t,_),At(_,s)}else xi(t),S()}}}function xi(t){const e=go.get(t);e&&(e.flags|=8,go.delete(t))}Ro().requestIdleCallback;Ro().cancelIdleCallback;const kn=t=>!!t.type.__asyncLoader,Lo=t=>t.type.__isKeepAlive;function pd(t,e){gl(t,"a",e)}function hd(t,e){gl(t,"da",e)}function gl(t,e,s=Ot){const n=t.__wdc||(t.__wdc=()=>{let o=s;for(;o;){if(o.isDeactivated)return;o=o.parent}return t()});if(Io(e,n,s),s){let o=s.parent;for(;o&&o.parent;)Lo(o.parent.vnode)&&md(n,e,s,o),o=o.parent}}function md(t,e,s,n){const o=Io(e,t,n,!0);Xa(()=>{Ga(n[e],o)},s)}function Io(t,e,s=Ot,n=!1){if(s){const o=s[t]||(s[t]=[]),a=e.__weh||(e.__weh=(...i)=>{Ts();const r=jn(s),l=as(e,s,t,i);return r(),xs(),l});return n?o.unshift(a):o.push(a),a}}const Cs=t=>(e,s=Ot)=>{(!Hn||t==="sp")&&Io(t,(...n)=>e(...n),s)},gd=Cs("bm"),Dt=Cs("m"),_l=Cs("bu"),_d=Cs("u"),ms=Cs("bum"),Xa=Cs("um"),vd=Cs("sp"),yd=Cs("rtg"),bd=Cs("rtc");function wd(t,e=Ot){Io("ec",t,e)}const Sd=Symbol.for("v-ndc");function Yt(t,e,s,n){let o;const a=s,i=Te(t);if(i||rt(t)){const r=i&&rn(t);let l=!1,c=!1;r&&(l=!Xt(t),c=Is(t),t=$o(t)),o=new Array(t.length);for(let u=0,d=t.length;u<d;u++)o[u]=e(l?c?fo(yt(t[u])):yt(t[u]):t[u],u,void 0,a)}else if(typeof t=="number"){o=new Array(t);for(let r=0;r<t;r++)o[r]=e(r+1,r,void 0,a)}else if(Qe(t))if(t[Symbol.iterator])o=Array.from(t,(r,l)=>e(r,l,void 0,a));else{const r=Object.keys(t);o=new Array(r.length);for(let l=0,c=r.length;l<c;l++){const u=r[l];o[l]=e(t[u],u,l,a)}}else o=[];return o}const Ca=t=>t?Dl(t)?No(t):Ca(t.parent):null,An=bt(Object.create(null),{$:t=>t,$el:t=>t.vnode.el,$data:t=>t.data,$props:t=>t.props,$attrs:t=>t.attrs,$slots:t=>t.slots,$refs:t=>t.refs,$parent:t=>Ca(t.parent),$root:t=>Ca(t.root),$host:t=>t.ce,$emit:t=>t.emit,$options:t=>yl(t),$forceUpdate:t=>t.f||(t.f=()=>{qa(t.update)}),$nextTick:t=>t.n||(t.n=On.bind(t.proxy)),$watch:t=>zd.bind(t)}),sa=(t,e)=>t!==Ye&&!t.__isScriptSetup&&ze(t,e),Md={get({_:t},e){if(e==="__v_skip")return!0;const{ctx:s,setupState:n,data:o,props:a,accessCache:i,type:r,appContext:l}=t;let c;if(e[0]!=="$"){const m=i[e];if(m!==void 0)switch(m){case 1:return n[e];case 2:return o[e];case 4:return s[e];case 3:return a[e]}else{if(sa(n,e))return i[e]=1,n[e];if(o!==Ye&&ze(o,e))return i[e]=2,o[e];if((c=t.propsOptions[0])&&ze(c,e))return i[e]=3,a[e];if(s!==Ye&&ze(s,e))return i[e]=4,s[e];Ea&&(i[e]=0)}}const u=An[e];let d,h;if(u)return e==="$attrs"&&Mt(t.attrs,"get",""),u(t);if((d=r.__cssModules)&&(d=d[e]))return d;if(s!==Ye&&ze(s,e))return i[e]=4,s[e];if(h=l.config.globalProperties,ze(h,e))return h[e]},set({_:t},e,s){const{data:n,setupState:o,ctx:a}=t;return sa(o,e)?(o[e]=s,!0):n!==Ye&&ze(n,e)?(n[e]=s,!0):ze(t.props,e)||e[0]==="$"&&e.slice(1)in t?!1:(a[e]=s,!0)},has({_:{data:t,setupState:e,accessCache:s,ctx:n,appContext:o,propsOptions:a,type:i}},r){let l,c;return!!(s[r]||t!==Ye&&r[0]!=="$"&&ze(t,r)||sa(e,r)||(l=a[0])&&ze(l,r)||ze(n,r)||ze(An,r)||ze(o.config.globalProperties,r)||(c=i.__cssModules)&&c[r])},defineProperty(t,e,s){return s.get!=null?t._.accessCache[e]=0:ze(s,"value")&&this.set(t,e,s.value,null),Reflect.defineProperty(t,e,s)}};function Ci(t){return Te(t)?t.reduce((e,s)=>(e[s]=null,e),{}):t}let Ea=!0;function Td(t){const e=yl(t),s=t.proxy,n=t.ctx;Ea=!1,e.beforeCreate&&Ei(e.beforeCreate,t,"bc");const{data:o,computed:a,methods:i,watch:r,provide:l,inject:c,created:u,beforeMount:d,mounted:h,beforeUpdate:m,updated:g,activated:x,deactivated:S,beforeDestroy:_,beforeUnmount:M,destroyed:b,unmounted:w,render:I,renderTracked:F,renderTriggered:z,errorCaptured:B,serverPrefetch:N,expose:ie,inheritAttrs:le,components:E,directives:q,filters:Me}=e;if(c&&xd(c,n,null),i)for(const Z in i){const R=i[Z];Ae(R)&&(n[Z]=R.bind(s))}if(o){const Z=o.call(s,s);Qe(Z)&&(t.data=Va(Z))}if(Ea=!0,a)for(const Z in a){const R=a[Z],ce=Ae(R)?R.bind(s,s):Ae(R.get)?R.get.bind(s,s):ss,K=!Ae(R)&&Ae(R.set)?R.set.bind(s):ss,O=$e({get:ce,set:K});Object.defineProperty(n,Z,{enumerable:!0,configurable:!0,get:()=>O.value,set:J=>O.value=J})}if(r)for(const Z in r)vl(r[Z],n,s,Z);if(l){const Z=Ae(l)?l.call(s):l;Reflect.ownKeys(Z).forEach(R=>{$d(R,Z[R])})}u&&Ei(u,t,"c");function he(Z,R){Te(R)?R.forEach(ce=>Z(ce.bind(s))):R&&Z(R.bind(s))}if(he(gd,d),he(Dt,h),he(_l,m),he(_d,g),he(pd,x),he(hd,S),he(wd,B),he(bd,F),he(yd,z),he(ms,M),he(Xa,w),he(vd,N),Te(ie))if(ie.length){const Z=t.exposed||(t.exposed={});ie.forEach(R=>{Object.defineProperty(Z,R,{get:()=>s[R],set:ce=>s[R]=ce,enumerable:!0})})}else t.exposed||(t.exposed={});I&&t.render===ss&&(t.render=I),le!=null&&(t.inheritAttrs=le),E&&(t.components=E),q&&(t.directives=q),N&&ml(t)}function xd(t,e,s=ss){Te(t)&&(t=ka(t));for(const n in t){const o=t[n];let a;Qe(o)?"default"in o?a=oo(o.from||n,o.default,!0):a=oo(o.from||n):a=oo(o),xt(a)?Object.defineProperty(e,n,{enumerable:!0,configurable:!0,get:()=>a.value,set:i=>a.value=i}):e[n]=a}}function Ei(t,e,s){as(Te(t)?t.map(n=>n.bind(e.proxy)):t.bind(e.proxy),e,s)}function vl(t,e,s,n){let o=n.includes(".")?$l(s,n):()=>s[n];if(rt(t)){const a=e[t];Ae(a)&&Bt(o,a)}else if(Ae(t))Bt(o,t.bind(s));else if(Qe(t))if(Te(t))t.forEach(a=>vl(a,e,s,n));else{const a=Ae(t.handler)?t.handler.bind(s):e[t.handler];Ae(a)&&Bt(o,a,t)}}function yl(t){const e=t.type,{mixins:s,extends:n}=e,{mixins:o,optionsCache:a,config:{optionMergeStrategies:i}}=t.appContext,r=a.get(e);let l;return r?l=r:!o.length&&!s&&!n?l=e:(l={},o.length&&o.forEach(c=>_o(l,c,i,!0)),_o(l,e,i)),Qe(e)&&a.set(e,l),l}function _o(t,e,s,n=!1){const{mixins:o,extends:a}=e;a&&_o(t,a,s,!0),o&&o.forEach(i=>_o(t,i,s,!0));for(const i in e)if(!(n&&i==="expose")){const r=Cd[i]||s&&s[i];t[i]=r?r(t[i],e[i]):e[i]}return t}const Cd={data:ki,props:Ai,emits:Ai,methods:bn,computed:bn,beforeCreate:Et,created:Et,beforeMount:Et,mounted:Et,beforeUpdate:Et,updated:Et,beforeDestroy:Et,beforeUnmount:Et,destroyed:Et,unmounted:Et,activated:Et,deactivated:Et,errorCaptured:Et,serverPrefetch:Et,components:bn,directives:bn,watch:kd,provide:ki,inject:Ed};function ki(t,e){return e?t?function(){return bt(Ae(t)?t.call(this,this):t,Ae(e)?e.call(this,this):e)}:e:t}function Ed(t,e){return bn(ka(t),ka(e))}function ka(t){if(Te(t)){const e={};for(let s=0;s<t.length;s++)e[t[s]]=t[s];return e}return t}function Et(t,e){return t?[...new Set([].concat(t,e))]:e}function bn(t,e){return t?bt(Object.create(null),t,e):e}function Ai(t,e){return t?Te(t)&&Te(e)?[...new Set([...t,...e])]:bt(Object.create(null),Ci(t),Ci(e??{})):e}function kd(t,e){if(!t)return e;if(!e)return t;const s=bt(Object.create(null),t);for(const n in e)s[n]=Et(t[n],e[n]);return s}function bl(){return{app:null,config:{isNativeTag:Cr,performance:!1,globalProperties:{},optionMergeStrategies:{},errorHandler:void 0,warnHandler:void 0,compilerOptions:{}},mixins:[],components:{},directives:{},provides:Object.create(null),optionsCache:new WeakMap,propsCache:new WeakMap,emitsCache:new WeakMap}}let Ad=0;function Rd(t,e){return function(n,o=null){Ae(n)||(n=bt({},n)),o!=null&&!Qe(o)&&(o=null);const a=bl(),i=new WeakSet,r=[];let l=!1;const c=a.app={_uid:Ad++,_component:n,_props:o,_container:null,_context:a,_instance:null,version:pf,get config(){return a.config},set config(u){},use(u,...d){return i.has(u)||(u&&Ae(u.install)?(i.add(u),u.install(c,...d)):Ae(u)&&(i.add(u),u(c,...d))),c},mixin(u){return a.mixins.includes(u)||a.mixins.push(u),c},component(u,d){return d?(a.components[u]=d,c):a.components[u]},directive(u,d){return d?(a.directives[u]=d,c):a.directives[u]},mount(u,d,h){if(!l){const m=c._ceVNode||ot(n,o);return m.appContext=a,h===!0?h="svg":h===!1&&(h=void 0),t(m,u,h),l=!0,c._container=u,u.__vue_app__=c,No(m.component)}},onUnmount(u){r.push(u)},unmount(){l&&(as(r,c._instance,16),t(null,c._container),delete c._container.__vue_app__)},provide(u,d){return a.provides[u]=d,c},runWithContext(u){const d=cn;cn=c;try{return u()}finally{cn=d}}};return c}}let cn=null;function $d(t,e){if(Ot){let s=Ot.provides;const n=Ot.parent&&Ot.parent.provides;n===s&&(s=Ot.provides=Object.create(n)),s[t]=e}}function oo(t,e,s=!1){const n=ei();if(n||cn){let o=cn?cn._context.provides:n?n.parent==null||n.ce?n.vnode.appContext&&n.vnode.appContext.provides:n.parent.provides:void 0;if(o&&t in o)return o[t];if(arguments.length>1)return s&&Ae(e)?e.call(n&&n.proxy):e}}const wl={},Sl=()=>Object.create(wl),Ml=t=>Object.getPrototypeOf(t)===wl;function Pd(t,e,s,n=!1){const o={},a=Sl();t.propsDefaults=Object.create(null),Tl(t,e,o,a);for(const i in t.propsOptions[0])i in o||(o[i]=void 0);s?t.props=n?o:Zu(o):t.type.props?t.props=o:t.props=a,t.attrs=a}function Ld(t,e,s,n){const{props:o,attrs:a,vnode:{patchFlag:i}}=t,r=Be(o),[l]=t.propsOptions;let c=!1;if((n||i>0)&&!(i&16)){if(i&8){const u=t.vnode.dynamicProps;for(let d=0;d<u.length;d++){let h=u[d];if(Oo(t.emitsOptions,h))continue;const m=e[h];if(l)if(ze(a,h))m!==a[h]&&(a[h]=m,c=!0);else{const g=Ls(h);o[g]=Aa(l,r,g,m,t,!1)}else m!==a[h]&&(a[h]=m,c=!0)}}}else{Tl(t,e,o,a)&&(c=!0);let u;for(const d in r)(!e||!ze(e,d)&&((u=Ys(d))===d||!ze(e,u)))&&(l?s&&(s[d]!==void 0||s[u]!==void 0)&&(o[d]=Aa(l,r,d,void 0,t,!0)):delete o[d]);if(a!==r)for(const d in a)(!e||!ze(e,d))&&(delete a[d],c=!0)}c&&ws(t.attrs,"set","")}function Tl(t,e,s,n){const[o,a]=t.propsOptions;let i=!1,r;if(e)for(let l in e){if(Mn(l))continue;const c=e[l];let u;o&&ze(o,u=Ls(l))?!a||!a.includes(u)?s[u]=c:(r||(r={}))[u]=c:Oo(t.emitsOptions,l)||(!(l in n)||c!==n[l])&&(n[l]=c,i=!0)}if(a){const l=Be(s),c=r||Ye;for(let u=0;u<a.length;u++){const d=a[u];s[d]=Aa(o,l,d,c[d],t,!ze(c,d))}}return i}function Aa(t,e,s,n,o,a){const i=t[s];if(i!=null){const r=ze(i,"default");if(r&&n===void 0){const l=i.default;if(i.type!==Function&&!i.skipFactory&&Ae(l)){const{propsDefaults:c}=o;if(s in c)n=c[s];else{const u=jn(o);n=c[s]=l.call(null,e),u()}}else n=l;o.ce&&o.ce._setProp(s,n)}i[0]&&(a&&!r?n=!1:i[1]&&(n===""||n===Ys(s))&&(n=!0))}return n}const Id=new WeakMap;function xl(t,e,s=!1){const n=s?Id:e.propsCache,o=n.get(t);if(o)return o;const a=t.props,i={},r=[];let l=!1;if(!Ae(t)){const u=d=>{l=!0;const[h,m]=xl(d,e,!0);bt(i,h),m&&r.push(...m)};!s&&e.mixins.length&&e.mixins.forEach(u),t.extends&&u(t.extends),t.mixins&&t.mixins.forEach(u)}if(!a&&!l)return Qe(t)&&n.set(t,on),on;if(Te(a))for(let u=0;u<a.length;u++){const d=Ls(a[u]);Ri(d)&&(i[d]=Ye)}else if(a)for(const u in a){const d=Ls(u);if(Ri(d)){const h=a[u],m=i[d]=Te(h)||Ae(h)?{type:h}:bt({},h),g=m.type;let x=!1,S=!0;if(Te(g))for(let _=0;_<g.length;++_){const M=g[_],b=Ae(M)&&M.name;if(b==="Boolean"){x=!0;break}else b==="String"&&(S=!1)}else x=Ae(g)&&g.name==="Boolean";m[0]=x,m[1]=S,(x||ze(m,"default"))&&r.push(d)}}const c=[i,r];return Qe(t)&&n.set(t,c),c}function Ri(t){return t[0]!=="$"&&!Mn(t)}const Ya=t=>t==="_"||t==="_ctx"||t==="$stable",Ja=t=>Te(t)?t.map(ds):[ds(t)],Od=(t,e,s)=>{if(e._n)return e;const n=nl((...o)=>Ja(e(...o)),s);return n._c=!1,n},Cl=(t,e,s)=>{const n=t._ctx;for(const o in t){if(Ya(o))continue;const a=t[o];if(Ae(a))e[o]=Od(o,a,n);else if(a!=null){const i=Ja(a);e[o]=()=>i}}},El=(t,e)=>{const s=Ja(e);t.slots.default=()=>s},kl=(t,e,s)=>{for(const n in e)(s||!Ya(n))&&(t[n]=e[n])},Dd=(t,e,s)=>{const n=t.slots=Sl();if(t.vnode.shapeFlag&32){const o=e._;o?(kl(n,e,s),s&&Pr(n,"_",o,!0)):Cl(e,n)}else e&&El(t,e)},Nd=(t,e,s)=>{const{vnode:n,slots:o}=t;let a=!0,i=Ye;if(n.shapeFlag&32){const r=e._;r?s&&r===1?a=!1:kl(o,e,s):(a=!e.$stable,Cl(e,o)),i=e}else e&&(El(t,e),i={default:1});if(a)for(const r in o)!Ya(r)&&i[r]==null&&delete o[r]},At=Zd;function Gd(t){return Hd(t)}function Hd(t,e){const s=Ro();s.__VUE__=!0;const{insert:n,remove:o,patchProp:a,createElement:i,createText:r,createComment:l,setText:c,setElementText:u,parentNode:d,nextSibling:h,setScopeId:m=ss,insertStaticContent:g}=t,x=(y,T,P,Y=null,j=null,V=null,ae=void 0,ne=null,$=!!T.dynamicChildren)=>{if(y===T)return;y&&!Ws(y,T)&&(Y=Ge(y),J(y,j,V,!0),y=null),T.patchFlag===-2&&($=!1,T.dynamicChildren=null);const{type:X,ref:pe,shapeFlag:re}=T;switch(X){case Do:S(y,T,P,Y);break;case It:_(y,T,P,Y);break;case Rn:y==null&&M(T,P,Y,ae);break;case Je:E(y,T,P,Y,j,V,ae,ne,$);break;default:re&1?I(y,T,P,Y,j,V,ae,ne,$):re&6?q(y,T,P,Y,j,V,ae,ne,$):(re&64||re&128)&&X.process(y,T,P,Y,j,V,ae,ne,$,nt)}pe!=null&&j?En(pe,y&&y.ref,V,T||y,!T):pe==null&&y&&y.ref!=null&&En(y.ref,null,V,y,!0)},S=(y,T,P,Y)=>{if(y==null)n(T.el=r(T.children),P,Y);else{const j=T.el=y.el;T.children!==y.children&&c(j,T.children)}},_=(y,T,P,Y)=>{y==null?n(T.el=l(T.children||""),P,Y):T.el=y.el},M=(y,T,P,Y)=>{[y.el,y.anchor]=g(y.children,T,P,Y,y.el,y.anchor)},b=({el:y,anchor:T},P,Y)=>{let j;for(;y&&y!==T;)j=h(y),n(y,P,Y),y=j;n(T,P,Y)},w=({el:y,anchor:T})=>{let P;for(;y&&y!==T;)P=h(y),o(y),y=P;o(T)},I=(y,T,P,Y,j,V,ae,ne,$)=>{T.type==="svg"?ae="svg":T.type==="math"&&(ae="mathml"),y==null?F(T,P,Y,j,V,ae,ne,$):N(y,T,j,V,ae,ne,$)},F=(y,T,P,Y,j,V,ae,ne)=>{let $,X;const{props:pe,shapeFlag:re,transition:me,dirs:_e}=y;if($=y.el=i(y.type,V,pe&&pe.is,pe),re&8?u($,y.children):re&16&&B(y.children,$,null,Y,j,na(y,V),ae,ne),_e&&Us(y,null,Y,"created"),z($,y,y.scopeId,ae,Y),pe){for(const He in pe)He!=="value"&&!Mn(He)&&a($,He,null,pe[He],V,Y);"value"in pe&&a($,"value",null,pe.value,V),(X=pe.onVnodeBeforeMount)&&is(X,Y,y)}_e&&Us(y,null,Y,"beforeMount");const ge=Ud(j,me);ge&&me.beforeEnter($),n($,T,P),((X=pe&&pe.onVnodeMounted)||ge||_e)&&At(()=>{X&&is(X,Y,y),ge&&me.enter($),_e&&Us(y,null,Y,"mounted")},j)},z=(y,T,P,Y,j)=>{if(P&&m(y,P),Y)for(let V=0;V<Y.length;V++)m(y,Y[V]);if(j){let V=j.subTree;if(T===V||Ll(V.type)&&(V.ssContent===T||V.ssFallback===T)){const ae=j.vnode;z(y,ae,ae.scopeId,ae.slotScopeIds,j.parent)}}},B=(y,T,P,Y,j,V,ae,ne,$=0)=>{for(let X=$;X<y.length;X++){const pe=y[X]=ne?$s(y[X]):ds(y[X]);x(null,pe,T,P,Y,j,V,ae,ne)}},N=(y,T,P,Y,j,V,ae)=>{const ne=T.el=y.el;let{patchFlag:$,dynamicChildren:X,dirs:pe}=T;$|=y.patchFlag&16;const re=y.props||Ye,me=T.props||Ye;let _e;if(P&&Fs(P,!1),(_e=me.onVnodeBeforeUpdate)&&is(_e,P,T,y),pe&&Us(T,y,P,"beforeUpdate"),P&&Fs(P,!0),(re.innerHTML&&me.innerHTML==null||re.textContent&&me.textContent==null)&&u(ne,""),X?ie(y.dynamicChildren,X,ne,P,Y,na(T,j),V):ae||R(y,T,ne,null,P,Y,na(T,j),V,!1),$>0){if($&16)le(ne,re,me,P,j);else if($&2&&re.class!==me.class&&a(ne,"class",null,me.class,j),$&4&&a(ne,"style",re.style,me.style,j),$&8){const ge=T.dynamicProps;for(let He=0;He<ge.length;He++){const Pe=ge[He],Xe=re[Pe],ut=me[Pe];(ut!==Xe||Pe==="value")&&a(ne,Pe,Xe,ut,j,P)}}$&1&&y.children!==T.children&&u(ne,T.children)}else!ae&&X==null&&le(ne,re,me,P,j);((_e=me.onVnodeUpdated)||pe)&&At(()=>{_e&&is(_e,P,T,y),pe&&Us(T,y,P,"updated")},Y)},ie=(y,T,P,Y,j,V,ae)=>{for(let ne=0;ne<T.length;ne++){const $=y[ne],X=T[ne],pe=$.el&&($.type===Je||!Ws($,X)||$.shapeFlag&198)?d($.el):P;x($,X,pe,null,Y,j,V,ae,!0)}},le=(y,T,P,Y,j)=>{if(T!==P){if(T!==Ye)for(const V in T)!Mn(V)&&!(V in P)&&a(y,V,T[V],null,j,Y);for(const V in P){if(Mn(V))continue;const ae=P[V],ne=T[V];ae!==ne&&V!=="value"&&a(y,V,ne,ae,j,Y)}"value"in P&&a(y,"value",T.value,P.value,j)}},E=(y,T,P,Y,j,V,ae,ne,$)=>{const X=T.el=y?y.el:r(""),pe=T.anchor=y?y.anchor:r("");let{patchFlag:re,dynamicChildren:me,slotScopeIds:_e}=T;_e&&(ne=ne?ne.concat(_e):_e),y==null?(n(X,P,Y),n(pe,P,Y),B(T.children||[],P,pe,j,V,ae,ne,$)):re>0&&re&64&&me&&y.dynamicChildren?(ie(y.dynamicChildren,me,P,j,V,ae,ne),(T.key!=null||j&&T===j.subTree)&&Za(y,T,!0)):R(y,T,P,pe,j,V,ae,ne,$)},q=(y,T,P,Y,j,V,ae,ne,$)=>{T.slotScopeIds=ne,y==null?T.shapeFlag&512?j.ctx.activate(T,P,Y,ae,$):Me(T,P,Y,j,V,ae,$):fe(y,T,$)},Me=(y,T,P,Y,j,V,ae)=>{const ne=y.component=af(y,Y,j);if(Lo(y)&&(ne.ctx.renderer=nt),rf(ne,!1,ae),ne.asyncDep){if(j&&j.registerDep(ne,he,ae),!y.el){const $=ne.subTree=ot(It);_(null,$,T,P),y.placeholder=$.el}}else he(ne,y,T,P,j,V,ae)},fe=(y,T,P)=>{const Y=T.component=y.component;if(Yd(y,T,P))if(Y.asyncDep&&!Y.asyncResolved){Z(Y,T,P);return}else Y.next=T,Y.update();else T.el=y.el,Y.vnode=T},he=(y,T,P,Y,j,V,ae)=>{const ne=()=>{if(y.isMounted){let{next:re,bu:me,u:_e,parent:ge,vnode:He}=y;{const vt=Al(y);if(vt){re&&(re.el=He.el,Z(y,re,ae)),vt.asyncDep.then(()=>{y.isUnmounted||ne()});return}}let Pe=re,Xe;Fs(y,!1),re?(re.el=He.el,Z(y,re,ae)):re=He,me&&Yo(me),(Xe=re.props&&re.props.onVnodeBeforeUpdate)&&is(Xe,ge,re,He),Fs(y,!0);const ut=Pi(y),lt=y.subTree;y.subTree=ut,x(lt,ut,d(lt.el),Ge(lt),y,j,V),re.el=ut.el,Pe===null&&Jd(y,ut.el),_e&&At(_e,j),(Xe=re.props&&re.props.onVnodeUpdated)&&At(()=>is(Xe,ge,re,He),j)}else{let re;const{el:me,props:_e}=T,{bm:ge,m:He,parent:Pe,root:Xe,type:ut}=y,lt=kn(T);Fs(y,!1),ge&&Yo(ge),!lt&&(re=_e&&_e.onVnodeBeforeMount)&&is(re,Pe,T),Fs(y,!0);{Xe.ce&&Xe.ce._def.shadowRoot!==!1&&Xe.ce._injectChildStyle(ut);const vt=y.subTree=Pi(y);x(null,vt,P,Y,y,j,V),T.el=vt.el}if(He&&At(He,j),!lt&&(re=_e&&_e.onVnodeMounted)){const vt=T;At(()=>is(re,Pe,vt),j)}(T.shapeFlag&256||Pe&&kn(Pe.vnode)&&Pe.vnode.shapeFlag&256)&&y.a&&At(y.a,j),y.isMounted=!0,T=P=Y=null}};y.scope.on();const $=y.effect=new Dr(ne);y.scope.off();const X=y.update=$.run.bind($),pe=y.job=$.runIfDirty.bind($);pe.i=y,pe.id=y.uid,$.scheduler=()=>qa(pe),Fs(y,!0),X()},Z=(y,T,P)=>{T.component=y;const Y=y.vnode.props;y.vnode=T,y.next=null,Ld(y,T.props,Y,P),Nd(y,T.children,P),Ts(),bi(y),xs()},R=(y,T,P,Y,j,V,ae,ne,$=!1)=>{const X=y&&y.children,pe=y?y.shapeFlag:0,re=T.children,{patchFlag:me,shapeFlag:_e}=T;if(me>0){if(me&128){K(X,re,P,Y,j,V,ae,ne,$);return}else if(me&256){ce(X,re,P,Y,j,V,ae,ne,$);return}}_e&8?(pe&16&&Ve(X,j,V),re!==X&&u(P,re)):pe&16?_e&16?K(X,re,P,Y,j,V,ae,ne,$):Ve(X,j,V,!0):(pe&8&&u(P,""),_e&16&&B(re,P,Y,j,V,ae,ne,$))},ce=(y,T,P,Y,j,V,ae,ne,$)=>{y=y||on,T=T||on;const X=y.length,pe=T.length,re=Math.min(X,pe);let me;for(me=0;me<re;me++){const _e=T[me]=$?$s(T[me]):ds(T[me]);x(y[me],_e,P,null,j,V,ae,ne,$)}X>pe?Ve(y,j,V,!0,!1,re):B(T,P,Y,j,V,ae,ne,$,re)},K=(y,T,P,Y,j,V,ae,ne,$)=>{let X=0;const pe=T.length;let re=y.length-1,me=pe-1;for(;X<=re&&X<=me;){const _e=y[X],ge=T[X]=$?$s(T[X]):ds(T[X]);if(Ws(_e,ge))x(_e,ge,P,null,j,V,ae,ne,$);else break;X++}for(;X<=re&&X<=me;){const _e=y[re],ge=T[me]=$?$s(T[me]):ds(T[me]);if(Ws(_e,ge))x(_e,ge,P,null,j,V,ae,ne,$);else break;re--,me--}if(X>re){if(X<=me){const _e=me+1,ge=_e<pe?T[_e].el:Y;for(;X<=me;)x(null,T[X]=$?$s(T[X]):ds(T[X]),P,ge,j,V,ae,ne,$),X++}}else if(X>me)for(;X<=re;)J(y[X],j,V,!0),X++;else{const _e=X,ge=X,He=new Map;for(X=ge;X<=me;X++){const ue=T[X]=$?$s(T[X]):ds(T[X]);ue.key!=null&&He.set(ue.key,X)}let Pe,Xe=0;const ut=me-ge+1;let lt=!1,vt=0;const Ue=new Array(ut);for(X=0;X<ut;X++)Ue[X]=0;for(X=_e;X<=re;X++){const ue=y[X];if(Xe>=ut){J(ue,j,V,!0);continue}let it;if(ue.key!=null)it=He.get(ue.key);else for(Pe=ge;Pe<=me;Pe++)if(Ue[Pe-ge]===0&&Ws(ue,T[Pe])){it=Pe;break}it===void 0?J(ue,j,V,!0):(Ue[it-ge]=X+1,it>=vt?vt=it:lt=!0,x(ue,T[it],P,null,j,V,ae,ne,$),Xe++)}const tt=lt?Fd(Ue):on;for(Pe=tt.length-1,X=ut-1;X>=0;X--){const ue=ge+X,it=T[ue],Zt=T[ue+1],Es=ue+1<pe?Zt.el||Zt.placeholder:Y;Ue[X]===0?x(null,it,P,Es,j,V,ae,ne,$):lt&&(Pe<0||X!==tt[Pe]?O(it,P,Es,2):Pe--)}}},O=(y,T,P,Y,j=null)=>{const{el:V,type:ae,transition:ne,children:$,shapeFlag:X}=y;if(X&6){O(y.component.subTree,T,P,Y);return}if(X&128){y.suspense.move(T,P,Y);return}if(X&64){ae.move(y,T,P,nt);return}if(ae===Je){n(V,T,P);for(let re=0;re<$.length;re++)O($[re],T,P,Y);n(y.anchor,T,P);return}if(ae===Rn){b(y,T,P);return}if(Y!==2&&X&1&&ne)if(Y===0)ne.beforeEnter(V),n(V,T,P),At(()=>ne.enter(V),j);else{const{leave:re,delayLeave:me,afterLeave:_e}=ne,ge=()=>{y.ctx.isUnmounted?o(V):n(V,T,P)},He=()=>{V._isLeaving&&V[bs](!0),re(V,()=>{ge(),_e&&_e()})};me?me(V,ge,He):He()}else n(V,T,P)},J=(y,T,P,Y=!1,j=!1)=>{const{type:V,props:ae,ref:ne,children:$,dynamicChildren:X,shapeFlag:pe,patchFlag:re,dirs:me,cacheIndex:_e}=y;if(re===-2&&(j=!1),ne!=null&&(Ts(),En(ne,null,P,y,!0),xs()),_e!=null&&(T.renderCache[_e]=void 0),pe&256){T.ctx.deactivate(y);return}const ge=pe&1&&me,He=!kn(y);let Pe;if(He&&(Pe=ae&&ae.onVnodeBeforeUnmount)&&is(Pe,T,y),pe&6)je(y.component,P,Y);else{if(pe&128){y.suspense.unmount(P,Y);return}ge&&Us(y,null,T,"beforeUnmount"),pe&64?y.type.remove(y,T,P,nt,Y):X&&!X.hasOnce&&(V!==Je||re>0&&re&64)?Ve(X,T,P,!1,!0):(V===Je&&re&384||!j&&pe&16)&&Ve($,T,P),Y&&Q(y)}(He&&(Pe=ae&&ae.onVnodeUnmounted)||ge)&&At(()=>{Pe&&is(Pe,T,y),ge&&Us(y,null,T,"unmounted")},P)},Q=y=>{const{type:T,el:P,anchor:Y,transition:j}=y;if(T===Je){Oe(P,Y);return}if(T===Rn){w(y);return}const V=()=>{o(P),j&&!j.persisted&&j.afterLeave&&j.afterLeave()};if(y.shapeFlag&1&&j&&!j.persisted){const{leave:ae,delayLeave:ne}=j,$=()=>ae(P,V);ne?ne(y.el,V,$):$()}else V()},Oe=(y,T)=>{let P;for(;y!==T;)P=h(y),o(y),y=P;o(T)},je=(y,T,P)=>{const{bum:Y,scope:j,job:V,subTree:ae,um:ne,m:$,a:X}=y;$i($),$i(X),Y&&Yo(Y),j.stop(),V&&(V.flags|=8,J(ae,y,T,P)),ne&&At(ne,T),At(()=>{y.isUnmounted=!0},T)},Ve=(y,T,P,Y=!1,j=!1,V=0)=>{for(let ae=V;ae<y.length;ae++)J(y[ae],T,P,Y,j)},Ge=y=>{if(y.shapeFlag&6)return Ge(y.component.subTree);if(y.shapeFlag&128)return y.suspense.next();const T=h(y.anchor||y.el),P=T&&T[al];return P?h(P):T};let et=!1;const at=(y,T,P)=>{y==null?T._vnode&&J(T._vnode,null,null,!0):x(T._vnode||null,y,T,null,null,null,P),T._vnode=y,et||(et=!0,bi(),el(),et=!1)},nt={p:x,um:J,m:O,r:Q,mt:Me,mc:B,pc:R,pbc:ie,n:Ge,o:t};return{render:at,hydrate:void 0,createApp:Rd(at)}}function na({type:t,props:e},s){return s==="svg"&&t==="foreignObject"||s==="mathml"&&t==="annotation-xml"&&e&&e.encoding&&e.encoding.includes("html")?void 0:s}function Fs({effect:t,job:e},s){s?(t.flags|=32,e.flags|=4):(t.flags&=-33,e.flags&=-5)}function Ud(t,e){return(!t||t&&!t.pendingBranch)&&e&&!e.persisted}function Za(t,e,s=!1){const n=t.children,o=e.children;if(Te(n)&&Te(o))for(let a=0;a<n.length;a++){const i=n[a];let r=o[a];r.shapeFlag&1&&!r.dynamicChildren&&((r.patchFlag<=0||r.patchFlag===32)&&(r=o[a]=$s(o[a]),r.el=i.el),!s&&r.patchFlag!==-2&&Za(i,r)),r.type===Do&&r.patchFlag!==-1&&(r.el=i.el),r.type===It&&!r.el&&(r.el=i.el)}}function Fd(t){const e=t.slice(),s=[0];let n,o,a,i,r;const l=t.length;for(n=0;n<l;n++){const c=t[n];if(c!==0){if(o=s[s.length-1],t[o]<c){e[n]=o,s.push(n);continue}for(a=0,i=s.length-1;a<i;)r=a+i>>1,t[s[r]]<c?a=r+1:i=r;c<t[s[a]]&&(a>0&&(e[n]=s[a-1]),s[a]=n)}}for(a=s.length,i=s[a-1];a-- >0;)s[a]=i,i=e[i];return s}function Al(t){const e=t.subTree.component;if(e)return e.asyncDep&&!e.asyncResolved?e:Al(e)}function $i(t){if(t)for(let e=0;e<t.length;e++)t[e].flags|=8}const Bd=Symbol.for("v-scx"),jd=()=>oo(Bd);function Bt(t,e,s){return Rl(t,e,s)}function Rl(t,e,s=Ye){const{immediate:n,deep:o,flush:a,once:i}=s,r=bt({},s),l=e&&n||!e&&a!=="post";let c;if(Hn){if(a==="sync"){const m=jd();c=m.__watcherHandles||(m.__watcherHandles=[])}else if(!l){const m=()=>{};return m.stop=ss,m.resume=ss,m.pause=ss,m}}const u=Ot;r.call=(m,g,x)=>as(m,u,g,x);let d=!1;a==="post"?r.scheduler=m=>{At(m,u&&u.suspense)}:a!=="sync"&&(d=!0,r.scheduler=(m,g)=>{g?m():qa(m)}),r.augmentJob=m=>{e&&(m.flags|=4),d&&(m.flags|=2,u&&(m.id=u.uid,m.i=u))};const h=id(t,e,r);return Hn&&(c?c.push(h):l&&h()),h}function zd(t,e,s){const n=this.proxy,o=rt(t)?t.includes(".")?$l(n,t):()=>n[t]:t.bind(n,n);let a;Ae(e)?a=e:(a=e.handler,s=e);const i=jn(this),r=Rl(o,a.bind(n),s);return i(),r}function $l(t,e){const s=e.split(".");return()=>{let n=t;for(let o=0;o<s.length&&n;o++)n=n[s[o]];return n}}const Vd=(t,e)=>e==="modelValue"||e==="model-value"?t.modelModifiers:t[`${e}Modifiers`]||t[`${Ls(e)}Modifiers`]||t[`${Ys(e)}Modifiers`];function Wd(t,e,...s){if(t.isUnmounted)return;const n=t.vnode.props||Ye;let o=s;const a=e.startsWith("update:"),i=a&&Vd(n,e.slice(7));i&&(i.trim&&(o=s.map(u=>rt(u)?u.trim():u)),i.number&&(o=s.map(Mu)));let r,l=n[r=Xo(e)]||n[r=Xo(Ls(e))];!l&&a&&(l=n[r=Xo(Ys(e))]),l&&as(l,t,6,o);const c=n[r+"Once"];if(c){if(!t.emitted)t.emitted={};else if(t.emitted[r])return;t.emitted[r]=!0,as(c,t,6,o)}}const Kd=new WeakMap;function Pl(t,e,s=!1){const n=s?Kd:e.emitsCache,o=n.get(t);if(o!==void 0)return o;const a=t.emits;let i={},r=!1;if(!Ae(t)){const l=c=>{const u=Pl(c,e,!0);u&&(r=!0,bt(i,u))};!s&&e.mixins.length&&e.mixins.forEach(l),t.extends&&l(t.extends),t.mixins&&t.mixins.forEach(l)}return!a&&!r?(Qe(t)&&n.set(t,null),null):(Te(a)?a.forEach(l=>i[l]=null):bt(i,a),Qe(t)&&n.set(t,i),i)}function Oo(t,e){return!t||!Eo(e)?!1:(e=e.slice(2).replace(/Once$/,""),ze(t,e[0].toLowerCase()+e.slice(1))||ze(t,Ys(e))||ze(t,e))}function Pi(t){const{type:e,vnode:s,proxy:n,withProxy:o,propsOptions:[a],slots:i,attrs:r,emit:l,render:c,renderCache:u,props:d,data:h,setupState:m,ctx:g,inheritAttrs:x}=t,S=mo(t);let _,M;try{if(s.shapeFlag&4){const w=o||n,I=w;_=ds(c.call(I,w,u,d,m,h,g)),M=r}else{const w=e;_=ds(w.length>1?w(d,{attrs:r,slots:i,emit:l}):w(d,null)),M=e.props?r:qd(r)}}catch(w){$n.length=0,Po(w,t,1),_=ot(It)}let b=_;if(M&&x!==!1){const w=Object.keys(M),{shapeFlag:I}=b;w.length&&I&7&&(a&&w.some(Na)&&(M=Xd(M,a)),b=Os(b,M,!1,!0))}return s.dirs&&(b=Os(b,null,!1,!0),b.dirs=b.dirs?b.dirs.concat(s.dirs):s.dirs),s.transition&&Nn(b,s.transition),_=b,mo(S),_}const qd=t=>{let e;for(const s in t)(s==="class"||s==="style"||Eo(s))&&((e||(e={}))[s]=t[s]);return e},Xd=(t,e)=>{const s={};for(const n in t)(!Na(n)||!(n.slice(9)in e))&&(s[n]=t[n]);return s};function Yd(t,e,s){const{props:n,children:o,component:a}=t,{props:i,children:r,patchFlag:l}=e,c=a.emitsOptions;if(e.dirs||e.transition)return!0;if(s&&l>=0){if(l&1024)return!0;if(l&16)return n?Li(n,i,c):!!i;if(l&8){const u=e.dynamicProps;for(let d=0;d<u.length;d++){const h=u[d];if(i[h]!==n[h]&&!Oo(c,h))return!0}}}else return(o||r)&&(!r||!r.$stable)?!0:n===i?!1:n?i?Li(n,i,c):!0:!!i;return!1}function Li(t,e,s){const n=Object.keys(e);if(n.length!==Object.keys(t).length)return!0;for(let o=0;o<n.length;o++){const a=n[o];if(e[a]!==t[a]&&!Oo(s,a))return!0}return!1}function Jd({vnode:t,parent:e},s){for(;e;){const n=e.subTree;if(n.suspense&&n.suspense.activeBranch===t&&(n.el=t.el),n===t)(t=e.vnode).el=s,e=e.parent;else break}}const Ll=t=>t.__isSuspense;function Zd(t,e){e&&e.pendingBranch?Te(t)?e.effects.push(...t):e.effects.push(t):Qr(t)}const Je=Symbol.for("v-fgt"),Do=Symbol.for("v-txt"),It=Symbol.for("v-cmt"),Rn=Symbol.for("v-stc"),$n=[];let zt=null;function D(t=!1){$n.push(zt=t?null:[])}function Qd(){$n.pop(),zt=$n[$n.length-1]||null}let Gn=1;function vo(t,e=!1){Gn+=t,t<0&&zt&&e&&(zt.hasOnce=!0)}function Il(t){return t.dynamicChildren=Gn>0?zt||on:null,Qd(),Gn>0&&zt&&zt.push(t),t}function U(t,e,s,n,o,a){return Il(p(t,e,s,n,o,a,!0))}function Pt(t,e,s,n,o){return Il(ot(t,e,s,n,o,!0))}function yo(t){return t?t.__v_isVNode===!0:!1}function Ws(t,e){return t.type===e.type&&t.key===e.key}const Ol=({key:t})=>t??null,ao=({ref:t,ref_key:e,ref_for:s})=>(typeof t=="number"&&(t=""+t),t!=null?rt(t)||xt(t)||Ae(t)?{i:Kt,r:t,k:e,f:!!s}:t:null);function p(t,e=null,s=null,n=0,o=null,a=t===Je?0:1,i=!1,r=!1){const l={__v_isVNode:!0,__v_skip:!0,type:t,props:e,key:e&&Ol(e),ref:e&&ao(e),scopeId:sl,slotScopeIds:null,children:s,component:null,suspense:null,ssContent:null,ssFallback:null,dirs:null,transition:null,el:null,anchor:null,target:null,targetStart:null,targetAnchor:null,staticCount:0,shapeFlag:a,patchFlag:n,dynamicProps:o,dynamicChildren:null,appContext:null,ctx:Kt};return r?(Qa(l,s),a&128&&t.normalize(l)):s&&(l.shapeFlag|=rt(s)?8:16),Gn>0&&!i&&zt&&(l.patchFlag>0||a&6)&&l.patchFlag!==32&&zt.push(l),l}const ot=ef;function ef(t,e=null,s=null,n=0,o=null,a=!1){if((!t||t===Sd)&&(t=It),yo(t)){const r=Os(t,e,!0);return s&&Qa(r,s),Gn>0&&!a&&zt&&(r.shapeFlag&6?zt[zt.indexOf(t)]=r:zt.push(r)),r.patchFlag=-2,r}if(df(t)&&(t=t.__vccOpts),e){e=tf(e);let{class:r,style:l}=e;r&&!rt(r)&&(e.class=qe(r)),Qe(l)&&(Ka(l)&&!Te(l)&&(l=bt({},l)),e.style=Ut(l))}const i=rt(t)?1:Ll(t)?128:il(t)?64:Qe(t)?4:Ae(t)?2:0;return p(t,e,s,n,o,i,a,!0)}function tf(t){return t?Ka(t)||Ml(t)?bt({},t):t:null}function Os(t,e,s=!1,n=!1){const{props:o,ref:a,patchFlag:i,children:r,transition:l}=t,c=e?sf(o||{},e):o,u={__v_isVNode:!0,__v_skip:!0,type:t.type,props:c,key:c&&Ol(c),ref:e&&e.ref?s&&a?Te(a)?a.concat(ao(e)):[a,ao(e)]:ao(e):a,scopeId:t.scopeId,slotScopeIds:t.slotScopeIds,children:r,target:t.target,targetStart:t.targetStart,targetAnchor:t.targetAnchor,staticCount:t.staticCount,shapeFlag:t.shapeFlag,patchFlag:e&&t.type!==Je?i===-1?16:i|16:i,dynamicProps:t.dynamicProps,dynamicChildren:t.dynamicChildren,appContext:t.appContext,dirs:t.dirs,transition:l,component:t.component,suspense:t.suspense,ssContent:t.ssContent&&Os(t.ssContent),ssFallback:t.ssFallback&&Os(t.ssFallback),placeholder:t.placeholder,el:t.el,anchor:t.anchor,ctx:t.ctx,ce:t.ce};return l&&n&&Nn(u,l.clone(u)),u}function Ds(t=" ",e=0){return ot(Do,null,t,e)}function bo(t,e){const s=ot(Rn,null,t);return s.staticCount=e,s}function Se(t="",e=!1){return e?(D(),Pt(It,null,t)):ot(It,null,t)}function ds(t){return t==null||typeof t=="boolean"?ot(It):Te(t)?ot(Je,null,t.slice()):yo(t)?$s(t):ot(Do,null,String(t))}function $s(t){return t.el===null&&t.patchFlag!==-1||t.memo?t:Os(t)}function Qa(t,e){let s=0;const{shapeFlag:n}=t;if(e==null)e=null;else if(Te(e))s=16;else if(typeof e=="object")if(n&65){const o=e.default;o&&(o._c&&(o._d=!1),Qa(t,o()),o._c&&(o._d=!0));return}else{s=32;const o=e._;!o&&!Ml(e)?e._ctx=Kt:o===3&&Kt&&(Kt.slots._===1?e._=1:(e._=2,t.patchFlag|=1024))}else Ae(e)?(e={default:e,_ctx:Kt},s=32):(e=String(e),n&64?(s=16,e=[Ds(e)]):s=8);t.children=e,t.shapeFlag|=s}function sf(...t){const e={};for(let s=0;s<t.length;s++){const n=t[s];for(const o in n)if(o==="class")e.class!==n.class&&(e.class=qe([e.class,n.class]));else if(o==="style")e.style=Ut([e.style,n.style]);else if(Eo(o)){const a=e[o],i=n[o];i&&a!==i&&!(Te(a)&&a.includes(i))&&(e[o]=a?[].concat(a,i):i)}else o!==""&&(e[o]=n[o])}return e}function is(t,e,s,n=null){as(t,e,7,[s,n])}const nf=bl();let of=0;function af(t,e,s){const n=t.type,o=(e?e.appContext:t.appContext)||nf,a={uid:of++,vnode:t,type:n,parent:e,appContext:o,root:null,next:null,subTree:null,effect:null,update:null,job:null,scope:new Pu(!0),render:null,proxy:null,exposed:null,exposeProxy:null,withProxy:null,provides:e?e.provides:Object.create(o.provides),ids:e?e.ids:["",0,0],accessCache:null,renderCache:[],components:null,directives:null,propsOptions:xl(n,o),emitsOptions:Pl(n,o),emit:null,emitted:null,propsDefaults:Ye,inheritAttrs:n.inheritAttrs,ctx:Ye,data:Ye,props:Ye,attrs:Ye,slots:Ye,refs:Ye,setupState:Ye,setupContext:null,suspense:s,suspenseId:s?s.pendingId:0,asyncDep:null,asyncResolved:!1,isMounted:!1,isUnmounted:!1,isDeactivated:!1,bc:null,c:null,bm:null,m:null,bu:null,u:null,um:null,bum:null,da:null,a:null,rtg:null,rtc:null,ec:null,sp:null};return a.ctx={_:a},a.root=e?e.root:a,a.emit=Wd.bind(null,a),t.ce&&t.ce(a),a}let Ot=null;const ei=()=>Ot||Kt;let wo,Ra;{const t=Ro(),e=(s,n)=>{let o;return(o=t[s])||(o=t[s]=[]),o.push(n),a=>{o.length>1?o.forEach(i=>i(a)):o[0](a)}};wo=e("__VUE_INSTANCE_SETTERS__",s=>Ot=s),Ra=e("__VUE_SSR_SETTERS__",s=>Hn=s)}const jn=t=>{const e=Ot;return wo(t),t.scope.on(),()=>{t.scope.off(),wo(e)}},Ii=()=>{Ot&&Ot.scope.off(),wo(null)};function Dl(t){return t.vnode.shapeFlag&4}let Hn=!1;function rf(t,e=!1,s=!1){e&&Ra(e);const{props:n,children:o}=t.vnode,a=Dl(t);Pd(t,n,a,e),Dd(t,o,s||e);const i=a?lf(t,e):void 0;return e&&Ra(!1),i}function lf(t,e){const s=t.type;t.accessCache=Object.create(null),t.proxy=new Proxy(t.ctx,Md);const{setup:n}=s;if(n){Ts();const o=t.setupContext=n.length>1?uf(t):null,a=jn(t),i=Bn(n,t,0,[t.props,o]),r=kr(i);if(xs(),a(),(r||t.sp)&&!kn(t)&&ml(t),r){if(i.then(Ii,Ii),e)return i.then(l=>{Oi(t,l)}).catch(l=>{Po(l,t,0)});t.asyncDep=i}else Oi(t,i)}else Nl(t)}function Oi(t,e,s){Ae(e)?t.type.__ssrInlineRender?t.ssrRender=e:t.render=e:Qe(e)&&(t.setupState=Yr(e)),Nl(t)}function Nl(t,e,s){const n=t.type;t.render||(t.render=n.render||ss);{const o=jn(t);Ts();try{Td(t)}finally{xs(),o()}}}const cf={get(t,e){return Mt(t,"get",""),t[e]}};function uf(t){const e=s=>{t.exposed=s||{}};return{attrs:new Proxy(t.attrs,cf),slots:t.slots,emit:t.emit,expose:e}}function No(t){return t.exposed?t.exposeProxy||(t.exposeProxy=new Proxy(Yr(Qu(t.exposed)),{get(e,s){if(s in e)return e[s];if(s in An)return An[s](t)},has(e,s){return s in e||s in An}})):t.proxy}function df(t){return Ae(t)&&"__vccOpts"in t}const $e=(t,e)=>od(t,e,Hn);function ff(t,e,s){try{vo(-1);const n=arguments.length;return n===2?Qe(e)&&!Te(e)?yo(e)?ot(t,null,[e]):ot(t,e):ot(t,null,e):(n>3?s=Array.prototype.slice.call(arguments,2):n===3&&yo(s)&&(s=[s]),ot(t,e,s))}finally{vo(1)}}const pf="3.5.22";/**
* @vue/runtime-dom v3.5.22
* (c) 2018-present Yuxi (Evan) You and Vue contributors
* @license MIT
**/let $a;const Di=typeof window<"u"&&window.trustedTypes;if(Di)try{$a=Di.createPolicy("vue",{createHTML:t=>t})}catch{}const Gl=$a?t=>$a.createHTML(t):t=>t,hf="http://www.w3.org/2000/svg",mf="http://www.w3.org/1998/Math/MathML",ys=typeof document<"u"?document:null,Ni=ys&&ys.createElement("template"),gf={insert:(t,e,s)=>{e.insertBefore(t,s||null)},remove:t=>{const e=t.parentNode;e&&e.removeChild(t)},createElement:(t,e,s,n)=>{const o=e==="svg"?ys.createElementNS(hf,t):e==="mathml"?ys.createElementNS(mf,t):s?ys.createElement(t,{is:s}):ys.createElement(t);return t==="select"&&n&&n.multiple!=null&&o.setAttribute("multiple",n.multiple),o},createText:t=>ys.createTextNode(t),createComment:t=>ys.createComment(t),setText:(t,e)=>{t.nodeValue=e},setElementText:(t,e)=>{t.textContent=e},parentNode:t=>t.parentNode,nextSibling:t=>t.nextSibling,querySelector:t=>ys.querySelector(t),setScopeId(t,e){t.setAttribute(e,"")},insertStaticContent(t,e,s,n,o,a){const i=s?s.previousSibling:e.lastChild;if(o&&(o===a||o.nextSibling))for(;e.insertBefore(o.cloneNode(!0),s),!(o===a||!(o=o.nextSibling)););else{Ni.innerHTML=Gl(n==="svg"?`<svg>${t}</svg>`:n==="mathml"?`<math>${t}</math>`:t);const r=Ni.content;if(n==="svg"||n==="mathml"){const l=r.firstChild;for(;l.firstChild;)r.appendChild(l.firstChild);r.removeChild(l)}e.insertBefore(r,s)}return[i?i.nextSibling:e.firstChild,s?s.previousSibling:e.lastChild]}},ks="transition",_n="animation",Un=Symbol("_vtc"),Hl={name:String,type:String,css:{type:Boolean,default:!0},duration:[String,Number,Object],enterFromClass:String,enterActiveClass:String,enterToClass:String,appearFromClass:String,appearActiveClass:String,appearToClass:String,leaveFromClass:String,leaveActiveClass:String,leaveToClass:String},_f=bt({},ul,Hl),vf=t=>(t.displayName="Transition",t.props=_f,t),yf=vf((t,{slots:e})=>ff(fd,bf(t),e)),Bs=(t,e=[])=>{Te(t)?t.forEach(s=>s(...e)):t&&t(...e)},Gi=t=>t?Te(t)?t.some(e=>e.length>1):t.length>1:!1;function bf(t){const e={};for(const E in t)E in Hl||(e[E]=t[E]);if(t.css===!1)return e;const{name:s="v",type:n,duration:o,enterFromClass:a=`${s}-enter-from`,enterActiveClass:i=`${s}-enter-active`,enterToClass:r=`${s}-enter-to`,appearFromClass:l=a,appearActiveClass:c=i,appearToClass:u=r,leaveFromClass:d=`${s}-leave-from`,leaveActiveClass:h=`${s}-leave-active`,leaveToClass:m=`${s}-leave-to`}=t,g=wf(o),x=g&&g[0],S=g&&g[1],{onBeforeEnter:_,onEnter:M,onEnterCancelled:b,onLeave:w,onLeaveCancelled:I,onBeforeAppear:F=_,onAppear:z=M,onAppearCancelled:B=b}=e,N=(E,q,Me,fe)=>{E._enterCancelled=fe,js(E,q?u:r),js(E,q?c:i),Me&&Me()},ie=(E,q)=>{E._isLeaving=!1,js(E,d),js(E,m),js(E,h),q&&q()},le=E=>(q,Me)=>{const fe=E?z:M,he=()=>N(q,E,Me);Bs(fe,[q,he]),Hi(()=>{js(q,E?l:a),vs(q,E?u:r),Gi(fe)||Ui(q,n,x,he)})};return bt(e,{onBeforeEnter(E){Bs(_,[E]),vs(E,a),vs(E,i)},onBeforeAppear(E){Bs(F,[E]),vs(E,l),vs(E,c)},onEnter:le(!1),onAppear:le(!0),onLeave(E,q){E._isLeaving=!0;const Me=()=>ie(E,q);vs(E,d),E._enterCancelled?(vs(E,h),ji(E)):(ji(E),vs(E,h)),Hi(()=>{E._isLeaving&&(js(E,d),vs(E,m),Gi(w)||Ui(E,n,S,Me))}),Bs(w,[E,Me])},onEnterCancelled(E){N(E,!1,void 0,!0),Bs(b,[E])},onAppearCancelled(E){N(E,!0,void 0,!0),Bs(B,[E])},onLeaveCancelled(E){ie(E),Bs(I,[E])}})}function wf(t){if(t==null)return null;if(Qe(t))return[oa(t.enter),oa(t.leave)];{const e=oa(t);return[e,e]}}function oa(t){return Tu(t)}function vs(t,e){e.split(/\s+/).forEach(s=>s&&t.classList.add(s)),(t[Un]||(t[Un]=new Set)).add(e)}function js(t,e){e.split(/\s+/).forEach(n=>n&&t.classList.remove(n));const s=t[Un];s&&(s.delete(e),s.size||(t[Un]=void 0))}function Hi(t){requestAnimationFrame(()=>{requestAnimationFrame(t)})}let Sf=0;function Ui(t,e,s,n){const o=t._endId=++Sf,a=()=>{o===t._endId&&n()};if(s!=null)return setTimeout(a,s);const{type:i,timeout:r,propCount:l}=Mf(t,e);if(!i)return n();const c=i+"end";let u=0;const d=()=>{t.removeEventListener(c,h),a()},h=m=>{m.target===t&&++u>=l&&d()};setTimeout(()=>{u<l&&d()},r+1),t.addEventListener(c,h)}function Mf(t,e){const s=window.getComputedStyle(t),n=g=>(s[g]||"").split(", "),o=n(`${ks}Delay`),a=n(`${ks}Duration`),i=Fi(o,a),r=n(`${_n}Delay`),l=n(`${_n}Duration`),c=Fi(r,l);let u=null,d=0,h=0;e===ks?i>0&&(u=ks,d=i,h=a.length):e===_n?c>0&&(u=_n,d=c,h=l.length):(d=Math.max(i,c),u=d>0?i>c?ks:_n:null,h=u?u===ks?a.length:l.length:0);const m=u===ks&&/\b(?:transform|all)(?:,|$)/.test(n(`${ks}Property`).toString());return{type:u,timeout:d,propCount:h,hasTransform:m}}function Fi(t,e){for(;t.length<e.length;)t=t.concat(t);return Math.max(...e.map((s,n)=>Bi(s)+Bi(t[n])))}function Bi(t){return t==="auto"?0:Number(t.slice(0,-1).replace(",","."))*1e3}function ji(t){return(t?t.ownerDocument:document).body.offsetHeight}function Tf(t,e,s){const n=t[Un];n&&(e=(e?[e,...n]:[...n]).join(" ")),e==null?t.removeAttribute("class"):s?t.setAttribute("class",e):t.className=e}const So=Symbol("_vod"),Ul=Symbol("_vsh"),Fl={name:"show",beforeMount(t,{value:e},{transition:s}){t[So]=t.style.display==="none"?"":t.style.display,s&&e?s.beforeEnter(t):vn(t,e)},mounted(t,{value:e},{transition:s}){s&&e&&s.enter(t)},updated(t,{value:e,oldValue:s},{transition:n}){!e!=!s&&(n?e?(n.beforeEnter(t),vn(t,!0),n.enter(t)):n.leave(t,()=>{vn(t,!1)}):vn(t,e))},beforeUnmount(t,{value:e}){vn(t,e)}};function vn(t,e){t.style.display=e?t[So]:"none",t[Ul]=!e}const Bl=Symbol("");function Jt(t){const e=ei();if(!e)return;const s=e.ut=(o=t(e.proxy))=>{Array.from(document.querySelectorAll(`[data-v-owner="${e.uid}"]`)).forEach(a=>Mo(a,o))},n=()=>{const o=t(e.proxy);e.ce?Mo(e.ce,o):Pa(e.subTree,o),s(o)};_l(()=>{Qr(n)}),Dt(()=>{Bt(n,ss,{flush:"post"});const o=new MutationObserver(n);o.observe(e.subTree.el.parentNode,{childList:!0}),Xa(()=>o.disconnect())})}function Pa(t,e){if(t.shapeFlag&128){const s=t.suspense;t=s.activeBranch,s.pendingBranch&&!s.isHydrating&&s.effects.push(()=>{Pa(s.activeBranch,e)})}for(;t.component;)t=t.component.subTree;if(t.shapeFlag&1&&t.el)Mo(t.el,e);else if(t.type===Je)t.children.forEach(s=>Pa(s,e));else if(t.type===Rn){let{el:s,anchor:n}=t;for(;s&&(Mo(s,e),s!==n);)s=s.nextSibling}}function Mo(t,e){if(t.nodeType===1){const s=t.style;let n="";for(const o in e){const a=$u(e[o]);s.setProperty(`--${o}`,a),n+=`--${o}: ${a};`}s[Bl]=n}}const xf=/(?:^|;)\s*display\s*:/;function Cf(t,e,s){const n=t.style,o=rt(s);let a=!1;if(s&&!o){if(e)if(rt(e))for(const i of e.split(";")){const r=i.slice(0,i.indexOf(":")).trim();s[r]==null&&io(n,r,"")}else for(const i in e)s[i]==null&&io(n,i,"");for(const i in s)i==="display"&&(a=!0),io(n,i,s[i])}else if(o){if(e!==s){const i=n[Bl];i&&(s+=";"+i),n.cssText=s,a=xf.test(s)}}else e&&t.removeAttribute("style");So in t&&(t[So]=a?n.display:"",t[Ul]&&(n.display="none"))}const zi=/\s*!important$/;function io(t,e,s){if(Te(s))s.forEach(n=>io(t,e,n));else if(s==null&&(s=""),e.startsWith("--"))t.setProperty(e,s);else{const n=Ef(t,e);zi.test(s)?t.setProperty(Ys(n),s.replace(zi,""),"important"):t[n]=s}}const Vi=["Webkit","Moz","ms"],aa={};function Ef(t,e){const s=aa[e];if(s)return s;let n=Ls(e);if(n!=="filter"&&n in t)return aa[e]=n;n=$r(n);for(let o=0;o<Vi.length;o++){const a=Vi[o]+n;if(a in t)return aa[e]=a}return e}const Wi="http://www.w3.org/1999/xlink";function Ki(t,e,s,n,o,a=Ru(e)){n&&e.startsWith("xlink:")?s==null?t.removeAttributeNS(Wi,e.slice(6,e.length)):t.setAttributeNS(Wi,e,s):s==null||a&&!Lr(s)?t.removeAttribute(e):t.setAttribute(e,a?"":Ns(s)?String(s):s)}function qi(t,e,s,n,o){if(e==="innerHTML"||e==="textContent"){s!=null&&(t[e]=e==="innerHTML"?Gl(s):s);return}const a=t.tagName;if(e==="value"&&a!=="PROGRESS"&&!a.includes("-")){const r=a==="OPTION"?t.getAttribute("value")||"":t.value,l=s==null?t.type==="checkbox"?"on":"":String(s);(r!==l||!("_value"in t))&&(t.value=l),s==null&&t.removeAttribute(e),t._value=s;return}let i=!1;if(s===""||s==null){const r=typeof t[e];r==="boolean"?s=Lr(s):s==null&&r==="string"?(s="",i=!0):r==="number"&&(s=0,i=!0)}try{t[e]=s}catch{}i&&t.removeAttribute(o||e)}function kf(t,e,s,n){t.addEventListener(e,s,n)}function Af(t,e,s,n){t.removeEventListener(e,s,n)}const Xi=Symbol("_vei");function Rf(t,e,s,n,o=null){const a=t[Xi]||(t[Xi]={}),i=a[e];if(n&&i)i.value=n;else{const[r,l]=$f(e);if(n){const c=a[e]=If(n,o);kf(t,r,c,l)}else i&&(Af(t,r,i,l),a[e]=void 0)}}const Yi=/(?:Once|Passive|Capture)$/;function $f(t){let e;if(Yi.test(t)){e={};let n;for(;n=t.match(Yi);)t=t.slice(0,t.length-n[0].length),e[n[0].toLowerCase()]=!0}return[t[2]===":"?t.slice(3):Ys(t.slice(2)),e]}let ia=0;const Pf=Promise.resolve(),Lf=()=>ia||(Pf.then(()=>ia=0),ia=Date.now());function If(t,e){const s=n=>{if(!n._vts)n._vts=Date.now();else if(n._vts<=s.attached)return;as(Of(n,s.value),e,5,[n])};return s.value=t,s.attached=Lf(),s}function Of(t,e){if(Te(e)){const s=t.stopImmediatePropagation;return t.stopImmediatePropagation=()=>{s.call(t),t._stopped=!0},e.map(n=>o=>!o._stopped&&n&&n(o))}else return e}const Ji=t=>t.charCodeAt(0)===111&&t.charCodeAt(1)===110&&t.charCodeAt(2)>96&&t.charCodeAt(2)<123,Df=(t,e,s,n,o,a)=>{const i=o==="svg";e==="class"?Tf(t,n,i):e==="style"?Cf(t,s,n):Eo(e)?Na(e)||Rf(t,e,s,n,a):(e[0]==="."?(e=e.slice(1),!0):e[0]==="^"?(e=e.slice(1),!1):Nf(t,e,n,i))?(qi(t,e,n),!t.tagName.includes("-")&&(e==="value"||e==="checked"||e==="selected")&&Ki(t,e,n,i,a,e!=="value")):t._isVueCE&&(/[A-Z]/.test(e)||!rt(n))?qi(t,Ls(e),n,a,e):(e==="true-value"?t._trueValue=n:e==="false-value"&&(t._falseValue=n),Ki(t,e,n,i))};function Nf(t,e,s,n){if(n)return!!(e==="innerHTML"||e==="textContent"||e in t&&Ji(e)&&Ae(s));if(e==="spellcheck"||e==="draggable"||e==="translate"||e==="autocorrect"||e==="form"||e==="list"&&t.tagName==="INPUT"||e==="type"&&t.tagName==="TEXTAREA")return!1;if(e==="width"||e==="height"){const o=t.tagName;if(o==="IMG"||o==="VIDEO"||o==="CANVAS"||o==="SOURCE")return!1}return Ji(e)&&rt(s)?!1:e in t}const Gf=["ctrl","shift","alt","meta"],Hf={stop:t=>t.stopPropagation(),prevent:t=>t.preventDefault(),self:t=>t.target!==t.currentTarget,ctrl:t=>!t.ctrlKey,shift:t=>!t.shiftKey,alt:t=>!t.altKey,meta:t=>!t.metaKey,left:t=>"button"in t&&t.button!==0,middle:t=>"button"in t&&t.button!==1,right:t=>"button"in t&&t.button!==2,exact:(t,e)=>Gf.some(s=>t[`${s}Key`]&&!e.includes(s))},Lt=(t,e)=>{const s=t._withMods||(t._withMods={}),n=e.join(".");return s[n]||(s[n]=(o,...a)=>{for(let i=0;i<e.length;i++){const r=Hf[e[i]];if(r&&r(o,e))return}return t(o,...a)})},Uf=bt({patchProp:Df},gf);let Zi;function Ff(){return Zi||(Zi=Gd(Uf))}const Qi=(...t)=>{const e=Ff().createApp(...t),{mount:s}=e;return e.mount=n=>{const o=jf(n);if(!o)return;const a=e._component;!Ae(a)&&!a.render&&!a.template&&(a.template=o.innerHTML),o.nodeType===1&&(o.textContent="");const i=s(o,!1,Bf(o));return o instanceof Element&&(o.removeAttribute("v-cloak"),o.setAttribute("data-v-app","")),i},e};function Bf(t){if(t instanceof SVGElement)return"svg";if(typeof MathMLElement=="function"&&t instanceof MathMLElement)return"mathml"}function jf(t){return rt(t)?document.querySelector(t):t}const ro={maxRetries:3,retryDelay:1e3,timeout:1e4};let ra=null;const un={enabled:!0,maxCacheSize:50*1024*1024,cachePrefix:"mgpic_",version:"1.0.0",loadInterval:50,batchSize:3};class zf{constructor(){this.cache=new Map,this.totalSize=0}isSupported(){return"caches"in window}getCacheName(){return`${un.cachePrefix}${un.version}`}async isCached(e){if(!this.isSupported())return!1;try{return await(await caches.open(this.getCacheName())).match(e)!==void 0}catch(s){return f(":",s.message),!1}}async cacheResource(e,s){if(!this.isSupported())return!1;try{const n=await caches.open(this.getCacheName());if(await n.match(e))return f(`: ${e}`),!0;await n.put(e,s.clone());const a=s.headers.get("content-length");return a&&(this.totalSize+=parseInt(a)),f(`: ${e}`),!0}catch(n){return f(":",n.message),!1}}async getCachedResource(e){if(!this.isSupported())return null;try{return await(await caches.open(this.getCacheName())).match(e)}catch(s){return f(":",s.message),null}}async cleanupCache(){if(this.isSupported())try{const e=await caches.keys(),s=this.getCacheName();for(const n of e)n.startsWith(un.cachePrefix)&&n!==s&&(await caches.delete(n),f(`: ${n}`))}catch(e){f(":",e.message)}}}const qt=new zf;let eo=null;function Vf(){return eo||(f("R2 URL"),eo="https://pub-6f9181bda40946ea92b5e87fe84e27d4.r2.dev",eo)}function G(t){let e=t;t.startsWith("/assets/")?e=t.slice(7):t.startsWith("@assets/")&&(e=t.slice(8));const s=Vf(),n=e.startsWith("/")?e.slice(1):e;return`${s}/${n}`}async function jl(t,e={}){if(qt.isSupported()){const o=await qt.getCachedResource(t);if(o)return f(` Cache Storage : ${t}`),o}const{maxRetries:s=ro.maxRetries,retryDelay:n=ro.retryDelay}=e;for(let o=1;o<=s;o++)try{f(` (${o}/${s}): ${t}`);const a=new AbortController,i=setTimeout(()=>a.abort(),ro.timeout),r=await fetch(t,{method:"GET",mode:"cors",credentials:"omit",cache:"no-cache",signal:a.signal,...e});if(clearTimeout(i),r.ok)return qt.isSupported()&&await qt.cacheResource(t,r),f(`: ${t}`),r;throw new Error(`HTTP ${r.status}: ${r.statusText}`)}catch(a){if(f(` (${o}/${s}): ${t}`,a.message),o===s)throw f(`: ${t}`,a.message),a;const i=n*o;f(` ${i}ms ...`),await new Promise(r=>setTimeout(r,i))}}async function Wf(t=["high","medium"]){try{if(ra){f("");const a=er(ra,t);return f(` ${a.length}  (: ${t.join(", ")})`),a}const e=G("asset-list.json");f(` R2 CDN : ${e}`);const s=await jl(e);if(!s.ok)throw new Error(`: HTTP ${s.status}`);const n=await s.json();ra=n,f("");const o=er(n,t);return f(` ${o.length}  (: ${t.join(", ")})`),o}catch(e){return f(":",e.message),["logo.glb","frontend_resource/start_game.png","frontend_resource/copper_warehouse.png","frontend_resource/game_wiki.png","frontend_resource/Tutorial.png","frontend_resource/gacha.png"]}}function er(t,e){const s=[];for(const n of e)if(t.categories&&t.categories[n]){const o=t.categories[n].resources||[];s.push(...o.map(a=>a.path))}return s}async function La(t=null,e=["high","medium"]){f("..."),await qt.cleanupCache();const s=await Wf(e),n=un.batchSize,o=un.loadInterval,a=s.length;let i=0;t&&t(0,a,0);for(let r=0;r<s.length;r+=n){const l=s.slice(r,r+n);f(` ${Math.floor(r/n)+1}/${Math.ceil(s.length/n)}: ${l.length} `);const c=l.map(async(S,_)=>{const M=G(S);try{if(await qt.isCached(M))return f(`Cache Storage: ${S}`),{success:!0,path:S,cached:!0,source:"cache"};const w=new AbortController,I=setTimeout(()=>w.abort(),ro.timeout),F=await fetch(M,{method:"GET",mode:"cors",credentials:"omit",cache:"no-cache",signal:w.signal});if(clearTimeout(I),F.ok){const z=F.headers.get("x-cache")||F.headers.get("cf-cache-status")||F.type==="basic"&&!F.redirected;return qt.isSupported()&&await qt.cacheResource(M,F),f(`: ${S}${z?" ()":""}`),{success:!0,path:S,cached:!1,fromBrowserCache:!!z}}else throw new Error(`HTTP ${F.status}: ${F.statusText}`)}catch(b){return f(`: ${S}`,b.message),{success:!1,path:S,error:b.message}}}),u=await Promise.all(c);i+=l.length;const d=Math.round(i/a*100);t&&t(i,a,d);const h=u.filter(S=>S.success).length,m=u.filter(S=>S.cached).length,g=u.filter(S=>S.fromBrowserCache).length,x=u.filter(S=>!S.success).length;f(`:  ${h}, Cache Storage ${m},  ${g},  ${x}`),r+n<s.length&&(f(` ${o}ms ...`),await new Promise(S=>setTimeout(S,o)))}f(""),t&&t(a,a,100)}async function Kf(){if(!qt.isSupported())return{supported:!1,message:"API"};try{const e=await(await caches.open(qt.getCacheName())).keys();return{supported:!0,cacheName:qt.getCacheName(),resourceCount:e.length,totalSize:qt.totalSize,maxSize:un.maxCacheSize}}catch(t){return{supported:!0,error:t.message}}}function Go(t,e){return G(`copper/${t.toLowerCase()}/${e}/${e}.glb`)}function Ho(t){return G(`enemy/${t}/${t}.glb`)}function zl(t){return G(`structure/${t}/${t}.glb`)}function qf(t){return G(t)}const ft=(t,e)=>{const s=t.__vccOpts||t;for(const[n,o]of e)s[n]=o;return s},Xf={class:"hall-container"},Yf=["src"],Jf={__name:"Hall",props:{musicOn:{type:Boolean,default:!0},paused:{type:Boolean,default:!1}},emits:["startGame","openWarehouse","openTutorial","openEncyclopedia","toggle-music"],setup(t,{emit:e}){const s=e,n=t;function o(){s("startGame")}function a(){s("openWarehouse")}function i(){s("openTutorial")}function r(){s("openEncyclopedia")}const l=H(G("@assets/frontend_resource/start_game.png")),c=H(G("@assets/frontend_resource/copper_warehouse.png")),u=H(G("@assets/frontend_resource/game_wiki.png")),d=H(G("@assets/frontend_resource/Tutorial.png")),h=H(G("ui/Gemini_Generated_Image_gtrehogtrehogtre (1).png")),m=H(!1),g=H(null),x=G("@assets/frontend_resource/hall.mp3");return Dt(()=>{setTimeout(()=>{m.value=!0,f("HallUI")},100),n.musicOn&&!n.paused&&g.value&&setTimeout(()=>{if(g.value.readyState>=2)g.value.play().then(()=>{f("[Hall] ")}).catch(_=>{f("[Hall] :",_)});else{const _=()=>{g.value.play().then(()=>{f("[Hall] ")}).catch(M=>{f("[Hall] :",M)}),g.value.removeEventListener("canplay",_)};g.value.addEventListener("canplay",_,{once:!0})}},200)}),Bt(()=>n.musicOn,S=>{if(g.value)if(S&&!n.paused)if(g.value.readyState>=2)g.value.play().catch(_=>{f("[Hall] :",_)});else{const _=()=>{g.value.play().catch(M=>{f("[Hall] :",M)}),g.value.removeEventListener("canplay",_)};g.value.addEventListener("canplay",_)}else g.value.pause()}),Bt(()=>n.paused,S=>{if(g.value){if(S)g.value.pause(),f("[Hall] ");else if(n.musicOn){if(g.value.readyState>=2)g.value.play().catch(_=>{f("[Hall] :",_)});else{const _=()=>{g.value.play().catch(M=>{f("[Hall] :",M)}),g.value.removeEventListener("canplay",_)};g.value.addEventListener("canplay",_)}f("[Hall] ")}}}),ms(()=>{g.value&&g.value.pause()}),(S,_)=>(D(),U("div",Xf,[p("div",{class:"hall-bg",style:Ut({backgroundImage:`url('${h.value}')`})},null,4),p("div",{class:qe(["menu",{"menu--loaded":m.value}])},[p("button",{class:"tile tile--start",style:Ut({backgroundImage:`url('${l.value}')`}),onClick:o},[..._[0]||(_[0]=[p("div",{class:"tile__mask"},null,-1),p("div",{class:"tile__caption tile__caption--bottom"},[p("div",{class:"tile__title"},""),p("div",{class:"tile__subtitle"},"Begin Adventure")],-1)])],4),p("button",{class:"tile tile--warehouse",style:Ut({backgroundImage:`url('${c.value}')`}),onClick:a},[..._[1]||(_[1]=[p("div",{class:"tile__mask"},null,-1),p("div",{class:"tile__caption tile__caption--top"},[p("div",{class:"tile__title"},""),p("div",{class:"tile__subtitle"},"Character Collection")],-1)])],4),p("button",{class:"tile tile--wiki",style:Ut({backgroundImage:`url('${u.value}')`}),onClick:r},[..._[2]||(_[2]=[p("div",{class:"tile__mask"},null,-1),p("div",{class:"tile__caption tile__caption--bottom"},[p("div",{class:"tile__title"},""),p("div",{class:"tile__subtitle"},"Encyclopedia")],-1)])],4),p("button",{class:"tile tile--tutorial",style:Ut({backgroundImage:`url('${d.value}')`}),onClick:i},[..._[3]||(_[3]=[p("div",{class:"tile__mask"},null,-1),p("div",{class:"tile__caption tile__caption--top"},[p("div",{class:"tile__title"},""),p("div",{class:"tile__subtitle"},"Tutorial")],-1)])],4)],2),p("audio",{ref_key:"audioRef",ref:g,src:de(x),loop:"",preload:"auto"},null,8,Yf)]))}},Zf=ft(Jf,[["__scopeId","data-v-45a9369d"]]),ts={HeartCrystalDust:{name:"",icon:G("resource/heart_crystal_dust.png")},RecallGear:{name:"",icon:G("resource/recall_gear.png")},ResonantCrystal:{name:"",icon:G("resource/resonant_star_crystal/resonant_star_crystal.png")},RefinedCopper:{name:"",icon:G("resource/refined_copper_ingot/refined_copper_ingot.png")},SpiritalSpark:{name:"",icon:G("resource/spiritual_spark.png")}};function ti(t){var e;if(Array.isArray(t==null?void 0:t.item_type)&&t.item_type[0]==="Resource"){const s=t.item_type[1];return((e=ts[s])==null?void 0:e.name)||s}else if(Array.isArray(t==null?void 0:t.item_type)&&t.item_type[0]==="Equipment")return"";return""}function St(t){var e;return((e=ts[t])==null?void 0:e.name)||t}function rs(t){var e;return((e=ts[t])==null?void 0:e.icon)||""}const Qf="modulepreload",ep=function(t,e){return new URL(t,e).href},tr={},Vl=function(e,s,n){let o=Promise.resolve();if(s&&s.length>0){const i=document.getElementsByTagName("link"),r=document.querySelector("meta[property=csp-nonce]"),l=(r==null?void 0:r.nonce)||(r==null?void 0:r.getAttribute("nonce"));o=Promise.allSettled(s.map(c=>{if(c=ep(c,n),c in tr)return;tr[c]=!0;const u=c.endsWith(".css"),d=u?'[rel="stylesheet"]':"";if(!!n)for(let g=i.length-1;g>=0;g--){const x=i[g];if(x.href===c&&(!u||x.rel==="stylesheet"))return}else if(document.querySelector(`link[href="${c}"]${d}`))return;const m=document.createElement("link");if(m.rel=u?"stylesheet":Qf,u||(m.as="script"),m.crossOrigin="",m.href=c,l&&m.setAttribute("nonce",l),document.head.appendChild(m),u)return new Promise((g,x)=>{m.addEventListener("load",g),m.addEventListener("error",()=>x(new Error(`Unable to preload CSS for ${c}`)))})}))}function a(i){const r=new Event("vite:preloadError",{cancelable:!0});if(r.payload=i,window.dispatchEvent(r),!r.defaultPrevented)throw i}return o.then(i=>{for(const r of i||[])r.status==="rejected"&&a(r.reason);return e().catch(a)})};function tp(t){return{all:t=t||new Map,on:function(e,s){var n=t.get(e);n?n.push(s):t.set(e,[s])},off:function(e,s){var n=t.get(e);n&&(s?n.splice(n.indexOf(s)>>>0,1):t.set(e,[]))},emit:function(e,s){var n=t.get(e);n&&n.slice().map(function(o){o(s)}),(n=t.get("*"))&&n.slice().map(function(o){o(e,s)})}}}const si=tp(),Ht={UPDATE_RESOURCES:"update:resources",RESOURCES_UPDATED:"resources:updated",COPPER_ID_ADDED:"copper:id:added",START_MENU_PAUSE:"menu:pause",START_MENU_RESUME:"menu:resume",START_MENU_STARTED:"menu:started",CONTROL_MODE_CHANGED:"control:mode:changed",GAME_STARTED:"game:started",GAME_ENDED:"game:ended"},Ks=(t,e)=>{si.emit(t,e)},Uo=(t,e)=>{si.on(t,e)},ni=(t,e)=>{si.off(t,e)};class sp{constructor(){this.queue=[],this.isProcessing=!1,this.handlers=new Map,this.sceneContext=null}setSceneContext(e){this.sceneContext=e}registerHandler(e,s){this.handlers.set(e,s)}enqueue(e){["handle_on_click_copper","on_game_start"].includes(e.type_msg)&&f("[MessageQueue] :",e.type_msg),this.queue.push(e),this.isProcessing||this.processNext()}async processNext(){if(this.queue.length===0){this.isProcessing=!1;return}this.isProcessing=!0;const e=50;let s=0;for(;this.queue.length>0&&s<e;){const n=this.queue.shift();s++;try{const{type_msg:o,content:a}=n,i=this.handlers.get(o);if(i){const r=JSON.parse(a),l=i(r,this.sceneContext||{});l&&typeof l.then=="function"&&await l}else f("[MessageQueue] :",o),f("[MessageQueue] :",Array.from(this.handlers.keys()))}catch(o){f("[MessageQueue] :",o),f("[MessageQueue] :",o.message),f("[MessageQueue] :",o.stack)}}this.queue.length>0?requestAnimationFrame(()=>this.processNext()):this.isProcessing=!1}}const Ce=new sp;function to(t,e){return t.find(s=>s.id===e)}function sr(t){return new Promise(e=>setTimeout(e,t))}function Wl(){f("[MessageQueue] ..."),Ce.registerHandler("handle_on_click_copper",async(a,i)=>{var u,d;const{copper:r,resources:l,has_attack_targets:c}=a;f(`[Handler] : ${((u=r.copper.copper_info)==null?void 0:u.name)||"Unknown"} (ID=${r.id})`),f(`[Handler] : HP=${r.now_health}/${r.copper.attribute.health}, =${r.can_move}, =${r.can_attack}, =${r.can_summon}, =${r.can_build}, =${c}`),f(`[Handler] : ${(d=r.copper)==null?void 0:d.copper_type}`),i.highlightSelectedCopper&&i.highlightSelectedCopper(r.id),i.onShowCopperInfo&&i.onShowCopperInfo(r,l,c)}),Ce.registerHandler("handle_on_click_enemy",async(a,i)=>{var m,g;const{enemy:r,resources:l,has_attack_targets:c}=a,u=r.owned||!1;f(`[Handler] ${u?"":""}: ${((m=r.enemy_base)==null?void 0:m.name)||"Unknown"} (ID=${r.id})`),f(`[Handler] : HP=${r.now_health}/${r.enemy_base.health}, =${r.can_move}, =${r.can_attack}, owned=${r.owned}, =${c}`);const h={id:r.id,now_health:r.now_health,can_move:u?r.can_move:!1,can_attack:u?r.can_attack:!1,can_summon:!1,position:r.position,isEnemy:!u,isOwnedEnemy:u,copper:{copper_info:{name:((g=r.enemy_base)==null?void 0:g.name)||(u?"":"")},attribute:{health:r.enemy_base.health,attack:r.enemy_base.attack,defense:r.enemy_base.defense,speed:r.enemy_base.speed}}};i.highlightSelectedCopper&&i.highlightSelectedCopper(r.id),i.onShowCopperInfo&&i.onShowCopperInfo(h,l,c)}),Ce.registerHandler("handle_on_click_structure",async(a,i)=>{var d;const{structure:r,resources:l}=a,u=r.owned||!1?"":"";f(`[Handler] ${u}: ${((d=r.structure_base)==null?void 0:d.name)||"Unknown"} (ID=${r.id})`),f(`[Handler] : HP=${r.now_health}/${r.structure_base.health}, =${r.can_move}, =${r.can_attack}, owned=${r.owned}, =${r.structure_base.has_storage}`),i.highlightSelectedCopper&&i.highlightSelectedCopper(r.id),i.onShowStructureInfo&&i.onShowStructureInfo(r,l)}),Ce.registerHandler("set_copper",async(a,i)=>{const{id:r,position:l,copper:c}=a;window.__ACTUAL_COPPER_IDS__||(window.__ACTUAL_COPPER_IDS__=[]),window.__ACTUAL_COPPER_IDS__.push(c.id),Ks(Ht.COPPER_ID_ADDED,c.id),i.onSetCopper&&await i.onSetCopper(r,l,c)}),Ce.registerHandler("set_enemy",async(a,i)=>{const{id:r,position:l,enemy:c}=a;i.onSetEnemy&&i.onSetEnemy(r,l,c),c.owned&&Ks(Ht.UPDATE_RESOURCES)}),Ce.registerHandler("set_material",async(a,i)=>{const{id:r,position:l,material:c}=a;i.onSetMaterial&&await i.onSetMaterial(r,l,c)}),Ce.registerHandler("set_structure",async(a,i)=>{const{id:r,position:l,structure:c}=a;i.onSetStructure&&await i.onSetStructure(r,l,c),c.owned&&Ks(Ht.UPDATE_RESOURCES)}),Ce.registerHandler("remove_unit",async(a,i)=>{const{id:r}=a,l=to(i.models||[],r),c=l&&l.type==="enemy"&&!l.isOwned,u=c?l.position:null;if(f(`[Handler] remove_unit: ID=${r}, type=${l==null?void 0:l.type}, isOwned=${l==null?void 0:l.isOwned}, isEnemyDeath=${c}, position=${JSON.stringify(u)}`),l&&l.object){l.object.traverse(m=>{m.material&&(Array.isArray(m.material)?m.material=m.material.map(g=>g.clone()):m.material=m.material.clone())});const d=500,h=performance.now();if(await new Promise(m=>{function g(){const x=performance.now()-h,S=Math.min(x/d,1);l.object&&l.object.traverse(_=>{_.material&&(Array.isArray(_.material)?_.material.forEach(M=>{M.transparent=!0,M.opacity=1-S}):(_.material.transparent=!0,_.material.opacity=1-S))}),S<1?requestAnimationFrame(g):m()}g()}),i.scene&&i.scene.remove(l.object),l.object.traverse(m=>{m.geometry&&m.geometry.dispose(),m.material&&(Array.isArray(m.material)?m.material.forEach(g=>{g.map&&g.map.dispose(),g.lightMap&&g.lightMap.dispose(),g.bumpMap&&g.bumpMap.dispose(),g.normalMap&&g.normalMap.dispose(),g.specularMap&&g.specularMap.dispose(),g.envMap&&g.envMap.dispose(),g.alphaMap&&g.alphaMap.dispose(),g.aoMap&&g.aoMap.dispose(),g.displacementMap&&g.displacementMap.dispose(),g.emissiveMap&&g.emissiveMap.dispose(),g.metalnessMap&&g.metalnessMap.dispose(),g.roughnessMap&&g.roughnessMap.dispose(),g.dispose()}):(m.material.map&&m.material.map.dispose(),m.material.lightMap&&m.material.lightMap.dispose(),m.material.bumpMap&&m.material.bumpMap.dispose(),m.material.normalMap&&m.material.normalMap.dispose(),m.material.specularMap&&m.material.specularMap.dispose(),m.material.envMap&&m.material.envMap.dispose(),m.material.alphaMap&&m.material.alphaMap.dispose(),m.material.aoMap&&m.material.aoMap.dispose(),m.material.displacementMap&&m.material.displacementMap.dispose(),m.material.emissiveMap&&m.material.emissiveMap.dispose(),m.material.metalnessMap&&m.material.metalnessMap.dispose(),m.material.roughnessMap&&m.material.roughnessMap.dispose(),m.material.dispose()))}),i.models){const m=i.models.indexOf(l);m>-1&&i.models.splice(m,1)}i.onClearState&&i.onClearState(r),i.onRemoveHealthBar&&i.onRemoveHealthBar(r),l.type==="copper"&&i.onRemoveCopper&&i.onRemoveCopper(r)}if(c&&u){f("[Handler] ...");const d=h=>{f("[Handler] :",h),i.onShowResourceGain&&Object.keys(h).length>0&&(f("[Handler] :",u,h),i.onShowResourceGain(u,h))};Uo(Ht.RESOURCES_UPDATED,d),Ks(Ht.UPDATE_RESOURCES),setTimeout(()=>{ni(Ht.RESOURCES_UPDATED,d)},1e3)}}),Ce.registerHandler("change_direction",async(a,i)=>{const{id:r,direction:l}=a,c=to(i.models||[],r);if(c&&c.object){let u=0;switch(l){case"PositiveY":u=0;break;case"PositiveX":u=Math.PI/2;break;case"NegativeY":u=Math.PI;break;case"NegativeX":u=-Math.PI/2;break}let d=c.object.rotation.y;d=Math.atan2(Math.sin(d),Math.cos(d));let h=u-d;h>Math.PI?h-=2*Math.PI:h<-Math.PI&&(h+=2*Math.PI);const m=300,g=performance.now();await new Promise(x=>{function S(){const _=performance.now()-g,M=Math.min(_/m,1),b=1-Math.pow(1-M,2);c.object&&(c.object.rotation.y=d+h*b),M<1?requestAnimationFrame(S):(c.object&&(c.object.rotation.y=u),x())}S()})}}),Ce.registerHandler("move_to",async(a,i)=>{const{id:r,to:l}=a,c=to(i.models||[],r);if(c&&c.object&&i.gridCellSize){const[u,d]=l,h=u,m=d,g=c.object.position.y;c.position=[u,d],i.onMoveStart&&i.onMoveStart(r,c),i.animateModelMove&&await new Promise(x=>{i.animateModelMove(c,{x:h,y:g,z:m},x)}),i.onMoveComplete&&i.onMoveComplete(r)}}),Ce.registerHandler("display_can_move",(a,i)=>{const{id:r,can_move:l}=a,c=l==="true"||l===!0;i.onDisplayCanMove&&i.onDisplayCanMove(r,c)}),Ce.registerHandler("display_can_attack",(a,i)=>{const{id:r,can_attack:l}=a,c=l==="true"||l===!0;i.onDisplayCanAttack&&i.onDisplayCanAttack(r,c)}),Ce.registerHandler("display_can_summon",(a,i)=>{const{id:r,can_summon:l}=a,c=l==="true"||l===!0;f(`[Handler] display_can_summon id=${r}, can_summon=${c}`),i.onDisplayCanSummon&&i.onDisplayCanSummon(r,c)}),Ce.registerHandler("update_health",(a,i)=>{const{id:r,now_health:l,max_health:c}=a;i.onUpdateHealth&&i.onUpdateHealth(r,l,c)}),Ce.registerHandler("clear_state",(a,i)=>{const{id:r}=a;i.onClearState&&i.onClearState(r)}),Ce.registerHandler("animate_move",async(a,i)=>{const{id:r}=a,l=to(i.models||[],r);if(!l){f(`[Handler] animate_move:  ID=${r}`);return}if(window.disableAutoFocus){f(`[Handler] animate_move:  ID=${r}`);return}const c=i.followEnemies!==void 0?i.followEnemies:!1;if(l.type==="enemy"&&!c){f(`[Handler] animate_move:  ID=${r}  context.followEnemies = true `);return}if(i.camera&&i.focusOnModel){const u=i.focusOnModel(l.object,i.camera,i.controls);i.focusState&&(i.focusState.focusPosition=u.focusPosition,i.focusState.focusTarget=u.focusTarget,i.focusState.lerpFactor=u.lerpFactor,f(`[Handler] animate_move:  ID=${r} (${l.name})`)),await sr(1e3)}}),Ce.registerHandler("animate_reset",async(a,i)=>{if(f("[Handler] animate_reset"),i.camera&&i.controls){const r={x:0,y:2,z:5},l={x:0,y:0,z:0};i.focusState&&(i.focusState.focusPosition=r,i.focusState.focusTarget=l,i.focusState.lerpFactor=.08),await sr(1e3)}}),Ce.registerHandler("put_map_block",(a,i)=>{const{position:r}=a;i.onPutMapBlock&&i.onPutMapBlock(r)}),Ce.registerHandler("put_room_blocks",async(a,i)=>{const{room_position:r,size:l}=a,[c,u]=r;if(f(`[Handler]  : [${c}, ${u}], ${l}x${l}`),!i.onPutMapBlock){f("[Handler]  context.onPutMapBlock ");return}f("[Handler]  context.onPutMapBlock ...");const d=32,h=l*l;let m=0;for(let g=0;g<l;g++)for(let x=0;x<l;x++){const S=[c+g,u+x];i.onPutMapBlock(S),m++,m%d===0&&await new Promise(_=>requestAnimationFrame(_))}f(`[Handler]  : ${h}`)}),Ce.registerHandler("put_resource_marker",(a,i)=>{const{position:r}=a;i.onPutResourceMarker&&i.onPutResourceMarker(r)}),Ce.registerHandler("clear_resource_marker",(a,i)=>{const{position:r}=a;i.onClearResourceMarker&&i.onClearResourceMarker(r)});let t=0,e=0,s=0;Ce.registerHandler("set_move_block",(a,i)=>{const{position:r}=a;t++,i.onSetMoveBlock&&i.onSetMoveBlock(r)}),Ce.registerHandler("set_attack_block",(a,i)=>{const{position:r}=a;e++,i.onSetAttackBlock&&i.onSetAttackBlock(r),(e===1||e%10===0)&&f(`[Handler]  ${e} `)}),Ce.registerHandler("set_can_summon_blocks",(a,i)=>{const{position:r}=a;s++,i.onSetCanSummonBlock&&i.onSetCanSummonBlock(r),(s===1||s%10===0)&&f(`[Handler]  ${s} `)});let n=0,o=Date.now();Ce.registerHandler("clear_block",(a,i)=>{const{position:r}=a;i.onClearBlock&&i.onClearBlock(r),n++;const l=Date.now();l-o>500&&(n>1&&f(`[Handler]   ${n} `),n=0,t>0&&(f(`[Handler]  ${t} `),t=0),e>0&&(f(`[Handler]  ${e} `),e=0),s>0&&(f(`[Handler]  ${s} `),s=0)),o=l}),Ce.registerHandler("attack_complete",(a,i)=>{const{id:r}=a;i.onAttackComplete&&i.onAttackComplete(r)}),Ce.registerHandler("on_game_round_pass",(a,i)=>{}),Ce.registerHandler("craft_success",(a,i)=>{i.onCraftResult&&i.onCraftResult(!0,a.message||"")}),Ce.registerHandler("craft_failed",(a,i)=>{i.onCraftResult&&i.onCraftResult(!1,a.message||"")}),Ce.registerHandler("cannot_pick_up_item",(a,i)=>{f("[Handler] :",a.message||a)}),Ce.registerHandler("equipment_slot_full",(a,i)=>{f("[Handler] :",a.message||a)}),Ce.registerHandler("inventory_full",(a,i)=>{f("[Handler] :",a.message||a)}),Ce.registerHandler("resource_not_enough",(a,i)=>{let r="";if(a.missing&&Array.isArray(a.missing)&&a.missing.length>0){const l={HeartCrystalDust:"",RecallGear:"",SpiritalSpark:"",RefinedCopper:"",ResonantCrystal:""};r=`: ${a.missing.map(u=>{const d=l[u.type]||u.type,h=u.needed-u.current;return`${d} ( ${h})`}).join("")}`}f("[Handler] :",r),i.onResourceNotEnough&&i.onResourceNotEnough(r)}),Ce.registerHandler("summon_failed",(a,i)=>{f("[Handler] :",a.message||a),i.onSummonFailed&&i.onSummonFailed(a.message||"")}),Ce.registerHandler("summon_expired",(a,i)=>{const{id:r,message:l}=a;f(`[Handler] : ID=${r}, ${l}`)}),Ce.registerHandler("get_summon_menu",(a,i)=>{const{contents:r}=a;f("[Handler] :",r),i.onShowSummonMenu&&i.onShowSummonMenu(r)}),Ce.registerHandler("get_structure_menu",(a,i)=>{const{contents:r}=a;if(!r||r.length===0){f("[Handler]  ");return}const l=r.filter(c=>c.name!=="");f("[Handler] ",l.length,""),i.onShowStructureMenu&&i.onShowStructureMenu(l)}),Ce.registerHandler("drill_resource_generate",(a,i)=>{const{position:r,resource_type:l,amount:c}=a;f(`[Handler] : =${JSON.stringify(r)}, =${l}, =${c}`);const u={[l]:parseInt(c)};i.onShowResourceGain&&i.onShowResourceGain(r,u),Ks(Ht.UPDATE_RESOURCES)}),Ce.registerHandler("game_over",(a,i)=>{f("[Handler] "),i.onGameOver&&i.onGameOver()}),Ce.registerHandler("success",(a,i)=>{f("[Handler] "),i.onGameSuccess&&i.onGameSuccess()})}const np=Object.freeze(Object.defineProperty({__proto__:null,messageQueue:Ce,registerAllHandlers:Wl},Symbol.toStringTag,{value:"Module"}));Wl();let De=null,gs=null;gs=(async()=>{try{return De=await Vl(()=>import("./main-X2DFl0h8.js"),[],import.meta.url),f("[Glue] main.js "),De}catch(t){return f("[Glue] main.js :",t.message),null}})();async function op(){return await gs,De!=null&&De.global_gacha?JSON.parse(De.global_gacha()):{type:"error",content:""}}async function Fo(){return await gs,De!=null&&De.global_get_resource?JSON.parse(De.global_get_resource()):{}}async function ap(){return await gs,De!=null&&De.global_craft?JSON.parse(De.global_craft()):{type:"error",content:""}}async function lo(){return await gs,De!=null&&De.global_get_copper_list?JSON.parse(De.global_get_copper_list()):[]}async function ip(t){return await gs,De!=null&&De.global_upgrade_copper?JSON.parse(De.global_upgrade_copper(t)):{type:"error",content:""}}async function Kl(t){await gs,De!=null&&De.global_info_subscribe?(De.global_info_subscribe(e=>{const s=JSON.parse(e);t(s),Ce.enqueue(s)}),f("[Glue] global_info_subscribe ")):f("[Glue] global_info_subscribe ")}async function rp(t){await gs,De!=null&&De.global_import_save&&De.global_import_save(t)}async function lp(){return await gs,De!=null&&De.global_export_save?JSON.parse(De.global_export_save()):{type:"error",content:""}}async function Ee(t){await gs,De!=null&&De.eventloop?De.eventloop(t):f("[Glue] eventloop ")}const cp={class:"draw-screen"},up={class:"draw-screen__body"},dp={class:"draw-card"},fp={class:"card-face card-back"},pp=["src"],hp={class:"card-face card-front"},mp=["src"],gp={key:1,class:"card-icon"},_p=["src"],vp={class:"draw-cost"},yp=["src"],bp=["disabled","title"],wp={key:0,class:"toast"},Sp={__name:"DrawScreen",emits:["draw"],setup(t,{emit:e}){const s=e,n=H(!1),o=H(!0),a=H(!1),i=H(""),r=H(""),l=H(""),c=H({left:0,top:0,width:0,height:0}),u=H(!1),d=H(!1),h=H(!1),m=H("");function g(M){m.value=M||"",h.value=!0,setTimeout(()=>{h.value=!1},1800)}async function x(){try{const b=await Fo(),w=Number((b==null?void 0:b.SpiritalSpark)??0);o.value=w>=10}catch{o.value=!1}}function S(){a.value=!1,u.value=!1,d.value=!1}function _(){if(n.value)return;if(x(),!o.value){g("");return}n.value=!0,f("[DrawScreen] runDrawSequence start");const M=document.querySelector(".draw-card");if(M){M.classList.add("is-shaking"),setTimeout(()=>M.classList.remove("is-shaking"),500);const b=M.getBoundingClientRect();c.value={left:Math.round(b.left),top:Math.round(b.top),width:Math.round(b.width),height:Math.round(b.height)}}setTimeout(async()=>{a.value=!0,u.value=!1,d.value=!0;try{const b=await op();if(b&&b.type==="success"&&b.copper&&b.copper.copper_info){const w=b.copper.copper_info;i.value=w.name||"",r.value="",l.value=G(w.icon_url||""),f("[DrawScreen] tempImage resolved:",l.value),await On(),setTimeout(()=>{d.value=!1,setTimeout(()=>{u.value=!0},350)},450),s("draw",{name:w.name,image:w.icon_url||""}),x()}else b&&b.type==="error"&&(a.value=!1,u.value=!1,d.value=!1,g(b.content||""),s("draw",{error:!0}),x())}catch{a.value=!1,u.value=!1,d.value=!1,g(""),s("draw",{error:!0}),x()}finally{setTimeout(()=>{n.value=!1},800)}},600)}return(M,b)=>(D(),U("div",cp,[p("div",up,[p("div",dp,[a.value?(D(),U("div",{key:0,class:"draw-temp",onClick:S},[b[3]||(b[3]=p("div",{class:"dim-backdrop"},null,-1)),p("div",{class:"temp-stack",style:Ut({left:c.value.left+"px",top:c.value.top+"px",width:c.value.width+"px",height:c.value.height+"px"}),onClick:b[2]||(b[2]=Lt(()=>{},["stop"]))},[p("div",{class:qe(["card",{flipped:d.value}]),onClick:b[0]||(b[0]=Lt(w=>d.value=!d.value,["stop"]))},[p("div",fp,[p("img",{src:de(G)("frontend_resource/gacha.png"),alt:"back"},null,8,pp)]),p("div",hp,[l.value?(D(),U("img",{key:0,src:l.value,alt:"copper",class:"card-front-img"},null,8,mp)):(D(),U("div",gp,se(r.value||""),1))])],2),p("div",{class:qe(["card-name-below",{show:u.value}]),onClick:b[1]||(b[1]=Lt(()=>{},["stop"]))},se(i.value),3)],4)])):Se("",!0),p("img",{class:"draw-card__img",src:de(G)("frontend_resource/gacha.png"),alt:"card"},null,8,_p)]),p("div",vp,[p("img",{class:"draw-cost__icon",src:de(G)("resource/spiritual_spark.png"),alt:"cost"},null,8,yp),b[4]||(b[4]=p("span",{class:"draw-cost__times"},"X 10",-1))]),p("button",{class:"draw-action",disabled:n.value||!o.value,title:o.value?"":"",onClick:_},"  ",8,bp),h.value?(D(),U("div",wp,se(m.value),1)):Se("",!0)])]))}},Mp=ft(Sp,[["__scopeId","data-v-af0adebc"]]);function nr(t,e){if(e===Dc)return console.warn("THREE.BufferGeometryUtils.toTrianglesDrawMode(): Geometry already defined as triangles."),t;if(e===ha||e===gr){let s=t.getIndex();if(s===null){const i=[],r=t.getAttribute("position");if(r!==void 0){for(let l=0;l<r.count;l++)i.push(l);t.setIndex(i),s=t.getIndex()}else return console.error("THREE.BufferGeometryUtils.toTrianglesDrawMode(): Undefined position attribute. Processing not possible."),t}const n=s.count-2,o=[];if(e===ha)for(let i=1;i<=n;i++)o.push(s.getX(0)),o.push(s.getX(i)),o.push(s.getX(i+1));else for(let i=0;i<n;i++)i%2===0?(o.push(s.getX(i)),o.push(s.getX(i+1)),o.push(s.getX(i+2))):(o.push(s.getX(i+2)),o.push(s.getX(i+1)),o.push(s.getX(i)));o.length/3!==n&&console.error("THREE.BufferGeometryUtils.toTrianglesDrawMode(): Unable to generate correct amount of triangles.");const a=t.clone();return a.setIndex(o),a.clearGroups(),a}else return console.error("THREE.BufferGeometryUtils.toTrianglesDrawMode(): Unknown draw mode:",e),t}class Bo extends _r{constructor(e){super(e),this.dracoLoader=null,this.ktx2Loader=null,this.meshoptDecoder=null,this.pluginCallbacks=[],this.register(function(s){return new kp(s)}),this.register(function(s){return new Ap(s)}),this.register(function(s){return new Gp(s)}),this.register(function(s){return new Hp(s)}),this.register(function(s){return new Up(s)}),this.register(function(s){return new $p(s)}),this.register(function(s){return new Pp(s)}),this.register(function(s){return new Lp(s)}),this.register(function(s){return new Ip(s)}),this.register(function(s){return new Ep(s)}),this.register(function(s){return new Op(s)}),this.register(function(s){return new Rp(s)}),this.register(function(s){return new Np(s)}),this.register(function(s){return new Dp(s)}),this.register(function(s){return new xp(s)}),this.register(function(s){return new Fp(s)}),this.register(function(s){return new Bp(s)})}load(e,s,n,o){const a=this;let i;if(this.resourcePath!=="")i=this.resourcePath;else if(this.path!==""){const c=wn.extractUrlBase(e);i=wn.resolveURL(c,this.path)}else i=wn.extractUrlBase(e);this.manager.itemStart(e);const r=function(c){o?o(c):console.error(c),a.manager.itemError(e),a.manager.itemEnd(e)},l=new co(this.manager);l.setPath(this.path),l.setResponseType("arraybuffer"),l.setRequestHeader(this.requestHeader),l.setWithCredentials(this.withCredentials),l.load(e,function(c){try{a.parse(c,i,function(u){s(u),a.manager.itemEnd(e)},r)}catch(u){r(u)}},n,r)}setDRACOLoader(e){return this.dracoLoader=e,this}setKTX2Loader(e){return this.ktx2Loader=e,this}setMeshoptDecoder(e){return this.meshoptDecoder=e,this}register(e){return this.pluginCallbacks.indexOf(e)===-1&&this.pluginCallbacks.push(e),this}unregister(e){return this.pluginCallbacks.indexOf(e)!==-1&&this.pluginCallbacks.splice(this.pluginCallbacks.indexOf(e),1),this}parse(e,s,n,o){let a;const i={},r={},l=new TextDecoder;if(typeof e=="string")a=JSON.parse(e);else if(e instanceof ArrayBuffer)if(l.decode(new Uint8Array(e,0,4))===ql){try{i[Ne.KHR_BINARY_GLTF]=new jp(e)}catch(d){o&&o(d);return}a=JSON.parse(i[Ne.KHR_BINARY_GLTF].content)}else a=JSON.parse(l.decode(e));else a=e;if(a.asset===void 0||a.asset.version[0]<2){o&&o(new Error("THREE.GLTFLoader: Unsupported asset. glTF versions >=2.0 are supported."));return}const c=new sh(a,{path:s||this.resourcePath||"",crossOrigin:this.crossOrigin,requestHeader:this.requestHeader,manager:this.manager,ktx2Loader:this.ktx2Loader,meshoptDecoder:this.meshoptDecoder});c.fileLoader.setRequestHeader(this.requestHeader);for(let u=0;u<this.pluginCallbacks.length;u++){const d=this.pluginCallbacks[u](c);d.name||console.error("THREE.GLTFLoader: Invalid plugin found: missing name"),r[d.name]=d,i[d.name]=!0}if(a.extensionsUsed)for(let u=0;u<a.extensionsUsed.length;++u){const d=a.extensionsUsed[u],h=a.extensionsRequired||[];switch(d){case Ne.KHR_MATERIALS_UNLIT:i[d]=new Cp;break;case Ne.KHR_DRACO_MESH_COMPRESSION:i[d]=new zp(a,this.dracoLoader);break;case Ne.KHR_TEXTURE_TRANSFORM:i[d]=new Vp;break;case Ne.KHR_MESH_QUANTIZATION:i[d]=new Wp;break;default:h.indexOf(d)>=0&&r[d]===void 0&&console.warn('THREE.GLTFLoader: Unknown extension "'+d+'".')}}c.setExtensions(i),c.setPlugins(r),c.parse(n,o)}parseAsync(e,s){const n=this;return new Promise(function(o,a){n.parse(e,s,o,a)})}}function Tp(){let t={};return{get:function(e){return t[e]},add:function(e,s){t[e]=s},remove:function(e){delete t[e]},removeAll:function(){t={}}}}const Ne={KHR_BINARY_GLTF:"KHR_binary_glTF",KHR_DRACO_MESH_COMPRESSION:"KHR_draco_mesh_compression",KHR_LIGHTS_PUNCTUAL:"KHR_lights_punctual",KHR_MATERIALS_CLEARCOAT:"KHR_materials_clearcoat",KHR_MATERIALS_DISPERSION:"KHR_materials_dispersion",KHR_MATERIALS_IOR:"KHR_materials_ior",KHR_MATERIALS_SHEEN:"KHR_materials_sheen",KHR_MATERIALS_SPECULAR:"KHR_materials_specular",KHR_MATERIALS_TRANSMISSION:"KHR_materials_transmission",KHR_MATERIALS_IRIDESCENCE:"KHR_materials_iridescence",KHR_MATERIALS_ANISOTROPY:"KHR_materials_anisotropy",KHR_MATERIALS_UNLIT:"KHR_materials_unlit",KHR_MATERIALS_VOLUME:"KHR_materials_volume",KHR_TEXTURE_BASISU:"KHR_texture_basisu",KHR_TEXTURE_TRANSFORM:"KHR_texture_transform",KHR_MESH_QUANTIZATION:"KHR_mesh_quantization",KHR_MATERIALS_EMISSIVE_STRENGTH:"KHR_materials_emissive_strength",EXT_MATERIALS_BUMP:"EXT_materials_bump",EXT_TEXTURE_WEBP:"EXT_texture_webp",EXT_TEXTURE_AVIF:"EXT_texture_avif",EXT_MESHOPT_COMPRESSION:"EXT_meshopt_compression",EXT_MESH_GPU_INSTANCING:"EXT_mesh_gpu_instancing"};class xp{constructor(e){this.parser=e,this.name=Ne.KHR_LIGHTS_PUNCTUAL,this.cache={refs:{},uses:{}}}_markDefs(){const e=this.parser,s=this.parser.json.nodes||[];for(let n=0,o=s.length;n<o;n++){const a=s[n];a.extensions&&a.extensions[this.name]&&a.extensions[this.name].light!==void 0&&e._addNodeRef(this.cache,a.extensions[this.name].light)}}_loadLight(e){const s=this.parser,n="light:"+e;let o=s.cache.get(n);if(o)return o;const a=s.json,l=((a.extensions&&a.extensions[this.name]||{}).lights||[])[e];let c;const u=new os(16777215);l.color!==void 0&&u.setRGB(l.color[0],l.color[1],l.color[2],ps);const d=l.range!==void 0?l.range:0;switch(l.type){case"directional":c=new fs(u),c.target.position.set(0,0,-1),c.add(c.target);break;case"point":c=new tn(u),c.distance=d;break;case"spot":c=new Nc(u),c.distance=d,l.spot=l.spot||{},l.spot.innerConeAngle=l.spot.innerConeAngle!==void 0?l.spot.innerConeAngle:0,l.spot.outerConeAngle=l.spot.outerConeAngle!==void 0?l.spot.outerConeAngle:Math.PI/4,c.angle=l.spot.outerConeAngle,c.penumbra=1-l.spot.innerConeAngle/l.spot.outerConeAngle,c.target.position.set(0,0,-1),c.add(c.target);break;default:throw new Error("THREE.GLTFLoader: Unexpected light type: "+l.type)}return c.position.set(0,0,0),cs(c,l),l.intensity!==void 0&&(c.intensity=l.intensity),c.name=s.createUniqueName(l.name||"light_"+e),o=Promise.resolve(c),s.cache.add(n,o),o}getDependency(e,s){if(e==="light")return this._loadLight(s)}createNodeAttachment(e){const s=this,n=this.parser,a=n.json.nodes[e],r=(a.extensions&&a.extensions[this.name]||{}).light;return r===void 0?null:this._loadLight(r).then(function(l){return n._getNodeRef(s.cache,r,l)})}}class Cp{constructor(){this.name=Ne.KHR_MATERIALS_UNLIT}getMaterialType(){return _t}extendParams(e,s,n){const o=[];e.color=new os(1,1,1),e.opacity=1;const a=s.pbrMetallicRoughness;if(a){if(Array.isArray(a.baseColorFactor)){const i=a.baseColorFactor;e.color.setRGB(i[0],i[1],i[2],ps),e.opacity=i[3]}a.baseColorTexture!==void 0&&o.push(n.assignTexture(e,"map",a.baseColorTexture,Tt))}return Promise.all(o)}}class Ep{constructor(e){this.parser=e,this.name=Ne.KHR_MATERIALS_EMISSIVE_STRENGTH}extendMaterialParams(e,s){const o=this.parser.json.materials[e];if(!o.extensions||!o.extensions[this.name])return Promise.resolve();const a=o.extensions[this.name].emissiveStrength;return a!==void 0&&(s.emissiveIntensity=a),Promise.resolve()}}class kp{constructor(e){this.parser=e,this.name=Ne.KHR_MATERIALS_CLEARCOAT}getMaterialType(e){const n=this.parser.json.materials[e];return!n.extensions||!n.extensions[this.name]?null:hs}extendMaterialParams(e,s){const n=this.parser,o=n.json.materials[e];if(!o.extensions||!o.extensions[this.name])return Promise.resolve();const a=[],i=o.extensions[this.name];if(i.clearcoatFactor!==void 0&&(s.clearcoat=i.clearcoatFactor),i.clearcoatTexture!==void 0&&a.push(n.assignTexture(s,"clearcoatMap",i.clearcoatTexture)),i.clearcoatRoughnessFactor!==void 0&&(s.clearcoatRoughness=i.clearcoatRoughnessFactor),i.clearcoatRoughnessTexture!==void 0&&a.push(n.assignTexture(s,"clearcoatRoughnessMap",i.clearcoatRoughnessTexture)),i.clearcoatNormalTexture!==void 0&&(a.push(n.assignTexture(s,"clearcoatNormalMap",i.clearcoatNormalTexture)),i.clearcoatNormalTexture.scale!==void 0)){const r=i.clearcoatNormalTexture.scale;s.clearcoatNormalScale=new kt(r,r)}return Promise.all(a)}}class Ap{constructor(e){this.parser=e,this.name=Ne.KHR_MATERIALS_DISPERSION}getMaterialType(e){const n=this.parser.json.materials[e];return!n.extensions||!n.extensions[this.name]?null:hs}extendMaterialParams(e,s){const o=this.parser.json.materials[e];if(!o.extensions||!o.extensions[this.name])return Promise.resolve();const a=o.extensions[this.name];return s.dispersion=a.dispersion!==void 0?a.dispersion:0,Promise.resolve()}}class Rp{constructor(e){this.parser=e,this.name=Ne.KHR_MATERIALS_IRIDESCENCE}getMaterialType(e){const n=this.parser.json.materials[e];return!n.extensions||!n.extensions[this.name]?null:hs}extendMaterialParams(e,s){const n=this.parser,o=n.json.materials[e];if(!o.extensions||!o.extensions[this.name])return Promise.resolve();const a=[],i=o.extensions[this.name];return i.iridescenceFactor!==void 0&&(s.iridescence=i.iridescenceFactor),i.iridescenceTexture!==void 0&&a.push(n.assignTexture(s,"iridescenceMap",i.iridescenceTexture)),i.iridescenceIor!==void 0&&(s.iridescenceIOR=i.iridescenceIor),s.iridescenceThicknessRange===void 0&&(s.iridescenceThicknessRange=[100,400]),i.iridescenceThicknessMinimum!==void 0&&(s.iridescenceThicknessRange[0]=i.iridescenceThicknessMinimum),i.iridescenceThicknessMaximum!==void 0&&(s.iridescenceThicknessRange[1]=i.iridescenceThicknessMaximum),i.iridescenceThicknessTexture!==void 0&&a.push(n.assignTexture(s,"iridescenceThicknessMap",i.iridescenceThicknessTexture)),Promise.all(a)}}class $p{constructor(e){this.parser=e,this.name=Ne.KHR_MATERIALS_SHEEN}getMaterialType(e){const n=this.parser.json.materials[e];return!n.extensions||!n.extensions[this.name]?null:hs}extendMaterialParams(e,s){const n=this.parser,o=n.json.materials[e];if(!o.extensions||!o.extensions[this.name])return Promise.resolve();const a=[];s.sheenColor=new os(0,0,0),s.sheenRoughness=0,s.sheen=1;const i=o.extensions[this.name];if(i.sheenColorFactor!==void 0){const r=i.sheenColorFactor;s.sheenColor.setRGB(r[0],r[1],r[2],ps)}return i.sheenRoughnessFactor!==void 0&&(s.sheenRoughness=i.sheenRoughnessFactor),i.sheenColorTexture!==void 0&&a.push(n.assignTexture(s,"sheenColorMap",i.sheenColorTexture,Tt)),i.sheenRoughnessTexture!==void 0&&a.push(n.assignTexture(s,"sheenRoughnessMap",i.sheenRoughnessTexture)),Promise.all(a)}}class Pp{constructor(e){this.parser=e,this.name=Ne.KHR_MATERIALS_TRANSMISSION}getMaterialType(e){const n=this.parser.json.materials[e];return!n.extensions||!n.extensions[this.name]?null:hs}extendMaterialParams(e,s){const n=this.parser,o=n.json.materials[e];if(!o.extensions||!o.extensions[this.name])return Promise.resolve();const a=[],i=o.extensions[this.name];return i.transmissionFactor!==void 0&&(s.transmission=i.transmissionFactor),i.transmissionTexture!==void 0&&a.push(n.assignTexture(s,"transmissionMap",i.transmissionTexture)),Promise.all(a)}}class Lp{constructor(e){this.parser=e,this.name=Ne.KHR_MATERIALS_VOLUME}getMaterialType(e){const n=this.parser.json.materials[e];return!n.extensions||!n.extensions[this.name]?null:hs}extendMaterialParams(e,s){const n=this.parser,o=n.json.materials[e];if(!o.extensions||!o.extensions[this.name])return Promise.resolve();const a=[],i=o.extensions[this.name];s.thickness=i.thicknessFactor!==void 0?i.thicknessFactor:0,i.thicknessTexture!==void 0&&a.push(n.assignTexture(s,"thicknessMap",i.thicknessTexture)),s.attenuationDistance=i.attenuationDistance||1/0;const r=i.attenuationColor||[1,1,1];return s.attenuationColor=new os().setRGB(r[0],r[1],r[2],ps),Promise.all(a)}}class Ip{constructor(e){this.parser=e,this.name=Ne.KHR_MATERIALS_IOR}getMaterialType(e){const n=this.parser.json.materials[e];return!n.extensions||!n.extensions[this.name]?null:hs}extendMaterialParams(e,s){const o=this.parser.json.materials[e];if(!o.extensions||!o.extensions[this.name])return Promise.resolve();const a=o.extensions[this.name];return s.ior=a.ior!==void 0?a.ior:1.5,Promise.resolve()}}class Op{constructor(e){this.parser=e,this.name=Ne.KHR_MATERIALS_SPECULAR}getMaterialType(e){const n=this.parser.json.materials[e];return!n.extensions||!n.extensions[this.name]?null:hs}extendMaterialParams(e,s){const n=this.parser,o=n.json.materials[e];if(!o.extensions||!o.extensions[this.name])return Promise.resolve();const a=[],i=o.extensions[this.name];s.specularIntensity=i.specularFactor!==void 0?i.specularFactor:1,i.specularTexture!==void 0&&a.push(n.assignTexture(s,"specularIntensityMap",i.specularTexture));const r=i.specularColorFactor||[1,1,1];return s.specularColor=new os().setRGB(r[0],r[1],r[2],ps),i.specularColorTexture!==void 0&&a.push(n.assignTexture(s,"specularColorMap",i.specularColorTexture,Tt)),Promise.all(a)}}class Dp{constructor(e){this.parser=e,this.name=Ne.EXT_MATERIALS_BUMP}getMaterialType(e){const n=this.parser.json.materials[e];return!n.extensions||!n.extensions[this.name]?null:hs}extendMaterialParams(e,s){const n=this.parser,o=n.json.materials[e];if(!o.extensions||!o.extensions[this.name])return Promise.resolve();const a=[],i=o.extensions[this.name];return s.bumpScale=i.bumpFactor!==void 0?i.bumpFactor:1,i.bumpTexture!==void 0&&a.push(n.assignTexture(s,"bumpMap",i.bumpTexture)),Promise.all(a)}}class Np{constructor(e){this.parser=e,this.name=Ne.KHR_MATERIALS_ANISOTROPY}getMaterialType(e){const n=this.parser.json.materials[e];return!n.extensions||!n.extensions[this.name]?null:hs}extendMaterialParams(e,s){const n=this.parser,o=n.json.materials[e];if(!o.extensions||!o.extensions[this.name])return Promise.resolve();const a=[],i=o.extensions[this.name];return i.anisotropyStrength!==void 0&&(s.anisotropy=i.anisotropyStrength),i.anisotropyRotation!==void 0&&(s.anisotropyRotation=i.anisotropyRotation),i.anisotropyTexture!==void 0&&a.push(n.assignTexture(s,"anisotropyMap",i.anisotropyTexture)),Promise.all(a)}}class Gp{constructor(e){this.parser=e,this.name=Ne.KHR_TEXTURE_BASISU}loadTexture(e){const s=this.parser,n=s.json,o=n.textures[e];if(!o.extensions||!o.extensions[this.name])return null;const a=o.extensions[this.name],i=s.options.ktx2Loader;if(!i){if(n.extensionsRequired&&n.extensionsRequired.indexOf(this.name)>=0)throw new Error("THREE.GLTFLoader: setKTX2Loader must be called before loading KTX2 textures");return null}return s.loadTextureImage(e,a.source,i)}}class Hp{constructor(e){this.parser=e,this.name=Ne.EXT_TEXTURE_WEBP}loadTexture(e){const s=this.name,n=this.parser,o=n.json,a=o.textures[e];if(!a.extensions||!a.extensions[s])return null;const i=a.extensions[s],r=o.images[i.source];let l=n.textureLoader;if(r.uri){const c=n.options.manager.getHandler(r.uri);c!==null&&(l=c)}return n.loadTextureImage(e,i.source,l)}}class Up{constructor(e){this.parser=e,this.name=Ne.EXT_TEXTURE_AVIF}loadTexture(e){const s=this.name,n=this.parser,o=n.json,a=o.textures[e];if(!a.extensions||!a.extensions[s])return null;const i=a.extensions[s],r=o.images[i.source];let l=n.textureLoader;if(r.uri){const c=n.options.manager.getHandler(r.uri);c!==null&&(l=c)}return n.loadTextureImage(e,i.source,l)}}class Fp{constructor(e){this.name=Ne.EXT_MESHOPT_COMPRESSION,this.parser=e}loadBufferView(e){const s=this.parser.json,n=s.bufferViews[e];if(n.extensions&&n.extensions[this.name]){const o=n.extensions[this.name],a=this.parser.getDependency("buffer",o.buffer),i=this.parser.options.meshoptDecoder;if(!i||!i.supported){if(s.extensionsRequired&&s.extensionsRequired.indexOf(this.name)>=0)throw new Error("THREE.GLTFLoader: setMeshoptDecoder must be called before loading compressed files");return null}return a.then(function(r){const l=o.byteOffset||0,c=o.byteLength||0,u=o.count,d=o.byteStride,h=new Uint8Array(r,l,c);return i.decodeGltfBufferAsync?i.decodeGltfBufferAsync(u,d,h,o.mode,o.filter).then(function(m){return m.buffer}):i.ready.then(function(){const m=new ArrayBuffer(u*d);return i.decodeGltfBuffer(new Uint8Array(m),u,d,h,o.mode,o.filter),m})})}else return null}}class Bp{constructor(e){this.name=Ne.EXT_MESH_GPU_INSTANCING,this.parser=e}createNodeMesh(e){const s=this.parser.json,n=s.nodes[e];if(!n.extensions||!n.extensions[this.name]||n.mesh===void 0)return null;const o=s.meshes[n.mesh];for(const c of o.primitives)if(c.mode!==Wt.TRIANGLES&&c.mode!==Wt.TRIANGLE_STRIP&&c.mode!==Wt.TRIANGLE_FAN&&c.mode!==void 0)return null;const i=n.extensions[this.name].attributes,r=[],l={};for(const c in i)r.push(this.parser.getDependency("accessor",i[c]).then(u=>(l[c]=u,l[c])));return r.length<1?null:(r.push(this.parser.createNodeMesh(e)),Promise.all(r).then(c=>{const u=c.pop(),d=u.isGroup?u.children:[u],h=c[0].count,m=[];for(const g of d){const x=new qs,S=new ke,_=new fn,M=new ke(1,1,1),b=new vr(g.geometry,g.material,h);for(let w=0;w<h;w++)l.TRANSLATION&&S.fromBufferAttribute(l.TRANSLATION,w),l.ROTATION&&_.fromBufferAttribute(l.ROTATION,w),l.SCALE&&M.fromBufferAttribute(l.SCALE,w),b.setMatrixAt(w,x.compose(S,_,M));for(const w in l)if(w==="_COLOR_0"){const I=l[w];b.instanceColor=new Gc(I.array,I.itemSize,I.normalized)}else w!=="TRANSLATION"&&w!=="ROTATION"&&w!=="SCALE"&&g.geometry.setAttribute(w,l[w]);yr.prototype.copy.call(b,g),this.parser.assignFinalMaterial(b),m.push(b)}return u.isGroup?(u.clear(),u.add(...m),u):m[0]}))}}const ql="glTF",yn=12,or={JSON:1313821514,BIN:5130562};class jp{constructor(e){this.name=Ne.KHR_BINARY_GLTF,this.content=null,this.body=null;const s=new DataView(e,0,yn),n=new TextDecoder;if(this.header={magic:n.decode(new Uint8Array(e.slice(0,4))),version:s.getUint32(4,!0),length:s.getUint32(8,!0)},this.header.magic!==ql)throw new Error("THREE.GLTFLoader: Unsupported glTF-Binary header.");if(this.header.version<2)throw new Error("THREE.GLTFLoader: Legacy binary file detected.");const o=this.header.length-yn,a=new DataView(e,yn);let i=0;for(;i<o;){const r=a.getUint32(i,!0);i+=4;const l=a.getUint32(i,!0);if(i+=4,l===or.JSON){const c=new Uint8Array(e,yn+i,r);this.content=n.decode(c)}else if(l===or.BIN){const c=yn+i;this.body=e.slice(c,c+r)}i+=r}if(this.content===null)throw new Error("THREE.GLTFLoader: JSON content not found.")}}class zp{constructor(e,s){if(!s)throw new Error("THREE.GLTFLoader: No DRACOLoader instance provided.");this.name=Ne.KHR_DRACO_MESH_COMPRESSION,this.json=e,this.dracoLoader=s,this.dracoLoader.preload()}decodePrimitive(e,s){const n=this.json,o=this.dracoLoader,a=e.extensions[this.name].bufferView,i=e.extensions[this.name].attributes,r={},l={},c={};for(const u in i){const d=Ia[u]||u.toLowerCase();r[d]=i[u]}for(const u in e.attributes){const d=Ia[u]||u.toLowerCase();if(i[u]!==void 0){const h=n.accessors[e.attributes[u]],m=dn[h.componentType];c[d]=m.name,l[d]=h.normalized===!0}}return s.getDependency("bufferView",a).then(function(u){return new Promise(function(d,h){o.decodeDracoFile(u,function(m){for(const g in m.attributes){const x=m.attributes[g],S=l[g];S!==void 0&&(x.normalized=S)}d(m)},r,c,ps,h)})})}}class Vp{constructor(){this.name=Ne.KHR_TEXTURE_TRANSFORM}extendTexture(e,s){return(s.texCoord===void 0||s.texCoord===e.channel)&&s.offset===void 0&&s.rotation===void 0&&s.scale===void 0||(e=e.clone(),s.texCoord!==void 0&&(e.channel=s.texCoord),s.offset!==void 0&&e.offset.fromArray(s.offset),s.rotation!==void 0&&(e.rotation=s.rotation),s.scale!==void 0&&e.repeat.fromArray(s.scale),e.needsUpdate=!0),e}}class Wp{constructor(){this.name=Ne.KHR_MESH_QUANTIZATION}}class Xl extends ru{constructor(e,s,n,o){super(e,s,n,o)}copySampleValue_(e){const s=this.resultBuffer,n=this.sampleValues,o=this.valueSize,a=e*o*3+o;for(let i=0;i!==o;i++)s[i]=n[a+i];return s}interpolate_(e,s,n,o){const a=this.resultBuffer,i=this.sampleValues,r=this.valueSize,l=r*2,c=r*3,u=o-s,d=(n-s)/u,h=d*d,m=h*d,g=e*c,x=g-c,S=-2*m+3*h,_=m-h,M=1-S,b=_-h+d;for(let w=0;w!==r;w++){const I=i[x+w+r],F=i[x+w+l]*u,z=i[g+w+r],B=i[g+w]*u;a[w]=M*I+b*F+S*z+_*B}return a}}const Kp=new fn;class qp extends Xl{interpolate_(e,s,n,o){const a=super.interpolate_(e,s,n,o);return Kp.fromArray(a).normalize().toArray(a),a}}const Wt={POINTS:0,LINES:1,LINE_LOOP:2,LINE_STRIP:3,TRIANGLES:4,TRIANGLE_STRIP:5,TRIANGLE_FAN:6},dn={5120:Int8Array,5121:Uint8Array,5122:Int16Array,5123:Uint16Array,5125:Uint32Array,5126:Float32Array},ar={9728:wr,9729:ma,9984:jc,9985:Bc,9986:Fc,9987:br},ir={33071:Vc,33648:zc,10497:Ms},la={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16},Ia={POSITION:"position",NORMAL:"normal",TANGENT:"tangent",TEXCOORD_0:"uv",TEXCOORD_1:"uv1",TEXCOORD_2:"uv2",TEXCOORD_3:"uv3",COLOR_0:"color",WEIGHTS_0:"skinWeight",JOINTS_0:"skinIndex"},As={scale:"scale",translation:"position",rotation:"quaternion",weights:"morphTargetInfluences"},Xp={CUBICSPLINE:void 0,LINEAR:Tr,STEP:ou},ca={OPAQUE:"OPAQUE",MASK:"MASK",BLEND:"BLEND"};function Yp(t){return t.DefaultMaterial===void 0&&(t.DefaultMaterial=new gt({color:16777215,emissive:0,metalness:1,roughness:1,transparent:!1,depthTest:!0,side:iu})),t.DefaultMaterial}function zs(t,e,s){for(const n in s.extensions)t[n]===void 0&&(e.userData.gltfExtensions=e.userData.gltfExtensions||{},e.userData.gltfExtensions[n]=s.extensions[n])}function cs(t,e){e.extras!==void 0&&(typeof e.extras=="object"?Object.assign(t.userData,e.extras):console.warn("THREE.GLTFLoader: Ignoring primitive type .extras, "+e.extras))}function Jp(t,e,s){let n=!1,o=!1,a=!1;for(let c=0,u=e.length;c<u;c++){const d=e[c];if(d.POSITION!==void 0&&(n=!0),d.NORMAL!==void 0&&(o=!0),d.COLOR_0!==void 0&&(a=!0),n&&o&&a)break}if(!n&&!o&&!a)return Promise.resolve(t);const i=[],r=[],l=[];for(let c=0,u=e.length;c<u;c++){const d=e[c];if(n){const h=d.POSITION!==void 0?s.getDependency("accessor",d.POSITION):t.attributes.position;i.push(h)}if(o){const h=d.NORMAL!==void 0?s.getDependency("accessor",d.NORMAL):t.attributes.normal;r.push(h)}if(a){const h=d.COLOR_0!==void 0?s.getDependency("accessor",d.COLOR_0):t.attributes.color;l.push(h)}}return Promise.all([Promise.all(i),Promise.all(r),Promise.all(l)]).then(function(c){const u=c[0],d=c[1],h=c[2];return n&&(t.morphAttributes.position=u),o&&(t.morphAttributes.normal=d),a&&(t.morphAttributes.color=h),t.morphTargetsRelative=!0,t})}function Zp(t,e){if(t.updateMorphTargets(),e.weights!==void 0)for(let s=0,n=e.weights.length;s<n;s++)t.morphTargetInfluences[s]=e.weights[s];if(e.extras&&Array.isArray(e.extras.targetNames)){const s=e.extras.targetNames;if(t.morphTargetInfluences.length===s.length){t.morphTargetDictionary={};for(let n=0,o=s.length;n<o;n++)t.morphTargetDictionary[s[n]]=n}else console.warn("THREE.GLTFLoader: Invalid extras.targetNames length. Ignoring names.")}}function Qp(t){let e;const s=t.extensions&&t.extensions[Ne.KHR_DRACO_MESH_COMPRESSION];if(s?e="draco:"+s.bufferView+":"+s.indices+":"+ua(s.attributes):e=t.indices+":"+ua(t.attributes)+":"+t.mode,t.targets!==void 0)for(let n=0,o=t.targets.length;n<o;n++)e+=":"+ua(t.targets[n]);return e}function ua(t){let e="";const s=Object.keys(t).sort();for(let n=0,o=s.length;n<o;n++)e+=s[n]+":"+t[s[n]]+";";return e}function Oa(t){switch(t){case Int8Array:return 1/127;case Uint8Array:return 1/255;case Int16Array:return 1/32767;case Uint16Array:return 1/65535;default:throw new Error("THREE.GLTFLoader: Unsupported normalized accessor component type.")}}function eh(t){return t.search(/\.jpe?g($|\?)/i)>0||t.search(/^data\:image\/jpeg/)===0?"image/jpeg":t.search(/\.webp($|\?)/i)>0||t.search(/^data\:image\/webp/)===0?"image/webp":t.search(/\.ktx2($|\?)/i)>0||t.search(/^data\:image\/ktx2/)===0?"image/ktx2":"image/png"}const th=new qs;class sh{constructor(e={},s={}){this.json=e,this.extensions={},this.plugins={},this.options=s,this.cache=new Tp,this.associations=new Map,this.primitiveCache={},this.nodeCache={},this.meshCache={refs:{},uses:{}},this.cameraCache={refs:{},uses:{}},this.lightCache={refs:{},uses:{}},this.sourceCache={},this.textureCache={},this.nodeNamesUsed={};let n=!1,o=-1,a=!1,i=-1;if(typeof navigator<"u"){const r=navigator.userAgent;n=/^((?!chrome|android).)*safari/i.test(r)===!0;const l=r.match(/Version\/(\d+)/);o=n&&l?parseInt(l[1],10):-1,a=r.indexOf("Firefox")>-1,i=a?r.match(/Firefox\/([0-9]+)\./)[1]:-1}typeof createImageBitmap>"u"||n&&o<17||a&&i<98?this.textureLoader=new pn(this.options.manager):this.textureLoader=new Hc(this.options.manager),this.textureLoader.setCrossOrigin(this.options.crossOrigin),this.textureLoader.setRequestHeader(this.options.requestHeader),this.fileLoader=new co(this.options.manager),this.fileLoader.setResponseType("arraybuffer"),this.options.crossOrigin==="use-credentials"&&this.fileLoader.setWithCredentials(!0)}setExtensions(e){this.extensions=e}setPlugins(e){this.plugins=e}parse(e,s){const n=this,o=this.json,a=this.extensions;this.cache.removeAll(),this.nodeCache={},this._invokeAll(function(i){return i._markDefs&&i._markDefs()}),Promise.all(this._invokeAll(function(i){return i.beforeRoot&&i.beforeRoot()})).then(function(){return Promise.all([n.getDependencies("scene"),n.getDependencies("animation"),n.getDependencies("camera")])}).then(function(i){const r={scene:i[0][o.scene||0],scenes:i[0],animations:i[1],cameras:i[2],asset:o.asset,parser:n,userData:{}};return zs(a,r,o),cs(r,o),Promise.all(n._invokeAll(function(l){return l.afterRoot&&l.afterRoot(r)})).then(function(){for(const l of r.scenes)l.updateMatrixWorld();e(r)})}).catch(s)}_markDefs(){const e=this.json.nodes||[],s=this.json.skins||[],n=this.json.meshes||[];for(let o=0,a=s.length;o<a;o++){const i=s[o].joints;for(let r=0,l=i.length;r<l;r++)e[i[r]].isBone=!0}for(let o=0,a=e.length;o<a;o++){const i=e[o];i.mesh!==void 0&&(this._addNodeRef(this.meshCache,i.mesh),i.skin!==void 0&&(n[i.mesh].isSkinnedMesh=!0)),i.camera!==void 0&&this._addNodeRef(this.cameraCache,i.camera)}}_addNodeRef(e,s){s!==void 0&&(e.refs[s]===void 0&&(e.refs[s]=e.uses[s]=0),e.refs[s]++)}_getNodeRef(e,s,n){if(e.refs[s]<=1)return n;const o=n.clone(),a=(i,r)=>{const l=this.associations.get(i);l!=null&&this.associations.set(r,l);for(const[c,u]of i.children.entries())a(u,r.children[c])};return a(n,o),o.name+="_instance_"+e.uses[s]++,o}_invokeOne(e){const s=Object.values(this.plugins);s.push(this);for(let n=0;n<s.length;n++){const o=e(s[n]);if(o)return o}return null}_invokeAll(e){const s=Object.values(this.plugins);s.unshift(this);const n=[];for(let o=0;o<s.length;o++){const a=e(s[o]);a&&n.push(a)}return n}getDependency(e,s){const n=e+":"+s;let o=this.cache.get(n);if(!o){switch(e){case"scene":o=this.loadScene(s);break;case"node":o=this._invokeOne(function(a){return a.loadNode&&a.loadNode(s)});break;case"mesh":o=this._invokeOne(function(a){return a.loadMesh&&a.loadMesh(s)});break;case"accessor":o=this.loadAccessor(s);break;case"bufferView":o=this._invokeOne(function(a){return a.loadBufferView&&a.loadBufferView(s)});break;case"buffer":o=this.loadBuffer(s);break;case"material":o=this._invokeOne(function(a){return a.loadMaterial&&a.loadMaterial(s)});break;case"texture":o=this._invokeOne(function(a){return a.loadTexture&&a.loadTexture(s)});break;case"skin":o=this.loadSkin(s);break;case"animation":o=this._invokeOne(function(a){return a.loadAnimation&&a.loadAnimation(s)});break;case"camera":o=this.loadCamera(s);break;default:if(o=this._invokeOne(function(a){return a!=this&&a.getDependency&&a.getDependency(e,s)}),!o)throw new Error("Unknown type: "+e);break}this.cache.add(n,o)}return o}getDependencies(e){let s=this.cache.get(e);if(!s){const n=this,o=this.json[e+(e==="mesh"?"es":"s")]||[];s=Promise.all(o.map(function(a,i){return n.getDependency(e,i)})),this.cache.add(e,s)}return s}loadBuffer(e){const s=this.json.buffers[e],n=this.fileLoader;if(s.type&&s.type!=="arraybuffer")throw new Error("THREE.GLTFLoader: "+s.type+" buffer type is not supported.");if(s.uri===void 0&&e===0)return Promise.resolve(this.extensions[Ne.KHR_BINARY_GLTF].body);const o=this.options;return new Promise(function(a,i){n.load(wn.resolveURL(s.uri,o.path),a,void 0,function(){i(new Error('THREE.GLTFLoader: Failed to load buffer "'+s.uri+'".'))})})}loadBufferView(e){const s=this.json.bufferViews[e];return this.getDependency("buffer",s.buffer).then(function(n){const o=s.byteLength||0,a=s.byteOffset||0;return n.slice(a,a+o)})}loadAccessor(e){const s=this,n=this.json,o=this.json.accessors[e];if(o.bufferView===void 0&&o.sparse===void 0){const i=la[o.type],r=dn[o.componentType],l=o.normalized===!0,c=new r(o.count*i);return Promise.resolve(new Sn(c,i,l))}const a=[];return o.bufferView!==void 0?a.push(this.getDependency("bufferView",o.bufferView)):a.push(null),o.sparse!==void 0&&(a.push(this.getDependency("bufferView",o.sparse.indices.bufferView)),a.push(this.getDependency("bufferView",o.sparse.values.bufferView))),Promise.all(a).then(function(i){const r=i[0],l=la[o.type],c=dn[o.componentType],u=c.BYTES_PER_ELEMENT,d=u*l,h=o.byteOffset||0,m=o.bufferView!==void 0?n.bufferViews[o.bufferView].byteStride:void 0,g=o.normalized===!0;let x,S;if(m&&m!==d){const _=Math.floor(h/m),M="InterleavedBuffer:"+o.bufferView+":"+o.componentType+":"+_+":"+o.count;let b=s.cache.get(M);b||(x=new c(r,_*m,o.count*m/u),b=new Uc(x,m/u),s.cache.add(M,b)),S=new au(b,l,h%m/u,g)}else r===null?x=new c(o.count*l):x=new c(r,h,o.count*l),S=new Sn(x,l,g);if(o.sparse!==void 0){const _=la.SCALAR,M=dn[o.sparse.indices.componentType],b=o.sparse.indices.byteOffset||0,w=o.sparse.values.byteOffset||0,I=new M(i[1],b,o.sparse.count*_),F=new c(i[2],w,o.sparse.count*l);r!==null&&(S=new Sn(S.array.slice(),S.itemSize,S.normalized)),S.normalized=!1;for(let z=0,B=I.length;z<B;z++){const N=I[z];if(S.setX(N,F[z*l]),l>=2&&S.setY(N,F[z*l+1]),l>=3&&S.setZ(N,F[z*l+2]),l>=4&&S.setW(N,F[z*l+3]),l>=5)throw new Error("THREE.GLTFLoader: Unsupported itemSize in sparse BufferAttribute.")}S.normalized=g}return S})}loadTexture(e){const s=this.json,n=this.options,a=s.textures[e].source,i=s.images[a];let r=this.textureLoader;if(i.uri){const l=n.manager.getHandler(i.uri);l!==null&&(r=l)}return this.loadTextureImage(e,a,r)}loadTextureImage(e,s,n){const o=this,a=this.json,i=a.textures[e],r=a.images[s],l=(r.uri||r.bufferView)+":"+i.sampler;if(this.textureCache[l])return this.textureCache[l];const c=this.loadImageSource(s,n).then(function(u){u.flipY=!1,u.name=i.name||r.name||"",u.name===""&&typeof r.uri=="string"&&r.uri.startsWith("data:image/")===!1&&(u.name=r.uri);const h=(a.samplers||{})[i.sampler]||{};return u.magFilter=ar[h.magFilter]||ma,u.minFilter=ar[h.minFilter]||br,u.wrapS=ir[h.wrapS]||Ms,u.wrapT=ir[h.wrapT]||Ms,u.generateMipmaps=!u.isCompressedTexture&&u.minFilter!==wr&&u.minFilter!==ma,o.associations.set(u,{textures:e}),u}).catch(function(){return null});return this.textureCache[l]=c,c}loadImageSource(e,s){const n=this,o=this.json,a=this.options;if(this.sourceCache[e]!==void 0)return this.sourceCache[e].then(d=>d.clone());const i=o.images[e],r=self.URL||self.webkitURL;let l=i.uri||"",c=!1;if(i.bufferView!==void 0)l=n.getDependency("bufferView",i.bufferView).then(function(d){c=!0;const h=new Blob([d],{type:i.mimeType});return l=r.createObjectURL(h),l});else if(i.uri===void 0)throw new Error("THREE.GLTFLoader: Image "+e+" is missing URI and bufferView");const u=Promise.resolve(l).then(function(d){return new Promise(function(h,m){let g=h;s.isImageBitmapLoader===!0&&(g=function(x){const S=new ui(x);S.needsUpdate=!0,h(S)}),s.load(wn.resolveURL(d,a.path),g,void 0,m)})}).then(function(d){return c===!0&&r.revokeObjectURL(l),cs(d,i),d.userData.mimeType=i.mimeType||eh(i.uri),d}).catch(function(d){throw console.error("THREE.GLTFLoader: Couldn't load texture",l),d});return this.sourceCache[e]=u,u}assignTexture(e,s,n,o){const a=this;return this.getDependency("texture",n.index).then(function(i){if(!i)return null;if(n.texCoord!==void 0&&n.texCoord>0&&(i=i.clone(),i.channel=n.texCoord),a.extensions[Ne.KHR_TEXTURE_TRANSFORM]){const r=n.extensions!==void 0?n.extensions[Ne.KHR_TEXTURE_TRANSFORM]:void 0;if(r){const l=a.associations.get(i);i=a.extensions[Ne.KHR_TEXTURE_TRANSFORM].extendTexture(i,r),a.associations.set(i,l)}}return o!==void 0&&(i.colorSpace=o),e[s]=i,i})}assignFinalMaterial(e){const s=e.geometry;let n=e.material;const o=s.attributes.tangent===void 0,a=s.attributes.color!==void 0,i=s.attributes.normal===void 0;if(e.isPoints){const r="PointsMaterial:"+n.uuid;let l=this.cache.get(r);l||(l=new Wc,qo.prototype.copy.call(l,n),l.color.copy(n.color),l.map=n.map,l.sizeAttenuation=!1,this.cache.add(r,l)),n=l}else if(e.isLine){const r="LineBasicMaterial:"+n.uuid;let l=this.cache.get(r);l||(l=new Kc,qo.prototype.copy.call(l,n),l.color.copy(n.color),l.map=n.map,this.cache.add(r,l)),n=l}if(o||a||i){let r="ClonedMaterial:"+n.uuid+":";o&&(r+="derivative-tangents:"),a&&(r+="vertex-colors:"),i&&(r+="flat-shading:");let l=this.cache.get(r);l||(l=n.clone(),a&&(l.vertexColors=!0),i&&(l.flatShading=!0),o&&(l.normalScale&&(l.normalScale.y*=-1),l.clearcoatNormalScale&&(l.clearcoatNormalScale.y*=-1)),this.cache.add(r,l),this.associations.set(l,this.associations.get(n))),n=l}e.material=n}getMaterialType(){return gt}loadMaterial(e){const s=this,n=this.json,o=this.extensions,a=n.materials[e];let i;const r={},l=a.extensions||{},c=[];if(l[Ne.KHR_MATERIALS_UNLIT]){const d=o[Ne.KHR_MATERIALS_UNLIT];i=d.getMaterialType(),c.push(d.extendParams(r,a,s))}else{const d=a.pbrMetallicRoughness||{};if(r.color=new os(1,1,1),r.opacity=1,Array.isArray(d.baseColorFactor)){const h=d.baseColorFactor;r.color.setRGB(h[0],h[1],h[2],ps),r.opacity=h[3]}d.baseColorTexture!==void 0&&c.push(s.assignTexture(r,"map",d.baseColorTexture,Tt)),r.metalness=d.metallicFactor!==void 0?d.metallicFactor:1,r.roughness=d.roughnessFactor!==void 0?d.roughnessFactor:1,d.metallicRoughnessTexture!==void 0&&(c.push(s.assignTexture(r,"metalnessMap",d.metallicRoughnessTexture)),c.push(s.assignTexture(r,"roughnessMap",d.metallicRoughnessTexture))),i=this._invokeOne(function(h){return h.getMaterialType&&h.getMaterialType(e)}),c.push(Promise.all(this._invokeAll(function(h){return h.extendMaterialParams&&h.extendMaterialParams(e,r)})))}a.doubleSided===!0&&(r.side=Ft);const u=a.alphaMode||ca.OPAQUE;if(u===ca.BLEND?(r.transparent=!0,r.depthWrite=!1):(r.transparent=!1,u===ca.MASK&&(r.alphaTest=a.alphaCutoff!==void 0?a.alphaCutoff:.5)),a.normalTexture!==void 0&&i!==_t&&(c.push(s.assignTexture(r,"normalMap",a.normalTexture)),r.normalScale=new kt(1,1),a.normalTexture.scale!==void 0)){const d=a.normalTexture.scale;r.normalScale.set(d,d)}if(a.occlusionTexture!==void 0&&i!==_t&&(c.push(s.assignTexture(r,"aoMap",a.occlusionTexture)),a.occlusionTexture.strength!==void 0&&(r.aoMapIntensity=a.occlusionTexture.strength)),a.emissiveFactor!==void 0&&i!==_t){const d=a.emissiveFactor;r.emissive=new os().setRGB(d[0],d[1],d[2],ps)}return a.emissiveTexture!==void 0&&i!==_t&&c.push(s.assignTexture(r,"emissiveMap",a.emissiveTexture,Tt)),Promise.all(c).then(function(){const d=new i(r);return a.name&&(d.name=a.name),cs(d,a),s.associations.set(d,{materials:e}),a.extensions&&zs(o,d,a),d})}createUniqueName(e){const s=qc.sanitizeNodeName(e||"");return s in this.nodeNamesUsed?s+"_"+ ++this.nodeNamesUsed[s]:(this.nodeNamesUsed[s]=0,s)}loadGeometries(e){const s=this,n=this.extensions,o=this.primitiveCache;function a(r){return n[Ne.KHR_DRACO_MESH_COMPRESSION].decodePrimitive(r,s).then(function(l){return rr(l,r,s)})}const i=[];for(let r=0,l=e.length;r<l;r++){const c=e[r],u=Qp(c),d=o[u];if(d)i.push(d.promise);else{let h;c.extensions&&c.extensions[Ne.KHR_DRACO_MESH_COMPRESSION]?h=a(c):h=rr(new Sr,c,s),o[u]={primitive:c,promise:h},i.push(h)}}return Promise.all(i)}loadMesh(e){const s=this,n=this.json,o=this.extensions,a=n.meshes[e],i=a.primitives,r=[];for(let l=0,c=i.length;l<c;l++){const u=i[l].material===void 0?Yp(this.cache):this.getDependency("material",i[l].material);r.push(u)}return r.push(s.loadGeometries(i)),Promise.all(r).then(function(l){const c=l.slice(0,l.length-1),u=l[l.length-1],d=[];for(let m=0,g=u.length;m<g;m++){const x=u[m],S=i[m];let _;const M=c[m];if(S.mode===Wt.TRIANGLES||S.mode===Wt.TRIANGLE_STRIP||S.mode===Wt.TRIANGLE_FAN||S.mode===void 0)_=a.isSkinnedMesh===!0?new Xc(x,M):new st(x,M),_.isSkinnedMesh===!0&&_.normalizeSkinWeights(),S.mode===Wt.TRIANGLE_STRIP?_.geometry=nr(_.geometry,gr):S.mode===Wt.TRIANGLE_FAN&&(_.geometry=nr(_.geometry,ha));else if(S.mode===Wt.LINES)_=new Yc(x,M);else if(S.mode===Wt.LINE_STRIP)_=new Jc(x,M);else if(S.mode===Wt.LINE_LOOP)_=new Zc(x,M);else if(S.mode===Wt.POINTS)_=new Qc(x,M);else throw new Error("THREE.GLTFLoader: Primitive mode unsupported: "+S.mode);Object.keys(_.geometry.morphAttributes).length>0&&Zp(_,a),_.name=s.createUniqueName(a.name||"mesh_"+e),cs(_,a),S.extensions&&zs(o,_,S),s.assignFinalMaterial(_),d.push(_)}for(let m=0,g=d.length;m<g;m++)s.associations.set(d[m],{meshes:e,primitives:m});if(d.length===1)return a.extensions&&zs(o,d[0],a),d[0];const h=new es;a.extensions&&zs(o,h,a),s.associations.set(h,{meshes:e});for(let m=0,g=d.length;m<g;m++)h.add(d[m]);return h})}loadCamera(e){let s;const n=this.json.cameras[e],o=n[n.type];if(!o){console.warn("THREE.GLTFLoader: Missing camera parameters.");return}return n.type==="perspective"?s=new Fn(Mr.radToDeg(o.yfov),o.aspectRatio||1,o.znear||1,o.zfar||2e6):n.type==="orthographic"&&(s=new eu(-o.xmag,o.xmag,o.ymag,-o.ymag,o.znear,o.zfar)),n.name&&(s.name=this.createUniqueName(n.name)),cs(s,n),Promise.resolve(s)}loadSkin(e){const s=this.json.skins[e],n=[];for(let o=0,a=s.joints.length;o<a;o++)n.push(this._loadNodeShallow(s.joints[o]));return s.inverseBindMatrices!==void 0?n.push(this.getDependency("accessor",s.inverseBindMatrices)):n.push(null),Promise.all(n).then(function(o){const a=o.pop(),i=o,r=[],l=[];for(let c=0,u=i.length;c<u;c++){const d=i[c];if(d){r.push(d);const h=new qs;a!==null&&h.fromArray(a.array,c*16),l.push(h)}else console.warn('THREE.GLTFLoader: Joint "%s" could not be found.',s.joints[c])}return new tu(r,l)})}loadAnimation(e){const s=this.json,n=this,o=s.animations[e],a=o.name?o.name:"animation_"+e,i=[],r=[],l=[],c=[],u=[];for(let d=0,h=o.channels.length;d<h;d++){const m=o.channels[d],g=o.samplers[m.sampler],x=m.target,S=x.node,_=o.parameters!==void 0?o.parameters[g.input]:g.input,M=o.parameters!==void 0?o.parameters[g.output]:g.output;x.node!==void 0&&(i.push(this.getDependency("node",S)),r.push(this.getDependency("accessor",_)),l.push(this.getDependency("accessor",M)),c.push(g),u.push(x))}return Promise.all([Promise.all(i),Promise.all(r),Promise.all(l),Promise.all(c),Promise.all(u)]).then(function(d){const h=d[0],m=d[1],g=d[2],x=d[3],S=d[4],_=[];for(let b=0,w=h.length;b<w;b++){const I=h[b],F=m[b],z=g[b],B=x[b],N=S[b];if(I===void 0)continue;I.updateMatrix&&I.updateMatrix();const ie=n._createAnimationTracks(I,F,z,B,N);if(ie)for(let le=0;le<ie.length;le++)_.push(ie[le])}const M=new su(a,void 0,_);return cs(M,o),M})}createNodeMesh(e){const s=this.json,n=this,o=s.nodes[e];return o.mesh===void 0?null:n.getDependency("mesh",o.mesh).then(function(a){const i=n._getNodeRef(n.meshCache,o.mesh,a);return o.weights!==void 0&&i.traverse(function(r){if(r.isMesh)for(let l=0,c=o.weights.length;l<c;l++)r.morphTargetInfluences[l]=o.weights[l]}),i})}loadNode(e){const s=this.json,n=this,o=s.nodes[e],a=n._loadNodeShallow(e),i=[],r=o.children||[];for(let c=0,u=r.length;c<u;c++)i.push(n.getDependency("node",r[c]));const l=o.skin===void 0?Promise.resolve(null):n.getDependency("skin",o.skin);return Promise.all([a,Promise.all(i),l]).then(function(c){const u=c[0],d=c[1],h=c[2];h!==null&&u.traverse(function(m){m.isSkinnedMesh&&m.bind(h,th)});for(let m=0,g=d.length;m<g;m++)u.add(d[m]);return u})}_loadNodeShallow(e){const s=this.json,n=this.extensions,o=this;if(this.nodeCache[e]!==void 0)return this.nodeCache[e];const a=s.nodes[e],i=a.name?o.createUniqueName(a.name):"",r=[],l=o._invokeOne(function(c){return c.createNodeMesh&&c.createNodeMesh(e)});return l&&r.push(l),a.camera!==void 0&&r.push(o.getDependency("camera",a.camera).then(function(c){return o._getNodeRef(o.cameraCache,a.camera,c)})),o._invokeAll(function(c){return c.createNodeAttachment&&c.createNodeAttachment(e)}).forEach(function(c){r.push(c)}),this.nodeCache[e]=Promise.all(r).then(function(c){let u;if(a.isBone===!0?u=new nu:c.length>1?u=new es:c.length===1?u=c[0]:u=new yr,u!==c[0])for(let d=0,h=c.length;d<h;d++)u.add(c[d]);if(a.name&&(u.userData.name=a.name,u.name=i),cs(u,a),a.extensions&&zs(n,u,a),a.matrix!==void 0){const d=new qs;d.fromArray(a.matrix),u.applyMatrix4(d)}else a.translation!==void 0&&u.position.fromArray(a.translation),a.rotation!==void 0&&u.quaternion.fromArray(a.rotation),a.scale!==void 0&&u.scale.fromArray(a.scale);if(!o.associations.has(u))o.associations.set(u,{});else if(a.mesh!==void 0&&o.meshCache.refs[a.mesh]>1){const d=o.associations.get(u);o.associations.set(u,{...d})}return o.associations.get(u).nodes=e,u}),this.nodeCache[e]}loadScene(e){const s=this.extensions,n=this.json.scenes[e],o=this,a=new es;n.name&&(a.name=o.createUniqueName(n.name)),cs(a,n),n.extensions&&zs(s,a,n);const i=n.nodes||[],r=[];for(let l=0,c=i.length;l<c;l++)r.push(o.getDependency("node",i[l]));return Promise.all(r).then(function(l){for(let u=0,d=l.length;u<d;u++)a.add(l[u]);const c=u=>{const d=new Map;for(const[h,m]of o.associations)(h instanceof qo||h instanceof ui)&&d.set(h,m);return u.traverse(h=>{const m=o.associations.get(h);m!=null&&d.set(h,m)}),d};return o.associations=c(a),a})}_createAnimationTracks(e,s,n,o,a){const i=[],r=e.name?e.name:e.uuid,l=[];As[a.path]===As.weights?e.traverse(function(h){h.morphTargetInfluences&&l.push(h.name?h.name:h.uuid)}):l.push(r);let c;switch(As[a.path]){case As.weights:c=fi;break;case As.rotation:c=pi;break;case As.translation:case As.scale:c=di;break;default:switch(n.itemSize){case 1:c=fi;break;case 2:case 3:default:c=di;break}break}const u=o.interpolation!==void 0?Xp[o.interpolation]:Tr,d=this._getArrayFromAccessor(n);for(let h=0,m=l.length;h<m;h++){const g=new c(l[h]+"."+As[a.path],s.array,d,u);o.interpolation==="CUBICSPLINE"&&this._createCubicSplineTrackInterpolant(g),i.push(g)}return i}_getArrayFromAccessor(e){let s=e.array;if(e.normalized){const n=Oa(s.constructor),o=new Float32Array(s.length);for(let a=0,i=s.length;a<i;a++)o[a]=s[a]*n;s=o}return s}_createCubicSplineTrackInterpolant(e){e.createInterpolant=function(n){const o=this instanceof pi?qp:Xl;return new o(this.times,this.values,this.getValueSize()/3,n)},e.createInterpolant.isInterpolantFactoryMethodGLTFCubicSpline=!0}}function nh(t,e,s){const n=e.attributes,o=new Rt;if(n.POSITION!==void 0){const r=s.json.accessors[n.POSITION],l=r.min,c=r.max;if(l!==void 0&&c!==void 0){if(o.set(new ke(l[0],l[1],l[2]),new ke(c[0],c[1],c[2])),r.normalized){const u=Oa(dn[r.componentType]);o.min.multiplyScalar(u),o.max.multiplyScalar(u)}}else{console.warn("THREE.GLTFLoader: Missing min/max properties for accessor POSITION.");return}}else return;const a=e.targets;if(a!==void 0){const r=new ke,l=new ke;for(let c=0,u=a.length;c<u;c++){const d=a[c];if(d.POSITION!==void 0){const h=s.json.accessors[d.POSITION],m=h.min,g=h.max;if(m!==void 0&&g!==void 0){if(l.setX(Math.max(Math.abs(m[0]),Math.abs(g[0]))),l.setY(Math.max(Math.abs(m[1]),Math.abs(g[1]))),l.setZ(Math.max(Math.abs(m[2]),Math.abs(g[2]))),h.normalized){const x=Oa(dn[h.componentType]);l.multiplyScalar(x)}r.max(l)}else console.warn("THREE.GLTFLoader: Missing min/max properties for accessor POSITION.")}}o.expandByVector(r)}t.boundingBox=o;const i=new lu;o.getCenter(i.center),i.radius=o.min.distanceTo(o.max)/2,t.boundingSphere=i}function rr(t,e,s){const n=e.attributes,o=[];function a(i,r){return s.getDependency("accessor",i).then(function(l){t.setAttribute(r,l)})}for(const i in n){const r=Ia[i]||i.toLowerCase();r in t.attributes||o.push(a(n[i],r))}if(e.indices!==void 0&&!t.index){const i=s.getDependency("accessor",e.indices).then(function(r){t.setIndex(r)});o.push(i)}return ga.workingColorSpace!==ps&&"COLOR_0"in n&&console.warn(`THREE.GLTFLoader: Converting vertex colors from "srgb-linear" to "${ga.workingColorSpace}" not supported.`),cs(t,e),nh(t,e,s),Promise.all(o).then(function(){return e.targets!==void 0?Jp(t,e.targets,s):t})}const da=new WeakMap;class jo extends _r{constructor(e){super(e),this.decoderPath="",this.decoderConfig={},this.decoderBinary=null,this.decoderPending=null,this.workerLimit=4,this.workerPool=[],this.workerNextTaskID=1,this.workerSourceURL="",this.defaultAttributeIDs={position:"POSITION",normal:"NORMAL",color:"COLOR",uv:"TEX_COORD"},this.defaultAttributeTypes={position:"Float32Array",normal:"Float32Array",color:"Float32Array",uv:"Float32Array"}}setDecoderPath(e){return this.decoderPath=e,this}setDecoderConfig(e){return this.decoderConfig=e,this}setWorkerLimit(e){return this.workerLimit=e,this}load(e,s,n,o){const a=new co(this.manager);a.setPath(this.path),a.setResponseType("arraybuffer"),a.setRequestHeader(this.requestHeader),a.setWithCredentials(this.withCredentials),a.load(e,i=>{this.parse(i,s,o)},n,o)}parse(e,s,n=()=>{}){this.decodeDracoFile(e,s,null,null,Tt,n).catch(n)}decodeDracoFile(e,s,n,o,a=ps,i=()=>{}){const r={attributeIDs:n||this.defaultAttributeIDs,attributeTypes:o||this.defaultAttributeTypes,useUniqueIDs:!!n,vertexColorSpace:a};return this.decodeGeometry(e,r).then(s).catch(i)}decodeGeometry(e,s){const n=JSON.stringify(s);if(da.has(e)){const l=da.get(e);if(l.key===n)return l.promise;if(e.byteLength===0)throw new Error("THREE.DRACOLoader: Unable to re-decode a buffer with different settings. Buffer has already been transferred.")}let o;const a=this.workerNextTaskID++,i=e.byteLength,r=this._getWorker(a,i).then(l=>(o=l,new Promise((c,u)=>{o._callbacks[a]={resolve:c,reject:u},o.postMessage({type:"decode",id:a,taskConfig:s,buffer:e},[e])}))).then(l=>this._createGeometry(l.geometry));return r.catch(()=>!0).then(()=>{o&&a&&this._releaseTask(o,a)}),da.set(e,{key:n,promise:r}),r}_createGeometry(e){const s=new Sr;e.index&&s.setIndex(new Sn(e.index.array,1));for(let n=0;n<e.attributes.length;n++){const o=e.attributes[n],a=o.name,i=o.array,r=o.itemSize,l=new Sn(i,r);a==="color"&&(this._assignVertexColorSpace(l,o.vertexColorSpace),l.normalized=!(i instanceof Float32Array)),s.setAttribute(a,l)}return s}_assignVertexColorSpace(e,s){if(s!==Tt)return;const n=new os;for(let o=0,a=e.count;o<a;o++)n.fromBufferAttribute(e,o),ga.colorSpaceToWorking(n,Tt),e.setXYZ(o,n.r,n.g,n.b)}_loadLibrary(e,s){const n=new co(this.manager);return n.setPath(this.decoderPath),n.setResponseType(s),n.setWithCredentials(this.withCredentials),new Promise((o,a)=>{n.load(e,o,void 0,a)})}preload(){return this._initDecoder(),this}_initDecoder(){if(this.decoderPending)return this.decoderPending;const e=typeof WebAssembly!="object"||this.decoderConfig.type==="js",s=[];return e?s.push(this._loadLibrary("draco_decoder.js","text")):(s.push(this._loadLibrary("draco_wasm_wrapper.js","text")),s.push(this._loadLibrary("draco_decoder.wasm","arraybuffer"))),this.decoderPending=Promise.all(s).then(n=>{const o=n[0];e||(this.decoderConfig.wasmBinary=n[1]);const a=oh.toString(),i=["/* draco decoder */",o,"","/* worker */",a.substring(a.indexOf("{")+1,a.lastIndexOf("}"))].join(`
`);this.workerSourceURL=URL.createObjectURL(new Blob([i]))}),this.decoderPending}_getWorker(e,s){return this._initDecoder().then(()=>{if(this.workerPool.length<this.workerLimit){const o=new Worker(this.workerSourceURL);o._callbacks={},o._taskCosts={},o._taskLoad=0,o.postMessage({type:"init",decoderConfig:this.decoderConfig}),o.onmessage=function(a){const i=a.data;switch(i.type){case"decode":o._callbacks[i.id].resolve(i);break;case"error":o._callbacks[i.id].reject(i);break;default:console.error('THREE.DRACOLoader: Unexpected message, "'+i.type+'"')}},this.workerPool.push(o)}else this.workerPool.sort(function(o,a){return o._taskLoad>a._taskLoad?-1:1});const n=this.workerPool[this.workerPool.length-1];return n._taskCosts[e]=s,n._taskLoad+=s,n})}_releaseTask(e,s){e._taskLoad-=e._taskCosts[s],delete e._callbacks[s],delete e._taskCosts[s]}debug(){console.log("Task load: ",this.workerPool.map(e=>e._taskLoad))}dispose(){for(let e=0;e<this.workerPool.length;++e)this.workerPool[e].terminate();return this.workerPool.length=0,this.workerSourceURL!==""&&URL.revokeObjectURL(this.workerSourceURL),this}}function oh(){let t,e;onmessage=function(i){const r=i.data;switch(r.type){case"init":t=r.decoderConfig,e=new Promise(function(u){t.onModuleLoaded=function(d){u({draco:d})},DracoDecoderModule(t)});break;case"decode":const l=r.buffer,c=r.taskConfig;e.then(u=>{const d=u.draco,h=new d.Decoder;try{const m=s(d,h,new Int8Array(l),c),g=m.attributes.map(x=>x.array.buffer);m.index&&g.push(m.index.array.buffer),self.postMessage({type:"decode",id:r.id,geometry:m},g)}catch(m){console.error(m),self.postMessage({type:"error",id:r.id,error:m.message})}finally{d.destroy(h)}});break}};function s(i,r,l,c){const u=c.attributeIDs,d=c.attributeTypes;let h,m;const g=r.GetEncodedGeometryType(l);if(g===i.TRIANGULAR_MESH)h=new i.Mesh,m=r.DecodeArrayToMesh(l,l.byteLength,h);else if(g===i.POINT_CLOUD)h=new i.PointCloud,m=r.DecodeArrayToPointCloud(l,l.byteLength,h);else throw new Error("THREE.DRACOLoader: Unexpected geometry type.");if(!m.ok()||h.ptr===0)throw new Error("THREE.DRACOLoader: Decoding failed: "+m.error_msg());const x={index:null,attributes:[]};for(const S in u){const _=self[d[S]];let M,b;if(c.useUniqueIDs)b=u[S],M=r.GetAttributeByUniqueId(h,b);else{if(b=r.GetAttributeId(h,i[u[S]]),b===-1)continue;M=r.GetAttribute(h,b)}const w=o(i,r,h,S,_,M);S==="color"&&(w.vertexColorSpace=c.vertexColorSpace),x.attributes.push(w)}return g===i.TRIANGULAR_MESH&&(x.index=n(i,r,h)),i.destroy(h),x}function n(i,r,l){const u=l.num_faces()*3,d=u*4,h=i._malloc(d);r.GetTrianglesUInt32Array(l,d,h);const m=new Uint32Array(i.HEAPF32.buffer,h,u).slice();return i._free(h),{array:m,itemSize:1}}function o(i,r,l,c,u,d){const h=d.num_components(),g=l.num_points()*h,x=g*u.BYTES_PER_ELEMENT,S=a(i,u),_=i._malloc(x);r.GetAttributeDataArrayForAllPoints(l,d,S,x,_);const M=new u(i.HEAPF32.buffer,_,g).slice();return i._free(_),{name:c,array:M,itemSize:h}}function a(i,r){switch(r){case Float32Array:return i.DT_FLOAT32;case Int8Array:return i.DT_INT8;case Int16Array:return i.DT_INT16;case Int32Array:return i.DT_INT32;case Uint8Array:return i.DT_UINT8;case Uint16Array:return i.DT_UINT16;case Uint32Array:return i.DT_UINT32}}}class ah{constructor(){this.gltfCache=new Map,this.modelPool=new Map,this.instancedMeshes=new Map,this.gltfLoader=null,this.dracoLoader=null,this.maxCacheSize=50,this.maxInstancesPerModel=1e3,this.preloadStatus=new Map,this.preloadQueue=[],this.initLoaders()}initLoaders(){this.gltfLoader||(this.gltfLoader=new Bo,this.gltfLoader.setCrossOrigin("anonymous"),this.dracoLoader=new jo,this.dracoLoader.setDecoderPath("https://www.gstatic.com/draco/versioned/decoders/1.5.6/"),this.dracoLoader.setCrossOrigin("anonymous"),this.gltfLoader.setDRACOLoader(this.dracoLoader),f("[ModelCache] GLTFDraco"))}async loadModel(e,s=!0){if(s&&this.modelPool.has(e)){const a=this.modelPool.get(e);return f(`[ModelCache] : ${e}`),a.clone(!0)}let n;if(this.gltfCache.has(e))f(`[ModelCache] GLTF: ${e}`),n=this.gltfCache.get(e);else try{const i=await(await jl(e)).arrayBuffer();f(`[ModelCache] GLTF: ${e}`),n=await new Promise((r,l)=>{this.gltfLoader.parse(i,"",c=>r(c),c=>l(c))}),this.cacheGLTF(e,n)}catch(a){throw f(`[ModelCache] : ${e}`,a),a}const o=n.scene.clone(!0);return s&&this.addToModelPool(e,o),o}async createInstancedMesh(e,s=100){if(this.instancedMeshes.has(e))return f(`[ModelCache] : ${e}`),this.instancedMeshes.get(e);const n=await this.loadModel(e,!0),o=[];if(n.traverse(l=>{l.isMesh&&o.push(l)}),o.length===0)throw new Error(`[ModelCache] : ${e}`);const a=o[0],i=new vr(a.geometry,a.material,s),r=new qs;for(let l=0;l<s;l++)r.setPosition(0,-1e3,0),i.setMatrixAt(l,r);return i.instanceMatrix.needsUpdate=!0,this.instancedMeshes.set(e,i),f(`[ModelCache] : ${e}, : ${s}`),i}updateInstancedMeshInstance(e,s,n,o,a){const i=this.instancedMeshes.get(e);if(!i){f(`[ModelCache] : ${e}`);return}if(s>=i.count){f(`[ModelCache] : ${s}/${i.count}`);return}const r=new qs;r.compose(n,new fn().setFromEuler(o),a),i.setMatrixAt(s,r),i.instanceMatrix.needsUpdate=!0}hideInstancedMeshInstance(e,s){const n=this.instancedMeshes.get(e);if(!n)return;const o=new qs;o.setPosition(0,-1e3,0),n.setMatrixAt(s,o),n.instanceMatrix.needsUpdate=!0}cacheGLTF(e,s){if(this.gltfCache.size>=this.maxCacheSize){const n=this.gltfCache.keys().next().value;this.gltfCache.delete(n),f(`[ModelCache] GLTF: ${n}`)}this.gltfCache.set(e,s),f(`[ModelCache] GLTF: ${e}`)}addToModelPool(e,s){if(this.modelPool.size>=this.maxCacheSize){const n=this.modelPool.keys().next().value,o=this.modelPool.get(n);this.disposeModel(o),this.modelPool.delete(n),f(`[ModelCache] : ${n}`)}this.modelPool.set(e,s),f(`[ModelCache] : ${e}`)}async preloadModels(e,s=null){f(`[ModelCache]  ${e.length} `);const n=e.length;let o=0;const a=e.filter(r=>{const l=this.preloadStatus.get(r);return!l||l==="failed"});f(`[ModelCache]  ${a.length} `);const i=3;for(let r=0;r<a.length;r+=i){const c=a.slice(r,r+i).map(async u=>{try{this.preloadStatus.set(u,"loading"),await this.loadModel(u,!0),this.preloadStatus.set(u,"loaded"),o++,s&&s(o,n,Math.round(o/n*100)),f(`[ModelCache] : ${u} (${o}/${n})`)}catch(d){f(`[ModelCache] : ${u}`,d),this.preloadStatus.set(u,"failed"),o++,s&&s(o,n,Math.round(o/n*100))}});await Promise.all(c),r+i<a.length&&await new Promise(u=>setTimeout(u,100))}f(`[ModelCache] : ${o}/${n} `)}isPreloaded(e){return this.preloadStatus.get(e)==="loaded"}getPreloadStatus(){const e={total:this.preloadStatus.size,loaded:0,loading:0,failed:0};for(const s of this.preloadStatus.values())e[s]++;return e}disposeModel(e){e&&e.traverse(s=>{s.isMesh&&(s.geometry&&s.geometry.dispose(),s.material&&(Array.isArray(s.material)?s.material.forEach(n=>{n.map&&n.map.dispose(),n.dispose&&n.dispose()}):(s.material.map&&s.material.map.dispose(),s.material.dispose&&s.material.dispose())))})}clearCache(){f("[ModelCache] ..."),this.modelPool.forEach(e=>{this.disposeModel(e)}),this.modelPool.clear(),this.instancedMeshes.forEach(e=>{this.disposeModel(e)}),this.instancedMeshes.clear(),this.gltfCache.clear(),this.preloadStatus.clear(),f("[ModelCache] ")}getCacheStatus(){return{gltfCacheSize:this.gltfCache.size,modelPoolSize:this.modelPool.size,instancedMeshesSize:this.instancedMeshes.size,preloadStatus:this.getPreloadStatus(),maxCacheSize:this.maxCacheSize,maxInstancesPerModel:this.maxInstancesPerModel,gltfLoaderInitialized:!!this.gltfLoader,dracoLoaderInitialized:!!this.dracoLoader}}updateConfig(e){e.maxCacheSize!==void 0&&(this.maxCacheSize=Math.max(10,e.maxCacheSize)),e.maxInstancesPerModel!==void 0&&(this.maxInstancesPerModel=Math.max(10,e.maxInstancesPerModel)),f("[ModelCache] :",this.getCacheStatus())}}const jt=new ah,ih={class:"model-wrapper"},rh={key:0,class:"model-loading"},lh={__name:"PuppetModelView",props:{puppet:{type:Object,default:null}},setup(t){const e=t,s=H(null),n=H(!1);let o=null,a=null,i=null,r=0,l=null,c=null,u=new uu,d=null,h=null,m=0,g=!1;window.__GLTF_MEMORY_CACHE__||(window.__GLTF_MEMORY_CACHE__=new Map,f("[PuppetModelView] Initialized global GLTF memory cache"));function x(){if(g)return;const b=s.value;if(!b){f("[PuppetModelView] Container not ready for Three.js initialization");return}f("[PuppetModelView] Initializing Three.js..."),a=new To,i=new Fn(45,1,.1,1e3),i.position.set(0,1,3),o=new xo({antialias:!0,alpha:!0}),o.setPixelRatio(window.devicePixelRatio||1),o.outputColorSpace=Tt,h=new jo,h.setDecoderPath("https://www.gstatic.com/draco/versioned/decoders/1.5.6/"),h.setCrossOrigin("anonymous"),f("[PuppetModelView] Draco loader initialized:",!!h),b.innerHTML="",b.appendChild(o.domElement);const w=new Co(16777215,1.2),I=new fs(16777215,1.5);I.position.set(3,5,2);const F=new fs(16777215,.8);F.position.set(-2,3,4);const z=new tn(16777215,1,10);z.position.set(0,2,3),a.add(w,I,F,z);const B=()=>{if(!b||!o)return;let ie=b.clientWidth,le=b.clientHeight;if(!ie||!le){const E=b.getBoundingClientRect();if(ie=E.width||200,le=E.height||200,!E.width||!E.height){requestAnimationFrame(B);return}}o.setSize(ie,le,!0),i.aspect=ie/Math.max(1,le),i.updateProjectionMatrix()};B(),d=new ResizeObserver(B),d.observe(b),requestAnimationFrame(()=>{B(),requestAnimationFrame(()=>{B(),requestAnimationFrame(B)})});const N=()=>{if(!o||!a||!i)return;r=requestAnimationFrame(N);const ie=u.getDelta();c&&c.update(ie),l&&(l.rotation.y+=ie*.6),o.render(a,i)};N(),g=!0,f("[PuppetModelView] Three.js initialized successfully, container size:",b.clientWidth,"x",b.clientHeight)}function S(){c&&(c.stopAllAction(),c=null),l&&(a.remove(l),l.traverse(b=>{b.isMesh&&(b.geometry&&b.geometry.dispose(),Array.isArray(b.material)?b.material.forEach(w=>{w.map&&w.map.dispose(),w&&w.dispose&&w.dispose()}):b.material&&(b.material.map&&b.material.map.dispose(),b.material.dispose&&b.material.dispose()))}),l=null)}function _(b){const w=new Rt().setFromObject(b),I=new ke,F=new ke;w.getSize(I),w.getCenter(F),b.position.sub(F),b.position.add(new ke(0,0,0)),b.scale.multiplyScalar(.8);const B=o==null?void 0:o.domElement,N=B?B.clientWidth||B.width:200,ie=B?B.clientHeight||B.height:200,le=Math.max(1e-6,N/Math.max(1,ie)),E=i.fov*(Math.PI/180),q=2*Math.atan(Math.tan(E/2)*le),Me=1.05,fe=I.y/2/Math.tan(E/2),he=I.x/2/Math.tan(q/2),Z=Me*Math.max(fe,he,.1);i.position.set(0,0,Z),i.lookAt(0,0,0)}async function M(b){var F;if(!b)return;f("[PuppetModelView] Loading puppet:",b.name),n.value=!0,x(),S();const w=++m;f("[PuppetModelView] ");let I=b.modelUrl||"";if(f("[PuppetModelView] Original modelUrl:",I),f("[PuppetModelView] Puppet image:",b.image),f("[PuppetModelView] Puppet name:",b.name),f("[PuppetModelView] Puppet data:",b),!I||I.trim()===""){f("[PuppetModelView] No model URL found");return}f("[PuppetModelView] Final Model URL:",I);try{f("[PuppetModelView] Starting to load:",I),f("[PuppetModelView] Cache status:",jt.getCacheStatus());const z=await jt.loadModel(I);if(f("[PuppetModelView] Model loaded from cache manager:",z),w!==m){f("[PuppetModelView] Ignoring outdated load result for:",b.name),gltf&&gltf.scene&&gltf.scene.traverse(B=>{B.isMesh&&(B.geometry&&B.geometry.dispose(),Array.isArray(B.material)?B.material.forEach(N=>{N.map&&N.map.dispose(),N.dispose&&N.dispose()}):B.material&&(B.material.map&&B.material.map.dispose(),B.material.dispose&&B.material.dispose()))});return}if(f("[PuppetModelView] Applying model for:",b.name),!a){f("[PuppetModelView] Scene not ready, initializing..."),x();let B=0;for(;!a&&B<40;)await new Promise(N=>setTimeout(N,50)),B++;if(!a){f("[PuppetModelView] Scene initialization timeout");return}}if(l=z,!l){f("[PuppetModelView] No model instance received");return}a.add(l),_(l),f("[PuppetModelView] Model loaded successfully:",b.name,"Scene children:",a.children.length),n.value=!1}catch(z){if(f("[PuppetModelView] Load failed:",z),f("[PuppetModelView] Failed URL:",I),f("[PuppetModelView] Puppet data:",b),typeof(z==null?void 0:z.message)=="string"&&z.message.includes("DRACOLoader")){f("[PuppetModelView] Retrying without Draco decoder...");try{const B=new Bo;B.setCrossOrigin("anonymous");const N=await B.loadAsync(I);if(w===m&&(l=N.scene||((F=N.scenes)==null?void 0:F[0]),l)){a.add(l),N.animations&&N.animations.length&&(c=new cu(l),c.clipAction(N.animations[0]).play()),_(l),f("[PuppetModelView] Model loaded successfully without Draco:",b.name);return}}catch(B){f("[PuppetModelView] Fallback load also failed:",B)}}if(w===m){const B=new us(1,1,1),N=new gt({color:8947967});l=new st(B,N),a.add(l),_(l)}n.value=!1}}return Bt(()=>e.puppet,async b=>{await On(),M(b)},{immediate:!1}),Dt(()=>{f("[PuppetModelView] Component mounted"),On(()=>{s.value&&(x(),e.puppet&&setTimeout(()=>{M(e.puppet)},0))})}),ms(()=>{if(f("[PuppetModelView] Cleaning up..."),cancelAnimationFrame(r),S(),d&&s.value)try{d.unobserve(s.value)}catch{}const b=a,w=o;o=null,a=null,i=null,g=!1,m=0;const I=()=>{if(f("[PuppetModelView] Starting deferred cleanup..."),b&&b.traverse(F=>{if(F.isMesh)try{if(F.geometry&&F.geometry.dispose(),Array.isArray(F.material))F.material.forEach(z=>{try{z.map&&z.map.dispose(),z.dispose&&z.dispose()}catch{}});else if(F.material)try{F.material.map&&F.material.map.dispose(),F.material.dispose&&F.material.dispose()}catch{}}catch{}}),w)try{w.dispose(),w.forceContextLoss&&w.forceContextLoss()}catch{}f("[PuppetModelView] Deferred cleanup completed")};typeof window<"u"&&window.requestIdleCallback?window.requestIdleCallback(I,{timeout:1e3}):setTimeout(I,100),f("[PuppetModelView] Quick cleanup completed, heavy cleanup deferred")}),(b,w)=>(D(),U("div",ih,[p("div",{ref_key:"mountEl",ref:s,class:"model-canvas"},null,512),n.value?(D(),U("div",rh,[...w[0]||(w[0]=[p("div",{class:"loading-spinner"},null,-1)])])):Se("",!0)]))}},ch=ft(lh,[["__scopeId","data-v-33527bae"]]),uh={class:"warehouse"},dh={class:"warehouse__resources"},fh={class:"resource-icon"},ph=["src","alt"],hh={class:"resource-value"},mh={class:"resource-tooltip"},gh={key:0,class:"warehouse__main"},_h={class:"warehouse__sidebar"},vh={class:"puppet-list"},yh=["onClick","onMouseenter"],bh={class:"puppet-card__quantity"},wh={class:"puppet-card__image"},Sh=["src","alt"],Mh={class:"puppet-card__info"},Th={class:"puppet-card__name"},xh={class:"puppet-card__level"},Ch={class:"puppet-detail__header"},Eh={class:"puppet-detail__name"},kh={class:"puppet-detail__content"},Ah={class:"puppet-detail__row"},Rh={class:"puppet-detail__model"},$h={class:"puppet-detail__description"},Ph={class:"puppet-detail__row"},Lh={class:"puppet-detail__stats"},Ih={class:"stats-section"},Oh={class:"stat-item"},Dh={class:"stat-value"},Nh={class:"stat-item"},Gh={class:"stat-value"},Hh={class:"stat-item"},Uh={class:"stat-value"},Fh={class:"stat-item"},Bh={class:"stat-value"},jh={class:"stat-item"},zh={class:"stat-value"},Vh={class:"stat-item"},Wh={class:"stat-value"},Kh={class:"stat-item"},qh={class:"stat-value"},Xh={class:"equipment-section"},Yh={class:"equipment-slots"},Jh=["src","alt"],Zh=["src"],Qh=["src"],em={key:3,class:"equipment-icon"},tm={key:0,class:"skill-section"},sm={class:"skill-info"},nm={class:"skill-text"},om={class:"skill-name"},am={class:"skill-cooldown"},im={class:"skill-effect"},rm={class:"skill-icon"},lm=["src","alt"],cm={key:1},um={class:"puppet-detail__upgrade"},dm={class:"upgrade-cost"},fm=["src"],pm={class:"cost-amount"},hm=["disabled"],mm=["src"],gm={class:"warehouse__placeholder",key:"placeholder"},_m=["src"],vm={__name:"Warehouse",props:{musicOn:{type:Boolean,default:!0}},setup(t,{expose:e}){Jt(Z=>({v9925b07e:Me,bf2e7e24:q,bf31385e:ie,bf304fa0:le,bf2f66e2:E}));const s=t,n=["SpiritalSpark","RecallGear","ResonantCrystal","RefinedCopper","HeartCrystalDust"];function o(Z){return n.map(R=>({icon:ts[R].icon,name:ts[R].name,value:Number((Z==null?void 0:Z[R])??0)}))}const a={IronWall:"",Arcanist:"",CraftsMan:"",Mechanic:"",Resonator:""};function i(Z){const R=Number(Z??1);return R===1?5:R===2?10:R===3?20:R===4?30:0}function r(Z){return(Z||[]).map((R,ce)=>{var Y,j,V,ae,ne,$;const K=(R==null?void 0:R.copper_info)||{},O=(K==null?void 0:K.skill)||{},J=(R==null?void 0:R.equipment_slot)||{},Q=(J==null?void 0:J.slot1)||null,Oe=(J==null?void 0:J.slot2)||null,je=(R==null?void 0:R.attribute)||{},Ve=((Y=Q==null?void 0:Q.equipment_base)==null?void 0:Y.attribute)||{},Ge=((j=Oe==null?void 0:Oe.equipment_base)==null?void 0:j.attribute)||{},et=Number(Ve.attack||0)+Number(Ge.attack||0),at=Number(Ve.defense||0)+Number(Ge.defense||0),nt=Number(Ve.dodge||0)+Number(Ge.dodge||0),Ct=R==null?void 0:R.copper_type,y=(R==null?void 0:R.level)??1,T=(K==null?void 0:K.model_url)||"",P=T?G(T):"";return{id:Number((R==null?void 0:R.id)??ce+1),name:(K==null?void 0:K.name)??"",level:y,suffix:(R==null?void 0:R.suffix)??0,image:G((K==null?void 0:K.icon_url)||""),modelUrl:P,quantity:1,description:(K==null?void 0:K.description)||"",stats:{level:`${y}/5`,health:Number(je.health||0),live_left:Number((R==null?void 0:R.live_left)??0),attack:{base:Number(je.attack||0),bonus:et},defense:{base:Number(je.defense||0),bonus:at},dodge:{base:Number(je.dodge||0),bonus:nt},class:a[Ct]||""},equipment:[Q?{name:((V=Q.equipment_base)==null?void 0:V.name)||"",icon:G(((ae=Q.equipment_base)==null?void 0:ae.resource_url)||""),equipped:!0,locked:!1}:{name:"",icon:"",equipped:!1,locked:!1},J!=null&&J.is_slot2_locked?{name:"",icon:"",equipped:!1,locked:!0}:Oe?{name:((ne=Oe.equipment_base)==null?void 0:ne.name)||"",icon:G((($=Oe.equipment_base)==null?void 0:$.resource_url)||""),equipped:!0,locked:!1}:{name:"",icon:"",equipped:!1,locked:!1}],skill:{name:(O==null?void 0:O.name)||"",cooldown:(O==null?void 0:O.cool_down)!=null?`${O.cool_down}`:"",effect:(O==null?void 0:O.description)||"",icon:G((O==null?void 0:O.resource_url)||"")},upgradeCost:i(y)}})}function l(Z,R,ce=[]){if(!Z||typeof Z!="object")return null;if(Object.prototype.hasOwnProperty.call(Z,R))return[...ce,R];if(Array.isArray(Z)){for(let K=0;K<Z.length;K++){const O=l(Z[K],R,[...ce,K]);if(O)return O}return null}for(const K of Object.keys(Z)){const O=l(Z[K],R,[...ce,K]);if(O)return O}return null}function c(Z,R){return R.reduce((ce,K)=>ce!=null?ce[K]:void 0,Z)}const u=H([]);async function d(){try{const Z=await Fo();Z&&(u.value=o(Z))}catch(Z){console.error("[Warehouse] :",Z),u.value=o({})}}Dt(()=>{d(),Uo(Ht.UPDATE_RESOURCES,d)});function h(Z){let R=Z;if(typeof Z=="string")try{R=JSON.parse(Z)}catch{}R&&R.type_msg&&(R.type_msg==="upgrade_cost_error"?alert(R.content||""):f("[GlobalInfo]",R))}Dt(()=>{try{Kl(h)}catch{}s.musicOn&&fe.value&&setTimeout(()=>{if(fe.value.readyState>=2)fe.value.play().then(()=>{f("[Warehouse] ")}).catch(R=>{f("[Warehouse] :",R)});else{const R=()=>{fe.value.play().then(()=>{f("[Warehouse] ")}).catch(ce=>{f("[Warehouse] :",ce)}),fe.value.removeEventListener("canplay",R)};fe.value.addEventListener("canplay",R,{once:!0})}},200)}),Bt(()=>s.musicOn,Z=>{if(fe.value)if(Z)if(fe.value.readyState>=2)fe.value.play().catch(R=>{f("[Warehouse] :",R)});else{const R=()=>{fe.value.play().catch(ce=>{f("[Warehouse] :",ce)}),fe.value.removeEventListener("canplay",R)};fe.value.addEventListener("canplay",R)}else fe.value.pause()}),ms(()=>{fe.value&&fe.value.pause(),ni(Ht.UPDATE_RESOURCES,d)});const m=H([]);Dt(async()=>{try{const Z=await lo();let R=Z&&Array.isArray(Z.coppers)?Z.coppers:[];if(!Array.isArray(R)){const ce=l(Z,"coppers");if(f("[Warehouse] copper key path:",ce),ce){const K=c(Z,ce);f("[Warehouse] copper found by path:",K),Array.isArray(K)&&(R=K)}!Array.isArray(R)&&Z&&Z.entries&&f("[Warehouse] copper entries sample:",Z.entries)}Array.isArray(R)||f("[Warehouse] copper list not array"),m.value=r(R),Array.isArray(m.value)&&m.value.length>0&&(g.value=m.value[0]),!g.value&&Array.isArray(m.value)&&m.value.length>0&&(g.value=m.value[0])}catch{m.value=[]}});const g=H(null),x=H([]),S=H(null),_=H(null),M=H(null);function b(Z,R){Z&&(x.value[R]=Z)}async function w(Z,R){g.value=Z,await On();const ce=x.value[R];if(ce&&typeof ce.scrollIntoView=="function"&&ce.scrollIntoView({block:"nearest",inline:"nearest",behavior:"smooth"}),S.value=R,_.value)try{_.value.scrollTo({top:0,behavior:"smooth"})}catch{_.value.scrollTop=0}setTimeout(()=>{S.value===R&&(S.value=null)},320)}const I=H(!1);function F(){I.value=!0}function z(){return I.value?(I.value=!1,!0):!1}e({handleBack:z});async function B(Z){try{await d();const R=await lo(),ce=Array.isArray(R==null?void 0:R.coppers)?R.coppers:[];m.value=r(ce)}catch{}}async function N(){if(!g.value)return;if(Number(g.value.level||0)>=5){alert("");return}const Z=g.value.id,R=await ip(Z);if(!R||R.type!=="success"){alert(R&&R.content?R.content:"");return}try{await d();const ce=await lo(),K=Array.isArray(ce==null?void 0:ce.coppers)?ce.coppers:[];m.value=r(K);const O=m.value.find(J=>J.id===Z);O&&(g.value=O)}catch{}}const ie=`url('${G("@assets/ui/panel2.png")}')`,le=`url('${G("@assets/ui/panel3.png")}')`,E=`url('${G("@assets/ui/panel4.png")}')`,q=`url('${G("@assets/ui/panel5.png")}')`,Me=`url('${G("@assets/frontend_resource/Gemini_Generated_Image_e03q5oe03q5oe03q.png")}')`,fe=H(null),he=G("assets/warehouse.mp3");return(Z,R)=>(D(),U("div",uh,[p("div",dh,[(D(!0),U(Je,null,Yt(u.value,ce=>(D(),U("div",{class:"resource-item",key:ce.name},[p("div",fh,[p("img",{src:ce.icon,alt:ce.name},null,8,ph)]),p("div",hh,se(ce.value),1),p("div",mh,se(ce.name),1)]))),128))]),I.value?Se("",!0):(D(),U("div",gh,[p("div",_h,[R[2]||(R[2]=p("div",{class:"warehouse__title"},"",-1)),p("div",vh,[(D(!0),U(Je,null,Yt(m.value,(ce,K)=>{var O;return D(),U("div",{class:qe(["puppet-card",{"puppet-card--selected":((O=g.value)==null?void 0:O.id)===ce.id,"puppet-card--pulse":S.value===K,"puppet-card--hover":M.value===K}]),key:ce.id,ref_for:!0,ref:J=>b(J,K),onClick:J=>w(ce,K),onMouseenter:J=>M.value=K,onMouseleave:R[0]||(R[0]=J=>M.value=null)},[p("div",bh,se(ce.level),1),p("div",wh,[p("img",{src:ce.image,alt:ce.name},null,8,Sh)]),p("div",Mh,[p("div",Th,se(ce.name)+se(ce.suffix),1),p("div",xh,se(ce.level)+"",1)])],42,yh)}),128)),p("div",{class:"puppet-card puppet-card--add",onClick:F},[...R[1]||(R[1]=[p("div",{class:"puppet-card__add-icon"},"+",-1),p("div",{class:"puppet-card__add-text"},"",-1)])])])]),p("div",{class:"warehouse__detail",ref_key:"detailWrap",ref:_},[ot(yf,{name:"fade-slide",mode:"out-in"},{default:nl(()=>{var ce,K,O,J;return[g.value?(D(),U("div",{class:"puppet-detail",key:((ce=g.value)==null?void 0:ce.id)||"none"},[p("div",Ch,[p("h2",Eh,se(g.value.name),1)]),p("div",kh,[p("div",Ah,[p("div",Rh,[ot(ch,{puppet:g.value},null,8,["puppet"])]),p("div",$h,se(g.value.description),1)]),p("div",Ph,[p("div",Lh,[p("div",Ih,[p("div",Oh,[R[3]||(R[3]=p("span",{class:"stat-label"},":",-1)),p("span",Dh,se(g.value.stats.health),1)]),p("div",Nh,[R[4]||(R[4]=p("span",{class:"stat-label"},":",-1)),p("span",Gh,se(g.value.stats.level),1)]),p("div",Hh,[R[5]||(R[5]=p("span",{class:"stat-label"},":",-1)),p("span",Uh,se(g.value.stats.live_left),1)]),p("div",Fh,[R[6]||(R[6]=p("span",{class:"stat-label"},":",-1)),p("span",Bh,se(g.value.stats.attack.base),1)]),p("div",jh,[R[7]||(R[7]=p("span",{class:"stat-label"},":",-1)),p("span",zh,se(g.value.stats.defense.base),1)]),p("div",Vh,[R[8]||(R[8]=p("span",{class:"stat-label"},":",-1)),p("span",Wh,se(g.value.stats.dodge.base)+"% ",1)]),p("div",Kh,[R[9]||(R[9]=p("span",{class:"stat-label"},":",-1)),p("span",qh,se(g.value.stats.class),1)])])]),p("div",Xh,[R[10]||(R[10]=p("h4",{class:"section-title"},"",-1)),p("div",Yh,[(D(!0),U(Je,null,Yt(g.value.equipment,(Q,Oe)=>(D(),U("div",{key:Oe,class:qe(["equipment-slot",{"equipment-slot--empty":!Q.equipped&&!Q.locked,"equipment-slot--locked":Q.locked}])},[Q.equipped&&Q.icon&&(Q.icon.startsWith("/")||Q.icon.startsWith("http"))?(D(),U("img",{key:0,src:Q.icon,alt:Q.name,class:"equipment-icon"},null,8,Jh)):Q.locked?(D(),U("img",{key:1,src:de(G)("@assets/ui/lock.png"),alt:"",class:"equipment-icon"},null,8,Zh)):Q.icon===""?(D(),U("img",{key:2,src:de(G)("@assets/ui/jia.png"),alt:"",class:"equipment-icon"},null,8,Qh)):(D(),U("span",em,se(Q.icon),1))],2))),128))])])]),((O=(K=g.value)==null?void 0:K.stats)==null?void 0:O.class)!==""?(D(),U("div",tm,[R[11]||(R[11]=p("h4",{class:"section-title"},"",-1)),p("div",sm,[p("div",nm,[p("div",om,se(g.value.skill.name),1),p("div",am," : "+se(g.value.skill.cooldown),1),p("div",im,se(g.value.skill.effect),1)]),p("div",rm,[g.value.skill.icon&&(g.value.skill.icon.startsWith("/")||g.value.skill.icon.startsWith("http"))?(D(),U("img",{key:0,src:g.value.skill.icon,alt:g.value.skill.name,class:"skill-icon-img"},null,8,lm)):(D(),U("span",cm,se(g.value.skill.icon),1))])])])):Se("",!0)]),p("div",um,[p("div",dm,[g.value.level<5?(D(),U("img",{key:0,src:de(ts).SpiritalSpark.icon,alt:"",class:"cost-icon-img"},null,8,fm)):Se("",!0),p("span",pm,se(g.value.level>=5?"":"X "+g.value.upgradeCost),1)]),p("button",{class:"upgrade-btn",onClick:N,disabled:((J=g.value)==null?void 0:J.level)>=5},[p("img",{src:de(G)("@assets/ui/upgrade.png"),class:"upgrade-icon",alt:""},null,8,mm)],8,hm)])])):(D(),U("div",gm,[...R[12]||(R[12]=[p("p",null,"",-1)])]))]}),_:1})],512)])),I.value?(D(),Pt(Mp,{key:1,onDraw:B})):Se("",!0),p("audio",{ref_key:"audioRef",ref:fe,src:de(he),loop:"",preload:"auto"},null,8,_m)]))}},ym=ft(vm,[["__scopeId","data-v-228931f6"]]),bm={class:"panel",style:{left:"24px",right:"auto"}},wm=["title"],Sm={key:0,width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg"},Mm={key:1,width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg"},Tm={class:"sr-only"},xm={__name:"TopLeftPanel",props:{musicOn:{type:Boolean,default:!0}},emits:["back","open-settings","toggle-music"],setup(t,{emit:e}){return(s,n)=>(D(),U("div",bm,[p("button",{class:"btn",onClick:n[0]||(n[0]=o=>s.$emit("back")),title:""},[...n[3]||(n[3]=[p("svg",{width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg"},[p("path",{d:"M15 18L9 12L15 6",stroke:"#ffffff","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"})],-1),p("span",{class:"sr-only"},"",-1)])]),p("button",{class:"btn",onClick:n[1]||(n[1]=o=>s.$emit("toggle-music")),title:t.musicOn?"":""},[t.musicOn?(D(),U("svg",Sm,[...n[4]||(n[4]=[p("path",{d:"M9 18V5L21 3V16",stroke:"#ffffff","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"},null,-1),p("circle",{cx:"6",cy:"18",r:"3",stroke:"#ffffff","stroke-width":"2"},null,-1),p("circle",{cx:"18",cy:"16",r:"3",stroke:"#ffffff","stroke-width":"2"},null,-1)])])):(D(),U("svg",Mm,[...n[5]||(n[5]=[p("path",{d:"M9 18V5L21 3V16",stroke:"#ffffff","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"},null,-1),p("circle",{cx:"6",cy:"18",r:"3",stroke:"#ffffff","stroke-width":"2"},null,-1),p("circle",{cx:"18",cy:"16",r:"3",stroke:"#ffffff","stroke-width":"2"},null,-1),p("line",{x1:"2",y1:"2",x2:"22",y2:"22",stroke:"#ffffff","stroke-width":"2","stroke-linecap":"round"},null,-1)])])),p("span",Tm,se(t.musicOn?"":""),1)],8,wm),p("button",{class:"btn",onClick:n[2]||(n[2]=o=>s.$emit("open-settings")),title:""},[...n[6]||(n[6]=[p("svg",{width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg"},[p("path",{d:"M12 15.5C13.933 15.5 15.5 13.933 15.5 12C15.5 10.067 13.933 8.5 12 8.5C10.067 8.5 8.5 10.067 8.5 12C8.5 13.933 10.067 15.5 12 15.5Z",stroke:"#ffffff","stroke-width":"2"}),p("path",{d:"M19.4 15A7.964 7.964 0 0 0 20 12C20 11.49 19.95 10.99 19.86 10.5L22 8.5L20 5.5L17.34 6.07C16.78 5.58 16.14 5.18 15.44 4.9L15 2H9L8.56 4.9C7.86 5.18 7.22 5.58 6.66 6.07L4 5.5L2 8.5L4.14 10.5C4.05 10.99 4 11.49 4 12C4 12.51 4.05 13.01 4.14 13.5L2 15.5L4 18.5L6.66 17.93C7.22 18.42 7.86 18.82 8.56 19.1L9 22H15L15.44 19.1C16.14 18.82 16.78 18.42 17.34 17.93L20 18.5L22 15.5L19.86 13.5C19.95 13.01 20 12.51 20 12",stroke:"#ffffff","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"})],-1),p("span",{class:"sr-only"},"",-1)])])]))}},lr=ft(xm,[["__scopeId","data-v-8380a348"]]),Cm=["automatic_loading_gun","charging_coil","heart_source_mineral_drill","mirro_light_refraction_tower","repair_workshop","resonance_alarm_bell","rivet_barrier","steam_mining_car","storm_anvil"];function Em(){const t=[],e=[{type:"arcanist",name:"bubble"},{type:"craftsman",name:"coil"},{type:"iron_wall",name:"bell"},{type:"mechanic",name:"gyro"},{type:"resonator",name:"clawster"}];for(const n of e){const o=Go(n.type,n.name);t.push(o)}const s=["goblin","guard","demon"];for(const n of s){const o=Ho(n);t.push(o)}return f(`[ModelPreloadConfig]  ${t.length} URL`),t}function km(){const t=[],e=[{type:"arcanist",name:"glimmer"},{type:"arcanist",name:"spark"},{type:"craftsman",name:"artifex"},{type:"craftsman",name:"wrench"},{type:"iron_wall",name:"chief"},{type:"iron_wall",name:"rocky"},{type:"mechanic",name:"karin"},{type:"mechanic",name:"tricky"},{type:"resonator",name:"diggs"},{type:"resonator",name:"hive"}];for(const n of e){const o=Go(n.type,n.name);t.push(o)}const s=["assassin","boxer","cruiser","devourer","glutton"];for(const n of s){const o=Ho(n);t.push(o)}return f(`[ModelPreloadConfig]  ${t.length} URL`),t}function Am(){const t=[],e=[{type:"arcanist",name:"syrup"},{type:"arcanist",name:"turner"},{type:"craftsman",name:"drillbit"},{type:"craftsman",name:"quickhand"},{type:"iron_wall",name:"tumble"},{type:"iron_wall",name:"wesley"},{type:"mechanic",name:"pendulum"},{type:"mechanic",name:"yoyo"},{type:"resonator",name:"melody"},{type:"resonator",name:"murmur"}];for(const n of e){const o=Go(n.type,n.name);t.push(o)}const s=["horn","mirror","scout","shatra","variant"];for(const n of s){const o=Ho(n);t.push(o)}for(const n of Cm){const o=zl(n);t.push(o)}return f(`[ModelPreloadConfig]  ${t.length} URL`),t}function Rm(t=["high","medium"]){const e=[];for(const n of t)switch(n){case"high":e.push(...Em());break;case"medium":e.push(...km());break;case"low":e.push(...Am());break}const s=[...new Set(e)];return f(`[ModelPreloadConfig]  ${t.join(", ")}  ${s.length} URL`),s}class $m{constructor(){this.isPreloading=!1,this.preloadProgress=0,this.preloadCallbacks=[]}async startPreload(e=["high","medium"],s=null){if(this.isPreloading){f("[ModelPreloadManager] ");return}this.isPreloading=!0,this.preloadProgress=0;try{const n=Rm(e);f(`[ModelPreloadManager]  ${n.length}  (: ${e.join(", ")})`),s&&this.preloadCallbacks.push(s),await jt.preloadModels(n,(o,a,i)=>{this.preloadProgress=i,this.notifyProgress(o,a,i)}),f("[ModelPreloadManager] ")}catch(n){f("[ModelPreloadManager] :",n)}finally{this.isPreloading=!1,this.preloadCallbacks=[]}}notifyProgress(e,s,n){this.preloadCallbacks.forEach(o=>{try{o(e,s,n)}catch(a){f("[ModelPreloadManager] :",a)}})}getStatus(){return{isPreloading:this.isPreloading,progress:this.preloadProgress,cacheStatus:jt.getCacheStatus()}}isModelPreloaded(e){return jt.isPreloaded(e)}async preloadModel(e){try{await jt.loadModel(e,!0),f(`[ModelPreloadManager] : ${e}`)}catch(s){f(`[ModelPreloadManager] : ${e}`,s)}}async preloadModels(e){const s=e.map(n=>this.preloadModel(n));await Promise.all(s),f(`[ModelPreloadManager] : ${e.length} `)}}const cr=new $m,Yl="mgpic_game_settings",ur={controlMode:"mobile",mouseSensitivity:.002};function Jl(){try{const t=localStorage.getItem(Yl);if(t){const e=JSON.parse(t);return{...ur,...e}}}catch(t){console.error("[GameSettings] :",t)}return{...ur}}function Pm(t){try{return localStorage.setItem(Yl,JSON.stringify(t)),!0}catch(e){return console.error("[GameSettings] :",e),!1}}function Lm(t,e){const s=Jl();return s[t]=e,Pm(s)}const Im={class:"startmenu"},Om={key:0,class:"download-banner"},Dm={key:1,class:"settings-local"},Nm={class:"settings-local__card"},Gm={class:"settings-local__content"},Hm={class:"settings-local__row"},Um={class:"setting-options"},Fm={__name:"StartMenu",props:{visible:{type:Boolean,default:!0}},emits:["started"],setup(t,{emit:e}){Jt(E=>({v51d6432e:S}));const s=t,n=H(null);let o=null,a=null,i=null,r=null,l=null,c=1.2;const u=H(!1),d=H(!1),h=H(!1),m=H("touchpad"),g=H(!1),x=H(G("ui/Gemini_Generated_Image_gtrehogtrehogtre (1).png")),S=`url('${G("@assets/ui/panel4.png")}')`,_=e;Bt(()=>s.visible,E=>{E&&o&&l?I():E||w()});function M(){if(r=requestAnimationFrame(M),l){const E=Date.now()*.001;l.position.y=Math.sin(E*.8)*.1,l.rotation.y=Math.sin(E*.6)*.1;const q=c+Math.sin(E*1.2)*.04;l.scale.setScalar(q)}i&&i.render(o,a)}function b(){!i||!a||(a.aspect=window.innerWidth/window.innerHeight,a.updateProjectionMatrix(),i.setSize(window.innerWidth,window.innerHeight))}function w(){r&&(cancelAnimationFrame(r),r=null),i&&i.setAnimationLoop(null)}function I(){r||M()}function F(){try{w()}catch{}try{window.removeEventListener("resize",b)}catch{}try{o&&(o.traverse(E=>{if(E.isMesh){E.geometry&&E.geometry.dispose&&E.geometry.dispose();const q=E.material;Array.isArray(q)?q.forEach(Me=>Me&&Me.dispose&&Me.dispose()):q&&q.dispose&&q.dispose()}}),o.clear())}catch{}try{if(i){i.clear(!0,!0,!0),i.dispose();const E=i.getContext&&i.getContext(),q=E&&E.getExtension&&E.getExtension("WEBGL_lose_context");q&&q.loseContext&&q.loseContext()}}catch{}o=null,a=null,i=null,l=null}async function z(E=null){try{window.getAssetUrl=G,window.precacheAllResources=La,window.getCacheStatus=Kf}catch{}if(!o||!i){f("[StartMenu] Scene or renderer not initialized in onMounted");return}if(E&&E(0,100,20),!o.children.some(fe=>fe.isLight)){const fe=new Co(4210752,.4);o.add(fe);const he=new fs(16777215,12.5);he.position.set(-5,-2,1),o.add(he)}E&&E(0,100,50);const Me=G("logo.glb");try{E&&E(0,100,60),f("[StartMenu] Logo...");const fe=await jt.loadModel(Me,!0);E&&E(0,100,80),fe.position.set(0,0,0),o.add(fe);const Z=new Rt().setFromObject(fe).getCenter(new ke);fe.position.set(-Z.x,-Z.y,-Z.z-.3);try{fe.scale.setScalar(c)}catch{}l=fe,E&&E(0,100,80),f("[StartMenu] Logo ...");try{await cr.startPreload(["high","medium"],(R,ce,K)=>{const O=80+K*.15;E&&E(0,100,Math.round(O)),f(`[StartMenu] : ${R}/${ce} (${K}%)`)}),f("[StartMenu] ")}catch(R){f("[StartMenu] :",R)}E&&E(0,100,100),u.value=!0,f("[StartMenu] "),d.value=!0}catch(fe){f("[StartMenu] 3D",fe);const he=new us(1,1,1),Z=new _t({color:16096779}),R=new st(he,Z);o.add(R),l=R,f("[StartMenu] ...");try{await cr.startPreload(["high","medium"],(ce,K,O)=>{const J=80+O*.15;E&&E(0,100,Math.round(J)),f(`[StartMenu] : ${ce}/${K} (${O}%)`)}),f("[StartMenu] ")}catch(ce){f("[StartMenu] :",ce)}E&&E(0,100,100),u.value=!0,f("[StartMenu] "),d.value=!0}window.__START_MENU_PAUSE__=()=>w(),window.__START_MENU_RESUME__=()=>I()}function B(){_("started"),w()}function N(){const E=Jl();m.value=E.controlMode,h.value=!0}function ie(){h.value=!1}function le(E){m.value=E,Lm("controlMode",E),window.updateControlMode&&window.updateControlMode(E),f(`[StartMenu] : ${E}`)}return Dt(()=>{var E;d.value=!1,u.value=!1,g.value=typeof window<"u"&&(window.navigator.userAgent.toLowerCase().includes("electron")||((E=window.process)==null?void 0:E.type)==="renderer"||!!(window.require&&window.process&&window.process.versions&&window.process.versions.electron)),f("[StartMenu] ..."),f("[StartMenu] Electron :",g.value),!o&&n.value?(o=new To,o.background=null,a=new Fn(50,window.innerWidth/window.innerHeight,.1,1e3),a.position.set(-3.655,.2,-.006),a.rotation.set(-1.618275,-1.538307,-1.6183,"XYZ"),i=new xo({antialias:!0,alpha:!0,canvas:n.value}),i.setSize(window.innerWidth,window.innerHeight),i.setPixelRatio(window.devicePixelRatio),i.setClearColor(0,0),window.addEventListener("resize",b),M(),f("[StartMenu] ")):o&&!l?f("[StartMenu] "):l&&(f("[StartMenu] Logo"),d.value=!0,u.value=!0),window.__INIT_THREE_SCENE__=async q=>{if(o&&l){f("[StartMenu] Logo"),d.value=!0,u.value=!0;return}f("[StartMenu] 3D..."),await z(q)}}),ms(()=>{F()}),(E,q)=>(D(),U("div",Im,[g.value?Se("",!0):(D(),U("div",Om,[...q[2]||(q[2]=[p("span",{class:"download-banner__text"},"  ",-1),p("a",{href:"https://github.com/MGPIC-2025/Cross/releases",target:"_blank",rel:"noopener noreferrer",class:"download-banner__link"},"  ",-1)])])),p("div",{class:"startmenu__bg",style:Ut({backgroundImage:`url('${x.value}')`})},null,4),p("canvas",{ref_key:"canvasRef",ref:n,class:"startmenu__canvas"},null,512),ol(p("div",{class:qe(["startmenu-ui",{"fade-in":d.value}])},[p("button",{id:"start-btn",class:"startmenu-btn","aria-label":"",onClick:B},"  "),p("button",{id:"settings-btn",class:"startmenu-btn","aria-label":"",onClick:N},"  ")],2),[[Fl,d.value]]),h.value?(D(),U("div",Dm,[p("div",Nm,[p("div",{class:"settings-local__header"},[q[3]||(q[3]=p("div",{class:"settings-local__title"},"",-1)),p("button",{class:"settings-local__close",onClick:ie,"aria-label":""},"  ")]),p("div",Gm,[p("div",Hm,[q[6]||(q[6]=p("div",{class:"setting-label"},"",-1)),p("div",Um,[p("button",{class:qe(["option-btn",{active:m.value==="touchpad"}]),onClick:q[0]||(q[0]=Me=>le("touchpad"))},[...q[4]||(q[4]=[p("span",{class:"option-title"},"",-1),p("span",{class:"option-desc"},"",-1)])],2),p("button",{class:qe(["option-btn",{active:m.value==="mouse"}]),onClick:q[1]||(q[1]=Me=>le("mouse"))},[...q[5]||(q[5]=[p("span",{class:"option-title"},"",-1),p("span",{class:"option-desc"},"",-1)])],2)])])])])])):Se("",!0)]))}},Bm=ft(Fm,[["__scopeId","data-v-90f3002b"]]),dr={type:"change"},oi={type:"start"},Zl={type:"end"},so=new fu,fr=new xr,jm=Math.cos(70*Mr.DEG2RAD),mt=new ke,Nt=2*Math.PI,Ke={NONE:-1,ROTATE:0,DOLLY:1,PAN:2,TOUCH_ROTATE:3,TOUCH_PAN:4,TOUCH_DOLLY_PAN:5,TOUCH_DOLLY_ROTATE:6},fa=1e-6;class zm extends du{constructor(e,s=null){super(e,s),this.state=Ke.NONE,this.target=new ke,this.cursor=new ke,this.minDistance=0,this.maxDistance=1/0,this.minZoom=0,this.maxZoom=1/0,this.minTargetRadius=0,this.maxTargetRadius=1/0,this.minPolarAngle=0,this.maxPolarAngle=Math.PI,this.minAzimuthAngle=-1/0,this.maxAzimuthAngle=1/0,this.enableDamping=!1,this.dampingFactor=.05,this.enableZoom=!0,this.zoomSpeed=1,this.enableRotate=!0,this.rotateSpeed=1,this.keyRotateSpeed=1,this.enablePan=!0,this.panSpeed=1,this.screenSpacePanning=!0,this.keyPanSpeed=7,this.zoomToCursor=!1,this.autoRotate=!1,this.autoRotateSpeed=2,this.keys={LEFT:"ArrowLeft",UP:"ArrowUp",RIGHT:"ArrowRight",BOTTOM:"ArrowDown"},this.mouseButtons={LEFT:nn.ROTATE,MIDDLE:nn.DOLLY,RIGHT:nn.PAN},this.touches={ONE:sn.ROTATE,TWO:sn.DOLLY_PAN},this.target0=this.target.clone(),this.position0=this.object.position.clone(),this.zoom0=this.object.zoom,this._domElementKeyEvents=null,this._lastPosition=new ke,this._lastQuaternion=new fn,this._lastTargetPosition=new ke,this._quat=new fn().setFromUnitVectors(e.up,new ke(0,1,0)),this._quatInverse=this._quat.clone().invert(),this._spherical=new hi,this._sphericalDelta=new hi,this._scale=1,this._panOffset=new ke,this._rotateStart=new kt,this._rotateEnd=new kt,this._rotateDelta=new kt,this._panStart=new kt,this._panEnd=new kt,this._panDelta=new kt,this._dollyStart=new kt,this._dollyEnd=new kt,this._dollyDelta=new kt,this._dollyDirection=new ke,this._mouse=new kt,this._performCursorZoom=!1,this._pointers=[],this._pointerPositions={},this._controlActive=!1,this._onPointerMove=Wm.bind(this),this._onPointerDown=Vm.bind(this),this._onPointerUp=Km.bind(this),this._onContextMenu=eg.bind(this),this._onMouseWheel=Ym.bind(this),this._onKeyDown=Jm.bind(this),this._onTouchStart=Zm.bind(this),this._onTouchMove=Qm.bind(this),this._onMouseDown=qm.bind(this),this._onMouseMove=Xm.bind(this),this._interceptControlDown=tg.bind(this),this._interceptControlUp=sg.bind(this),this.domElement!==null&&this.connect(this.domElement),this.update()}connect(e){super.connect(e),this.domElement.addEventListener("pointerdown",this._onPointerDown),this.domElement.addEventListener("pointercancel",this._onPointerUp),this.domElement.addEventListener("contextmenu",this._onContextMenu),this.domElement.addEventListener("wheel",this._onMouseWheel,{passive:!1}),this.domElement.getRootNode().addEventListener("keydown",this._interceptControlDown,{passive:!0,capture:!0}),this.domElement.style.touchAction="none"}disconnect(){this.domElement.removeEventListener("pointerdown",this._onPointerDown),this.domElement.removeEventListener("pointermove",this._onPointerMove),this.domElement.removeEventListener("pointerup",this._onPointerUp),this.domElement.removeEventListener("pointercancel",this._onPointerUp),this.domElement.removeEventListener("wheel",this._onMouseWheel),this.domElement.removeEventListener("contextmenu",this._onContextMenu),this.stopListenToKeyEvents(),this.domElement.getRootNode().removeEventListener("keydown",this._interceptControlDown,{capture:!0}),this.domElement.style.touchAction="auto"}dispose(){this.disconnect()}getPolarAngle(){return this._spherical.phi}getAzimuthalAngle(){return this._spherical.theta}getDistance(){return this.object.position.distanceTo(this.target)}listenToKeyEvents(e){e.addEventListener("keydown",this._onKeyDown),this._domElementKeyEvents=e}stopListenToKeyEvents(){this._domElementKeyEvents!==null&&(this._domElementKeyEvents.removeEventListener("keydown",this._onKeyDown),this._domElementKeyEvents=null)}saveState(){this.target0.copy(this.target),this.position0.copy(this.object.position),this.zoom0=this.object.zoom}reset(){this.target.copy(this.target0),this.object.position.copy(this.position0),this.object.zoom=this.zoom0,this.object.updateProjectionMatrix(),this.dispatchEvent(dr),this.update(),this.state=Ke.NONE}update(e=null){const s=this.object.position;mt.copy(s).sub(this.target),mt.applyQuaternion(this._quat),this._spherical.setFromVector3(mt),this.autoRotate&&this.state===Ke.NONE&&this._rotateLeft(this._getAutoRotationAngle(e)),this.enableDamping?(this._spherical.theta+=this._sphericalDelta.theta*this.dampingFactor,this._spherical.phi+=this._sphericalDelta.phi*this.dampingFactor):(this._spherical.theta+=this._sphericalDelta.theta,this._spherical.phi+=this._sphericalDelta.phi);let n=this.minAzimuthAngle,o=this.maxAzimuthAngle;isFinite(n)&&isFinite(o)&&(n<-Math.PI?n+=Nt:n>Math.PI&&(n-=Nt),o<-Math.PI?o+=Nt:o>Math.PI&&(o-=Nt),n<=o?this._spherical.theta=Math.max(n,Math.min(o,this._spherical.theta)):this._spherical.theta=this._spherical.theta>(n+o)/2?Math.max(n,this._spherical.theta):Math.min(o,this._spherical.theta)),this._spherical.phi=Math.max(this.minPolarAngle,Math.min(this.maxPolarAngle,this._spherical.phi)),this._spherical.makeSafe(),this.enableDamping===!0?this.target.addScaledVector(this._panOffset,this.dampingFactor):this.target.add(this._panOffset),this.target.sub(this.cursor),this.target.clampLength(this.minTargetRadius,this.maxTargetRadius),this.target.add(this.cursor);let a=!1;if(this.zoomToCursor&&this._performCursorZoom||this.object.isOrthographicCamera)this._spherical.radius=this._clampDistance(this._spherical.radius);else{const i=this._spherical.radius;this._spherical.radius=this._clampDistance(this._spherical.radius*this._scale),a=i!=this._spherical.radius}if(mt.setFromSpherical(this._spherical),mt.applyQuaternion(this._quatInverse),s.copy(this.target).add(mt),this.object.lookAt(this.target),this.enableDamping===!0?(this._sphericalDelta.theta*=1-this.dampingFactor,this._sphericalDelta.phi*=1-this.dampingFactor,this._panOffset.multiplyScalar(1-this.dampingFactor)):(this._sphericalDelta.set(0,0,0),this._panOffset.set(0,0,0)),this.zoomToCursor&&this._performCursorZoom){let i=null;if(this.object.isPerspectiveCamera){const r=mt.length();i=this._clampDistance(r*this._scale);const l=r-i;this.object.position.addScaledVector(this._dollyDirection,l),this.object.updateMatrixWorld(),a=!!l}else if(this.object.isOrthographicCamera){const r=new ke(this._mouse.x,this._mouse.y,0);r.unproject(this.object);const l=this.object.zoom;this.object.zoom=Math.max(this.minZoom,Math.min(this.maxZoom,this.object.zoom/this._scale)),this.object.updateProjectionMatrix(),a=l!==this.object.zoom;const c=new ke(this._mouse.x,this._mouse.y,0);c.unproject(this.object),this.object.position.sub(c).add(r),this.object.updateMatrixWorld(),i=mt.length()}else console.warn("WARNING: OrbitControls.js encountered an unknown camera type - zoom to cursor disabled."),this.zoomToCursor=!1;i!==null&&(this.screenSpacePanning?this.target.set(0,0,-1).transformDirection(this.object.matrix).multiplyScalar(i).add(this.object.position):(so.origin.copy(this.object.position),so.direction.set(0,0,-1).transformDirection(this.object.matrix),Math.abs(this.object.up.dot(so.direction))<jm?this.object.lookAt(this.target):(fr.setFromNormalAndCoplanarPoint(this.object.up,this.target),so.intersectPlane(fr,this.target))))}else if(this.object.isOrthographicCamera){const i=this.object.zoom;this.object.zoom=Math.max(this.minZoom,Math.min(this.maxZoom,this.object.zoom/this._scale)),i!==this.object.zoom&&(this.object.updateProjectionMatrix(),a=!0)}return this._scale=1,this._performCursorZoom=!1,a||this._lastPosition.distanceToSquared(this.object.position)>fa||8*(1-this._lastQuaternion.dot(this.object.quaternion))>fa||this._lastTargetPosition.distanceToSquared(this.target)>fa?(this.dispatchEvent(dr),this._lastPosition.copy(this.object.position),this._lastQuaternion.copy(this.object.quaternion),this._lastTargetPosition.copy(this.target),!0):!1}_getAutoRotationAngle(e){return e!==null?Nt/60*this.autoRotateSpeed*e:Nt/60/60*this.autoRotateSpeed}_getZoomScale(e){const s=Math.abs(e*.01);return Math.pow(.95,this.zoomSpeed*s)}_rotateLeft(e){this._sphericalDelta.theta-=e}_rotateUp(e){this._sphericalDelta.phi-=e}_panLeft(e,s){mt.setFromMatrixColumn(s,0),mt.multiplyScalar(-e),this._panOffset.add(mt)}_panUp(e,s){this.screenSpacePanning===!0?mt.setFromMatrixColumn(s,1):(mt.setFromMatrixColumn(s,0),mt.crossVectors(this.object.up,mt)),mt.multiplyScalar(e),this._panOffset.add(mt)}_pan(e,s){const n=this.domElement;if(this.object.isPerspectiveCamera){const o=this.object.position;mt.copy(o).sub(this.target);let a=mt.length();a*=Math.tan(this.object.fov/2*Math.PI/180),this._panLeft(2*e*a/n.clientHeight,this.object.matrix),this._panUp(2*s*a/n.clientHeight,this.object.matrix)}else this.object.isOrthographicCamera?(this._panLeft(e*(this.object.right-this.object.left)/this.object.zoom/n.clientWidth,this.object.matrix),this._panUp(s*(this.object.top-this.object.bottom)/this.object.zoom/n.clientHeight,this.object.matrix)):(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - pan disabled."),this.enablePan=!1)}_dollyOut(e){this.object.isPerspectiveCamera||this.object.isOrthographicCamera?this._scale/=e:(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - dolly/zoom disabled."),this.enableZoom=!1)}_dollyIn(e){this.object.isPerspectiveCamera||this.object.isOrthographicCamera?this._scale*=e:(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - dolly/zoom disabled."),this.enableZoom=!1)}_updateZoomParameters(e,s){if(!this.zoomToCursor)return;this._performCursorZoom=!0;const n=this.domElement.getBoundingClientRect(),o=e-n.left,a=s-n.top,i=n.width,r=n.height;this._mouse.x=o/i*2-1,this._mouse.y=-(a/r)*2+1,this._dollyDirection.set(this._mouse.x,this._mouse.y,1).unproject(this.object).sub(this.object.position).normalize()}_clampDistance(e){return Math.max(this.minDistance,Math.min(this.maxDistance,e))}_handleMouseDownRotate(e){this._rotateStart.set(e.clientX,e.clientY)}_handleMouseDownDolly(e){this._updateZoomParameters(e.clientX,e.clientX),this._dollyStart.set(e.clientX,e.clientY)}_handleMouseDownPan(e){this._panStart.set(e.clientX,e.clientY)}_handleMouseMoveRotate(e){this._rotateEnd.set(e.clientX,e.clientY),this._rotateDelta.subVectors(this._rotateEnd,this._rotateStart).multiplyScalar(this.rotateSpeed);const s=this.domElement;this._rotateLeft(Nt*this._rotateDelta.x/s.clientHeight),this._rotateUp(Nt*this._rotateDelta.y/s.clientHeight),this._rotateStart.copy(this._rotateEnd),this.update()}_handleMouseMoveDolly(e){this._dollyEnd.set(e.clientX,e.clientY),this._dollyDelta.subVectors(this._dollyEnd,this._dollyStart),this._dollyDelta.y>0?this._dollyOut(this._getZoomScale(this._dollyDelta.y)):this._dollyDelta.y<0&&this._dollyIn(this._getZoomScale(this._dollyDelta.y)),this._dollyStart.copy(this._dollyEnd),this.update()}_handleMouseMovePan(e){this._panEnd.set(e.clientX,e.clientY),this._panDelta.subVectors(this._panEnd,this._panStart).multiplyScalar(this.panSpeed),this._pan(this._panDelta.x,this._panDelta.y),this._panStart.copy(this._panEnd),this.update()}_handleMouseWheel(e){this._updateZoomParameters(e.clientX,e.clientY),e.deltaY<0?this._dollyIn(this._getZoomScale(e.deltaY)):e.deltaY>0&&this._dollyOut(this._getZoomScale(e.deltaY)),this.update()}_handleKeyDown(e){let s=!1;switch(e.code){case this.keys.UP:e.ctrlKey||e.metaKey||e.shiftKey?this.enableRotate&&this._rotateUp(Nt*this.keyRotateSpeed/this.domElement.clientHeight):this.enablePan&&this._pan(0,this.keyPanSpeed),s=!0;break;case this.keys.BOTTOM:e.ctrlKey||e.metaKey||e.shiftKey?this.enableRotate&&this._rotateUp(-Nt*this.keyRotateSpeed/this.domElement.clientHeight):this.enablePan&&this._pan(0,-this.keyPanSpeed),s=!0;break;case this.keys.LEFT:e.ctrlKey||e.metaKey||e.shiftKey?this.enableRotate&&this._rotateLeft(Nt*this.keyRotateSpeed/this.domElement.clientHeight):this.enablePan&&this._pan(this.keyPanSpeed,0),s=!0;break;case this.keys.RIGHT:e.ctrlKey||e.metaKey||e.shiftKey?this.enableRotate&&this._rotateLeft(-Nt*this.keyRotateSpeed/this.domElement.clientHeight):this.enablePan&&this._pan(-this.keyPanSpeed,0),s=!0;break}s&&(e.preventDefault(),this.update())}_handleTouchStartRotate(e){if(this._pointers.length===1)this._rotateStart.set(e.pageX,e.pageY);else{const s=this._getSecondPointerPosition(e),n=.5*(e.pageX+s.x),o=.5*(e.pageY+s.y);this._rotateStart.set(n,o)}}_handleTouchStartPan(e){if(this._pointers.length===1)this._panStart.set(e.pageX,e.pageY);else{const s=this._getSecondPointerPosition(e),n=.5*(e.pageX+s.x),o=.5*(e.pageY+s.y);this._panStart.set(n,o)}}_handleTouchStartDolly(e){const s=this._getSecondPointerPosition(e),n=e.pageX-s.x,o=e.pageY-s.y,a=Math.sqrt(n*n+o*o);this._dollyStart.set(0,a)}_handleTouchStartDollyPan(e){this.enableZoom&&this._handleTouchStartDolly(e),this.enablePan&&this._handleTouchStartPan(e)}_handleTouchStartDollyRotate(e){this.enableZoom&&this._handleTouchStartDolly(e),this.enableRotate&&this._handleTouchStartRotate(e)}_handleTouchMoveRotate(e){if(this._pointers.length==1)this._rotateEnd.set(e.pageX,e.pageY);else{const n=this._getSecondPointerPosition(e),o=.5*(e.pageX+n.x),a=.5*(e.pageY+n.y);this._rotateEnd.set(o,a)}this._rotateDelta.subVectors(this._rotateEnd,this._rotateStart).multiplyScalar(this.rotateSpeed);const s=this.domElement;this._rotateLeft(Nt*this._rotateDelta.x/s.clientHeight),this._rotateUp(Nt*this._rotateDelta.y/s.clientHeight),this._rotateStart.copy(this._rotateEnd)}_handleTouchMovePan(e){if(this._pointers.length===1)this._panEnd.set(e.pageX,e.pageY);else{const s=this._getSecondPointerPosition(e),n=.5*(e.pageX+s.x),o=.5*(e.pageY+s.y);this._panEnd.set(n,o)}this._panDelta.subVectors(this._panEnd,this._panStart).multiplyScalar(this.panSpeed),this._pan(this._panDelta.x,this._panDelta.y),this._panStart.copy(this._panEnd)}_handleTouchMoveDolly(e){const s=this._getSecondPointerPosition(e),n=e.pageX-s.x,o=e.pageY-s.y,a=Math.sqrt(n*n+o*o);this._dollyEnd.set(0,a),this._dollyDelta.set(0,Math.pow(this._dollyEnd.y/this._dollyStart.y,this.zoomSpeed)),this._dollyOut(this._dollyDelta.y),this._dollyStart.copy(this._dollyEnd);const i=(e.pageX+s.x)*.5,r=(e.pageY+s.y)*.5;this._updateZoomParameters(i,r)}_handleTouchMoveDollyPan(e){this.enableZoom&&this._handleTouchMoveDolly(e),this.enablePan&&this._handleTouchMovePan(e)}_handleTouchMoveDollyRotate(e){this.enableZoom&&this._handleTouchMoveDolly(e),this.enableRotate&&this._handleTouchMoveRotate(e)}_addPointer(e){this._pointers.push(e.pointerId)}_removePointer(e){delete this._pointerPositions[e.pointerId];for(let s=0;s<this._pointers.length;s++)if(this._pointers[s]==e.pointerId){this._pointers.splice(s,1);return}}_isTrackingPointer(e){for(let s=0;s<this._pointers.length;s++)if(this._pointers[s]==e.pointerId)return!0;return!1}_trackPointer(e){let s=this._pointerPositions[e.pointerId];s===void 0&&(s=new kt,this._pointerPositions[e.pointerId]=s),s.set(e.pageX,e.pageY)}_getSecondPointerPosition(e){const s=e.pointerId===this._pointers[0]?this._pointers[1]:this._pointers[0];return this._pointerPositions[s]}_customWheelEvent(e){const s=e.deltaMode,n={clientX:e.clientX,clientY:e.clientY,deltaY:e.deltaY};switch(s){case 1:n.deltaY*=16;break;case 2:n.deltaY*=100;break}return e.ctrlKey&&!this._controlActive&&(n.deltaY*=10),n}}function Vm(t){this.enabled!==!1&&(this._pointers.length===0&&(this.domElement.setPointerCapture(t.pointerId),this.domElement.addEventListener("pointermove",this._onPointerMove),this.domElement.addEventListener("pointerup",this._onPointerUp)),!this._isTrackingPointer(t)&&(this._addPointer(t),t.pointerType==="touch"?this._onTouchStart(t):this._onMouseDown(t)))}function Wm(t){this.enabled!==!1&&(t.pointerType==="touch"?this._onTouchMove(t):this._onMouseMove(t))}function Km(t){switch(this._removePointer(t),this._pointers.length){case 0:this.domElement.releasePointerCapture(t.pointerId),this.domElement.removeEventListener("pointermove",this._onPointerMove),this.domElement.removeEventListener("pointerup",this._onPointerUp),this.dispatchEvent(Zl),this.state=Ke.NONE;break;case 1:const e=this._pointers[0],s=this._pointerPositions[e];this._onTouchStart({pointerId:e,pageX:s.x,pageY:s.y});break}}function qm(t){let e;switch(t.button){case 0:e=this.mouseButtons.LEFT;break;case 1:e=this.mouseButtons.MIDDLE;break;case 2:e=this.mouseButtons.RIGHT;break;default:e=-1}switch(e){case nn.DOLLY:if(this.enableZoom===!1)return;this._handleMouseDownDolly(t),this.state=Ke.DOLLY;break;case nn.ROTATE:if(t.ctrlKey||t.metaKey||t.shiftKey){if(this.enablePan===!1)return;this._handleMouseDownPan(t),this.state=Ke.PAN}else{if(this.enableRotate===!1)return;this._handleMouseDownRotate(t),this.state=Ke.ROTATE}break;case nn.PAN:if(t.ctrlKey||t.metaKey||t.shiftKey){if(this.enableRotate===!1)return;this._handleMouseDownRotate(t),this.state=Ke.ROTATE}else{if(this.enablePan===!1)return;this._handleMouseDownPan(t),this.state=Ke.PAN}break;default:this.state=Ke.NONE}this.state!==Ke.NONE&&this.dispatchEvent(oi)}function Xm(t){switch(this.state){case Ke.ROTATE:if(this.enableRotate===!1)return;this._handleMouseMoveRotate(t);break;case Ke.DOLLY:if(this.enableZoom===!1)return;this._handleMouseMoveDolly(t);break;case Ke.PAN:if(this.enablePan===!1)return;this._handleMouseMovePan(t);break}}function Ym(t){this.enabled===!1||this.enableZoom===!1||this.state!==Ke.NONE||(t.preventDefault(),this.dispatchEvent(oi),this._handleMouseWheel(this._customWheelEvent(t)),this.dispatchEvent(Zl))}function Jm(t){this.enabled!==!1&&this._handleKeyDown(t)}function Zm(t){switch(this._trackPointer(t),this._pointers.length){case 1:switch(this.touches.ONE){case sn.ROTATE:if(this.enableRotate===!1)return;this._handleTouchStartRotate(t),this.state=Ke.TOUCH_ROTATE;break;case sn.PAN:if(this.enablePan===!1)return;this._handleTouchStartPan(t),this.state=Ke.TOUCH_PAN;break;default:this.state=Ke.NONE}break;case 2:switch(this.touches.TWO){case sn.DOLLY_PAN:if(this.enableZoom===!1&&this.enablePan===!1)return;this._handleTouchStartDollyPan(t),this.state=Ke.TOUCH_DOLLY_PAN;break;case sn.DOLLY_ROTATE:if(this.enableZoom===!1&&this.enableRotate===!1)return;this._handleTouchStartDollyRotate(t),this.state=Ke.TOUCH_DOLLY_ROTATE;break;default:this.state=Ke.NONE}break;default:this.state=Ke.NONE}this.state!==Ke.NONE&&this.dispatchEvent(oi)}function Qm(t){switch(this._trackPointer(t),this.state){case Ke.TOUCH_ROTATE:if(this.enableRotate===!1)return;this._handleTouchMoveRotate(t),this.update();break;case Ke.TOUCH_PAN:if(this.enablePan===!1)return;this._handleTouchMovePan(t),this.update();break;case Ke.TOUCH_DOLLY_PAN:if(this.enableZoom===!1&&this.enablePan===!1)return;this._handleTouchMoveDollyPan(t),this.update();break;case Ke.TOUCH_DOLLY_ROTATE:if(this.enableZoom===!1&&this.enableRotate===!1)return;this._handleTouchMoveDollyRotate(t),this.update();break;default:this.state=Ke.NONE}}function eg(t){this.enabled!==!1&&t.preventDefault()}function tg(t){t.key==="Control"&&(this._controlActive=!0,this.domElement.getRootNode().addEventListener("keyup",this._interceptControlUp,{passive:!0,capture:!0}))}function sg(t){t.key==="Control"&&(this._controlActive=!1,this.domElement.getRootNode().removeEventListener("keyup",this._interceptControlUp,{passive:!0,capture:!0}))}const ng={class:"startgame-modal"},og={class:"card"},ag={class:"card__header"},ig=["src"],rg={class:"card__body"},lg={class:"card__content"},cg={key:0,class:"loading"},ug={key:1,class:"error"},dg={key:2,class:"list"},fg=["onClick"],pg={class:"item__img"},hg=["src","alt"],mg={class:"item__meta"},gg={class:"item__name"},_g={class:"item__level"},vg={class:"preview"},yg={class:"preview__info"},bg={key:0,class:"preview__empty"},wg={key:1,class:"preview__names"},Sg={class:"preview__name-number"},Mg={class:"preview__name-text"},Tg={class:"card__footer"},xg=["disabled"],Cg=["src"],Eg={__name:"StartGame",props:{musicOn:{type:Boolean,default:!0},paused:{type:Boolean,default:!1}},emits:["confirm","close"],setup(t,{emit:e}){Jt(O=>({aa824e20:q,aa807ca4:fe,aa7b0830:ce,a5e82c30:K,aa7dc26a:he,aa7bf0ee:R,aa816562:Me,aa7cd9ac:Z}));const s=e,n=t,o=H(!0),a=H(""),i=H([]),r=H(new Set),l=H(null),c=H(null),u=G("@assets/frontend_resource/startgame.mp3");let d,h,m,g,x;const S=new Map,_=$e(()=>r.value.size===3),M=$e(()=>i.value.filter(O=>r.value.has(O.id)));function b(){if(!l.value)return;d=new To,d.background=new os(1710618),h=new Fn(45,l.value.clientWidth/l.value.clientHeight,.1,100),h.position.set(0,3,8),m=new xo({antialias:!0}),m.setSize(l.value.clientWidth,l.value.clientHeight),m.setPixelRatio(window.devicePixelRatio),l.value.appendChild(m.domElement),g=new zm(h,m.domElement),g.enableDamping=!0,g.dampingFactor=.05,g.target.set(0,1,0);const O=new Co(16777215,.5);d.add(O);const J=new fs(16777215,1);J.position.set(0,5,10),d.add(J);const Q=new fs(11193599,.4);Q.position.set(-5,3,5),d.add(Q);const Oe=new fs(16764074,.4);Oe.position.set(5,3,5),d.add(Oe);const je=new fs(16777215,.3);je.position.set(0,5,-5),d.add(je);const Ve=new Pn(20,20),Ge=new gt({color:2763306,side:Ft}),et=new st(Ve,Ge);et.rotation.x=-Math.PI/2,et.position.y=0,d.add(et),x=new Bo;const at=new jo;at.setDecoderPath("https://www.gstatic.com/draco/versioned/decoders/1.5.6/"),x.setDRACOLoader(at),w(),window.addEventListener("resize",I)}function w(){requestAnimationFrame(w),g&&g.update(),m&&d&&h&&m.render(d,h)}function I(){!l.value||!h||!m||(h.aspect=l.value.clientWidth/l.value.clientHeight,h.updateProjectionMatrix(),m.setSize(l.value.clientWidth,l.value.clientHeight))}function F(O){const J=r.value;if(J.has(O))J.delete(O);else{if(J.size>=3)return;J.add(O)}r.value=new Set(J)}async function z(O,J){if(!d||!x)return;let Q=O.modelUrl;f(`[StartGame] model_url: ${O.name}, URL: ${Q}`);try{const Oe=await jt.loadModel(Q,!0);f(`[StartGame] : ${O.name}`);const Ve=new Rt().setFromObject(Oe).getSize(new ke),Ge=new es;Ge.add(Oe);const et=2.5,at=-(M.value.length-1)*et/2;Ge.position.set(at+J*et,0,0),Ge.scale.set(1,1,1),Ge.rotation.y=-Math.PI/2;const nt=new Rt().setFromObject(Ge);Ge.position.y=-nt.min.y,d.add(Ge),S.set(O.id,Ge),f(`[StartGame] : ${O.name}`)}catch(Oe){f(`[StartGame] : ${O.name}`,Oe),B(O,J)}}function B(O,J){if(!d)return;const Q=new us(.8,.8,.8),Oe=new gt({color:4491519}),je=new st(Q,Oe),Ve=2.5,Ge=-(M.value.length-1)*Ve/2;je.position.set(Ge+J*Ve,.8,0),je.rotation.y=-Math.PI/2,d.add(je),S.set(O.id,je)}function N(){d&&(S.forEach(O=>{d.remove(O),O.geometry&&O.geometry.dispose(),O.material&&(Array.isArray(O.material)?O.material.forEach(J=>J.dispose()):O.material.dispose())}),S.clear(),M.value.forEach((O,J)=>{z(O,J)}))}async function ie(){o.value=!0,a.value="";try{const O=await lo(),J=Array.isArray(O==null?void 0:O.coppers)?O.coppers:[];i.value=(J||[]).map((Q,Oe)=>{var Ve,Ge,et,at,nt,Ct;const je=(Ve=Q==null?void 0:Q.copper_info)==null?void 0:Ve.model_url;return f(`[StartGame] Copper ${((Ge=Q==null?void 0:Q.copper_info)==null?void 0:Ge.name)||Oe+1}: model_url=${je}`),{id:Number((Q==null?void 0:Q.id)??Oe+1),name:((et=Q==null?void 0:Q.copper_info)==null?void 0:et.name)||`#${Oe+1}`,icon:G(((at=Q==null?void 0:Q.copper_info)==null?void 0:at.icon_url)||""),level:Number((Q==null?void 0:Q.level)??1),copperType:(Q==null?void 0:Q.copper_type)||"Arcanist",modelName:((Ct=(nt=Q==null?void 0:Q.copper_info)==null?void 0:nt.name)==null?void 0:Ct.toLowerCase())||"",modelUrl:je?G(je):""}})}catch(O){f("[StartGame] ",O),a.value=""}finally{o.value=!1}}async function le(){if(r.value.size!==3)return;const O=Array.from(r.value).map(J=>String(J));window.__ACTUAL_COPPER_IDS__=O,f("[StartGame] ID:",O),s("confirm",{ids:O})}function E(){s("close")}Bt(M,()=>{N()},{deep:!0}),Dt(()=>{ie(),setTimeout(()=>{b()},100),n.musicOn&&!n.paused&&c.value&&setTimeout(()=>{if(c.value.readyState>=2)c.value.play().then(()=>{f("[StartGame] ")}).catch(J=>{f("[StartGame] :",J)});else{const J=()=>{c.value.play().then(()=>{f("[StartGame] ")}).catch(Q=>{f("[StartGame] :",Q)}),c.value.removeEventListener("canplay",J)};c.value.addEventListener("canplay",J,{once:!0})}},200)}),Bt(()=>n.musicOn,O=>{if(c.value)if(O&&!n.paused)if(c.value.readyState>=2)c.value.play().catch(J=>{f("[StartGame] :",J)});else{const J=()=>{c.value.play().catch(Q=>{f("[StartGame] :",Q)}),c.value.removeEventListener("canplay",J)};c.value.addEventListener("canplay",J)}else c.value.pause()}),Bt(()=>n.paused,O=>{if(c.value){if(O)c.value.pause(),f("[StartGame] ");else if(n.musicOn){if(c.value.readyState>=2)c.value.play().catch(J=>{f("[StartGame] :",J)});else{const J=()=>{c.value.play().catch(Q=>{f("[StartGame] :",Q)}),c.value.removeEventListener("canplay",J)};c.value.addEventListener("canplay",J)}f("[StartGame] ")}}}),ms(()=>{window.removeEventListener("resize",I),c.value&&c.value.pause(),S.forEach(O=>{d&&d.remove(O)}),S.clear(),m&&m.dispose(),g&&g.dispose()});const q=`url('${G("@assets/ui/panel1.png")}')`,Me=`url('${G("@assets/ui/panel2.png")}')`,fe=`url('${G("@assets/ui/panel3.png")}')`,he=`url('${G("@assets/ui/panel6.png")}')`,Z=`url('${G("@assets/ui/panel7.png")}')`,R=`url('${G("@assets/ui/panel8.png")}')`,ce=`url('${G("@assets/ui/panel9.png")}')`,K=`url('${G("@assets/ui/panel10.png")}')`;return(O,J)=>(D(),U("div",ng,[p("div",og,[p("div",ag,[J[0]||(J[0]=p("div",{class:"card__title"},"",-1)),p("button",{class:"card__close",onClick:E,"aria-label":""},[p("img",{src:de(G)("@assets/ui/close.png"),alt:""},null,8,ig)])]),p("div",rg,[p("div",lg,[o.value?(D(),U("div",cg,"...")):a.value?(D(),U("div",ug,se(a.value),1)):(D(),U("div",dg,[(D(!0),U(Je,null,Yt(i.value,Q=>(D(),U("div",{key:Q.id,class:qe(["item",{"item--selected":r.value.has(Q.id)}]),onClick:Oe=>F(Q.id)},[p("div",pg,[p("img",{src:Q.icon,alt:Q.name},null,8,hg)]),p("div",mg,[p("div",gg,se(Q.name),1),p("div",_g,"Lv. "+se(Q.level),1)])],10,fg))),128))])),J[1]||(J[1]=p("div",{class:"hint"},"3",-1))]),p("div",vg,[J[2]||(J[2]=p("div",{class:"preview__title"},"",-1)),p("div",{ref_key:"previewContainer",ref:l,class:"preview__scene"},null,512),p("div",yg,[M.value.length===0?(D(),U("div",bg,"  ")):(D(),U("div",wg,[(D(!0),U(Je,null,Yt(M.value,(Q,Oe)=>(D(),U("div",{key:Q.id,class:"preview__name"},[p("span",Sg,se(Oe+1),1),p("span",Mg,se(Q.name),1)]))),128))]))])])]),p("div",Tg,[p("button",{class:"btn btn--primary",disabled:!_.value,onClick:le},"  ",8,xg),p("button",{class:"btn",onClick:E},"")])]),p("audio",{ref_key:"audioRef",ref:c,src:de(u),loop:"",preload:"auto"},null,8,Cg)]))}},kg=ft(Eg,[["__scopeId","data-v-5e159611"]]),Ag={:"spark",:"syrup",:"bubble",:"glimmer",:"turner",:"wrench",:"artifex",:"coil",:"drillbit",:"quickhand",:"rocky",:"wesley",:"bell",:"tumble",:"chief",:"gyro",:"tricky",:"pendulum",:"yoyo",:"karin",:"murmur",:"melody",:"clawster",:"diggs",:"hive"},Rg={IronWall:"iron_wall",Arcanist:"arcanist",Mechanic:"mechanic",Resonator:"resonator",CraftsMan:"craftsman"};function $g(t){return Ag[t]||t.toLowerCase()}function Pg(t){return Rg[t]||t.toLowerCase()}const Lg={:"rivet_barrier",:"gear_arrow_tower",:"heart_source_mineral_drill",:"steam_mining_car",:"charging_coil",:"repair_workshop",:"mirro_light_refraction_tower",:"resonance_alarm_bell",:"storm_anvil",:"automatic_loading_gun"};function Ig(t){return Lg[t]||t.toLowerCase().replace(/\s+/g,"_")}function Og(t,e){const s=new Map;function n(c,u,d){if(s.has(c)){const I=s.get(c);I.maxHp=d,o(c,u,d);return}const h=1,m=.1,g=new Pn(h,m),x=new _t({color:4456448,side:Ft,depthTest:!1,depthWrite:!1,transparent:!1,toneMapped:!1}),S=new st(g,x),_=new Pn(h,m),M=new _t({color:a(u,d),side:Ft,depthTest:!1,depthWrite:!1,transparent:!1,toneMapped:!1}),b=new st(_,M);b.position.z=.001;const w=new es;w.add(S),w.add(b),w.renderOrder=999,S.renderOrder=999,b.renderOrder=1e3,t.add(w),s.set(c,{bar:b,background:S,container:w,maxHp:d}),o(c,u,d)}function o(c,u,d){const h=s.get(c);if(!h)return;const{bar:m}=h,g=Math.max(0,Math.min(1,u/d));m.scale.x=g,m.position.x=-(1-g)*.5,m.material.color.setHex(a(u,d))}function a(c,u){const d=c/u;return d>.6?65280:d>.3?16776960:16711680}function i(c){const u=s.get(c);if(!u)return;const{bar:d,background:h,container:m}=u;d.geometry.dispose(),d.material.dispose(),h.geometry.dispose(),h.material.dispose(),t.remove(m),s.delete(c)}function r(c){s.forEach((u,d)=>{const h=c.find(m=>m.id===d);if(h&&h.object){const{container:m}=u,g=h.object.position.clone();g.y+=1.5,m.position.copy(g),m.lookAt(e.position)}})}function l(){s.forEach((c,u)=>{i(u)}),s.clear()}return{healthBars:s,createOrUpdateHealthBar:n,updateHealthBarValue:o,removeHealthBar:i,updateHealthBarsPosition:r,dispose:l}}const Dg={url:G("@assets/ui/skybox.jpg"),radius:1e3,segments:32,hemisphere:!1},Ng={ambient:{color:16777215,intensity:.5},mainDirectional:{color:16777215,intensity:1.2,position:{x:0,y:20,z:5},castShadow:!0},topLight:{color:16777215,intensity:.8,position:{x:0,y:30,z:0}},hemisphere:{skyColor:16777215,groundColor:4473924,intensity:.6,position:{x:0,y:20,z:0}}};function Gg(){return{...Dg}}const Hg={fov:60,near:.1,far:2e3,position:{x:0,y:5,z:10}},Ug={antialias:!0},Fg={decoderPath:"https://www.gstatic.com/draco/versioned/decoders/1.5.6/"},Bg={moveSpeed:.2,rotationSpeed:.003,focusLerpFactor:.08},jg={enabled:!0,units:[{id:1,name:"1",color:4491519,position:{x:.5,y:.4,z:.5},size:.8},{id:2,name:"2",color:16729156,position:{x:4.5,y:.4,z:4.5},size:.8}]},zg={enabled:!0,materialType:"standard",basic:{color:4868682,opacity:.8},standard:{color:5921386,roughness:.3,metalness:.7,opacity:.8},texture:{url:null,repeat:{x:1,y:1}},size:.95,height:.05,yOffset:-.02},Vg={enabled:!1,size:100,materialType:"standard",texture:{url:null,repeat:{x:10,y:10},wrapS:"RepeatWrapping",wrapT:"RepeatWrapping"},color:{value:2763306},standard:{color:3815994,roughness:.8,metalness:.1,normalMap:null,normalScale:{x:1,y:1},roughnessMap:null,aoMap:null},position:{x:0,y:0,z:0},rotation:{x:-Math.PI/2,y:0,z:0}};function Wg(){return{...Ng}}function Kg(){return{...Hg}}function qg(){return{...Ug}}function Xg(){return{...Fg}}function pr(){return{...Bg}}function Yg(){return{...jg}}function Jg(){return{...Vg}}function Ql(){return{...zg}}function Zg(t){const e={move:[],attack:[],summon:[]},s=Ql();function n(d={}){var m;const h={...s,...d};if(!h.enabled)return new _t({transparent:!0,opacity:0});if(h.materialType==="texture"&&h.texture.url){const x=new pn().load(h.texture.url);return x.colorSpace=Tt,x.wrapS=Ms,x.wrapT=Ms,x.repeat.set(h.texture.repeat.x,h.texture.repeat.y),new gt({map:x,side:Ft,transparent:!0,opacity:((m=h.standard)==null?void 0:m.opacity)||1})}else return h.materialType==="standard"?new gt({color:h.standard.color,roughness:h.standard.roughness,metalness:h.standard.metalness,side:Ft,transparent:!0,opacity:h.standard.opacity}):new _t({color:h.basic.color,side:Ft,transparent:!0,opacity:h.basic.opacity})}const o={move:{color:4521796,opacity:.6},attack:{color:16729156,opacity:.6},summon:{color:16776960,opacity:.6}};function a(d,h="move"){const[m,g]=d,x=o[h]||o.move,S=s.size||.9,_=s.height||.08,M=new Pn(S,S),b=new _t({color:x.color,side:Ft,transparent:!0,opacity:x.opacity}),w=new st(M,b);return w.rotation.x=-Math.PI/2,w.position.set(m,_,g),w.userData={position:d,type:h},t.add(w),e[h].push(w),w}function i(d){const[h,m]=d;let g=!1;return Object.keys(e).forEach(x=>{const S=e[x].findIndex(_=>{const M=_.userData.position;return M[0]===h&&M[1]===m});if(S!==-1){const _=e[x][S];t.remove(_),_.geometry.dispose(),_.material.dispose(),e[x].splice(S,1),g=!0}}),g}function r(d){e[d]&&(e[d].forEach(h=>{t.remove(h),h.geometry.dispose(),h.material.dispose()}),e[d]=[])}function l(){Object.keys(e).forEach(d=>{r(d)})}function c(d,h){var x;const[m,g]=d;return(x=e[h])==null?void 0:x.some(S=>{const _=S.userData.position;return _[0]===m&&_[1]===g})}function u(){l()}return{indicators:e,createIndicator:a,createCellMaterial:n,clearIndicatorAt:i,clearIndicators:r,clearAllIndicators:l,hasIndicatorAt:c,dispose:u}}function Qg(){const t={geometries:[],materials:[],meshes:[],maxSize:10},e={geometries:[],materials:[],meshes:[],maxSize:10};function s(r){let l;if(t.meshes.length>0)l=t.meshes.pop(),l.geometry.dispose(),l.geometry=new uo(.05,.05,r,8),l.material.opacity=.9;else{const c=new uo(.05,.05,r,8),u=new _t({color:16729156,transparent:!0,opacity:.9,emissive:16729156,emissiveIntensity:.5});l=new st(c,u)}return l}function n(r){t.meshes.length<t.maxSize?t.meshes.push(r):(r.geometry.dispose(),r.material.dispose())}function o(){let r;if(e.meshes.length>0)r=e.meshes.pop(),r.scale.set(1,1,1),r.material.opacity=.8;else{const l=new _a(.2,.4,32),c=new _t({color:16711680,side:Ft,transparent:!0,opacity:.8,emissive:16711680,emissiveIntensity:.5});r=new st(l,c),r.rotation.x=-Math.PI/2}return r}function a(r){e.meshes.length<e.maxSize?e.meshes.push(r):(r.geometry.dispose(),r.material.dispose())}function i(){t.meshes.forEach(r=>{r.geometry.dispose(),r.material.dispose()}),t.meshes=[],t.geometries=[],t.materials=[],e.meshes.forEach(r=>{r.geometry.dispose(),r.material.dispose()}),e.meshes=[],e.geometries=[],e.materials=[]}return{getAttackRay:s,recycleAttackRay:n,getExplosionRing:o,recycleExplosionRing:a,dispose:i}}function e_(t){const e=Qg();function s(a,i){const r=new ke(a[0],.5,a[1]),l=new ke(i[0],.5,i[1]),c=r.distanceTo(l),u=e.getAttackRay(c),d=new ke().addVectors(r,l).multiplyScalar(.5);u.position.copy(d);const h=new ke().subVectors(l,r).normalize(),m=new fn;m.setFromUnitVectors(new ke(0,1,0),h),u.quaternion.copy(m),t.add(u);let g=.9;const x=()=>{g-=.05,u.material.opacity=g,g<=0?(t.remove(u),e.recycleAttackRay(u)):requestAnimationFrame(x)};setTimeout(x,300);const S=e.getExplosionRing();S.position.set(i[0],.1,i[1]),t.add(S);let _=1,M=.8;const b=()=>{_+=.1,M-=.08,S.scale.set(_,_,1),S.material.opacity=M,M<=0?(t.remove(S),e.recycleExplosionRing(S)):requestAnimationFrame(b)};b()}function n(a,i){const r=Object.entries(i).filter(([w,I])=>I>0).map(([w,I])=>{const F=St(w);return`+${I} ${F}`});if(r.length===0)return;const l=r.join(`
`),c=document.createElement("canvas"),u=c.getContext("2d");c.width=512,c.height=256,u.fillStyle="rgba(0, 0, 0, 0)",u.fillRect(0,0,c.width,c.height),u.font="bold 48px Arial",u.fillStyle="#ffff00",u.strokeStyle="#000000",u.lineWidth=4,u.textAlign="center",u.textBaseline="middle";const d=l.split(`
`),h=60,m=c.height/2-(d.length-1)*h/2;d.forEach((w,I)=>{const F=m+I*h;u.strokeText(w,c.width/2,F),u.fillText(w,c.width/2,F)});const g=new pu(c),x=new hu({map:g,transparent:!0,opacity:1}),S=new mu(x);S.scale.set(2,1,1),S.position.set(a[0],1.5,a[1]),t.add(S);let _=1.5,M=1;const b=()=>{_+=.02,M-=.01,S.position.y=_,S.material.opacity=M,M<=0?(t.remove(S),S.material.map.dispose(),S.material.dispose()):requestAnimationFrame(b)};b()}function o(){e.dispose()}return{createAttackEffect:s,createResourceGainEffect:n,dispose:o}}const t_={gameScene:G("@assets/frontend_resource/gamescene.mp3")},s_={move:G("@assets/frontend_resource/move.mp3"),moveEnemy:G("@assets/frontend_resource/move_enemy.mp3"),attack:G("@assets/frontend_resource/attack.mp3"),attackEnemy:G("@assets/frontend_resource/attack_enemy.mp3"),meHurt:G("@assets/frontend_resource/me_hurt.mp3"),enemyHurt:G("@assets/frontend_resource/enemy_hurt.mp3")};function n_(t){return t_[t]||""}function Zs(t){return s_[t]||""}let ct=null;function o_(t,e,s={}){const{radius:n=1e3,segments:o=32,hemisphere:a=!1}=s;ct&&(t.remove(ct),ct.geometry&&ct.geometry.dispose(),ct.material&&(ct.material.map&&ct.material.map.dispose(),ct.material.dispose()),ct=null),new pn().load(e,r=>{r.colorSpace=Tt;const l=a?new va(n,o,o,0,Math.PI*2,0,Math.PI/2):new va(n,o,o),c=new _t({map:r,side:_u,depthWrite:!1});ct=new st(l,c),ct.position.set(0,0,0),t.add(ct),f(`[SceneUtils] ${a?"":""}${n}`)},void 0,r=>{f("[SceneUtils] ",r),t.background=new os(2236962)})}function a_(t,e){if(!e||!e.url){t.background=new os(2236962);return}o_(t,e.url,{radius:e.radius||1e3,segments:e.segments||32,hemisphere:e.hemisphere||!1})}function i_(t,e){const s=new Co(e.ambient.color,e.ambient.intensity);t.add(s);const n=new fs(e.mainDirectional.color,e.mainDirectional.intensity);n.position.set(e.mainDirectional.position.x,e.mainDirectional.position.y,e.mainDirectional.position.z),n.castShadow=e.mainDirectional.castShadow,t.add(n);const o=new fs(e.topLight.color,e.topLight.intensity);o.position.set(e.topLight.position.x,e.topLight.position.y,e.topLight.position.z),t.add(o);const a=new gu(e.hemisphere.skyColor,e.hemisphere.groundColor,e.hemisphere.intensity);a.position.set(e.hemisphere.position.x,e.hemisphere.position.y,e.hemisphere.position.z),t.add(a)}function r_(t={}){const e={...Kg(),...t},s=window.innerWidth/window.innerHeight,n=new Fn(e.fov,s,e.near,e.far);return n.position.set(e.position.x,e.position.y,e.position.z),n}function l_(t,e={}){const s={...qg(),...e},n=e.width||window.innerWidth,o=e.height||window.innerHeight,a=new xo({antialias:s.antialias});return a.setSize(n,o),a.setPixelRatio(window.devicePixelRatio),t.appendChild(a.domElement),a}function c_(t=null){const e=Xg(),s=t||e.decoderPath,n=new Bo,o=new jo;return o.setDecoderPath(s),n.setDRACOLoader(o),n}function u_(t,e){const s=Yg();s.enabled&&(s.units.forEach(n=>{const o=new us(n.size,n.size,n.size),a=new gt({color:n.color}),i=new st(o,a);i.position.set(n.position.x,n.position.y,n.position.z),t.add(i),e.push({id:n.id,object:i,name:n.name,type:"test"})}),f("[SceneUtils] :",e.map(n=>`ID=${n.id}`)))}function d_(t,e={}){const s={...Jg(),...e};if(!s.enabled)return null;const n=new Pn(s.size,s.size);let o;if(s.materialType==="texture"&&s.texture.url){const r=new pn().load(s.texture.url);r.colorSpace=Tt,r.wrapS=mi[s.texture.wrapS]||Ms,r.wrapT=mi[s.texture.wrapT]||Ms,r.repeat.set(s.texture.repeat.x,s.texture.repeat.y),o=new gt({map:r,side:Ft})}else if(s.materialType==="color")o=new _t({color:s.color.value,side:Ft});else{const i={color:s.standard.color,roughness:s.standard.roughness,metalness:s.standard.metalness,side:Ft},r=new pn;if(s.standard.normalMap){const l=r.load(s.standard.normalMap);l.colorSpace=Tt,i.normalMap=l,i.normalScale=new kt(s.standard.normalScale.x,s.standard.normalScale.y)}if(s.standard.roughnessMap){const l=r.load(s.standard.roughnessMap);l.colorSpace=Tt,i.roughnessMap=l}if(s.standard.aoMap){const l=r.load(s.standard.aoMap);l.colorSpace=Tt,i.aoMap=l}o=new gt(i)}const a=new st(n,o);return a.position.set(s.position.x,s.position.y,s.position.z),a.rotation.set(s.rotation.x,s.rotation.y,s.rotation.z),a.renderOrder=-200,t.add(a),f(`[SceneUtils] ${s.materialType}${s.size}`),a}function f_(t){ct&&t&&(t.remove(ct),ct.geometry&&ct.geometry.dispose(),ct.material&&(ct.material.map&&ct.material.map.dispose(),ct.material.dispose()),ct=null)}const p_={key:0,class:"diamond-name"},h_={class:"diamond-row diamond-row--top"},m_=["title","aria-disabled"],g_={class:"diamond border-orange-red"},__={class:"diamond-content"},v_={class:"diamond-text"},y_={class:"diamond-value"},b_={class:"diamond-row diamond-row--bottom"},w_={class:"diamond border-orange-red"},S_={class:"diamond-content"},M_={class:"diamond-text"},T_={class:"diamond-value"},x_={class:"diamond border-green"},C_={class:"diamond-content"},E_={class:"diamond-text"},k_={class:"diamond-value"},A_={class:"diamond border-blue"},R_={class:"diamond-content"},$_={class:"diamond-text"},P_={class:"diamond-value"},L_={__name:"DiamondPanel",props:{copperInfo:{type:Object,required:!0},inventoryItems:{type:Array,default:()=>[]},inventoryCapacity:{type:Number,default:5}},emits:["inventory-click"],setup(t,{emit:e}){Jt(_=>({v2b14f7a8:h,v6dc22a41:s,v740cabaa:n,v4ea1daaa:o}));const s=`url('${G("ui/border-blue.png")}')`,n=`url('${G("ui/border-green.png")}')`,o=`url('${G("ui/border-orange-red.png")}')`,a=t,i=e,r=$e(()=>{var _;return(((_=a.copperInfo)==null?void 0:_.name)||"").trim()}),l=$e(()=>{var _,M;return((_=a.copperInfo)==null?void 0:_.isOwnedEnemy)===!0||((M=a.copperInfo)==null?void 0:M.isEnemy)===!0}),c=$e(()=>l.value&&r.value!==""),u=$e(()=>{var M;const _=(M=a.copperInfo)==null?void 0:M.position;return!Array.isArray(_)||_.length<2?"--":`${_[0]},${_[1]}`}),d=$e(()=>l.value===!0),h=`url('${G("@assets/ui/panel4.png")}')`,m=H({SpiritalSpark:0,RecallGear:0,ResonantCrystal:0,RefinedCopper:0,HeartCrystalDust:0});async function g(){try{const _=await Fo();_&&Object.keys(m.value).forEach(M=>{m.value[M]=_[M]||0})}catch(_){console.error("[DiamondPanel] :",_)}}$e(()=>Object.values(m.value).filter(_=>_>0).length);function x(){d.value||i("inventory-click")}const S=H(null);return Dt(async()=>{if(g(),Uo(Ht.UPDATE_RESOURCES,g),!S.value)return;function _(b){return new Promise((w,I)=>{const F=new Image;F.onload=()=>w(F),F.onerror=()=>I(),F.src=b})}function M(b,w){S.value&&S.value.style.setProperty(b,String(w))}try{const[b,w,I]=await Promise.all([_(G("ui/border-blue.png")),_(G("ui/border-green.png")),_(G("ui/border-orange-red.png"))]),F=Math.max(3,Math.round(b.naturalHeight/4)),z=Math.max(3,Math.round(w.naturalHeight/4)),B=Math.max(3,Math.round(I.naturalHeight/4));M("--border-blue-slice",F),M("--border-green-slice",z),M("--border-orange-red-slice",B)}catch{M("--border-blue-slice","8"),M("--border-green-slice","8"),M("--border-orange-red-slice","8")}}),(_,M)=>(D(),U("div",{ref_key:"diamondPanelRef",ref:S,class:"diamond-panel"},[c.value?(D(),U("div",p_,se(r.value),1)):Se("",!0),p("div",h_,[p("div",{class:qe(["diamond","border-blue",{"diamond--disabled":d.value}]),onClick:x,title:d.value?"":"","aria-disabled":d.value?"true":"false"},[...M[0]||(M[0]=[p("div",{class:"diamond-content"},[p("div",{class:"diamond-text"},[p("div",{class:"diamond-label"},"")])],-1)])],10,m_),p("div",g_,[p("div",__,[p("div",v_,[M[1]||(M[1]=p("div",{class:"diamond-label"},"",-1)),p("div",y_,se(u.value),1)])])])]),p("div",b_,[p("div",w_,[p("div",S_,[p("div",M_,[M[2]||(M[2]=p("div",{class:"diamond-label"},"",-1)),p("div",T_,se(t.copperInfo.attack),1)])])]),p("div",x_,[p("div",C_,[p("div",E_,[M[3]||(M[3]=p("div",{class:"diamond-label"},"",-1)),p("div",k_,se(t.copperInfo.defense),1)])])]),p("div",A_,[p("div",R_,[p("div",$_,[M[4]||(M[4]=p("div",{class:"diamond-label"},"",-1)),p("div",P_,se(t.copperInfo.speed),1)])])])])],512))}},I_=ft(L_,[["__scopeId","data-v-94197fa6"]]),O_={class:"minecraft-inventory"},D_={class:"inventory-layout"},N_={class:"inventory-section"},G_={class:"equipment-header-mc"},H_={class:"copper-name"},U_={class:"inventory-grid"},F_={class:"slot-icon"},B_=["src","alt"],j_=["src"],z_=["src"],V_={key:3,class:"equipment-icon"},W_={class:"slot-tooltip"},K_={class:"tooltip-name"},q_={__name:"InventoryModal",props:{visible:{type:Boolean,default:!1},copperName:{type:String,default:""},equipment:{type:Array,default:()=>[]}},emits:["close"],setup(t,{emit:e}){const s=t,n=$e(()=>s.equipment||[]),o=e;function a(){o("close")}return(i,r)=>t.visible?(D(),U("div",{key:0,class:"inventory-modal",onClick:Lt(a,["self"])},[p("div",O_,[p("div",D_,[p("div",N_,[p("div",G_,[p("h4",null,[p("span",H_,se(t.copperName),1),r[0]||(r[0]=Ds("  ",-1))])]),p("div",U_,[(D(),U(Je,null,Yt(2,(l,c)=>{var u,d,h,m,g,x,S,_,M,b;return p("div",{key:c,class:qe(["inv-slot",{"has-item":c<n.value.length&&((u=n.value[c])==null?void 0:u.equipped),"slot-locked":(d=n.value[c])==null?void 0:d.locked}])},[c<n.value.length?(D(),U(Je,{key:0},[p("div",F_,[(h=n.value[c])!=null&&h.equipped&&((m=n.value[c])!=null&&m.icon)&&n.value[c].icon!==""&&(n.value[c].icon.startsWith("/")||n.value[c].icon.startsWith("http")||n.value[c].icon.includes("."))?(D(),U("img",{key:0,src:n.value[c].icon,alt:((g=n.value[c])==null?void 0:g.name)||"",class:"equipment-icon"},null,8,B_)):(x=n.value[c])!=null&&x.locked?(D(),U("img",{key:1,src:de(G)("@assets/ui/lock.png"),alt:"",class:"equipment-icon"},null,8,j_)):((S=n.value[c])==null?void 0:S.icon)===""?(D(),U("img",{key:2,src:de(G)("@assets/ui/jia.png"),alt:"",class:"equipment-icon"},null,8,z_)):(D(),U("span",V_,se(((_=n.value[c])==null?void 0:_.icon)||""),1))]),p("div",W_,[p("div",K_,se(((M=n.value[c])==null?void 0:M.name)||((b=n.value[c])!=null&&b.locked?"":"")),1)])],64)):Se("",!0)],2)}),64))])])])])])):Se("",!0)}},X_=ft(q_,[["__scopeId","data-v-87970a7f"]]),Y_={class:"health-bar","aria-label":"Health Bar"},J_={class:"health-bar__border"},Z_={class:"health-bar__border-left"},Q_=["src"],ev={class:"health-bar__border-right"},tv=["src"],sv={class:"health-bar__text"},nv={__name:"HealthBar",props:{hp:{type:Number,default:0},maxHp:{type:Number,default:100}},setup(t){Jt(l=>({v3bf30af6:o,v3ceb41be:a}));const e=t,s=G("ui/blood-border-left.png"),n=G("ui/blood-border-right.png"),o=`url('${G("ui/blood-border-middle.png")}')`,a=`url('${G("ui/blood-bar.png")}')`,i=$e(()=>{if(!e.maxHp||e.maxHp===0)return 0;const c=Math.max(0,Math.min(e.hp,e.maxHp))/e.maxHp*100;return Math.max(0,Math.min(100,c))}),r=$e(()=>{const l=Math.max(0,Math.min(e.hp,e.maxHp)),c=e.maxHp||100;return`${Math.round(l)}/${Math.round(c)}`});return(l,c)=>(D(),U("div",Y_,[p("div",J_,[p("div",Z_,[p("img",{src:de(s),alt:""},null,8,Q_)]),c[0]||(c[0]=p("div",{class:"health-bar__border-middle"},null,-1)),p("div",ev,[p("img",{src:de(n),alt:""},null,8,tv)]),p("div",{class:"health-bar__fill",style:Ut({width:`calc(${i.value}% + 20px)`})},null,4),p("div",sv,se(r.value),1)])]))}},ov=ft(nv,[["__scopeId","data-v-7b5f9ec2"]]),av={class:"tri-panel"},iv={class:"diamond","aria-label":""},rv=["src"],lv=["src"],cv=["title"],uv=["src"],dv=["src"],fv=["title"],pv=["src"],hv=["src","alt"],mv={__name:"TriPanel",props:{copperType:{type:String,default:""},canMove:{type:Boolean,default:!0},canAttack:{type:Boolean,default:!0},canSummon:{type:Boolean,default:!1}},emits:["move","wait","attack","summon","build"],setup(t,{emit:e}){const s=t,n=e,o=$e(()=>s.copperType==="CraftsMan"?"build":s.copperType==="Resonator"?"summon":"attack"),a=$e(()=>o.value==="build"?s.canSummon?"":"":o.value==="summon"?s.canSummon?"":"":s.canAttack?"":""),i=$e(()=>o.value==="build"||o.value==="summon"?!s.canSummon:!s.canAttack),r=G("ui/your-image.png"),l=G("ui/boot.png"),c=G("ui/mushroom.png"),u=G("ui/sword.png"),d=G("@assets/ui/summon.png"),h=G("@assets/ui/build.png");function m(){s.canMove&&n("move")}function g(){n("wait")}function x(){if(o.value==="build"){if(!s.canSummon)return;n("build")}else if(o.value==="summon"){if(!s.canSummon)return;n("summon")}else{if(!s.canAttack)return;n("attack")}}return(S,_)=>(D(),U("div",av,[p("div",iv,[p("div",{class:"hex top",title:"",onClick:g},[p("img",{class:"hex-bg",src:de(r),alt:""},null,8,rv),p("img",{class:"hex-icon",src:de(l),alt:""},null,8,lv)]),p("div",{class:qe(["hex left",{"is-locked":t.canMove===!1}]),title:t.canMove?"":"",onClick:m},[p("img",{class:"hex-bg",src:de(r),alt:""},null,8,uv),p("img",{class:"hex-icon",src:de(c),alt:""},null,8,dv)],10,cv),p("div",{class:qe(["hex right",{"is-locked":i.value}]),title:a.value,onClick:x},[p("img",{class:"hex-bg",src:de(r),alt:""},null,8,pv),p("img",{class:"hex-icon",src:o.value==="build"?de(h):o.value==="summon"?de(d):de(u),alt:o.value==="build"?"":o.value==="summon"?"":""},null,8,hv)],10,fv)])]))}},gv=ft(mv,[["__scopeId","data-v-38a09e87"]]),_v={class:"modal-header"},vv=["src"],yv={class:"modal-info"},bv={class:"info-text"},wv={class:"copper-name"},Sv={class:"modal-body"},Mv={class:"structure-list"},Tv=["onClick"],xv={class:"structure-header"},Cv={class:"structure-name-row"},Ev={class:"structure-name"},kv={class:"structure-type"},Av={class:"structure-stats"},Rv={class:"stat"},$v={class:"stat-value"},Pv={class:"stat"},Lv={class:"stat-value"},Iv={class:"stat"},Ov={class:"stat-value"},Dv={class:"stat"},Nv={class:"stat-value"},Gv={class:"structure-cost"},Hv={class:"cost-value"},Uv={class:"structure-desc"},Fv={key:0,class:"selected-badge"},Bv={class:"modal-footer"},jv=["disabled"],zv={__name:"BuildModal",props:{visible:{type:Boolean,default:!1},copperName:{type:String,default:""},structureList:{type:Array,default:()=>[]},position:{type:Array,default:null}},emits:["close","build"],setup(t,{emit:e}){Jt(S=>({b71f15e0:d,v26ebd2fa:g,v26e918c0:m,v26ea017e:h,b71e2d22:x}));const s=t,n=e,o=H(null),a=$e(()=>[...s.structureList].sort((S,_)=>{const M=b=>{var I;const w=((I=b.cost)==null?void 0:I.cost)||b.cost;return!Array.isArray(w)||w.length===0?0:Array.isArray(w[0])?w[0][1]:w[0].count};return M(S)-M(_)}));function i(S){o.value=S}function r(){if(!o.value){f("[BuildModal] ");return}f("[BuildModal] :",o.value.name),n("build",o.value.name),l()}function l(){o.value=null,n("close")}function c(S){return{:"",:"",:"",:""}[S]||""}function u(S){if(!S)return"";const _=S.cost||S;return!Array.isArray(_)||_.length===0?"":_.map(M=>{var b;if(Array.isArray(M)){const w=M[0],I=M[1];return`${((b=ts[w])==null?void 0:b.name)||w} x${I}`}return`${ti(M)} x${M.count}`}).join(", ")}const d=`url('${G("@assets/ui/panel11.png")}')`,h=`url('${G("@assets/ui/panel7.png")}')`,m=`url('${G("@assets/ui/panel8.png")}')`,g=`url('${G("@assets/ui/panel5.png")}')`,x=`url('${G("@assets/ui/panel12.png")}')`;return(S,_)=>(D(),Pt(ll,{to:"body"},[t.visible?(D(),U("div",{key:0,class:"modal-overlay",onClick:Lt(l,["self"])},[p("div",{class:"build-modal",onClick:_[0]||(_[0]=Lt(()=>{},["stop"]))},[p("div",_v,[_[1]||(_[1]=p("h2",{class:"modal-title"}," ",-1)),p("button",{class:"close-btn",onClick:l,title:""},[p("img",{src:de(G)("@assets/ui/close.png"),alt:""},null,8,vv)])]),p("div",yv,[p("p",bv,[p("span",wv,se(t.copperName),1),_[2]||(_[2]=Ds("  ",-1))]),_[3]||(_[3]=p("p",{class:"tip-text"},"   ",-1))]),p("div",Sv,[p("div",Mv,[(D(!0),U(Je,null,Yt(a.value,M=>{var b,w,I;return D(),U("div",{key:M.name,class:qe(["structure-card",{selected:((b=o.value)==null?void 0:b.name)===M.name}]),onClick:F=>i(M)},[p("div",xv,[p("div",Cv,[p("span",Ev,se(M.name),1)]),p("span",kv,se(c(M.name)),1)]),p("div",Av,[p("div",Rv,[_[4]||(_[4]=p("span",{class:"stat-label"},"",-1)),p("span",$v,se(M.health),1)]),p("div",Pv,[_[5]||(_[5]=p("span",{class:"stat-label"},"",-1)),p("span",Lv,se(((w=M.attribute)==null?void 0:w.attack)||""),1)]),p("div",Iv,[_[6]||(_[6]=p("span",{class:"stat-label"},"",-1)),p("span",Ov,se(M.has_storage?"":""),1)]),p("div",Dv,[_[7]||(_[7]=p("span",{class:"stat-label"},"",-1)),p("span",Nv,se(M.attack_range||""),1)])]),p("div",Gv,[_[8]||(_[8]=p("span",{class:"cost-label"}," ",-1)),p("span",Hv,se(u(M.cost)),1)]),p("div",Uv,se(M.description),1),((I=o.value)==null?void 0:I.name)===M.name?(D(),U("div",Fv,"  ")):Se("",!0)],10,Tv)}),128))])]),p("div",Bv,[p("button",{class:"btn btn-cancel",onClick:l},""),p("button",{class:"btn btn-confirm",disabled:!o.value,onClick:r},"  ",8,jv)])])])):Se("",!0)]))}},Vv=ft(zv,[["__scopeId","data-v-96b14c10"]]),Wv={key:0,class:"copper-panel-parent"},Kv={key:0,class:"minimized-content"},qv=["src"],Xv={class:"minimized-info"},Yv={class:"minimized-name"},Jv={class:"minimized-action"},Zv=["src"],Qv={class:"panel-content"},ey={key:0,class:"resources"},ty={class:"resources-list"},sy=["onClick"],ny={class:"resource-name"},oy={class:"resource-count"},ay={key:2,class:"enemy-info-tip"},iy={__name:"ActionPanel",props:{copper:{type:Object,default:null},resources:{type:Array,default:()=>[]},hasAttackTargets:{type:Boolean,default:!0},onSelectCopper:{type:Function,default:null}},emits:["close","action","selectCopper"],setup(t,{expose:e,emit:s}){Jt(K=>({a4d8c7e2:a.value,e0fd0632:i.value,v58bba3fc:r.value,v1ac48a75:l.value,v27e0a61e:u.value,v0e219880:c.value}));const n=t,o=s,a=$e(()=>`url('${G("ui/sword.png")}')`),i=$e(()=>`url('${G("ui/red.png")}')`),r=$e(()=>`url('${G("ui/boot.png")}')`),l=$e(()=>`url('${G("ui/green.png")}')`),c=$e(()=>`url('${G("@assets/ui/build.png")}')`),u=$e(()=>`url('${G("@assets/ui/summon.png")}')`),d=G("@assets/ui/close.png"),h=H("full"),m=H(null),g=H(!1),x=H(!1),S=H([]),_=$e(()=>{var O,J,Q,Oe,je,Ve,Ge,et,at,nt,Ct,y,T,P,Y,j,V,ae,ne,$,X,pe,re,me,_e,ge,He,Pe,Xe,ut,lt,vt,Ue,tt,ue;if(!n.copper)return null;const K=((J=(O=n.copper.copper)==null?void 0:O.copper_info)==null?void 0:J.name)||((Oe=(Q=n.copper.enemy)==null?void 0:Q.enemy_base)==null?void 0:Oe.name)||((je=n.copper.enemy_base)==null?void 0:je.name)||n.copper.name||` #${n.copper.id}`;return{id:n.copper.id,name:K,level:((Ve=n.copper.copper)==null?void 0:Ve.level)??((Ge=n.copper.enemy)==null?void 0:Ge.level)??((et=n.copper.enemy_base)==null?void 0:et.level)??1,hp:n.copper.now_health,maxHp:((nt=(at=n.copper.copper)==null?void 0:at.attribute)==null?void 0:nt.health)??((y=(Ct=n.copper.enemy)==null?void 0:Ct.enemy_base)==null?void 0:y.health)??((T=n.copper.enemy_base)==null?void 0:T.health)??100,attack:((Y=(P=n.copper.copper)==null?void 0:P.attribute)==null?void 0:Y.attack)??((V=(j=n.copper.enemy)==null?void 0:j.enemy_base)==null?void 0:V.attack)??((ae=n.copper.enemy_base)==null?void 0:ae.attack)??0,defense:(($=(ne=n.copper.copper)==null?void 0:ne.attribute)==null?void 0:$.defense)??((pe=(X=n.copper.enemy)==null?void 0:X.enemy_base)==null?void 0:pe.defense)??((re=n.copper.enemy_base)==null?void 0:re.defense)??0,speed:((_e=(me=n.copper.copper)==null?void 0:me.attribute)==null?void 0:_e.speed)??((He=(ge=n.copper.enemy)==null?void 0:ge.enemy_base)==null?void 0:He.speed)??((Pe=n.copper.enemy_base)==null?void 0:Pe.speed)??0,canMove:n.copper.can_move,canAttack:n.copper.can_attack,canSummon:n.copper.can_summon,position:Array.isArray(n.copper.position)&&n.copper.position.length>=2?n.copper.position:Array.isArray((Xe=n.copper.enemy)==null?void 0:Xe.position)&&n.copper.enemy.position.length>=2?n.copper.enemy.position:Array.isArray((ut=n.copper.enemy_base)==null?void 0:ut.position)&&n.copper.enemy_base.position.length>=2?n.copper.enemy_base.position:[0,0],inventoryCapacity:((lt=n.copper.inventory)==null?void 0:lt.capacity)||0,copperType:((vt=n.copper.copper)==null?void 0:vt.copper_type)||((tt=(Ue=n.copper.enemy)==null?void 0:Ue.enemy_base)==null?void 0:tt.enemy_type)||((ue=n.copper.enemy_base)==null?void 0:ue.enemy_type)||"",isOwnedEnemy:n.copper.isOwnedEnemy===!0,isEnemy:n.copper.isEnemy===!0}}),M=$e(()=>{var Q,Oe,je,Ve,Ge;if(!n.copper)return[];const K=((Q=n.copper.copper)==null?void 0:Q.equipment_slot)||{},O=(K==null?void 0:K.slot1)||null,J=(K==null?void 0:K.slot2)||null;return[O?{name:((Oe=O.equipment_base)==null?void 0:Oe.name)||"",icon:G(((je=O.equipment_base)==null?void 0:je.resource_url)||""),equipped:!0,locked:!1}:{name:"",icon:"",equipped:!1,locked:!1},K!=null&&K.is_slot2_locked?{name:"",icon:"",equipped:!1,locked:!0}:J?{name:((Ve=J.equipment_base)==null?void 0:Ve.name)||"",icon:G(((Ge=J.equipment_base)==null?void 0:Ge.resource_url)||""),equipped:!0,locked:!1}:{name:"",icon:"",equipped:!1,locked:!1}]});Bt(()=>{var K;return(K=n.copper)==null?void 0:K.id},(K,O)=>{K!==O&&(h.value="full",m.value=null,g.value=!1,x.value=!1)});async function b(){if(!_.value.canMove)return;f("[ActionPanel] ");const K=n.copper.isOwnedEnemy===!0,O=K?"on_enemy_move_start":"on_move_start";f(`[ActionPanel] : ${K?"":""}, : ${O}`);const J=JSON.stringify({type:O,content:{id:String(_.value.id)}});await Ee(J),h.value="minimized",m.value="moving",o("action",{type:"moveStart",copperId:_.value.id})}async function w(){if(f("[ActionPanel] ",{canAttack:_.value.canAttack,copperId:_.value.id,name:_.value.name}),!_.value.canAttack){f("[ActionPanel] : ");return}f("[ActionPanel] ");const K=n.copper.isOwnedEnemy===!0,O=K?"on_enemy_attack_start":"on_attack_start";f(`[ActionPanel] : ${K?"":""}, : ${O}`);const J=JSON.stringify({type:O,content:{id:String(_.value.id)}});await Ee(J),h.value="minimized",m.value="attacking",o("action",{type:"attackStart",copperId:_.value.id})}async function I(){if(f("[ActionPanel] ",{canSummon:_.value.canSummon,copperId:_.value.id,name:_.value.name}),!_.value.canSummon){f("[ActionPanel] : ");return}f("[ActionPanel] ");const K=JSON.stringify({type:"on_summon_start",content:{id:String(_.value.id)}});await Ee(K),h.value="minimized",m.value="summoning",o("action",{type:"summonStart",copperId:_.value.id})}async function F(){if(f("[ActionPanel] ",{copperId:_.value.id,name:_.value.name}),!_.value.canSummon){f("[ActionPanel] : /");return}o("action",{type:"buildRequest",copperId:_.value.id})}function z(K){f("[ActionPanel] ",(K==null?void 0:K.length)||0,""),S.value=K||[],x.value=!0}async function B(K){f("[ActionPanel] :",K),x.value=!1;const O=JSON.stringify({type:"on_structure_build_start",content:{id:String(_.value.id),name:K}});await Ee(O),h.value="minimized",m.value="building",o("action",{type:"buildStart",copperId:_.value.id,structureName:K})}function N(){f("[ActionPanel] "),g.value=!0}async function ie(K){f(`[ActionPanel] : index=${K}`);const O=JSON.stringify({type:"on_copper_pick_up",content:{id:String(_.value.id),index:String(K)}});await Ee(O),await q()}async function le(){f("[ActionPanel] ");const K=JSON.stringify({type:"on_copper_craft",content:{id:String(_.value.id)}});await Ee(K),await q()}async function E(){await le()}async function q(){const O=n.copper.isOwnedEnemy===!0?"on_click_enemy":"on_click_copper",J=JSON.stringify({type:O,content:{id:String(_.value.id)}});await Ee(J)}function Me(){f("[ActionPanel] "),o("action",{type:"wait",copperId:_.value.id})}function fe(){h.value="full",m.value=null,g.value=!1,o("close")}function he(){g.value=!1}function Z(){h.value="full",m.value=null,o("action",{type:"cancel",copperId:_.value.id})}function R(){Z(),fe()}async function ce(K){n.onSelectCopper?await n.onSelectCopper(K):o("selectCopper",K)}return e({cancelAction:Z,handleSelectCopper:ce,showBuildMenu:z}),(K,O)=>{var J,Q,Oe,je,Ve,Ge,et,at;return D(),U(Je,null,[t.copper?(D(),U("div",Wv,[ot(I_,{"copper-info":_.value,"inventory-items":[],"inventory-capacity":5,onInventoryClick:N},null,8,["copper-info"]),ot(ov,{hp:((J=_.value)==null?void 0:J.hp)||0,"max-hp":((Q=_.value)==null?void 0:Q.maxHp)||100},null,8,["hp","max-hp"]),h.value==="minimized"||t.resources&&t.resources.length>0&&h.value==="full"?(D(),U("div",{key:0,class:qe(["copper-panel",{"copper-panel--minimized":h.value==="minimized","copper-panel--min-attack":h.value==="minimized"&&m.value==="attacking","copper-panel--min-move":h.value==="minimized"&&m.value==="moving","copper-panel--min-summon":h.value==="minimized"&&m.value==="summoning","copper-panel--min-build":h.value==="minimized"&&m.value==="building"}]),onClick:O[0]||(O[0]=Lt(()=>{},["stop"]))},[h.value==="minimized"?(D(),U("div",Kv,[p("button",{class:"minimized-close",type:"button",onClick:R,title:""},[p("img",{src:de(d),alt:""},null,8,qv)]),p("div",Xv,[p("span",Yv,se(_.value.name),1),p("span",Jv,se(m.value==="moving"?"...":m.value==="attacking"?"...":m.value==="summoning"?"...":m.value==="building"?"...":""),1)])])):(D(),U(Je,{key:1},[p("button",{class:"close-btn",onClick:fe,title:""},[p("img",{src:de(d),alt:""},null,8,Zv)]),p("div",Qv,[t.resources&&t.resources.length>0?(D(),U("div",ey,[O[3]||(O[3]=p("div",{class:"resources-header"}," ",-1)),p("div",ty,[(D(!0),U(Je,null,Yt(t.resources,(nt,Ct)=>(D(),U("div",{key:Ct,class:"resource-item",onClick:y=>ie(Ct),title:""},[p("span",ny,se(de(ti)(nt)),1),p("span",oy,"x"+se(nt.count||1),1),O[2]||(O[2]=p("span",{class:"resource-pickup"},"",-1))],8,sy))),128))])])):Se("",!0)])],64))],2)):Se("",!0),n.copper.isEnemy?Se("",!0):(D(),Pt(gv,{key:1,"copper-type":(Oe=_.value)==null?void 0:Oe.copperType,"can-move":((je=_.value)==null?void 0:je.canMove)!==!1,"can-attack":((Ve=_.value)==null?void 0:Ve.canAttack)!==!1,"can-summon":((Ge=_.value)==null?void 0:Ge.canSummon)!==!1,onMove:b,onWait:Me,onAttack:w,onSummon:I,onBuild:F},null,8,["copper-type","can-move","can-attack","can-summon"])),n.copper.isEnemy?(D(),U("div",ay,[...O[4]||(O[4]=[p("span",null," ",-1)])])):Se("",!0)])):Se("",!0),ot(X_,{visible:g.value,"copper-name":((et=_.value)==null?void 0:et.name)||"",equipment:M.value,onClose:he,onCraft:E},null,8,["visible","copper-name","equipment"]),ot(Vv,{visible:x.value,"copper-name":((at=_.value)==null?void 0:at.name)||"","structure-list":S.value,onClose:O[1]||(O[1]=nt=>x.value=!1),onBuild:B},null,8,["visible","copper-name","structure-list"])],64)}}},ry=ft(iy,[["__scopeId","data-v-3fc53dbe"]]),ly={class:"panel"},cy={class:"panel-inner"},uy={class:"section section-header"},dy=["aria-label"],fy={class:"section section-body"},py={class:"current-doll",role:"status","aria-live":"polite"},hy={key:0},my={class:"section section-choices",role:"group","aria-label":"Character Queue"},gy=["aria-pressed","data-copper-id","title","onClick"],_y=["alt","src","data-default-src","data-selected-src"],vy={class:"actions"},yy=["disabled"],by=["disabled"],wy={__name:"TurnSystem",props:{currentCopperId:{type:Number,default:null},copperList:{type:Array,default:()=>[]},roundNumber:{type:Number,default:1},isEnemyMoving:{type:Boolean,default:!1}},emits:["nextCopper","endRound","selectCopper"],setup(t,{emit:e}){Jt(M=>({v47a453cf:r,v1e3f2614:c,c03019fe:l,v4742a9d0:u,v0776a3a9:d,v9cd100b8:h,baf36480:m}));const s=t,n=e,o=H(null),a=G("ui/choice.png"),i=G("ui/choice-active.png"),r=`url('${G("ui/ribbon-left.png")}')`,l=`url('${G("ui/ribbon-middle.png")}')`,c=`url('${G("ui/ribbon-right.png")}')`,u=`url('${G("ui/panel.png")}')`,d=`url('${G("ui/round1.png")}')`,h=`url('${G("ui/currentcupper.png")}')`,m=`url('${G("ui/btn.png")}')`,g=$e(()=>{if(!s.currentCopperId)return null;const M=s.copperList.find(b=>b.id===s.currentCopperId);return M?{id:M.id,name:M.name||` #${M.id}`,level:M.level??0,isSummon:M.type==="summon"}:null});function x(){n("nextCopper")}async function S(){const M=JSON.stringify({type:"on_game_round_pass"});await Ee(M),n("endRound")}function _(M){n("selectCopper",M)}return Dt(async()=>{if(!o.value)return;function M(w){return new Promise((I,F)=>{const z=new Image;z.onload=()=>I(z),z.onerror=B=>{f(":",w,B),F(B)},z.src=w})}function b(w,I){o.value&&(o.value.style.setProperty(w,String(I)),f(` CSS  ${w} = ${I}`))}try{const[w,I,F]=await Promise.all([M(G("ui/panel.png")),M(G("ui/btn.png")),M(G("ui/currentcupper.png"))]),z=Math.max(4,Math.round(w.naturalHeight/4)),B=Math.max(3,Math.round(I.naturalHeight/3)),N=Math.max(3,Math.round(F.naturalHeight/4));f(":",{panelSlice:z,btnSlice:B,currentSlice:N,currentImgSize:`${F.naturalWidth}x${F.naturalHeight}`}),b("--panel-slice",z),b("--btn-slice",B),b("--current-slice",N),setTimeout(()=>{const ie=getComputedStyle(o.value);f("CSS :",{"--current-slice":ie.getPropertyValue("--current-slice"),"--panel-slice":ie.getPropertyValue("--panel-slice"),"--btn-slice":ie.getPropertyValue("--btn-slice")})},100)}catch(w){f(":",w),b("--panel-slice","8"),b("--btn-slice","11"),b("--current-slice","8")}}),(M,b)=>(D(),U("div",{ref_key:"turnSystemRef",ref:o,class:"turn-system"},[b[0]||(b[0]=p("div",{class:"ribbon","aria-hidden":"true"},[p("div",{class:"ribbon-cap left"}),p("div",{class:"ribbon-fill"},"CONTROL"),p("div",{class:"ribbon-cap right"})],-1)),p("div",ly,[p("div",cy,[p("section",uy,[p("div",{class:"round-header",role:"img","aria-label":`Round ${t.roundNumber}`}," Round "+se(t.roundNumber),9,dy)]),p("section",fy,[p("div",py,[p("span",null,se(g.value?`${g.value.name||` #${t.currentCopperId}`}`:""),1),g.value&&!g.value.isSummon?(D(),U("span",hy," Lv."+se(g.value.level??0)+" ",1)):Se("",!0)])]),p("section",my,[(D(!0),U(Je,null,Yt(t.copperList,w=>(D(),U("button",{key:w.id,class:"choice",type:"button","aria-pressed":String(w.id===t.currentCopperId),"data-copper-id":w.id,title:w.name||` #${w.id}`,onClick:I=>_(w.id)},[p("img",{alt:w.name||`Character ${w.id}`,src:w.id===t.currentCopperId?de(i):de(a),"data-default-src":de(a),"data-selected-src":de(i)},null,8,_y)],8,gy))),128))])])]),p("div",vy,[p("button",{class:"btn btn-primary",onClick:x,disabled:!t.currentCopperId||t.isEnemyMoving},"  ",8,yy),p("button",{class:"btn btn-secondary",onClick:S,disabled:t.isEnemyMoving},"  ",8,by)])],512))}},Sy=ft(wy,[["__scopeId","data-v-a62c4b3a"]]),My={class:"modal-info"},Ty={class:"info-text"},xy={class:"copper-name"},Cy={class:"cost-text"},Ey=["src"],ky={class:"modal-body"},Ay={class:"enemy-list"},Ry=["onClick"],$y={class:"enemy-header"},Py={class:"enemy-name-row"},Ly={class:"enemy-name"},Iy={class:"enemy-level"},Oy={class:"enemy-type"},Dy={class:"enemy-stats"},Ny={class:"stat"},Gy={class:"stat-value"},Hy={class:"stat"},Uy={class:"stat-value"},Fy={class:"stat"},By={class:"stat-value"},jy={class:"stat"},zy={class:"stat-value"},Vy={class:"stat"},Wy={class:"stat-value"},Ky={class:"enemy-desc"},qy={key:0,class:"selected-badge"},Xy={class:"modal-footer"},Yy=["disabled"],Jy={__name:"SummonModal",props:{visible:{type:Boolean,default:!1},copperName:{type:String,default:""},enemyList:{type:Array,default:()=>[]},position:{type:Array,default:null}},emits:["close","summon"],setup(t,{emit:e}){Jt(d=>({v94d47748:s}));const s=`url('${G("@assets/ui/panel6.png")}')`,n=t,o=e,a=H(null),i=$e(()=>[...n.enemyList].sort((d,h)=>d.level-h.level));function r(d){a.value=d}function l(){if(!a.value){f("[SummonModal] ");return}f("[SummonModal] :",a.value.name),o("summon",a.value.name),c()}function c(){a.value=null,o("close")}function u(d){return{goblin:"",cruiser:"",scout:"",boxer:"",horn:"",assassin:"",devourer:"",mirror:"",guard:"",demon:"",variant:"",shatra:"BOSS",glutton:"BOSS"}[d]||d}return(d,h)=>(D(),Pt(ll,{to:"body"},[t.visible?(D(),U("div",{key:0,class:"modal-overlay",onClick:Lt(c,["self"])},[p("div",{class:"summon-modal",onClick:h[0]||(h[0]=Lt(()=>{},["stop"]))},[p("div",{class:"modal-header"},[h[1]||(h[1]=p("h2",{class:"modal-title"}," ",-1)),p("button",{class:"close-btn",onClick:c,title:""},"")]),p("div",My,[p("p",Ty,[p("span",xy,se(t.copperName),1),h[2]||(h[2]=Ds("  ",-1))]),p("p",Cy,[p("img",{class:"cost-icon",src:de(G)("resource/spiritual_spark.png"),alt:""},null,8,Ey),h[3]||(h[3]=Ds(" ",-1)),h[4]||(h[4]=p("strong",null,"1 ",-1))])]),p("div",ky,[p("div",Ay,[(D(!0),U(Je,null,Yt(i.value,m=>{var g,x;return D(),U("div",{key:m.name,class:qe(["enemy-card",{selected:((g=a.value)==null?void 0:g.name)===m.name}]),onClick:S=>r(m)},[p("div",$y,[p("div",Py,[p("span",Ly,se(m.name),1),p("span",Iy,"Lv."+se(m.level),1)]),p("span",Oy,se(u(m.enemy_type)),1)]),p("div",Dy,[p("div",Ny,[h[5]||(h[5]=p("span",{class:"stat-label"},"",-1)),p("span",Gy,se(m.health),1)]),p("div",Hy,[h[6]||(h[6]=p("span",{class:"stat-label"},"",-1)),p("span",Uy,se(m.attack),1)]),p("div",Fy,[h[7]||(h[7]=p("span",{class:"stat-label"},"",-1)),p("span",By,se(m.defense),1)]),p("div",jy,[h[8]||(h[8]=p("span",{class:"stat-label"},"",-1)),p("span",zy,se(m.attack_range),1)]),p("div",Vy,[h[9]||(h[9]=p("span",{class:"stat-label"},"",-1)),p("span",Wy,se(m.move_range),1)])]),p("div",Ky,se(m.description),1),((x=a.value)==null?void 0:x.name)===m.name?(D(),U("div",qy,"   ")):Se("",!0)],10,Ry)}),128))])]),p("div",Xy,[p("button",{class:"btn btn-cancel",onClick:c},""),p("button",{class:"btn btn-confirm",disabled:!a.value,onClick:l},"  ",8,Yy)])])])):Se("",!0)]))}},Zy=ft(Jy,[["__scopeId","data-v-cecd3d8d"]]),Qy={key:0,class:"minimized-content"},e0={class:"minimized-info"},t0={class:"minimized-name"},s0={class:"minimized-action"},n0={key:1},o0={class:"structure-panel__header"},a0={class:"structure-panel__title"},i0={class:"structure-panel__body"},r0={class:"structure-panel__health"},l0={class:"structure-panel__health-bar"},c0={class:"structure-panel__health-text"},u0={key:0,class:"structure-panel__storage"},d0={class:"structure-panel__storage-content"},f0={key:0,class:"structure-panel__storage-item"},p0={class:"structure-panel__storage-name"},h0={class:"structure-panel__storage-count"},m0={key:1,class:"structure-panel__storage-empty"},g0={key:1,class:"structure-panel__ground-resources"},_0={class:"structure-panel__ground-list"},v0={class:"structure-panel__resource-name"},y0={class:"structure-panel__resource-count"},b0={key:2,class:"structure-panel__actions"},w0={__name:"StructurePanel",props:{structure:{type:Object,required:!0},resources:{type:Array,default:()=>[]},actionMode:{type:String,default:null}},emits:["close","action","cancel"],setup(t,{emit:e}){Jt(w=>({v31b4b180:g}));const s=t,n=e,o=$e(()=>{var w;return((w=s.structure.structure_base)==null?void 0:w.name)||""}),a=$e(()=>s.structure.owned||!1),i=$e(()=>{var w;return((w=s.structure.structure_base)==null?void 0:w.has_storage)||!1}),r=$e(()=>s.structure.storage||null),l=$e(()=>s.structure.can_move||!1),c=$e(()=>s.structure.can_attack||!1),u=$e(()=>s.structure.now_health||0),d=$e(()=>{var w;return((w=s.structure.structure_base)==null?void 0:w.health)||100}),h=$e(()=>d.value===0?0:Math.max(0,Math.min(100,u.value/d.value*100))),m=$e(()=>{const w=h.value;return w>60?"#4ade80":w>30?"#facc15":"#ef4444"});G("@assets/ui/panel.png");const g=`url('${G("@assets/ui/panel11.png")}')`,x=$e(()=>s.actionMode!==null),S=$e(()=>s.actionMode==="move"?"...":s.actionMode==="attack"?"...":s.actionMode==="extract"?"...":s.actionMode==="transfer"?"...":"");function _(w){f(`[StructurePanel] : ${w}`),n("action",{type:w})}function M(){f("[StructurePanel] "),n("cancel")}function b(){n("close")}return(w,I)=>(D(),U("div",{class:qe(["structure-panel",{"structure-panel--minimized":x.value}])},[x.value?(D(),U("div",Qy,[p("div",e0,[p("span",t0,se(o.value),1),p("span",s0,se(S.value),1)]),p("div",{class:"minimized-actions"},[p("button",{class:"mini-btn mini-btn--cancel",onClick:M,title:""},"  ")])])):(D(),U("div",n0,[p("div",o0,[p("div",a0,[Ds(se(o.value)+" ",1),p("span",{class:qe(["structure-panel__badge",{"structure-panel__badge--owned":a.value}])},se(a.value?"":""),3)]),p("button",{class:"structure-panel__close",onClick:b,"aria-label":""},"  ")]),p("div",i0,[p("div",r0,[I[4]||(I[4]=p("div",{class:"structure-panel__health-label"},"",-1)),p("div",l0,[p("div",{class:"structure-panel__health-fill",style:Ut({width:h.value+"%",backgroundColor:m.value})},null,4)]),p("div",c0,se(Math.ceil(u.value))+" / "+se(Math.ceil(d.value)),1)]),i.value?(D(),U("div",u0,[I[5]||(I[5]=p("div",{class:"structure-panel__storage-label"},"",-1)),p("div",d0,[r.value?(D(),U("div",f0,[p("span",p0,se(de(ti)(r.value)),1),p("span",h0,"x"+se(r.value.count||0),1)])):(D(),U("div",m0,""))])])):Se("",!0),t.resources&&t.resources.length>0?(D(),U("div",g0,[I[6]||(I[6]=p("div",{class:"structure-panel__ground-label"},"",-1)),p("div",_0,[(D(!0),U(Je,null,Yt(t.resources,(F,z)=>(D(),U("div",{key:z,class:"structure-panel__ground-item"},[p("span",v0,se(F.name||""),1),p("span",y0,"x"+se(F.count||0),1)]))),128))])])):Se("",!0),a.value?(D(),U("div",b0,[l.value?(D(),U("button",{key:0,class:"structure-panel__action-btn structure-panel__action-btn--move",onClick:I[0]||(I[0]=F=>_("move"))},"  ")):Se("",!0),c.value?(D(),U("button",{key:1,class:"structure-panel__action-btn structure-panel__action-btn--attack",onClick:I[1]||(I[1]=F=>_("attack"))},"  ")):Se("",!0),i.value&&r.value?(D(),U("button",{key:2,class:"structure-panel__action-btn structure-panel__action-btn--transfer",onClick:I[2]||(I[2]=F=>_("transfer"))},"  ")):Se("",!0),i.value?(D(),U("button",{key:3,class:"structure-panel__action-btn structure-panel__action-btn--extract",onClick:I[3]||(I[3]=F=>_("extract"))},"  ")):Se("",!0)])):Se("",!0)])]))],2))}},S0=ft(w0,[["__scopeId","data-v-c3c198e2"]]),M0={class:"resource-panel"},T0={class:"resource-list"},x0={class:"resource-layout"},C0={class:"row row-top"},E0=["title"],k0=["src","alt"],A0={class:"resource-count"},R0={class:"resource-tooltip"},$0=["title"],P0=["src","alt"],L0={class:"resource-count"},I0={class:"resource-tooltip"},O0={class:"row row-middle"},D0=["title"],N0=["src","alt"],G0={class:"resource-count"},H0={class:"resource-tooltip"},U0={class:"row row-bottom"},F0=["title"],B0=["src","alt"],j0={class:"resource-count"},z0={class:"resource-tooltip"},V0=["title"],W0=["src","alt"],K0={class:"resource-count"},q0={class:"resource-tooltip"},X0={class:"crafting-section"},Y0={class:"crafting-grid"},J0=["src"],Z0={class:"craft-count"},Q0={class:"craft-arrow-group"},eb=["src","alt"],tb={class:"craft-result"},sb={class:"recipe-display"},nb=["src"],ob={class:"craft-count"},ab={__name:"ResourcePanel",setup(t,{expose:e}){Jt(d=>({v6e6b9dca:n}));const n=`url('${G("@assets/ui/panel5.png")}')`,o=H({SpiritalSpark:0,RecallGear:0,ResonantCrystal:0,RefinedCopper:0,HeartCrystalDust:0}),a=["HeartCrystalDust","RecallGear","ResonantCrystal","RefinedCopper"],i=H(!1),r=H({visible:!1,success:!0,text:""});function l(d,h=!0,m=1500){r.value={visible:!0,success:h,text:d},window.clearTimeout(l._timer),l._timer=window.setTimeout(()=>{r.value.visible=!1},m)}async function c(){if(!i.value){i.value=!0;try{const d=await ap();Ks(Ht.UPDATE_RESOURCES),(d==null?void 0:d.type)==="error"?(console.warn("[ResourcePanel] :",(d==null?void 0:d.content)||d),l("",!1)):(console.log("[ResourcePanel] :",d),l("",!0))}catch(d){console.error("[ResourcePanel] :",d),l("",!1)}finally{i.value=!1}}}async function u(){try{const d=await Fo();if(d){const h={},m={};return Object.keys(o.value).forEach(g=>{const x=o.value[g],S=d[g]||0;m[g]=S;const _=S-x;_>0&&(h[g]=_)}),o.value=m,Ks(Ht.RESOURCES_UPDATED,h),h}}catch(d){console.error("[ResourcePanel] :",d)}return{}}return Dt(()=>{u(),Uo(Ht.UPDATE_RESOURCES,u)}),ms(()=>{ni(Ht.UPDATE_RESOURCES,u)}),e({updateResources:u}),(d,h)=>{var m;return D(),U("div",M0,[h[0]||(h[0]=p("div",{class:"resource-header"},[p("span",{class:"header-text"},"")],-1)),p("div",T0,[p("div",x0,[p("div",C0,[p("div",{class:"resource-slot small",title:de(St)("RecallGear")},[de(rs)("RecallGear")?(D(),U("img",{key:0,src:de(rs)("RecallGear"),alt:de(St)("RecallGear"),class:"resource-icon"},null,8,k0)):Se("",!0),p("div",A0,se(o.value.RecallGear||0),1),p("div",R0,se(de(St)("RecallGear")),1)],8,E0),p("div",{class:"resource-slot small",title:de(St)("HeartCrystalDust")},[de(rs)("HeartCrystalDust")?(D(),U("img",{key:0,src:de(rs)("HeartCrystalDust"),alt:de(St)("HeartCrystalDust"),class:"resource-icon"},null,8,P0)):Se("",!0),p("div",L0,se(o.value.HeartCrystalDust||0),1),p("div",I0,se(de(St)("HeartCrystalDust")),1)],8,$0)]),p("div",O0,[p("div",{class:"resource-slot large",title:de(St)("SpiritalSpark")},[de(rs)("SpiritalSpark")?(D(),U("img",{key:0,src:de(rs)("SpiritalSpark"),alt:de(St)("SpiritalSpark"),class:"resource-icon"},null,8,N0)):Se("",!0),p("div",G0,se(o.value.SpiritalSpark||0),1),p("div",H0,se(de(St)("SpiritalSpark")),1)],8,D0)]),p("div",U0,[p("div",{class:"resource-slot small",title:de(St)("ResonantCrystal")},[de(rs)("ResonantCrystal")?(D(),U("img",{key:0,src:de(rs)("ResonantCrystal"),alt:de(St)("ResonantCrystal"),class:"resource-icon"},null,8,B0)):Se("",!0),p("div",j0,se(o.value.ResonantCrystal||0),1),p("div",z0,se(de(St)("ResonantCrystal")),1)],8,F0),p("div",{class:"resource-slot small",title:de(St)("RefinedCopper")},[de(rs)("RefinedCopper")?(D(),U("img",{key:0,src:de(rs)("RefinedCopper"),alt:de(St)("RefinedCopper"),class:"resource-icon"},null,8,W0)):Se("",!0),p("div",K0,se(o.value.RefinedCopper||0),1),p("div",q0,se(de(St)("RefinedCopper")),1)],8,V0)])])]),p("div",X0,[p("div",Y0,[(D(),U(Je,null,Yt(a,(g,x)=>{var S;return p("div",{class:"craft-slot",key:x},[(S=de(ts)[g])!=null&&S.icon?(D(),U("img",{key:0,src:de(ts)[g].icon,class:"craft-icon"},null,8,J0)):Se("",!0),p("div",Z0,se(o.value[g]||0),1)])}),64))]),p("div",Q0,[p("img",{class:qe(["craft-arrow-img",{disabled:i.value}]),src:de(G)("@assets/ui/upgrade.png"),alt:i.value?"":"",onClick:c},null,10,eb),r.value.visible?(D(),U("div",{key:0,class:qe(["craft-toast",{success:r.value.success,error:!r.value.success}])},se(r.value.text),3)):Se("",!0)]),p("div",tb,[p("div",sb,[(m=de(ts).SpiritalSpark)!=null&&m.icon?(D(),U("img",{key:0,src:de(ts).SpiritalSpark.icon,class:"recipe-icon"},null,8,nb)):Se("",!0),p("div",ob,se(o.value.SpiritalSpark||0),1)])])])])}}},ib=ft(ab,[["__scopeId","data-v-f3ce41a7"]]),rb={key:0,class:"virtual-controls"},lb={class:"joystick-container joystick-left"},cb={class:"joystick-container joystick-right"},ub={class:"vertical-buttons"},Qs=50,db={__name:"VirtualControls",props:{visible:{type:Boolean,default:!0}},emits:["move","rotate","verticalMove"],setup(t,{emit:e}){const s=e,n=H(!1),o=H({x:0,y:0}),a=H({x:0,y:0}),i=H(null),r=H(!1),l=H({x:0,y:0}),c=H({x:0,y:0}),u=H(null),d=H(!1),h=H(!1);function m(le){le.preventDefault();const E=le.touches[0];if(!E)return;i.value=E.identifier;const q=le.target.getBoundingClientRect(),Me=q.left+q.width/2,fe=q.top+q.height/2;o.value={x:Me,y:fe},n.value=!0,S(E.clientX,E.clientY)}function g(le){if(!n.value)return;const E=Array.from(le.touches).find(q=>q.identifier===i.value);E&&S(E.clientX,E.clientY)}function x(le){Array.from(le.changedTouches).find(q=>q.identifier===i.value)&&(n.value=!1,a.value={x:0,y:0},i.value=null,s("move",{x:0,y:0}))}function S(le,E){const q=le-o.value.x,Me=E-o.value.y,fe=Math.sqrt(q*q+Me*Me),he=Math.min(fe,Qs);if(fe>0){const Z=q/fe*he,R=Me/fe*he;a.value={x:Z,y:R},s("move",{x:Z/Qs,y:R/Qs})}}function _(le){le.preventDefault();const E=le.touches[0];if(!E)return;u.value=E.identifier;const q=le.target.getBoundingClientRect(),Me=q.left+q.width/2,fe=q.top+q.height/2;l.value={x:Me,y:fe},r.value=!0,w(E.clientX,E.clientY)}function M(le){if(!r.value)return;const E=Array.from(le.touches).find(q=>q.identifier===u.value);E&&w(E.clientX,E.clientY)}function b(le){Array.from(le.changedTouches).find(q=>q.identifier===u.value)&&(r.value=!1,c.value={x:0,y:0},u.value=null,s("rotate",{x:0,y:0}))}function w(le,E){const q=le-l.value.x,Me=E-l.value.y,fe=Math.sqrt(q*q+Me*Me),he=Math.min(fe,Qs);if(fe>0){const Z=q/fe*he,R=Me/fe*he;c.value={x:Z,y:R},s("rotate",{x:Z/Qs,y:R/Qs})}}function I(){d.value=!0,s("verticalMove",{up:!0,down:!1})}function F(){d.value=!1,s("verticalMove",{up:!1,down:h.value})}function z(){h.value=!0,s("verticalMove",{up:!1,down:!0})}function B(){h.value=!1,s("verticalMove",{up:d.value,down:!1})}const N=$e(()=>({transform:`translate(${a.value.x}px, ${a.value.y}px)`})),ie=$e(()=>({transform:`translate(${c.value.x}px, ${c.value.y}px)`}));return(le,E)=>t.visible?(D(),U("div",rb,[p("div",lb,[E[0]||(E[0]=p("div",{class:"joystick-label"},"",-1)),p("div",{class:"joystick-base",onTouchstart:m,onTouchmove:g,onTouchend:x,onTouchcancel:x},[p("div",{class:qe(["joystick-stick",{active:n.value}]),style:Ut(N.value)},null,6)],32)]),p("div",cb,[E[1]||(E[1]=p("div",{class:"joystick-label"},"",-1)),p("div",{class:"joystick-base",onTouchstart:_,onTouchmove:M,onTouchend:b,onTouchcancel:b},[p("div",{class:qe(["joystick-stick",{active:r.value}]),style:Ut(ie.value)},null,6)],32)]),p("div",ub,[p("button",{class:qe(["vertical-button up-button",{pressed:d.value}]),onTouchstart:Lt(I,["prevent"]),onTouchend:Lt(F,["prevent"]),onTouchcancel:Lt(F,["prevent"])},"  ",34),p("button",{class:qe(["vertical-button down-button",{pressed:h.value}]),onTouchstart:Lt(z,["prevent"]),onTouchend:Lt(B,["prevent"]),onTouchcancel:Lt(B,["prevent"])},"  ",34)])])):Se("",!0)}},fb=ft(db,[["__scopeId","data-v-50616a1e"]]),pb={class:"game-scene"},hb={key:7,class:"info-panel"},mb={key:8,class:"game-over-overlay"},gb={key:9,class:"game-over-overlay"},_b={key:10,class:"credits-overlay"},vb={key:11,class:"game-over-overlay"},yb=["src"],bb=["src"],wb=["src"],Sb=["src"],Mb=["src"],Tb=["src"],xb=["src"],Cb={__name:"GameScene",props:{isGameMode:{type:Boolean,default:!1},musicOn:{type:Boolean,default:!0}},emits:["back"],setup(t,{emit:e}){Jt(k=>({v68129cc4:Ic,v6811b406:Oc}));const s=t,n=H(null),o=e,a=H(null),i=n_("gameScene"),r=H(null),l=H(null),c=H(null),u=H(null),d=H(null),h=H(null),m=Zs("move"),g=Zs("moveEnemy"),x=Zs("attack"),S=Zs("attackEnemy"),_=Zs("meHurt"),M=Zs("enemyHurt");let b,w,I,F,z=[],N={focusPosition:null,focusTarget:null,lerpFactor:pr().focusLerpFactor},ie=null,le=new kt,E=null,q=null,Me=null;const fe=new Map,he={w:!1,a:!1,s:!1,d:!1,shift:!1,space:!1},R=pr().moveSpeed,ce=H("mobile"),K=H(.002),O=H({x:0,y:0}),J=H({x:0,y:0}),Q=H({up:!1,down:!1});window.updateControlMode=k=>{ce.value=k,f(`[GameScene] : ${k}`)},window.updateMouseSensitivity=k=>{K.value=k};function Oe(k){O.value=k}function je(k){J.value=k}function Ve(k){Q.value=k}function Ge(k){const A=k.key.toLowerCase();A==="w"||A==="a"||A==="s"||A==="d"?he[A]=!0:A==="shift"?he.shift=!0:A===" "?(he.space=!0,k.preventDefault()):A==="escape"&&document.pointerLockElement&&document.exitPointerLock()}function et(k){const A=k.key.toLowerCase();A==="w"||A==="a"||A==="s"||A==="d"?he[A]=!1:A==="shift"?he.shift=!1:A===" "&&(he.space=!1)}let at=!1,nt=0,Ct=0,y=0,T=0,P=!1;function Y(k){k.button===0&&(ce.value==="mouse"&&n.value&&n.value.requestPointerLock(),at=!0,nt=k.clientX,Ct=k.clientY)}function j(){at=!1}function V(k){if(ce.value==="touchpad"){if(!at)return;const A=k.clientX-nt,W=k.clientY-Ct;T-=A*K.value,y-=W*K.value,nt=k.clientX,Ct=k.clientY}else if(ce.value==="mouse"&&P){const A=k.movementX||0,W=k.movementY||0;T-=A*K.value,y-=W*K.value}y=Math.max(-Math.PI/2,Math.min(Math.PI/2,y)),w.rotation.order="YXZ",w.rotation.y=T,w.rotation.x=y}function ae(){P=document.pointerLockElement===n.value,f(P?"[GameScene] ":"[GameScene] ")}function ne(){f("[GameScene] ")}const $=H(null),X=H([]),pe=H(null),re=H(!1),me=H([]),_e=H([]),ge=H(null),He=H(null),Pe=H(!1),Xe=H(null),ut=H([]),lt=H(null),vt=H(1),Ue=H([]),tt=H(-1),ue=H(null),it=H(!1),Zt=H(new Set),Es=H(!1),zn=new Map,zo=H(!1),Vo=H(!1),Vn=H(!1),Wn=H(!1),tc=$e(()=>{if(Ue.value.length===0||tt.value<0||tt.value>=Ue.value.length)return null;const k=Ue.value[tt.value];return k?k.id:null});Dt(async()=>{var A;f("[GameScene] "),sc(),f("[GameScene] "),ic(),f("[GameScene] ");const{messageQueue:k}=await Vl(async()=>{const{messageQueue:W}=await Promise.resolve().then(()=>np);return{messageQueue:W}},void 0,import.meta.url);if((A=k.sceneContext)!=null&&A.setTestMode&&k.sceneContext.setTestMode("eventloop"),window.__ACTUAL_COPPER_IDS__){const W=window.__ACTUAL_COPPER_IDS__;f("[GameScene] ID:",W);const ee=JSON.stringify({type:"on_game_start",content:{ids:W}});Ee(ee).catch(ve=>{f("[GameScene] ",ve)}),delete window.__ACTUAL_COPPER_IDS__}else f("[GameScene] ID");window.addEventListener("keydown",Ge),window.addEventListener("keyup",et),window.addEventListener("mousedown",Y),window.addEventListener("mouseup",j),window.addEventListener("mousemove",V),document.addEventListener("pointerlockchange",ae),document.addEventListener("pointerlockerror",ne),ii(),s.musicOn&&a.value&&setTimeout(()=>{if(a.value.readyState>=2)a.value.play().then(()=>{f("[GameScene] ")}).catch(ee=>{f("[GameScene] :",ee)});else{const ee=()=>{a.value.play().then(()=>{f("[GameScene] ")}).catch(ve=>{f("[GameScene] :",ve)}),a.value.removeEventListener("canplay",ee)};a.value.addEventListener("canplay",ee,{once:!0})}},200)}),Bt(()=>s.musicOn,k=>{if(a.value)if(k)if(a.value.readyState>=2)a.value.play().catch(A=>{f("[GameScene] :",A)});else{const A=()=>{a.value.play().catch(W=>{f("[GameScene] :",W)}),a.value.removeEventListener("canplay",A)};a.value.addEventListener("canplay",A)}else a.value.pause()}),ms(()=>{window.removeEventListener("resize",ai),window.removeEventListener("click",ri),window.removeEventListener("keydown",Ge),window.removeEventListener("keyup",et),window.removeEventListener("mousedown",Y),window.removeEventListener("mouseup",j),window.removeEventListener("mousemove",V),document.removeEventListener("pointerlockchange",ae),document.removeEventListener("pointerlockerror",ne),document.pointerLockElement&&document.exitPointerLock(),a.value&&a.value.pause(),E&&E.dispose(),q&&q.dispose(),Me&&Me.dispose(),b&&f_(b),I&&I.dispose()});function sc(){b=new To;const k=Gg();a_(b,k),w=r_(),ie=new gi,I=l_(n.value),F=null;const A=Wg();i_(b,A),d_(b),c_(),s.isGameMode&&window.addEventListener("click",ri),u_(b,z),E=Og(b,w),q=Zg(b),Me=e_(b),f("[GameScene] "),f('[GameScene] - /(ID=1,2)""'),f("[GameScene] - EventLoop"),window.addEventListener("resize",ai)}async function nc(k,A,W,ee=1){const ve=Go(k,A);try{const v=await jt.loadModel(ve,!0);f(`[GameScene] : ${A}`);const C=v.clone(!0);C.traverse(be=>{be.material&&(Array.isArray(be.material)?be.material=be.material.map(we=>we.clone()):be.material=be.material.clone())});const te=new Rt().setFromObject(C).getSize(new ke),oe=new es;oe.add(C),oe.position.set(W[0],0,W[1]),oe.scale.set(ee,ee,ee),oe.rotation.y=0;const ye=new Rt().setFromObject(oe);return oe.position.y=-ye.min.y,f(`[GameScene] : ${A}, URL: ${ve}`),oe}catch(v){return f(`[GameScene] : ${A}`,v),null}}async function oc(k,A,W=1,ee="model"){try{const ve=await jt.loadModel(k,!0);f(`[GameScene] : ${ee}, url=${k}`);const v=ve.clone(!0);v.traverse(oe=>{oe.material&&(Array.isArray(oe.material)?oe.material=oe.material.map(ye=>ye.clone()):oe.material=oe.material.clone())});const L=new Rt().setFromObject(v).getSize(new ke),te=new es;return te.add(v),te.position.set(A[0],0,A[1]),te.scale.set(W,W,W),te}catch(ve){return f(`[GameScene] : ${ee}, url=${k}, error=${ve}`),null}}async function ac(k,A,W=1){const ee=Ho(k);try{const ve=await jt.loadModel(ee,!0);f(`[GameScene] : ${k}`);const v=ve.clone(!0);v.traverse(be=>{be.material&&(Array.isArray(be.material)?be.material=be.material.map(we=>we.clone()):be.material=be.material.clone())});const L=new Rt().setFromObject(v).getSize(new ke),te=new es;te.add(v),te.position.set(A[0],0,A[1]),te.scale.set(W,W,W),te.rotation.y=0;const oe=new Rt().setFromObject(te);te.position.y=-oe.min.y;const ye=new tn(16729156,2.5,12);return ye.position.set(0,L.y*W*.8,0),te.add(ye),f(`[GameScene] : ${k}, URL: ${ee}`),te}catch(ve){return f(`[GameScene] : ${k}`,ve),null}}let Kn=null;function ic(){const k=new Map,A=new Map,W=new Map;function ee(v,C,L){const te=z.find(we=>we.id===v);if(!te||!te.object)return;let oe,ye;C==="move"?(oe=65280,ye=.8):C==="attack"?(oe=16711680,ye=1):C==="summon"?(oe=16776960,ye=1.2):(oe=16777215,ye=1),k.has(v)||k.set(v,{});const be=k.get(v);if(be[C]&&(b.remove(be[C]),be[C].geometry.dispose(),be[C].material.dispose(),delete be[C]),L){const we=new _a(ye-.1,ye,32),Re=new _t({color:oe,side:Ft,transparent:!0,opacity:.6}),Le=new st(we,Re);Le.rotation.x=-Math.PI/2,Le.position.set(te.object.position.x,.1,te.object.position.z),b.add(Le),be[C]=Le}}const ve=v=>{if(z.forEach(C=>{C.object&&(C.object.scale.set(1,1,1),C.object.traverse(L=>{var te;L.material&&((te=L.material.emissive)==null||te.setHex(0),L.material.emissiveIntensity!==void 0&&(L.material.emissiveIntensity=0))}))}),v!==null){const C=z.find(L=>L.id===v);if(C){C.object.scale.set(1.1,1.1,1.1),C.object.traverse(te=>{te.material&&te.material.emissive&&(te.material.emissive.setHex(16755200),te.material.emissiveIntensity=.5)});const L=C.type==="summon"?"":C.type==="copper"?"":"";f(`[GameScene] ${L}: ${C.name} (ID=${v})`)}}};Kn=(v,C)=>{const L=z.find(dt=>dt.id===v);if(!L)return;const te=new Map;L.object.traverse(dt=>{dt.material&&dt.material.emissive&&(te.set(dt,{color:dt.material.emissive.getHex(),intensity:dt.material.emissiveIntensity||0}),dt.material.emissive.setHex(16711680),dt.material.emissiveIntensity=.8)}),setTimeout(()=>{te.forEach((dt,Qt)=>{Qt.material&&Qt.material.emissive&&(Qt.material.emissive.setHex(dt.color),Qt.material.emissiveIntensity=dt.intensity)})},500);const oe=new ke(L.object.position.x,.5,L.object.position.z),ye=new ke(C[0],.5,C[1]),be=new ke().subVectors(ye,oe),we=be.length(),Re=new ke().addVectors(oe,ye).multiplyScalar(.5),Le=new uo(.05,.05,we,8),xe=new _t({color:16729156,transparent:!0,opacity:.9,emissive:16729156,emissiveIntensity:.5}),Ie=new st(Le,xe);Ie.position.copy(Re),Ie.quaternion.setFromUnitVectors(new ke(0,1,0),be.normalize()),b.add(Ie);const Fe=new _a(.2,.4,32),We=new _t({color:16711680,side:Ft,transparent:!0,opacity:.8,emissive:16711680,emissiveIntensity:.5}),wt=new st(Fe,We);wt.rotation.x=-Math.PI/2,wt.position.copy(ye),b.add(wt);const Hs=performance.now(),pt=300;function ht(){const Qt=(performance.now()-Hs)/pt;if(Qt<1){const mn=1-Qt;xe&&(xe.opacity=mn),We&&(We.opacity=mn),wt.scale.set(1+Qt*2,1+Qt*2,1),requestAnimationFrame(ht)}else b.remove(Ie),b.remove(wt),Le.dispose(),xe.dispose(),Fe.dispose(),We.dispose()}ht(),f(`[GameScene] : ID=${v}, =${oe.x.toFixed(1)},${oe.z.toFixed(1)}  [${C[0]},${C[1]}]`)},Ce.setSceneContext({scene:b,camera:w,controls:F,models:z,gridCellSize:1,focusState:N,focusOnModel:rc,onShowCopperInfo:(v,C,L)=>{var oe,ye,be,we,Re,Le,xe,Ie,Fe,We,wt;f(`[GameScene] onShowCopperInfo : type=${(oe=v.copper)==null?void 0:oe.copper_type}, can_build=${v.can_build}, can_summon=${v.can_summon}`),((ye=v.copper)==null?void 0:ye.copper_type)==="CraftsMan"&&v.id!==void 0&&zn.set(v.id,v.can_build===!0);const te=((we=(be=v.copper)==null?void 0:be.copper_info)==null?void 0:we.name)||v.name||((Le=(Re=v.enemy)==null?void 0:Re.enemy_base)==null?void 0:Le.name)||((Ie=(xe=v.enemy)==null?void 0:xe.enemy_base)==null?void 0:Ie.enemy_type)||((Fe=v.enemy_base)==null?void 0:Fe.name)||((We=v.enemy_base)==null?void 0:We.enemy_type)||` #${v.id}`;((wt=v.copper)==null?void 0:wt.copper_type)==="CraftsMan"?(f(`[GameScene]  can_build=${v.can_build}  can_summon`),$.value={...v,name:te,can_summon:v.can_build===!0}):$.value={...v,name:te},X.value=C||[],re.value=L||!1,f(`[GameScene] : ID=${$.value.id}, has_attack_targets=${re.value}, can_summon=${$.value.can_summon}`)},onShowStructureInfo:(v,C)=>{var L;ge.value=v,He.value={structure:v,resources:C},f(`[GameScene] : ID=${v.id}, =${(L=v.structure_base)==null?void 0:L.name}, =${v.now_health}/${v.structure_base.health}`)},highlightSelectedCopper:ve,createAttackEffect:Kn,onMoveStart:(v,C)=>{s.isGameMode&&it.value&&(C==null?void 0:C.type)==="enemy"&&!(C!=null&&C.isOwned)&&(f(`[GameScene]  ${v} `),Zt.value.add(v))},onMoveComplete:v=>{if(!s.isGameMode)return;const C=z.find(ye=>ye.id===v);if((C==null?void 0:C.type)==="structure"){f("[GameScene] "),ue.value=null,Es.value=!1,setTimeout(async()=>{await hn(v)},300);return}if((C==null?void 0:C.type)==="enemy"&&!(C!=null&&C.isOwned)){it.value&&Zt.value.has(v)?(f(`[GameScene]  ${v} `),Zt.value.delete(v),Zt.value.size===0&&(f("[GameScene] "),it.value=!1)):f(`[GameScene]  ${v} `);return}const te=Ue.value.some(ye=>ye.id===v),oe=(C==null?void 0:C.type)==="summon"||(C==null?void 0:C.isOwned);!te&&!oe||(Es.value=!1,f("[GameScene] "),ue.value=null,pe.value&&pe.value.cancelAction(),setTimeout(async()=>{(C==null?void 0:C.type)==="summon"?await qn(v,!1):await Gs(v),setTimeout(()=>{if(X.value&&X.value.length>0){f("[GameScene] ");return}ci()},100)},300))},onCraftResult:(v,C)=>{f(`[GameScene] : ${v?"":""} - ${C}`),alert(C)},onResourceNotEnough:v=>{f(`[GameScene] : ${v}`),alert(` ${v}`),ue.value=null,lt.value=null,Pe.value=!1,Xe.value=null},onSummonFailed:v=>{f(`[GameScene] : ${v}`),alert(` ${v}`),ue.value=null,Pe.value=!1,Xe.value=null},onShowSummonMenu:v=>{f("[GameScene] :",v),ut.value=v||[]},onShowStructureMenu:v=>{var C;f("[GameScene] ",(v==null?void 0:v.length)||0,""),(C=pe.value)!=null&&C.showBuildMenu?pe.value.showBuildMenu(v||[]):f("[GameScene]  copperActionPanelRef.value.showBuildMenu ")},onRemoveCopper:v=>{const C=Ue.value.findIndex(L=>L.id===v);C>-1&&(f(`[GameScene] : ID=${v}`),Ue.value.splice(C,1),$.value&&$.value.id===v&&Wo(),Ue.value.length===0||tt.value===C?tt.value=-1:tt.value>C?tt.value-=1:tt.value>=Ue.value.length&&(tt.value=Ue.value.length-1))},onShowResourceGain:(v,C)=>{f("[GameScene] :",v,C),Me&&Object.keys(C).length>0&&Me.createResourceGainEffect(v,C)},onGameOver:()=>{f("[GameScene] "),zo.value=!0},onGameSuccess:()=>{f("[GameScene] "),Vo.value=!0},onAttackComplete:v=>{if(!s.isGameMode)return;const C=z.find(te=>te.id===v);if((C==null?void 0:C.type)==="structure"){f("[GameScene] "),ue.value=null,setTimeout(async()=>{await hn(v)},300);return}if(!Ue.value.some(te=>te.id===v)){f("[GameScene] ");return}f("[GameScene] "),ue.value=null,pe.value&&pe.value.cancelAction(),setTimeout(async()=>{(C==null?void 0:C.type)==="summon"?await qn(v,!1):await Gs(v),setTimeout(()=>{if(X.value&&X.value.length>0){f("[GameScene] ");return}ci()},100)},300)},onSetMoveBlock:v=>{q&&q.createIndicator(v,"move"),f(`[GameScene] : =${v}`)},onSetAttackBlock:v=>{if(ue.value==="transferring"){me.value.push(v);const C=z.find(L=>{if(L.type==="copper"&&L.object){const te=L.object.position;return Math.abs(te.x-v[0])<.1&&Math.abs(te.z-v[1])<.1}return!1});if(C){const L=Ue.value.find(oe=>oe.id===C.id);_e.value.find(oe=>oe.id===C.id)||(_e.value.push({id:C.id,name:C.name||(L?L.name:` #${C.id}`)||` #${C.id}`,position:v}),f(`[GameScene] : ${C.name||C.id} (ID=${C.id}), =${_e.value.length}`))}else f(`[GameScene]  ${v} `)}else q&&q.createIndicator(v,"attack"),re.value=!0,f(`[GameScene] : ${v}`)},onSetCanSummonBlock:v=>{q&&q.createIndicator(v,"summon"),f(`[GameScene] : =${v}`)},onClearBlock:v=>{q&&q.clearIndicatorAt(v)},onSetCopper:async(v,C,L)=>{var xe,Ie,Fe,We,wt,Hs;if(f(`[GameScene] : id=${L.id}, pos=${C}`),z.find(pt=>pt.id===L.id)){f(`[GameScene] ID=${L.id}`);return}if(((xe=L.copper)==null?void 0:xe.copper_type)==="CraftsMan"&&(zn.set(L.id,L.can_build===!0),f(`[GameScene]  can_build : id=${L.id}, can_build=${L.can_build}`)),s.isGameMode){const pt={id:L.id,name:((Ie=L.copper.copper_info)==null?void 0:Ie.name)||` #${L.id}`,level:Number(((Fe=L.copper)==null?void 0:Fe.level)??0),turnDone:!1};Ue.value.find(ht=>ht.id===L.id)||(Ue.value.push(pt),f(`[GameScene] : ${pt.name}`))}const oe=L.copper.copper_type||"Arcanist",ye=((We=L.copper.copper_info)==null?void 0:We.name)||"default",be=(wt=L.copper.copper_info)==null?void 0:wt.model_url;let we=1;switch(oe){case"IronWall":we=1.2;break;case"Arcanist":we=1;break;case"Mechanic":we=1.1;break;case"Resonator":we=1;break;case"CraftsMan":we=1;break;default:we=1}let Re;if(be&&be.includes("/enemy/")){const pt=G(be);if(f(`[GameScene] URL: ${be} -> ${pt}`),Re=await oc(pt,C,we,ye),Re){const dt=new Rt().setFromObject(Re).getSize(new ke),Qt=new Rt().setFromObject(Re);Re.position.y=-Qt.min.y;const mn=new tn(4474111,2.5,12);mn.position.set(0,dt.y*we*.8,0),Re.add(mn)}}else{const pt=$g(ye),ht=Pg(oe);f(`[GameScene] : =${ye}, =${pt}, type=${oe}, typeFolder=${ht}`),Re=await nc(ht,pt,C,we)}if(!Re){f(`[GameScene] : ${ye}`);const pt=new us(.8,.8,.8);let ht=4491519;switch(oe){case"IronWall":ht=8947848;break;case"Arcanist":ht=16729224;break;case"Mechanic":ht=4521864;break;case"Resonator":ht=16755268;break;case"CraftsMan":ht=4474111;break}const dt=new gt({color:ht});Re=new st(pt,dt),Re.position.set(C[0],.4,C[1])}Re.userData.modelId=L.id,b.add(Re);const Le={id:L.id,object:Re,name:((Hs=L.copper.copper_info)==null?void 0:Hs.name)||`Copper_${L.id}`,type:"copper"};z.push(Le),f(`[GameScene] : ${Le.name} (ID=${L.id})`)},onSetEnemy:async(v,C,L)=>{var Ie,Fe,We,wt,Hs;const te=L.id,oe=L.owned||!1;if(f(`[GameScene] : id=${te}, pos=${C}, owned=${oe}`),z.find(pt=>pt.id===te)){f(`[GameScene] ID=${te}`);return}const we=(((Ie=L.enemy_base)==null?void 0:Ie.enemy_type)||"").toLowerCase()||"goblin";let Re=1;switch(we){case"demon":case"glutton":case"devourer":Re=1.5;break;case"guard":case"horn":Re=1.2;break;default:Re=1}const Le={id:te,object:null,name:((Fe=L.enemy_base)==null?void 0:Fe.enemy_type)||`Enemy_${te}`,type:oe?"summon":"enemy",position:C,isOwned:oe,isLoading:!0};z.push(Le);let xe=await ac(we,C,Re);if(!xe){f(`[GameScene] : ${we}`);const pt=new us(.8,.8,.8),ht=new gt({color:oe?4474111:16711680});xe=new st(pt,ht),xe.position.set(C[0],.4,C[1])}if(oe&&xe){const ht=new Rt().setFromObject(xe).getSize(new ke),dt=new tn(4474111,2.5,12);dt.position.set(0,ht.y*Re*.8,0),xe.add(dt),f(`[GameScene] : ${we}`)}xe.userData.modelId=te,b.add(xe),Le.object=xe,Le.isLoading=!1,L.now_health!==void 0&&((We=L.enemy_base)==null?void 0:We.health)!==void 0&&E&&(E.createOrUpdateHealthBar(te,L.now_health,L.enemy_base.health),f(`[GameScene] : ${we} (${L.now_health}/${L.enemy_base.health})`)),oe&&(Ue.value.push({id:te,name:((wt=L.enemy_base)==null?void 0:wt.name)||we,type:"summon",enemy:L}),f(`[GameScene] : ${we} (ID=${te})`)),f(`[GameScene] : ${((Hs=L.enemy_base)==null?void 0:Hs.enemy_type)||te}, owned=${oe}`)},onSetMaterial:async(v,C,L)=>{var Re,Le,xe;if(f(`[GameScene] : id=${v}, pos=${C}, name=${(Re=L.material_base)==null?void 0:Re.name}`),z.find(Ie=>Ie.id===v)){f(`[GameScene] ID=${v}`);return}const oe=((Le=L.material_base)==null?void 0:Le.name)||"",ye=(xe=L.material_base)==null?void 0:xe.model_url;if(!ye){f("[GameScene] model_url");const Ie=new us(.5,.5,.5),Fe=new gt({color:16755200,metalness:.3,roughness:.7}),We=new st(Ie,Fe);We.position.set(C[0],.25,C[1]),We.userData.modelId=v,b.add(We),z.push({id:v,object:We,name:oe||`Material_${v}`,type:"material"});return}const be=qf(ye);let we=null;try{const Ie=await jt.loadModel(be,!0),Fe=new es;Fe.add(Ie),Fe.position.set(C[0],0,C[1]),Fe.scale.set(1,1,1),Fe.rotation.y=0;const We=new Rt().setFromObject(Fe);Fe.position.y=-We.min.y,we=Fe,f(`[GameScene] : ${oe}, URL: ${be}`)}catch(Ie){f(`[GameScene] : ${oe}`,Ie);const Fe=new us(.5,.5,.5),We=new gt({color:16755200,metalness:.3,roughness:.7});we=new st(Fe,We),we.position.set(C[0],.25,C[1])}we.userData.modelId=v,b.add(we),z.push({id:v,object:we,name:oe||`Material_${v}`,type:"material"}),f(`[GameScene] : ${oe}`)},onSetStructure:async(v,C,L)=>{var Re,Le;if(f(`[GameScene] : id=${v}, pos=${C}`),z.find(xe=>xe.id===v)){f(`[GameScene] ID=${v}`);return}const oe=((Re=L.structure_base)==null?void 0:Re.name)||"",ye=Ig(oe),be=zl(ye);let we=null;try{const xe=await jt.loadModel(be,!0),Ie=new es;Ie.add(xe),Ie.position.set(C[0],0,C[1]),Ie.scale.set(1,1,1),Ie.rotation.y=0;const Fe=new Rt().setFromObject(Ie);Ie.position.y=-Fe.min.y,we=Ie,f(`[GameScene] : ${oe}, URL: ${be}`)}catch(xe){f(`[GameScene] : ${oe}`,xe);const Ie=new us(.9,1.2,.9),Fe=new gt({color:6710886,metalness:.5,roughness:.6});we=new st(Ie,Fe),we.position.set(C[0],.6,C[1])}we.userData.modelId=v,b.add(we),z.push({id:v,object:we,name:oe||`Structure_${v}`,type:"structure"}),f(`[GameScene] : ${oe}`),L.now_health!==void 0&&((Le=L.structure_base)!=null&&Le.health)&&E&&(E.createOrUpdateHealthBar(v,L.now_health,L.structure_base.health),f(`[GameScene] : ${oe} (${L.now_health}/${L.structure_base.health})`))},onPutResourceMarker:v=>{const C=`${v[0]},${v[1]}`;if(W.has(C)){const Fe=W.get(C);b.remove(Fe),Fe.traverse(We=>{We.geometry&&We.geometry.dispose(),We.material&&(Array.isArray(We.material)?We.material.forEach(wt=>wt.dispose()):We.material.dispose())}),W.delete(C)}const L=new es,te=new uo(.15,.2,.25,8),oe=new gt({color:16766720,emissive:16755200,emissiveIntensity:.6,metalness:.7,roughness:.3}),ye=new st(te,oe);ye.position.y=.125,L.add(ye);const be=new va(.08,8,8),we=new gt({color:16776960,emissive:16776960,emissiveIntensity:1}),Re=new st(be,we);Re.position.y=.3,L.add(Re);const Le=v[0],xe=v[1];L.position.set(Le,.15,xe);const Ie=new tn(16766720,1.5,3);Ie.position.set(0,.3,0),L.add(Ie),b.add(L),W.set(C,L)},onClearResourceMarker:v=>{const C=`${v[0]},${v[1]}`;if(W.has(C)){const L=W.get(C);b.remove(L),L.traverse(te=>{te.geometry&&te.geometry.dispose(),te.material&&(Array.isArray(te.material)?te.material.forEach(oe=>oe.dispose()):te.material.dispose())}),W.delete(C)}},onDisplayCanMove:(v,C)=>{f(`[GameScene] : id=${v}, show=${C}`),ee(v,"move",C),$.value&&$.value.id===v&&($.value={...$.value,can_move:C},f(`[GameScene] selectedCopper.can_move=${C}`))},onDisplayCanAttack:(v,C)=>{f(`[GameScene] : id=${v}, show=${C}`),ee(v,"attack",C),$.value&&$.value.id===v&&($.value={...$.value,can_attack:C},f(`[GameScene] selectedCopper.can_attack=${C}`))},onDisplayCanSummon:(v,C)=>{var ye;let L=C,te=!1,oe=!1;$.value&&$.value.id===v?(te=((ye=$.value.copper)==null?void 0:ye.copper_type)==="CraftsMan",oe=$.value.can_build===!0):zn.has(v)&&(te=!0,oe=zn.get(v)),te&&(L=oe,f(`[GameScene] : id=${v}, can_build=${L}`)),f(`[GameScene] /: id=${v}, show=${L}`),ee(v,"summon",L),$.value&&$.value.id===v&&($.value={...$.value,can_summon:L},f(`[GameScene] selectedCopper.can_summon=${L}`))},onClearState:v=>{if(f(`[GameScene] : id=${v}`),k.has(v)){const C=k.get(v);C.move&&(b.remove(C.move),C.move.geometry.dispose(),C.move.material.dispose(),delete C.move),C.attack&&(b.remove(C.attack),C.attack.geometry.dispose(),C.attack.material.dispose(),delete C.attack),C.summon&&(b.remove(C.summon),C.summon.geometry.dispose(),C.summon.material.dispose(),delete C.summon),k.delete(v)}},onUpdateHealth:(v,C,L)=>{f(`[GameScene] : id=${v}, hp=${C}/${L}`);const te=fe.get(v);if(te!==void 0&&C<te&&C>0){const oe=z.find(ye=>ye.id===v);if(oe){const ye=oe.type==="copper",be=ye?d.value:h.value;be&&(be.currentTime=0,be.play().catch(we=>{f(`[GameScene]  (${ye?"":""}):`,we)}),f(`[GameScene] : ${ye?"":""} (ID=${v})`))}}fe.set(v,C),E&&E.createOrUpdateHealthBar(v,C,L)},onRemoveHealthBar:v=>{f(`[GameScene] : id=${v}`),E&&E.removeHealthBar(v),fe.delete(v)},onPutMapBlock:v=>{const C=`${v[0]},${v[1]}`;if(A.has(C)){const Le=A.get(C);b.remove(Le),Le.geometry.dispose(),Le.material&&(Le.material.map&&Le.material.map.dispose(),Array.isArray(Le.material)?Le.material.forEach(xe=>{xe.map&&xe.map.dispose(),xe.dispose()}):Le.material.dispose())}const L=Ql();if(!L.enabled)return;const te=L.size||.9,oe=.05,ye=new us(te,oe,te);let be;if(L.materialType==="texture"&&L.texture.url){const xe=new pn().load(L.texture.url);xe.colorSpace=Tt,xe.wrapS=Ms,xe.wrapT=Ms,xe.repeat.set(L.texture.repeat.x,L.texture.repeat.y);const Ie=1;be=new gt({map:xe,transparent:!1,opacity:Ie,depthTest:!0,depthWrite:!0})}else L.materialType==="standard"?be=new gt({color:L.standard.color,roughness:L.standard.roughness,metalness:L.standard.metalness,transparent:!1,opacity:1,depthTest:!0,depthWrite:!0}):be=new _t({color:L.basic.color,transparent:!1,opacity:1,depthTest:!0,depthWrite:!0});const we=new st(ye,be);we.renderOrder=-100;const Re=L.yOffset||0;we.position.set(v[0],oe/2+Re,v[1]),b.add(we),A.set(C,we)},animateModelMove:(v,C,L)=>{if(!v||!v.object)return;const te=v.type==="enemy",oe=te?l.value:r.value;oe&&(oe.currentTime=0,oe.play().catch(xe=>{f(`[GameScene]  (${te?"":""}):`,xe)})),v.isMoving=!0;const ye=v.object.position.clone(),be=new ke(C.x,C.y,C.z),we=500,Re=performance.now();function Le(){if(!v||!v.object){L&&L();return}const xe=performance.now()-Re,Ie=Math.min(xe/we,1),Fe=1-Math.pow(1-Ie,2);v.object.position.lerpVectors(ye,be,Fe),Ie<1?requestAnimationFrame(Le):(v.object.position.copy(be),v.isMoving=!1,L&&L())}Le()},setTestMode:v=>{f(`[GameScene] ${v==="backend"?"":"EventLoop"}`),z.forEach(C=>{C.type==="test"?C.object.visible=v==="backend":(C.type==="copper"||C.type==="enemy")&&(C.object.visible=v==="eventloop")}),f(`[GameScene] ${v==="backend"?"":""}${v==="eventloop"?"":""}EventLoop`)}}),f("[GameScene] ")}function rc(k,A,W){const ee=new ke;k.getWorldPosition(ee);const ve=window.cameraFocusDistance||8,v=window.cameraFocusHeight||6,C=0,L=ve;return{focusPosition:new ke(ee.x+C,ee.y+v,ee.z+L).clone(),focusTarget:ee.clone(),lerpFactor:.1}}function ai(){w.aspect=window.innerWidth/window.innerHeight,w.updateProjectionMatrix(),I.setSize(window.innerWidth,window.innerHeight)}function ii(){requestAnimationFrame(ii);const k=he.w||he.a||he.s||he.d||he.shift||he.space,A=ce.value==="mobile"&&(Math.abs(O.value.x)>.01||Math.abs(O.value.y)>.01||Q.value.up||Q.value.down);if(k||A){const W=new ke;he.w&&(W.z-=1),he.s&&(W.z+=1),he.a&&(W.x-=1),he.d&&(W.x+=1),ce.value==="mobile"&&(W.x+=O.value.x,W.z+=O.value.y),he.shift&&(W.y-=1),he.space&&(W.y+=1),ce.value==="mobile"&&(Q.value.up&&(W.y+=1),Q.value.down&&(W.y-=1)),W.applyQuaternion(w.quaternion),he.shift||he.space||ce.value==="mobile"&&(Q.value.up||Q.value.down)?W.y=he.shift||ce.value==="mobile"&&Q.value.down?-1:1:W.y=0,w.position.add(W.multiplyScalar(R))}ce.value==="mobile"&&(Math.abs(J.value.x)>.01||Math.abs(J.value.y)>.01)&&(T-=J.value.x*.05,y-=J.value.y*.05,y=Math.max(-Math.PI/2,Math.min(Math.PI/2,y)),w.rotation.order="YXZ",w.rotation.y=T,w.rotation.x=y),N.focusPosition&&N.focusTarget&&(w.position.lerp(N.focusPosition,N.lerpFactor),w.lookAt(N.focusTarget),T=w.rotation.y,y=w.rotation.x,w.position.distanceTo(N.focusPosition)<.5&&(f("[GameScene] "),N.focusPosition=null,N.focusTarget=null)),E&&E.updateHealthBarsPosition(z),I.render(b,w)}function ri(k){if(k.target.tagName!=="CANVAS")return;if(le.x=k.clientX/window.innerWidth*2-1,le.y=-(k.clientY/window.innerHeight)*2+1,ie.setFromCamera(le,w),ue.value==="moving"||ue.value==="attacking"||ue.value==="summoning"||ue.value==="building"||ue.value==="transferring"||ue.value==="structureMoving"||ue.value==="structureAttacking"||ue.value==="structureExtract"||ue.value==="structureTransfer"){lc(le);return}const A=z.filter(ee=>(ee.type==="copper"||ee.type==="summon"||ee.type==="enemy"||ee.type==="structure")&&ee.object).map(ee=>ee.object),W=ie.intersectObjects(A,!0);if(W.length>0){let ee=W[0].object;for(;ee.parent&&!ee.userData.modelId;)ee=ee.parent;const ve=ee.userData.modelId;if(ve!==void 0){const v=z.find(te=>te.id===ve),L={copper:"",summon:"",enemy:"",structure:""}[v==null?void 0:v.type]||"";f(`[GameScene] ${L}ID:`,ve),(v==null?void 0:v.type)==="summon"||(v==null?void 0:v.type)==="enemy"?qn(ve,(v==null?void 0:v.type)==="enemy"):(v==null?void 0:v.type)==="structure"?hn(ve):Gs(ve)}}else $.value=null,ge.value=null}async function lc(k){const A=new xr(new ke(0,1,0),0),W=new gi;if(W.setFromCamera(k,w),ue.value==="moving"&&Es.value){f("[GameScene] ");return}const ee=new ke;if(W.ray.intersectPlane(A,ee),ee){const ve=Math.round(ee.x),v=Math.round(ee.z);f(`[GameScene] : (${ve}, ${v})`);const C={moving:"move",attacking:"attack",summoning:"summon",building:"summon",structureMoving:"move",structureAttacking:"attack",structureExtract:"attack",structureTransfer:"attack"}[ue.value];if(!q||!q.hasIndicatorAt([ve,v],C)){f(`[GameScene]  (${ve}, ${v}) `);return}ue.value==="moving"?await cc(ve,v):ue.value==="attacking"?await uc(ve,v):ue.value==="summoning"?await dc(ve,v):ue.value==="building"?await fc(ve,v):ue.value==="structureMoving"?await wc(ve,v):ue.value==="structureAttacking"?await Sc(ve,v):ue.value==="structureExtract"?await Mc(ve,v):ue.value==="structureTransfer"&&await Tc(ve,v)}}async function cc(k,A){if(!$.value)return;if(Es.value){f("[GameScene] ");return}const W=$.value.isOwnedEnemy===!0,ee=W?"on_enemy_move_apply":"on_move_apply";f(`[GameScene] : (${k}, ${A}), =${W?"":""}, =${ee}`);const ve=JSON.stringify({type:ee,content:{id:String($.value.id),position:{x:String(k),y:String(A)}}});Es.value=!0,await Ee(ve)}async function uc(k,A){if(!$.value)return;const W=$.value.isOwnedEnemy===!0,ee=W?"on_enemy_attack_apply":"on_attack_apply";f(`[GameScene] : (${k}, ${A}), =${W?"":""}, =${ee}`);const ve=$.value.id,v=z.find(L=>L.id===ve);if(v){const L=v.type==="enemy",te=L?u.value:c.value;te&&(te.currentTime=0,te.play().catch(oe=>{f(`[GameScene]  (${L?"":""}):`,oe)})),Kn&&Kn(ve,[k,A])}const C=JSON.stringify({type:ee,content:{id:String($.value.id),position:{x:String(k),y:String(A)}}});await Ee(C)}async function dc(k,A){if(!$.value)return;f(`[GameScene] : (${k}, ${A})`),Xe.value=[k,A];const W=JSON.stringify({type:"on_get_summon_menu"});await Ee(W),await new Promise(ee=>setTimeout(ee,100)),Pe.value=!0}async function fc(k,A){if(!$.value||!lt.value)return;f(`[GameScene]  ${lt.value} : (${k}, ${A})`);const W=$.value.id,ee=JSON.stringify({type:"on_structure_build_apply",content:{id:String(W),position:{x:String(k),y:String(A)},name:lt.value}});await Ee(ee),ue.value=null,lt.value=null,pe.value&&pe.value.cancelAction(),await new Promise(ve=>setTimeout(ve,100)),f("[GameScene] "),await Gs(W)}async function pc(k){if(!$.value||!Xe.value)return;const[A,W]=Xe.value;f(`[GameScene]  ${k} : (${A}, ${W})`);try{const ee=JSON.stringify({type:"on_summon_apply",content:{id:String($.value.id),position:{x:String(A),y:String(W)},name:k}});await Ee(ee)}catch(ee){f("[GameScene] :",ee)}finally{Pe.value=!1,ue.value=null,Xe.value=null,pe.value&&pe.value.cancelAction();try{const ee=JSON.stringify({type:"on_summon_end"});await Ee(ee)}catch(ee){f("[GameScene] :",ee)}}}function hc(){Pe.value=!1,Xe.value=null,ue.value=null;const k=JSON.stringify({type:"on_summon_end"});Ee(k).catch(A=>{f("[GameScene] ",A)})}function li(){if(f("[GameScene] "),ue.value==="structureMoving"){const k=JSON.stringify({type:"on_structure_move_end"});Ee(k).catch(A=>{f("[GameScene] ",A)})}else if(ue.value==="structureAttacking"){const k=JSON.stringify({type:"on_structure_attack_end"});Ee(k).catch(A=>{f("[GameScene] ",A)})}else if(ue.value==="structureExtract"){const k=JSON.stringify({type:"on_structure_extract_end"});Ee(k).catch(A=>{f("[GameScene] ",A)})}else if(ue.value==="structureTransfer"){const k=JSON.stringify({type:"on_structure_transfer_end"});Ee(k).catch(A=>{f("[GameScene] ",A)})}ue.value=null}function mc(){li(),ge.value=null,He.value=null,f("[GameScene] ")}async function gc(k){if(!ge.value)return;const A=ge.value.id;switch(f(`[GameScene] : ${k.type}, ID=${A}`),k.type){case"move":await _c(A);break;case"attack":await vc(A);break;case"transfer":await bc(A);break;case"extract":await yc(A);break;default:f("[GameScene] :",k.type)}}async function _c(k){f(`[GameScene]  ${k} `);const A=JSON.stringify({type:"on_structure_move_start",content:{id:String(k)}});await Ee(A),ue.value="structureMoving"}async function vc(k){f(`[GameScene]  ${k} `);const A=JSON.stringify({type:"on_structure_attack_start",content:{id:String(k)}});await Ee(A),ue.value="structureAttacking"}async function yc(k){f(`[GameScene]  ${k} `);const A=JSON.stringify({type:"on_structure_extract_start",content:{id:String(k)}});await Ee(A),ue.value="structureExtract"}async function bc(k){f(`[GameScene]  ${k} `);const A=JSON.stringify({type:"on_structure_transfer_start",content:{id:String(k)}});await Ee(A),ue.value="structureTransfer"}async function wc(k,A){if(!ge.value)return;f(`[GameScene]  ${ge.value.id}  (${k}, ${A})`);const W=JSON.stringify({type:"on_structure_move_apply",content:{id:String(ge.value.id),position:{x:String(k),y:String(A)}}});await Ee(W),ue.value=null}async function Sc(k,A){if(!ge.value)return;f(`[GameScene]  ${ge.value.id}  (${k}, ${A})`);const W=JSON.stringify({type:"on_structure_attack_apply",content:{id:String(ge.value.id),position:{x:String(k),y:String(A)}}});await Ee(W),ue.value=null}async function Mc(k,A){if(!ge.value)return;f(`[GameScene]  ${ge.value.id}  (${k}, ${A}) `);const W=ge.value.id,ee=JSON.stringify({type:"on_structure_extract_apply",content:{id:String(W),position:{x:String(k),y:String(A)}}});await Ee(ee),f("[GameScene] ");const ve=JSON.stringify({type:"on_structure_extract_end"});await Ee(ve),await new Promise(v=>setTimeout(v,100)),f("[GameScene] "),ue.value=null,setTimeout(async()=>{f("[GameScene] "),await hn(W)},300)}async function Tc(k,A){if(!ge.value)return;f(`[GameScene]  ${ge.value.id}  (${k}, ${A}) `);const W=ge.value.id,ee=JSON.stringify({type:"on_structure_transfer_apply",content:{id:String(W),position:{x:String(k),y:String(A)}}});await Ee(ee),f("[GameScene] ");const ve=JSON.stringify({type:"on_structure_transfer_end"});await Ee(ve),await new Promise(v=>setTimeout(v,100)),f("[GameScene] "),ue.value=null,setTimeout(async()=>{f("[GameScene] "),await hn(W)},300)}async function Gs(k){const A=Ue.value.findIndex(ee=>ee.id===k);A!==-1&&(tt.value=A),ge.value=null;const W=JSON.stringify({type:"on_click_copper",content:{id:String(k)}});await Ee(W)}async function hn(k){f(`[GameScene] : ID=${k}`),$.value=null;const A=JSON.stringify({type:"on_click_structure",content:{id:String(k)}});await Ee(A)}async function qn(k,A=!1){if(A)tt.value=-1,Wo();else{const ee=Ue.value.findIndex(ve=>ve.id===k);ee!==-1&&(tt.value=ee)}ge.value=null;const W=JSON.stringify({type:"on_click_enemy",content:{id:String(k)}});await Ee(W)}function Wo(){$.value=null,X.value=[],ue.value=null}async function xc(k){if(f("[GameScene] :",k),k.type==="moveStart")ue.value="moving";else if(k.type==="attackStart")ue.value="attacking";else if(k.type==="summonStart")ue.value="summoning";else if(k.type==="buildRequest"){f("[GameScene] ");const A=JSON.stringify({type:"on_get_structure_menu"});await Ee(A)}else if(k.type==="buildStart")ue.value="building",lt.value=k.structureName||null;else if(k.type==="transferring"||k.type==="transferStart")ue.value="transferring",me.value=[],_e.value=[];else if(k.type==="transferComplete")ue.value=null,me.value=[],_e.value=[];else if(k.type==="cancel"){const A=ue.value;if(A==="moving"){const W=JSON.stringify({type:"on_move_end"});Ee(W).catch(ee=>{f("[GameScene] ",ee)})}else if(A==="attacking"){const W=JSON.stringify({type:"on_attack_end"});Ee(W).catch(ee=>{f("[GameScene] ",ee)})}else if(A==="transferring"){const W=JSON.stringify({type:"on_transfer_end"});Ee(W).catch(ee=>{f("[GameScene] ",ee)}),me.value=[],_e.value=[]}else if(A==="summoning"){const W=JSON.stringify({type:"on_summon_end"});Ee(W).catch(ee=>{f("[GameScene] ",ee)}),Pe.value=!1}else if(A==="building"){const W=JSON.stringify({type:"on_structure_build_end"});Ee(W).catch(ee=>{f("[GameScene] ",ee)}),lt.value=null,Xe.value=null}ue.value=null}else k.type==="wait"&&(f("[GameScene] "),Ko())}function ci(){if(Ue.value.length!==0){if($.value){const k=$.value.can_move,A=$.value.can_attack,W=$.value.can_summon;if(f(`[GameScene] : ID=${$.value.id}, can_move=${k}, can_attack=${A}, can_summon=${W}, hasAttackTargets=${re.value}`),k||A&&re.value||W){f("[GameScene] ");return}}f("[GameScene] "),Ko()}}async function Ko(){var W,ee,ve;if(Ue.value.length===0)return;$.value=null,ue.value=null,tt.value;let k=0;const A=Ue.value.length;for(;k<A;){tt.value=(tt.value+1)%Ue.value.length;const v=Ue.value[tt.value];f(`[GameScene] : ${v.name||v.id} ( ${k+1}/${A})`),await new Promise(ye=>{setTimeout(async()=>{const be=z.find(Re=>Re.id===v.id);(be==null?void 0:be.type)==="summon"?await qn(v.id,!1):await Gs(v.id),ye()},300)}),await new Promise(ye=>setTimeout(ye,200));const C=((W=$.value)==null?void 0:W.can_move)||!1,L=((ee=$.value)==null?void 0:ee.can_attack)||!1,te=((ve=$.value)==null?void 0:ve.can_summon)||!1,oe=C||L&&re.value||te;if(f(`[GameScene]  ${v.name}: can_move=${C}, can_attack=${L}, can_summon=${te}, hasTargets=${re.value}, valid=${oe}`),$.value&&oe){f(`[GameScene] : ${v.name||v.id}`);return}k++}f("[GameScene] "),$.value=null,s.isGameMode&&f('[GameScene] ""')}function Cc(){vt.value++,tt.value=-1,$.value=null,ue.value=null,Ue.value.forEach(A=>A.turnDone=!1),f(`[GameScene]  ${vt.value}`);const k=z.filter(A=>A.type==="enemy"&&!A.isOwned);if(f(`[GameScene]  ${k.length} `),k.length===0)f("[GameScene] "),it.value=!1;else{it.value=!0,Zt.value.clear(),f("[GameScene] ");let A=setTimeout(()=>{it.value&&Zt.value.size>0&&(f("[GameScene] "),it.value=!1,Zt.value.clear())},3e3),W=setInterval(()=>{it.value||(clearTimeout(A),clearInterval(W))},100);setTimeout(()=>{it.value&&Zt.value.size===0&&(f("[GameScene] "),it.value=!1,clearTimeout(A),clearInterval(W))},1e3)}}async function Ec(){f("[GameScene] "),zo.value=!1;const k=JSON.stringify({type:"on_game_over"});await Ee(k).catch(A=>{f("[GameScene]  on_game_over ",A)}),o("back")}async function kc(){f("[GameScene] game over"),Vo.value=!1;const k=JSON.stringify({type:"on_game_over"});await Ee(k).catch(A=>{f("[GameScene]  on_game_over ",A)}),Ac()}function Ac(){f("[GameScene] "),Vn.value=!0,setTimeout(()=>{f("[GameScene] "),Vn.value=!1,o("back")},5e3)}function Rc(){f("[GameScene] "),Vn.value=!1,o("back")}function $c(){f("[GameScene] "),Wn.value=!0}function Pc(){f("[GameScene] "),Wn.value=!1}async function Lc(){f("[GameScene]  game_over "),Wn.value=!1;const k=JSON.stringify({type:"on_game_over"});await Ee(k).catch(A=>{f("[GameScene]  on_game_over ",A)}),o("back")}const Ic=`url('${G("@assets/ui/panel7.png")}')`,Oc=`url('${G("@assets/ui/panel8.png")}')`;return(k,A)=>{var W,ee,ve,v;return D(),U("div",pb,[p("div",{ref_key:"container",ref:n,class:"scene-container"},null,512),t.isGameMode?(D(),Pt(Sy,{key:0,currentCopperId:tc.value,copperList:Ue.value,roundNumber:vt.value,isEnemyMoving:it.value,onNextCopper:Ko,onEndRound:Cc,onSelectCopper:Gs},null,8,["currentCopperId","copperList","roundNumber","isEnemyMoving"])):Se("",!0),t.isGameMode?(D(),U("button",{key:1,class:"withdraw-button",onClick:$c},"  ")):Se("",!0),t.isGameMode?(D(),Pt(ib,{key:2})):Se("",!0),t.isGameMode?(D(),Pt(fb,{key:3,visible:!0,onMove:Oe,onRotate:je,onVerticalMove:Ve})):Se("",!0),t.isGameMode&&$.value?(D(),Pt(ry,{key:4,ref_key:"copperActionPanelRef",ref:pe,copper:$.value,resources:X.value,hasAttackTargets:re.value,transferTargets:_e.value,onSelectCopper:Gs,onClose:Wo,onAction:xc},null,8,["copper","resources","hasAttackTargets","transferTargets"])):Se("",!0),t.isGameMode?(D(),Pt(Zy,{key:5,visible:Pe.value,"copper-name":((ve=(ee=(W=$.value)==null?void 0:W.copper)==null?void 0:ee.copper_info)==null?void 0:ve.name)||"","enemy-list":ut.value,position:Xe.value,onClose:hc,onSummon:pc},null,8,["visible","copper-name","enemy-list","position"])):Se("",!0),t.isGameMode&&ge.value?(D(),Pt(S0,{key:6,structure:ge.value,resources:((v=He.value)==null?void 0:v.resources)||[],"action-mode":ue.value==="structureMoving"?"move":ue.value==="structureAttacking"?"attack":ue.value==="structureExtract"?"extract":ue.value==="structureTransfer"?"transfer":null,onClose:mc,onAction:gc,onCancel:li},null,8,["structure","resources","action-mode"])):Se("",!0),t.isGameMode?Se("",!0):(D(),U("div",hb,[...A[0]||(A[0]=[bo('<h3 data-v-0b1d6d7a>3D</h3><p style="color:#ffd700;font-weight:600;" data-v-0b1d6d7a> </p><div style="margin:8px 0;padding:8px;background:rgba(255, 255, 255, 0.1);border-radius:6px;" data-v-0b1d6d7a><p style="font-weight:600;" data-v-0b1d6d7a> </p><p style="font-size:12px;" data-v-0b1d6d7a>  = ID:1</p><p style="font-size:12px;" data-v-0b1d6d7a>  = ID:2</p></div><div style="margin:8px 0;padding:8px;background:rgba(255, 255, 255, 0.1);border-radius:6px;" data-v-0b1d6d7a><p style="font-weight:600;" data-v-0b1d6d7a> EventLoop</p><p style="font-size:12px;" data-v-0b1d6d7a>1.   EventLoop</p><p style="font-size:12px;" data-v-0b1d6d7a>2. &quot; &quot;</p><p style="font-size:12px;" data-v-0b1d6d7a>3. 3</p><p style="font-size:11px;" data-v-0b1d6d7a>  =IronWall  =Arcanist  =CraftsMan </p></div>',4)])])),zo.value?(D(),U("div",mb,[p("div",{class:"game-over-dialog"},[A[1]||(A[1]=p("h2",{class:"game-over-title"},"",-1)),A[2]||(A[2]=p("p",{class:"game-over-message"},"",-1)),p("button",{class:"game-over-button",onClick:Ec},"  ")])])):Se("",!0),Vo.value?(D(),U("div",gb,[p("div",{class:"game-over-dialog success-dialog"},[A[3]||(A[3]=p("h2",{class:"success-title"},"  ",-1)),A[4]||(A[4]=p("p",{class:"game-over-message"},"",-1)),p("button",{class:"game-over-button success-button",onClick:kc},"  ")])])):Se("",!0),Vn.value?(D(),U("div",_b,[p("div",{class:"credits-container"},[A[5]||(A[5]=bo('<h1 class="credits-title" data-v-0b1d6d7a></h1><div class="credits-content" data-v-0b1d6d7a><div class="credits-section" data-v-0b1d6d7a><h2 data-v-0b1d6d7a></h2><p data-v-0b1d6d7a>MGPIC Team</p></div><div class="credits-section" data-v-0b1d6d7a><h2 data-v-0b1d6d7a></h2><p data-v-0b1d6d7a>Backend Developer</p><p data-v-0b1d6d7a>Frontend Developer</p></div><div class="credits-section" data-v-0b1d6d7a><h2 data-v-0b1d6d7a></h2><p data-v-0b1d6d7a>3D Artist</p><p data-v-0b1d6d7a>UI Designer</p></div><div class="credits-section" data-v-0b1d6d7a><h2 data-v-0b1d6d7a></h2><p data-v-0b1d6d7a>Sound Designer</p></div><div class="credits-section" data-v-0b1d6d7a><h2 data-v-0b1d6d7a></h2><p data-v-0b1d6d7a></p></div></div>',2)),p("button",{class:"skip-credits-button",onClick:Rc},"")])])):Se("",!0),Wn.value?(D(),U("div",vb,[p("div",{class:"game-over-dialog"},[A[6]||(A[6]=p("h2",{class:"withdraw-title"},"",-1)),A[7]||(A[7]=p("p",{class:"game-over-message"},[Ds(""),p("br"),Ds("")],-1)),p("div",{class:"dialog-buttons"},[p("button",{class:"dialog-button cancel-button",onClick:Pc},"  "),p("button",{class:"dialog-button confirm-button",onClick:Lc},"  ")])])])):Se("",!0),p("audio",{ref_key:"audioRef",ref:a,src:de(i),loop:"",preload:"auto"},null,8,yb),p("audio",{ref_key:"moveSoundRef",ref:r,src:de(m),preload:"auto"},null,8,bb),p("audio",{ref_key:"moveEnemySoundRef",ref:l,src:de(g),preload:"auto"},null,8,wb),p("audio",{ref_key:"attackSoundRef",ref:c,src:de(x),preload:"auto"},null,8,Sb),p("audio",{ref_key:"attackEnemySoundRef",ref:u,src:de(S),preload:"auto"},null,8,Mb),p("audio",{ref_key:"meHurtSoundRef",ref:d,src:de(_),preload:"auto"},null,8,Tb),p("audio",{ref_key:"enemyHurtSoundRef",ref:h,src:de(M),preload:"auto"},null,8,xb)])}}},Eb=ft(Cb,[["__scopeId","data-v-0b1d6d7a"]]),kb={class:"stage"},Ab={key:0,style:{position:"relative",width:"100%",height:"100%"}},Rb={key:2,class:"modal"},$b={class:"modal-title"},Pb={key:2,class:"overlay",style:{"z-index":"30000","align-items":"flex-start","justify-content":"flex-start",background:"rgba(0, 0, 0, 0.25)"}},Lb={class:"settings"},Ib={class:"settings__header"},Ob=["src"],Db={class:"settings__content"},Nb={__name:"App",setup(t){const e=H(!1),s=H(null),n=H(!1),o=H(null),a=H([]);H(0);const i=H(!0),r=H(!1),l=H(!1);let c=null;function u(B){s.value!==B&&(a.value.push(s.value),s.value=B),window.__START_MENU_PAUSE__&&window.__START_MENU_PAUSE__(),e.value=!0}function d(){i.value=!1,c&&clearTimeout(c),c=setTimeout(()=>{i.value||(f("[App] StartMenu"),l.value=!0)},5*60*1e3)}function h(){s.value=null,a.value=[],window.__START_MENU_RESUME__&&window.__START_MENU_RESUME__(),e.value=!1}function m(B){f("[App] ID:",B.ids),h(),r.value=!0,f("[App] ")}function g(){r.value=!1}function x(){n.value=!0,e.value=!0}function S(){n.value=!1,s.value||(window.__START_MENU_RESUME__&&window.__START_MENU_RESUME__(),e.value=!1)}function _(){if(n.value){S();return}if(s.value){if(s.value==="warehouse"&&o.value&&o.value.handleBack&&o.value.handleBack())return;const B=a.value.pop()??null;s.value=B,B||(e.value=!1);return}if(!i.value){c&&(clearTimeout(c),c=null),l.value&&(l.value=!1,f("[App] StartMenu")),i.value=!0,setTimeout(()=>{window.__INIT_THREE_SCENE__?window.__INIT_THREE_SCENE__().then(()=>{window.__START_MENU_RESUME__&&window.__START_MENU_RESUME__()}).catch(()=>{window.__START_MENU_RESUME__&&window.__START_MENU_RESUME__()}):window.__START_MENU_RESUME__&&window.__START_MENU_RESUME__()},100),e.value=!1;return}}const M=H(!0),b=H(null);function w(){M.value=!M.value,f("[App] :",M.value?"":"")}async function I(){try{f("[App] ...");const B=await lp();if(B.type==="error"){f("[App] :",B.content),alert(": "+B.content);return}f("[App] ...");const N=new Blob([JSON.stringify(B,null,2)],{type:"application/json"}),ie=document.createElement("a");ie.href=URL.createObjectURL(N);const le=new Date().toISOString().replace(/[:.]/g,"-").slice(0,-5);ie.download=`mgpic-save-${le}.json`,ie.click(),URL.revokeObjectURL(ie.href),f("[App] ")}catch(B){f("[App] :",B),alert("")}}function F(){try{b.value&&b.value.click()}catch{}}async function z(B){try{const N=B.target&&B.target.files&&B.target.files[0];if(!N)return;f("[App] ...");const ie=new FileReader;ie.onload=async()=>{try{const le=String(ie.result||"{}"),E=JSON.parse(le);f("[App] ..."),await rp(le),f("[App] "),alert("")}catch(le){f("[App] :",le),alert(": "+le.message)}B.target.value=""},ie.onerror=()=>{f("[App] "),alert(""),B.target.value=""},ie.readAsText(N)}catch(N){f("[App] :",N),alert("")}}return Dt(()=>{Kl(B=>{})}),ms(()=>{c&&(clearTimeout(c),c=null)}),(B,N)=>(D(),U("div",kb,[r.value?(D(),Pt(Eb,{key:0,isGameMode:!0,"music-on":M.value,onBack:g},null,8,["music-on"])):Se("",!0),r.value?Se("",!0):(D(),U(Je,{key:1},[l.value?Se("",!0):ol((D(),Pt(Bm,{key:0,visible:i.value,onStarted:d},null,8,["visible"])),[[Fl,i.value]]),i.value?Se("",!0):(D(),Pt(lr,{key:1,"music-on":M.value,onBack:_,onOpenSettings:x,onToggleMusic:w},null,8,["music-on"])),ot(Zf,{"music-on":M.value,paused:s.value==="start"||s.value==="warehouse"||r.value,onStartGame:N[0]||(N[0]=ie=>u("start")),onOpenWarehouse:N[1]||(N[1]=ie=>u("warehouse")),onOpenTutorial:N[2]||(N[2]=ie=>u("tutorial")),onOpenEncyclopedia:N[3]||(N[3]=ie=>u("encyclopedia")),onToggleMusic:w},null,8,["music-on","paused"]),s.value?(D(),U("div",{key:2,class:qe(["overlay",{"overlay--warehouse":s.value==="warehouse"}])},[s.value==="warehouse"?(D(),U("div",Ab,[ot(lr,{"music-on":M.value,onBack:_,onOpenSettings:x,onToggleMusic:w},null,8,["music-on"]),ot(ym,{ref_key:"warehouseRef",ref:o,"music-on":M.value},null,8,["music-on"])])):s.value==="start"?(D(),Pt(kg,{key:1,"music-on":M.value,paused:r.value,onClose:h,onConfirm:m},null,8,["music-on","paused"])):(D(),U("div",Rb,[p("h2",$b,se(s.value==="warehouse"?"  Copper Warehouse":s.value==="tutorial"?"  Tutorial":s.value==="encyclopedia"?"  Game Encyclopedia":"  Start Game"),1),N[4]||(N[4]=p("p",{class:"modal-body"},"",-1)),p("button",{class:"close-btn",onClick:h},"")]))],2)):Se("",!0)],64)),n.value?(D(),U("div",Pb,[p("div",Lb,[p("div",Ib,[N[5]||(N[5]=p("div",{class:"settings__title"},"",-1)),p("button",{class:"settings__close",onClick:S,"aria-label":""},[p("img",{src:de(G)("@assets/ui/close.png"),alt:""},null,8,Ob)])]),p("div",Db,[p("button",{class:"settings__item",onClick:I},[...N[6]||(N[6]=[bo('<span class="settings__icon" data-v-b00c8af0><svg width="44" height="44" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-b00c8af0><path d="M12 3v12m0 0l-4-4m4 4l4-4" stroke="#fff" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" data-v-b00c8af0></path><path d="M4 19h16" stroke="#fff" stroke-width="2" stroke-linecap="round" data-v-b00c8af0></path></svg></span><span class="settings__label" data-v-b00c8af0></span>',2)])]),p("button",{class:"settings__item",onClick:F},[...N[7]||(N[7]=[bo('<span class="settings__icon" data-v-b00c8af0><svg width="44" height="44" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-b00c8af0><path d="M12 21V9m0 0l4 4m-4-4L8 13" stroke="#fff" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" data-v-b00c8af0></path><path d="M4 5h16" stroke="#fff" stroke-width="2" stroke-linecap="round" data-v-b00c8af0></path></svg></span><span class="settings__label" data-v-b00c8af0></span>',2)])]),p("input",{ref_key:"fileInput",ref:b,type:"file",accept:".json",onChange:z,style:{display:"none"}},null,544)])])])):Se("",!0)]))}},hr=ft(Nb,[["__scopeId","data-v-b00c8af0"]]);function Gb(){const t=navigator.userAgent;return/Safari/.test(t)&&!/Chrome/.test(t)&&!/Chromium/.test(t)}function Hb(){const t=document.getElementById("safari-warning"),e=document.getElementById("loading-screen");t.style.display="flex",e.style.display="none",document.getElementById("download-local").addEventListener("click",()=>{window.open("https://github.com/MGPIC-2025/Cross/releases","_blank")}),document.getElementById("continue-safari").addEventListener("click",()=>{t.style.display="none",e.style.display="flex",ec()}),document.getElementById("download-chrome").addEventListener("click",()=>{window.open("https://www.google.com/chrome/","_blank")})}function pa(t,e,s,n=""){const o=document.getElementById("progress-bar"),a=document.getElementById("progress-text"),i=document.querySelector(".loading-subtitle");o&&(o.style.width=s+"%"),a&&(t===0&&e===0?a.textContent=`${s}%`:a.textContent=`${t} / ${e} (${s}%)`),i&&n&&(i.textContent=n)}function mr(){const t=document.getElementById("loading-screen");t&&(t.classList.add("fade-out"),setTimeout(()=>{t.style.display="none"},500))}async function ec(){try{f("..."),await La(pa,["high"]),f(""),pa(0,100,100,"..."),Qi(hr).mount("#app"),await new Promise(e=>setTimeout(e,200)),window.__INIT_THREE_SCENE__&&await window.__INIT_THREE_SCENE__((e,s,n)=>{pa(0,0,n,`3D... ${n}%`)}),f(""),setTimeout(()=>{mr()},300),setTimeout(async()=>{try{f("..."),await La(null,["medium"]),f("")}catch(e){f(":",e)}},1e3)}catch(t){f(":",t),Qi(hr).mount("#app"),mr()}}Gb()?(f("Safari"),Hb()):(f("Safari"),ec());
